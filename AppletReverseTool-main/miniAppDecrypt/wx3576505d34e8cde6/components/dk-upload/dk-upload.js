(global.webpackJsonp=global.webpackJsonp||[]).push([["components/dk-upload/dk-upload"],{"3d09":function(e,t,i){"use strict";i.r(t);var n=i("c800"),o=i.n(n);for(var a in n)["default"].indexOf(a)<0&&function(e){i.d(t,e,(function(){return n[e]}))}(a);t.default=o.a},"6bc0":function(e,t,i){"use strict";i.d(t,"b",(function(){return o})),i.d(t,"c",(function(){return a})),i.d(t,"a",(function(){return n}));var n={uIcon:function(){return i.e("node-modules/uview-ui/components/u-icon/u-icon").then(i.bind(null,"83fd"))},uLazyLoad:function(){return i.e("node-modules/uview-ui/components/u-lazy-load/u-lazy-load").then(i.bind(null,"aeb0"))},shmilyDragImage:function(){return i.e("uni_modules/shmily-drag-image/components/shmily-drag-image/shmily-drag-image").then(i.bind(null,"88ec"))},dkCompress:function(){return i.e("components/dk-compress/dk-compress").then(i.bind(null,"d4d9"))},yyPrivacyPopup:function(){return i.e("components/yy-privacy-popup/yy-privacy-popup").then(i.bind(null,"cedb"))}},o=function(){var e=this,t=(e.$createElement,e._self._c,e.is_sort?null:e.uploadLists.length<e.max&&e.add),i=e.is_sort?null:e.__map(e.uploadLists,(function(t,i){return{$orig:e.__get_orig(t),g1:/.(gif|jpg|jpeg|png|gif|jpg|png)$/.test(t)}}));e.$mp.data=Object.assign({},{$root:{g0:t,l0:i}})},a=[]},"6e98":function(e,t,i){"use strict";var n=i("7f1d");i.n(n).a},"77ab":function(e,t,i){"use strict";i.r(t);var n=i("6bc0"),o=i("3d09");for(var a in o)["default"].indexOf(a)<0&&function(e){i.d(t,e,(function(){return o[e]}))}(a);i("6e98");var s=i("828b"),u=Object(s.a)(o.default,n.b,n.c,!1,null,null,null,!1,n.a,void 0);t.default=u.exports},"7f1d":function(e,t,i){},c800:function(e,t,i){"use strict";(function(e,n){var o=i("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=o(i("7eb4")),s=o(i("ee10")),u=i("942a"),c=i("ae87"),r={name:"htz-image-upload",props:{is_sort:{type:Boolean,default:!1},max:{type:Number,default:1},chooseNum:{type:Number,default:9},name:{type:String,default:"file"},remove:{type:Boolean,default:!0},add:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},sourceType:{type:Array,default:function(){return["album","camera"]}},action:{type:String,default:"https://up-z2.qiniup.com"},headers:{type:Object,default:function(){}},compress:{type:Boolean,default:!0},quality:{type:Number,default:80},value:{type:Array,default:function(){return[]}},uploadSuccess:{default:function(e){return{success:!1,url:""}}},mediaType:{type:String,default:"image"},maxDuration:{type:Number,default:60},camera:{type:String,default:"back"},dirName:{type:String,default:"default"},size:{type:String,default:"default"},poster:{type:String,default:void 0},is_hd:{type:Number,default:2},is_img:{type:String,default:""},img_size:{type:Number||String,default:120},margin_img:{type:Number||String,default:20}},computed:{imgDesc:function(){return this.uploadLists.length+"/"+this.max+this.is_img}},data:function(){return{keyExt:void 0,formData:{token:void 0,key:void 0},uploadLists:[],mediaTypeData:["image","video","all"],previewVideoSrc:""}},mounted:function(){this.formData.token=this.vuex_qiniu.token,this.$nextTick((function(){this.uploadLists=this.value,-1===this.mediaTypeData.indexOf(this.mediaType)&&e.showModal({title:"提示",content:"mediaType参数不正确",showCancel:!1,success:function(e){e.confirm||e.cancel}})}))},watch:{value:function(e,t){console.log("更新图片数据",e),this.$set(this,"uploadLists",e)},uploadLists:function(e){this.$emit("input",this.uploadLists)}},methods:{previewVideo:function(e){this.previewVideoSrc=e},previewVideoClose:function(){this.previewVideoSrc=""},imgDel:function(t){var i=this;e.showModal({title:"提示",content:"您确定要删除么?",success:function(e){if(e.confirm){var n=i.uploadLists[t];i.uploadLists.splice(t,1),i.$emit("input",i.uploadLists),i.$emit("imgDelete",{del:n,tempFilePaths:i.uploadLists})}else e.cancel}})},imgInit:function(e){var t=this.uploadLists[e];this.uploadLists.splice(e,1),this.$emit("input",this.uploadLists),this.$emit("imgDelete",{del:t,tempFilePaths:this.uploadLists})},imgPreview:function(t){var i=this.uploadLists.filter((function(e){return/.(gif|jpg|jpeg|png|gif|jpg|png)$/.test(e)}));e.previewImage({urls:i,current:t,loop:!0})},chooseFile:function(){var t=this;if(this.vuex_privacy)this.$pribacy({success:function(){t.chooseFile()}});else{if(this.disabled)return this.vuex_other.sign_video_warn?this.$u.toast(this.vuex_other.sign_video_warn):void 0;switch(this.mediaTypeData.indexOf(this.mediaType)){case 1:this.videoAdd();break;case 2:e.showActionSheet({itemList:["相册","视频"],success:function(e){1==e.tapIndex?t.videoAdd():0==e.tapIndex&&t.imgAdd()},fail:function(e){console.log(e.errMsg)}});break;default:this.imgAdd()}}},videoAdd:function(){var t,i=this;console.log("videoAdd"),this.keyExt=".mp4";var n=Math.abs(this.uploadLists.length-this.max);this.chooseNum>n||this.chooseNum,t=1==this.vuex_file_handling.video_compress,e.chooseVideo({compressed:t,sourceType:this.sourceType,camera:this.camera,maxDuration:this.maxDuration,success:function(e){i.$emit("videoDetail",e),i.chooseSuccessMethod([e.tempFilePath],1)},fail:function(e){-1==e.errMsg.indexOf("cancel")?console.log(e):(0,u.toast)("已取消上传")}})},imgAdd:function(){var t=this;console.log("imgAdd"),this.keyExt=".png";var i=Math.abs(this.uploadLists.length-this.max),o=this.chooseNum>i?i:this.chooseNum;console.log("nowNum",i),console.log("thisNum",o),e.showActionSheet({itemList:["拍摄","从相册选择","从聊天选择"],success:function(i){var a=i.tapIndex;if(2===a)n.chooseMessageFile({count:o,type:"image",success:function(e){var i=e.tempFiles;console.info(i),t.chooseSuccessMethod(i.map((function(e){return e.path})),0)}});else{var s=0===a?"camera":"album",c=1===t.vuex_other.is_hd?["original","compressed"]:["compressed"];e.chooseImage({count:o,sizeType:c,sourceType:[s],success:function(e){console.log(e.tempFiles);for(var i=0;i<e.tempFiles.length;i++)if(e.tempFiles[i].size>1024*t.vuex_file_handling.image_size*1024)return void(0,u.showModel)("提示","单张图片高于".concat(t.vuex_file_handling.image_size,"M图片，如有需求请联系客服免费调整"));t.chooseSuccessMethod(e.tempFilePaths,0)}})}},fail:function(e){console.log(e.errMsg)}})},appCamera:function(){var e=this,t=plus.camera.getCamera(),i=t.supportedImageResolutions[0],n=t.supportedImageFormats[0];t.captureImage((function(t){e.chooseSuccessMethod([t],0)}),(function(e){console.log("Capture image failed: "+e.message)}),{resolution:i,format:n})},appGallery:function(e){var t=this;plus.gallery.pick((function(e){console.log(e),t.chooseSuccessMethod(e.files,0)}),(function(e){}),{filter:"image",multiple:!0,maximum:e})},chooseSuccessMethod:function(e,t){var i=this;return(0,s.default)(a.default.mark((function n(){return a.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:console.log("获取路径",e,t),""==i.action?i.$emit("chooseSuccess",e,t):1==t?(console.log("filePaths",e),i.imgUpload(e)):i.imgCompress(e);case 2:case"end":return n.stop()}}),n)})))()},imgCompress:function(t){var i=this;return(0,s.default)(a.default.mark((function n(){var o,s,c;return a.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,o=t,2!==i.is_hd){n.next=28;break}if(1!=i.vuex_file_handling.image_compress){n.next=20;break}return setTimeout((function(){e.showLoading({title:"压缩中。。。",mask:!0})}),300),console.log("开始压缩481"),n.prev=6,n.next=9,i.$refs.compress.batchCompress({batchSrc:t,quality:i.quality/100});case 9:o=n.sent,n.next=16;break;case 12:n.prev=12,n.t0=n.catch(6),console.log("压缩失败",n.t0),(0,u.toast)("压缩失败");case 16:console.log(o,"111111"),e.showLoading({title:"检测中。。。",mask:!0}),n.next=21;break;case 20:setTimeout((function(){e.showLoading({title:"检测中。。。",mask:!0})}),300);case 21:console.log("开始验证"),s=[],c=[],o.forEach((function(e){s.push(i.mediaCheck(e,2).then((function(t){c.push(e)})).catch((function(e){i.$u.toast("验证失败，请重试"),console.log(e)})))})),Promise.all(s).then((function(e){i.imgUpload(c)})),n.next=29;break;case 28:i.imgUpload(t);case 29:n.next=35;break;case 31:n.prev=31,n.t1=n.catch(0),e.hideLoading(),i.$u.toast("压缩失败，请重试");case 35:case"end":return n.stop()}}),n,null,[[0,31],[6,12]])})))()},imgUpload:function(t){var i=this;return(0,s.default)(a.default.mark((function n(){var o;return a.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:e.showLoading({title:"上传中。。。",mask:!0}),i.formData,o=[],t.forEach((function(t,n){o.push(new Promise((function(n,o){i.$qiniu.upload(t,function(){var t=(0,s.default)(a.default.mark((function t(s){var u,r;return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.hideLoading(),!(u=s.key)){t.next=8;break}r=i.vuex_qiniu.domain+"/"+u,i.$emit("uploadSuccess",r),n(r),t.next=12;break;case 8:return t.next=10,(0,c.getConfig)();case 10:i.$u.toast("上传失败，请重试"),o();case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),(function(e){o(e)}),(0,c.getQiNiuOptions)(i.dirName+String(2==i.vuex_file_handling.image_examine?2:"")+String(1==i.vuex_file_handling.image_compress?"":"_ys"+i.vuex_file_handling.image_compress),i.keyExt))})))})),Promise.all(o).then((function(t){e.hideLoading()})).catch((function(t,n){(0,c.getConfig)(),e.hideLoading(),i.$emit("uploadFail",t)}));case 5:case"end":return n.stop()}}),n)})))()},canvasDataURL:function(e,t,i){var n=new Image;n.src=e,n.onload=function(){var e=this.width,n=this.height,o=e/n;e=t.width||e,n=t.height||e/o;var a=.8,s=document.createElement("canvas"),u=s.getContext("2d"),c=document.createAttribute("width");c.nodeValue=e;var r=document.createAttribute("height");r.nodeValue=n,s.setAttributeNode(c),s.setAttributeNode(r),u.drawImage(this,0,0,e,n),t.quality&&t.quality<=1&&t.quality>0&&(a=t.quality);var l=s.toDataURL("image/jpeg",a);i(l)}},delImage:function(t){e.showModal({title:"提示",content:"您确定要删除么?",success:function(e){e.confirm&&t()}})}}};t.default=r}).call(this,i("df3c").default,i("3223").default)}}]),(global.webpackJsonp=global.webpackJsonp||[]).push(["components/dk-upload/dk-upload-create-component",{"components/dk-upload/dk-upload-create-component":function(e,t,i){i("df3c").createComponent(i("77ab"))}},[["components/dk-upload/dk-upload-create-component"]]]);