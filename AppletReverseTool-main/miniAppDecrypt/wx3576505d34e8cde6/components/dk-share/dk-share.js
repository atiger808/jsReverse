(global.webpackJsonp=global.webpackJsonp||[]).push([["components/dk-share/dk-share"],{"57a0":function(e,t,n){"use strict";(function(e,a){var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,c,i=r(n("7eb4")),u=r(n("34cf")),s=r(n("ee10")),p=n("ae87"),l=n("7c3f"),d=n("818f"),f=n("942a"),h=e.upx2px(564),x=e.upx2px(289),m=0,g=0,v={name:"dk-share",props:{headerImg:{type:String,default:""},title:{type:String,default:"草莓千层蛋糕"},subTitle:{type:String,default:"鲜嫩多汁的草莓融合香甜奶油"},desc:{type:String,default:""},scene:{type:String,default:void 0},path:{type:String,default:void 0},showOffica:{type:Boolean,default:!1},top:{type:[Number,String],default:0},mainTit:{type:String,default:"参与投票"},creator:{type:Boolean,default:!1},type:{type:[Number,String],default:1},pid:{type:Number,default:0},isAd:{type:Boolean,default:!0},filePath:{type:String,default:void 0}},data:function(){return{tempFilePath:void 0,canvasW:e.upx2px(650),canvasH:e.upx2px(900),isShow:!1,share:l.SHARE_IMG,qrcode:void 0,qrcode_local:void 0,h5Url:"",flexHeight:0}},created:function(){},mounted:function(){},methods:{toShare:function(){this.$emit("share")},showModel:function(){(0,f.showModel)("提示","")},handleShare:function(e){var t=this;return(0,s.default)(i.default.mark((function n(){var a,r;return i.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:a={appId:l.APP_ID,sid:(0,f.getData)().sid||(0,f.getData)().id,type:t.type},t.pid&&(a.pId=t.pid),r="",n.t0=e,n.next="h5"===n.t0?6:"web"===n.t0?9:12;break;case 6:return r="https://www.toupiao168.vip/h5/#/?".concat((0,f.objAsStr)(a)),t.$u.route({url:"/pages-son/one/index/h5",params:{url:encodeURIComponent(r)}}),n.abrupt("break",14);case 9:return r="https://www.toupiao168.vip/voting_real_time/#/?".concat((0,f.objAsStr)(a),"&multiId=1"),t.$u.route({url:"/pages-son/one/index/h5",params:{url:encodeURIComponent(r),type:"web"}}),n.abrupt("break",14);case 12:return t.$u.route({url:"/pages-son/one/index/official-account-desc",params:{path:encodeURIComponent(t.path+"?"+(0,f.objAsStr)(a)),img_src:t.headerImg}}),n.abrupt("break",14);case 14:case"end":return n.stop()}}),n)})))()},getH5Url:function(){var e=this;return(0,s.default)(i.default.mark((function t(){var n,a,r,o,c;return i.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log(e.scene,"actId=495&pId=2182",l.APP_ID),n=e.scene.split("&").map((function(e){return e.split("=")[1]})),a=(0,u.default)(n,2),r=a[0],o=a[1],c="actId="+(0,d.encrypt)(r),o&&(c+="&pId="+(0,d.encrypt)(o)),t.next=6,e.$u.api.urlScheme({path:e.path,scene:c}).then(function(){var t=(0,s.default)(i.default.mark((function t(n){var a,r,o;return i.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:console.log(n),a=n.split("="),(r=(0,u.default)(a,2))[0],o=r[1],e.h5Url=o;case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 6:case"end":return t.stop()}}),t)})))()},showCanvas:function(){var t=this;return(0,s.default)(i.default.mark((function n(){var r,o,c,u,s,l;return i.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t.isShow=!0,setTimeout((function(){e.createSelectorQuery().in(t).select("#content").boundingClientRect((function(e){console.log("获取到content",e.height),t.flexHeight=Math.floor(.8*e.height)})).exec()}),100),t.qrcode){n.next=24;break}r="voting",n.t0=t.type,n.next=2===n.t0?7:3===n.t0?9:4===n.t0?11:13;break;case 7:return r="simple",n.abrupt("break",15);case 9:return r="solitaire",n.abrupt("break",15);case 11:return r="multiple",n.abrupt("break",15);case 13:return r="voting",n.abrupt("break",15);case 15:return o={sid:(0,f.getData)().sid||(0,f.getData)().id},t.pid&&(o.pId=t.pid),n.next=19,a.getAccountInfoSync();case 19:return c=n.sent,n.next=22,t.$u.api.getCode({path:t.path,scene:(0,f.objAsStr)(o),show_splash_ad:t.isAd,type:r,env_version:c.miniProgram.envVersion});case 22:t.qrcode=n.sent,e.getImageInfo({src:t.qrcode,success:function(e){var n=e.path;t.qrcode_local=n}});case 24:if(!t.filePath){n.next=28;break}e.getImageInfo({src:t.filePath,success:function(e){t.tempFilePath=e.path,t.canvasH=e.height*(650/e.width),t.canvasW=650}}),n.next=38;break;case 28:if(t.tempFilePath){n.next=38;break}return n.next=31,(0,p.getImageInfo)(t.headerImg);case 31:u=n.sent,s=u.width,l=u.height,m=e.upx2px(l)*(h/e.upx2px(s)),g=m-x,t.canvasH=t.canvasH+g,t.$nextTick((function(){this.__init()}));case 38:case"end":return n.stop()}}),n)})))()},__init:function(){var t=this;return(0,s.default)(i.default.mark((function n(){return i.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:e.createSelectorQuery().in(t).select("#my-canvas").fields({node:!0,size:!0}).exec(function(){var n=(0,s.default)(i.default.mark((function n(a){var r,u,s,p,l,d,f,x,v,b;return i.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log(1122,a),c=a[0].node,o=c.getContext("2d"),r=e.getSystemInfoSync().pixelRatio,c.width=a[0].width*r,c.height=a[0].height*r,o.scale(r,r),o.fillStyle="#FFFFFF",o.fillRect(0,0,t.canvasW,t.canvasH),t.drawRoundRect(o,0,0,t.canvasW,t.canvasH,e.upx2px(24),"#FFFFFF"),u=(t.canvasW-h)/2,s=e.upx2px(518),p=e.upx2px(64),(l=c.createImage()).src=t.share,n.next=17,t.imgOnload(l);case 17:return o.drawImage(l,u,e.upx2px(58),s,p),(d=c.createImage()).src=t.headerImg,n.prev=20,n.next=23,t.imgOnload(d);case 23:n.next=30;break;case 25:return n.prev=25,n.t0=n.catch(20),d.src=t.headerImg+"?imageView2/0/w/600",n.next=30,t.imgOnload(d);case 30:return f=d.width,x=d.height,console.log("图片",d.src,f,x),t.drawRoundImg(o,d,u,e.upx2px(169),h,m),o.font="bold normal 16px sans-serif",o.fillStyle="black",v=g,console.log("extraHeight",g),t.title.length>19?(o.fillText(t.title.slice(0,19),u,e.upx2px(508)+v,e.upx2px(512)),t.title.length>37?o.fillText(t.title.slice(19,36)+"...",u,e.upx2px(548)+v,e.upx2px(512)):o.fillText(t.title.slice(19,36),u,e.upx2px(548)+v,e.upx2px(512))):o.fillText(t.title,u,e.upx2px(508)+v,e.upx2px(512)),o.font="13px sans-serif",o.fillStyle="#666666",o.fillText(t.desc,e.upx2px(55),e.upx2px(591)+v),t.drawDashLine(o,20,e.upx2px(645)+v,t.canvasW-e.upx2px(20),e.upx2px(645)+v,5),t.drawEmptyRound(o,0,e.upx2px(645)+v,e.upx2px(20)),t.drawEmptyRound(o,t.canvasW,e.upx2px(645)+v,e.upx2px(20)),o.font="normal bold ".concat(e.upx2px(36),"px sans-serif"),o.fillStyle="#121212",o.fillText("长按识别  "+t.mainTit,e.upx2px(253),e.upx2px(760)+v),o.font="".concat(e.upx2px(30),"px sans-serif"),o.fillStyle="#333333",o.fillText("为每一个梦想助力",e.upx2px(296),e.upx2px(810)+v),(b=c.createImage()).src=t.qrcode,n.next=54,t.imgOnload(b);case 54:o.drawImage(b,e.upx2px(28),e.upx2px(670)+v,e.upx2px(198),e.upx2px(198)),setTimeout((function(){e.canvasToTempFilePath({canvas:c,quality:1,complete:function(e){t.tempFilePath=e.tempFilePath}},t)}),300);case 56:case"end":return n.stop()}}),n,null,[[20,25]])})));return function(e){return n.apply(this,arguments)}}());case 1:case"end":return n.stop()}}),n)})))()},imgOnload:function(e){return new Promise((function(t,n){e.onload=function(e){t()},e.onerror=function(){n("海报生成失败，请重试。。。")}}))},drawEmptyRound:function(e,t,n,a){e.save(),e.beginPath(),e.arc(t,n,a,0,2*Math.PI,!0),e.fillStyle="rgba(0, 0, 0, 0.6)",e.fill(),e.restore(),e.closePath()},drawDashLine:function(e,t,n,a,r,o){e.strokeStyle="#cccccc",e.lineWidth=1;for(var c=o,i=a-t,u=r-n,s=Math.floor(Math.sqrt(i*i+u*u)/c),p=0;p<s;p++)p%2==0?e.moveTo(t+i/s*p,n+u/s*p):e.lineTo(t+i/s*p,n+u/s*p);e.stroke()},drawRoundImg:function(t,n,a,r,o,c){var i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:e.upx2px(16);t.beginPath(),t.save(),t.arc(a+i,r+i,i,Math.PI,1.5*Math.PI),t.arc(a+o-i,r+i,i,1.5*Math.PI,2*Math.PI),t.arc(a+o-i,r+c-i,i,0,.5*Math.PI),t.arc(a+i,r+c-i,i,.5*Math.PI,Math.PI),t.clip(),t.drawImage(n,a,r,o,c),t.restore(),t.closePath()},drawRoundRect:function(e,t,n,a,r,o,c){e.save(),e.beginPath(),e.fillStyle=c,e.strokeStyle=c,e.lineJoin="round",e.lineWidth=o,e.strokeRect(t+o/2,n+o/2,a-o,r-o),e.fillRect(t+o,n+o,a-2*o,r-2*o),e.stroke(),e.closePath()}},beforeDestroy:function(){o=null},options:{styleIsolation:"shared"}};t.default=v}).call(this,n("df3c").default,n("3223").default)},"5a0a":function(e,t,n){},"82ae":function(e,t,n){"use strict";n.r(t);var a=n("57a0"),r=n.n(a);for(var o in a)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(o);t.default=r.a},cc12:function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return a}));var a={uPopup:function(){return n.e("node-modules/uview-ui/components/u-popup/u-popup").then(n.bind(null,"5409"))},dkLoading:function(){return n.e("components/dk-loading/dk-loading").then(n.bind(null,"4a40"))},uIcon:function(){return n.e("node-modules/uview-ui/components/u-icon/u-icon").then(n.bind(null,"83fd"))}},r=function(){var e=this;e.$createElement,e._self._c,e._isMounted||(e.e0=function(t){e.isShow=!1},e.e1=function(t){e.isShow=!1},e.e2=function(t){e.isShow=!1})},o=[]},cdc9:function(e,t,n){"use strict";var a=n("5a0a");n.n(a).a},dd7d:function(e,t,n){"use strict";n.r(t);var a=n("cc12"),r=n("82ae");for(var o in r)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(o);n("cdc9");var c=n("828b"),i=Object(c.a)(r.default,a.b,a.c,!1,null,"5c6a3d64",null,!1,a.a,void 0);t.default=i.exports}}]),(global.webpackJsonp=global.webpackJsonp||[]).push(["components/dk-share/dk-share-create-component",{"components/dk-share/dk-share-create-component":function(e,t,n){n("df3c").createComponent(n("dd7d"))}},[["components/dk-share/dk-share-create-component"]]]);