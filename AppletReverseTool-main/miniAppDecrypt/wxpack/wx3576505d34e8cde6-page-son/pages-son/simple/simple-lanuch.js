(global.webpackJsonp=global.webpackJsonp||[]).push([["pages-son/simple/simple-lanuch"],{"250e":function(e,n,t){"use strict";t.d(n,"b",(function(){return i})),t.d(n,"c",(function(){return r})),t.d(n,"a",(function(){return o}));var o={dkLoading:function(){return t.e("components/dk-loading/dk-loading").then(t.bind(null,"4a40"))},yyPrivacyLoading:function(){return t.e("components/yy-privacy-loading/yy-privacy-loading").then(t.bind(null,"ceb3"))},uForm:function(){return t.e("node-modules/uview-ui/components/u-form/u-form").then(t.bind(null,"eddd"))},uImage:function(){return t.e("node-modules/uview-ui/components/u-image/u-image").then(t.bind(null,"44e8"))},uIcon:function(){return t.e("node-modules/uview-ui/components/u-icon/u-icon").then(t.bind(null,"83fd"))},uFormItem:function(){return Promise.all([t.e("common/vendor"),t.e("node-modules/uview-ui/components/u-form-item/u-form-item")]).then(t.bind(null,"961a"))},uInput:function(){return Promise.all([t.e("common/vendor"),t.e("node-modules/uview-ui/components/u-input/u-input")]).then(t.bind(null,"5905"))},dkEditor:function(){return Promise.all([t.e("common/vendor"),t.e("components/dk-editor/dk-editor")]).then(t.bind(null,"1016"))},dkTimeRange:function(){return t.e("components/dk-time-range/dk-time-range").then(t.bind(null,"4e97"))},uCellGroup:function(){return t.e("node-modules/uview-ui/components/u-cell-group/u-cell-group").then(t.bind(null,"a51c"))},uCellItem:function(){return t.e("node-modules/uview-ui/components/u-cell-item/u-cell-item").then(t.bind(null,"0098"))},dkSwitch:function(){return t.e("components/dk-switch/dk-switch").then(t.bind(null,"73a3"))},uCollapse:function(){return t.e("node-modules/uview-ui/components/u-collapse/u-collapse").then(t.bind(null,"723a"))},uCollapseItem:function(){return t.e("node-modules/uview-ui/components/u-collapse-item/u-collapse-item").then(t.bind(null,"df20"))},dkCopyright:function(){return t.e("components/dk-copyright/dk-copyright").then(t.bind(null,"640b"))},uButton:function(){return t.e("node-modules/uview-ui/components/u-button/u-button").then(t.bind(null,"66c1"))},dkAvatar:function(){return t.e("components/dk-avatar/dk-avatar").then(t.bind(null,"1252"))},dkPopNotice:function(){return t.e("components/dk-pop-notice/dk-pop-notice").then(t.bind(null,"5314"))},dkUserInfo:function(){return Promise.all([t.e("common/vendor"),t.e("components/dk-user-info/dk-user-info")]).then(t.bind(null,"867d"))},dkCompress:function(){return t.e("components/dk-compress/dk-compress").then(t.bind(null,"d4d9"))},yyPrivacyPopup:function(){return t.e("components/yy-privacy-popup/yy-privacy-popup").then(t.bind(null,"cedb"))}},i=function(){this.$createElement;var e=(this._self._c,this.form.cover_image.length),n=this.form.cover_image.length,t={color:this.form.voting_form?"#2979ff":"#909399"};this.$mp.data=Object.assign({},{$root:{g0:e,g1:n,a0:{"font-size":"30rpx","font-weight":"bold"},a1:{"font-weight":"bold"},a2:{"font-weight":"bold"},a3:t,a4:{"font-weight":"bold"}}})},r=[]},"341f":function(e,n,t){"use strict";t.r(n);var o=t("e052"),i=t.n(o);for(var r in o)["default"].indexOf(r)<0&&function(e){t.d(n,e,(function(){return o[e]}))}(r);n.default=i.a},"3edb":function(e,n,t){"use strict";(function(e,n){var o=t("47a9");t("d74d"),o(t("3240"));var i=o(t("85c3"));e.__webpack_require_UNI_MP_PLUGIN__=t,n(i.default)}).call(this,t("3223").default,t("df3c").createPage)},"4ee8":function(e,n,t){"use strict";var o=t("fad6");t.n(o).a},"85c3":function(e,n,t){"use strict";t.r(n);var o=t("250e"),i=t("341f");for(var r in i)["default"].indexOf(r)<0&&function(e){t.d(n,e,(function(){return i[e]}))}(r);t("4ee8");var u=t("828b"),s=Object(u.a)(i.default,o.b,o.c,!1,null,null,null,!1,o.a,void 0);n.default=s.exports},e052:function(e,n,t){"use strict";(function(e){var o=t("47a9");Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i=o(t("7eb4")),r=o(t("3b2d")),u=o(t("7ca3")),s=o(t("ee10")),a=t("3544"),c=t("ae87"),l=t("ca4b"),d=t("942a");function f(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function m(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?f(Object(t),!0).forEach((function(n){(0,u.default)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):f(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var p,h={components:{VoteTimes:function(){t.e("pages-son/simple/components/vote-times").then(function(){return resolve(t("cb7f"))}.bind(null,t)).catch(t.oe)},SelectMuilt:function(){t.e("pages-son/simple/components/select-muilt").then(function(){return resolve(t("2efa"))}.bind(null,t)).catch(t.oe)},simpleOptions:function(){Promise.all([t.e("common/vendor"),t.e("pages-son/simple/components/simple-options")]).then(function(){return resolve(t("ec9a"))}.bind(null,t)).catch(t.oe)},sponsor:function(){t.e("pages-son/simple/components/sponsor").then(function(){return resolve(t("c303"))}.bind(null,t)).catch(t.oe)},selectScore:function(){t.e("pages-son/simple/components/select-score").then(function(){return resolve(t("ac57"))}.bind(null,t)).catch(t.oe)}},computed:{isHeadDesc:function(){var e,n=this;return null===(e=this.IS_HEAD_ARY.find((function(e){return e.value===n.form.is_head})))||void 0===e?void 0:e.name},is_head_value:function(){var e=this;return this.IS_HEAD_ARY.findIndex((function(n){return n.value===e.form.is_head}))},ruleLocation_label:function(){var e,n=this;return null===(e=this.SIMPLE_RULE_LOCATION.find((function(e){return e.value===n.form.rule_location})))||void 0===e?void 0:e.name},ruleLocation_value:function(){var e=this,n=this.SIMPLE_RULE_LOCATION.findIndex((function(n){return n.value===e.form.rule_location}));return n>0?n:0}},data:function(){return{shareText:d.shareText,submitStyle:l.submitStyle,dkLoading:!0,show_notice:!1,notice_key:"vote-mode",batch_add_visible:!1,IS_HEAD_ARY:a.IS_HEAD_ARY,IS_VOTE_NUM:a.IS_VOTE_NUM,SIMPLE_RULE_LOCATION:a.SIMPLE_RULE_LOCATION,form:{id:void 0,type:a.SIMPLE_WORD,cover_image:[],sponsor:{is:1,head:void 0,name:"微信用户",scan_code:void 0},title:void 0,notice:"",start_time:(0,c.getTime)(),end_time:(0,c.getTime)(30),is_repeat:1,is_head:2,is_vote_num:2,vote_type:1,voting_form:"",is_ranking:2,is_share:1,limit_area:"",is_first:2,rich_text:[{type:a.WORDS,desc:"文字",guid:"ushDGUNhj",content:""}],day_votes:{type:1,num:5,weight:1},vote_option:{min:void 0,max:void 0},scoring:{min:void 0,max:void 0},rule_location:1},join:[],rules:{title:[{required:!0,message:"请填写投票标题",trigger:"blur"},{max:50,message:"投票标题不能超过50个字符",trigger:"blur"}],rich_text:[{trigger:"blur",validator:function(e,n,t){1===n.length&&n[0].type===a.WORDS&&t();for(var o=0;o<n.length;o++){var i=n[o];switch(i.type){case a.LARGE_IMG:i.content||t(new Error("请上传投票说明大图"));break;case a.WORDS:i.content||t(new Error("投票说明文字打开必填"));break;case a.CODE:break;case a.SMALL_IMG:i.content.length||t(new Error("请上传投票说明小图"));break;case a.PLACE:i.content.address||t(new Error("请选择位置信息"))}}t()}}]},cellItemTit:l.cellItemTit,RESULT_SHOW:a.RESULT_SHOW,needSave:!0}},methods:{permissions:function(){var e=this;return(0,s.default)(i.default.mark((function n(){var t;return i.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,d.permissions)();case 2:(t=n.sent)&&(e.form.is_share=t);case 4:case"end":return n.stop()}}),n)})))()},getPhoneNumber:function(e){var n=this;return(0,s.default)(i.default.mark((function t(){return i.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:(0,d.getPhoneNumber)(e,(function(){n.submit()}),n,"simple_create");case 1:case"end":return t.stop()}}),t)})))()},onBindIsHead:function(e){var n=e.detail.value;this.form.is_head=this.IS_HEAD_ARY[n].value},handleShowNotice:function(e){this.notice_key=e,this.show_notice=!0},onRemove:function(){this.form.cover_image=[]},myUpload:function(e){var n=this;return(0,s.default)(i.default.mark((function t(){var o,r;return i.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=e.path,t.next=3,n.uploadImg(o,"cover");case 3:r=t.sent,n.form.cover_image.push(r);case 5:case"end":return t.stop()}}),t)})))()},onCover:function(){var n=this;e.showActionSheet({itemList:["大图上传","小图裁剪上传"],success:function(t){0===t.tapIndex?(0,c.chooseImage)(1,["original","compressed"]).then((function(t){e.showLoading({title:"压缩中。。。",mask:!0}),n.$refs.compress.compress({src:t[0]}).then((function(e){n.uploadImg(e,"vote").then((function(e){n.form.cover_image.push(e),n.$u.toast("上传成功")}))}))})):(0,c.chooseImage)(1,["original","compressed"]).then((function(e){n.$u.route({url:"/pages-son/one/index/cropper",params:{tempFilePath:e[0],destWidth:750,destHeight:380,lockRatio:!0,type:"cover"}})}))},fail:function(e){console.log(e.errMsg)}})},submit:function(){var n=this,t="",o=[];if(!this.form.id){o=this.$u.deepClone(this.join);try{o.forEach((function(e,o){if(!e.name)throw new Error("请输入第".concat(o+1,"个选项名称"));if(!(3!==n.form.type||e.thumb.length||e.sign_video&&e.sign_video.url))throw new Error("请上传图片或者视频");if(0===e.media_type&&!e.thumb.length)throw new Error("请上传图片");if(!(1!==e.media_type||e.sign_video&&e.sign_video.url))throw new Error("请上传视频");t+=e.name,delete e.sign_head}))}catch(e){return this.$u.toast(e.message)}}this.$refs.uForm.validate(function(){var r=(0,s.default)(i.default.mark((function r(u){var s,c,l,d;return i.default.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(!u){i.next=25;break}return 1===(s=m({},n.form)).rich_text.length&&s.rich_text[0].type===a.WORDS&&(s.rich_text[0].content||(s.rich_text=[])),1===s.vote_option.max&&(s.vote_option.max=void 0,s.vote_option.min=void 0),e.showLoading({title:"内容检测中...",mask:!0}),s.phone=n.vuex_user.phone,t+=s.sponsor.name+s.title+s.notice+s.rich_text.filter((function(e){return 2===e.type})).map((function(e){return e.content})).join(""),1!==s.scoring.max&&void 0!==s.scoring.max||(s.scoring=""),i.next=10,n.$u.api.verify({type:1,content1:t});case 10:return e.showLoading({title:n.form.id?"活动更新中...":"创建活动中...",mask:!0}),i.next=13,n.$u.api.store(s);case 13:if(c=i.sent,l=c.id,d=c.sid,n.form.id){i.next=21;break}return i.next=19,n.$u.api.batchStore({activity_id:l,join:o});case 19:n.needSave=!1,n.$u.vuex("vuex_simple_lanuch",void 0);case 21:n.$refs.uForm.resetFields(),n.$u.toast(n.form.id?"更新成功":"创建成功"),n.form.id=l,n.$u.route({url:"/pages-son/simple/simple-activity",type:"redirect",params:{sid:d||l}});case 25:case"end":return i.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}())},onChangeMediaType:function(){this.form.type=this.form.type===a.SIMPLE_WORD?a.SIMPLE_IMG:a.SIMPLE_WORD,this.join.forEach((function(e){e.thumb=[],e.sign_video="",e.media_type=-1}))},handleCell:function(e){var n=this.form.voting_form?encodeURIComponent(JSON.stringify(this.form.voting_form)):void 0;this.$u.route({url:"/pages-son/one/vote/".concat(e),params:{form:n}})},deepCompare:function(e,n){return null===e&&null===n||null!==e&&null!==n&&("object"===(0,r.default)(e)&&"object"===(0,r.default)(n)?this.deepCompareObject(e,n):("string"==typeof e||"number"==typeof e||"boolean"==typeof e)&&e==n)},deepCompareObject:function(e,n){if(e.constructor!==n.constructor)return!1;for(var t in e)if(!n.hasOwnProperty(t)||!this.deepCompare(e[t],n[t]))return console.log("对象差异值",e[t],n[t]),!1;return!0},changeRuleLocation:function(e){var n=e.detail,t=Number(n.value);this.form.rule_location=this.SIMPLE_RULE_LOCATION[t].value}},onLoad:function(n){for(var t=this,o=n.edit_activity_id,r=0;r<2;r++){var u=this.$u.deepClone(a.SIMPLE_JOIN);this.join.push(u)}this.form.sponsor.head=this.vuex_token?this.vuex_user.avatar_url:this.defaultAvatar(),this.form.sponsor.name=this.vuex_token?this.vuex_user.nickname:"微信用户",p=JSON.stringify({form:this.form,join:this.join}),this.$u.vuex("vuex_activity_data.cloud_examine",1),o?this.$u.api.edit({id:o}).then((function(e){t.$u.vuex("vuex_activity_data.cloud_examine",e.cloud_examine||1),t.form=Object.assign(t.form,e),t.form.vote_option||(t.form.vote_option={min:void 0,max:void 0}),""===t.form.scoring&&(t.form.scoring={min:void 0,max:void 0}),0===t.form.rich_text.length&&(t.form.rich_text=[{type:a.WORDS,desc:"文字",guid:"ushDGUNhj",content:""}])})):this.vuex_simple_lanuch&&(console.log("vuex_simple_lanuch",this.vuex_simple_lanuch),e.showModal({confirmText:"继续编辑",cancelText:"重新编辑",content:"上次编辑未保存，是否继续？",success:function(e){if(e.confirm){var n=JSON.parse(t.vuex_simple_lanuch);t.form=n.form,t.join=n.join,p=JSON.stringify({form:t.form,join:t.join})}else e.cancel&&t.$u.vuex("vuex_simple_lanuch",null)}})),this.$nextTick((function(){t.dkLoading=!1})),e.$on("coverImage",function(){var n=(0,s.default)(i.default.mark((function n(o){var r,u,s,a;return i.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=t.vuex_file_handling.image_compress,u=t.vuex_file_handling.image_examine,s=2==u?2:"",s+=1==r?"":"_ys"+r,a=o.url,1!=r){n.next=10;break}return setTimeout((function(){e.showLoading({title:"压缩中。。。",mask:!0})}),300),n.next=9,t.$refs.compress.compress({src:o.url});case 9:a=n.sent;case 10:n.t0=o.type,n.next="cover"===n.t0?13:"sponsor"===n.t0?15:"avatar"===n.t0?17:19;break;case 13:return t.uploadImg(a,"vote"+s).then((function(e){t.form.cover_image.push(e),t.$u.toast("上传成功")})),n.abrupt("break",19);case 15:return t.uploadImg(a,"vote"+s).then((function(e){t.$set(t.form.sponsor,"scan_code",e),t.$u.toast("上传成功")})),n.abrupt("break",19);case 17:return t.uploadImg(a,"avatar").then((function(e){t.$set(t.form.sponsor,"head",e),t.$u.toast("上传成功")})),n.abrupt("break",19);case 19:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()),e.$on("addLocation",(function(e){t.$refs.dkEditor.getLocation(e)})),e.$on("voting_form",(function(e){t.form.voting_form=e}))},onUnload:function(){if(e.$off("voting_form"),e.$off("addLocation"),e.$off("coverImage"),this.needSave&&!this.form.id){var n=JSON.stringify({form:this.form,join:this.join});if(this.deepCompare(JSON.parse(n),JSON.parse(p)))return;console.log("存入数据"),this.$u.vuex("vuex_simple_lanuch",n)}},onReady:function(){this.$refs.uForm.setRules(this.rules)}};n.default=h}).call(this,t("df3c").default)},fad6:function(e,n,t){}},[["3edb","common/runtime","common/vendor"]]]);