var e=require("../@babel/runtime/helpers/interopRequireDefault");require("../@babel/runtime/helpers/Arrayincludes"),require("../@babel/runtime/helpers/Objectentries");var t=e(require("../@babel/runtime/helpers/typeof"));(global.webpackJsonpMpvue=global.webpackJsonpMpvue||[]).push([["common/others"],{0:function(e,t,n){n.r(t),n.d(t,"INIT_MINE_USER_INFO",(function(){return r})),n.d(t,"INIT_BOOKSHELF",(function(){return o})),n.d(t,"BOOKSHELF_SYNC",(function(){return i})),n.d(t,"BOOKSHELF_MORE",(function(){return a})),n.d(t,"LAST_APP_LOGINTIME",(function(){return u})),n.d(t,"LAST_WP_LOGINTIME",(function(){return s})),n.d(t,"SET_UPDATE_LIST",(function(){return c})),n.d(t,"CLEAR_UPDATE_LIST",(function(){return l})),n.d(t,"INIT_RECENTREAD",(function(){return f})),n.d(t,"INIT_BOOKDETAIL",(function(){return d})),n.d(t,"INIT_BOOK_READER",(function(){return _})),n.d(t,"STORE_RATINGS_BUTTON_STATUS",(function(){return E})),n.d(t,"INIT_CHAPTERINFOS",(function(){return p})),n.d(t,"READ_CHAPTER",(function(){return h})),n.d(t,"PRELOAD_CHAPTER",(function(){return I})),n.d(t,"CANCEL_AUTO_PAY",(function(){return m})),n.d(t,"UPLOAD_READING_SCHEDULE_TIME",(function(){return v})),n.d(t,"ON_UNLOAD_READER",(function(){return T})),n.d(t,"READ_RECORD",(function(){return g})),n.d(t,"LATEST_READ_BOOK",(function(){return A})),n.d(t,"ADD_TO_BOOKSHELF",(function(){return R})),n.d(t,"REMOVE_FROM_BOOKSHELF",(function(){return O})),n.d(t,"REMOVE_SHELF_UPDATED_FLAG",(function(){return S})),n.d(t,"INIT_BOOKSTORE",(function(){return C})),n.d(t,"INIT_BOOKSTORE_COMBINED",(function(){return k})),n.d(t,"INIT_BOOKSTORE_CATEGORIES",(function(){return b})),n.d(t,"INIT_BOOKSTORE_RANKING",(function(){return L})),n.d(t,"INIT_BOOKSTORE_RECOMMENDATION_CATEGORY",(function(){return y})),n.d(t,"LOAD_BOOKSTORE_RECOMMENDATION_CATEGORY",(function(){return N})),n.d(t,"LOAD_BOOKSTORE_RECOMMENDATION_BOOKS",(function(){return w})),n.d(t,"INIT_CATEGORIES",(function(){return D})),n.d(t,"STORE_RECOMMENDATION",(function(){return M})),n.d(t,"STORE_NOVELS",(function(){return P})),n.d(t,"STORE_ALL_NOVELS",(function(){return G})),n.d(t,"STORE_ALL_NOVELS_MORE",(function(){return B})),n.d(t,"STORE_TRENDING",(function(){return U})),n.d(t,"STORE_ALL_TRENDING",(function(){return F})),n.d(t,"STORE_ALL_TRENDING_MORE",(function(){return x})),n.d(t,"STORE_TOPTATED",(function(){return V})),n.d(t,"STORE_ALL_TOPRATED",(function(){return H})),n.d(t,"STORE_ALL_TOPRATED_MORE",(function(){return K})),n.d(t,"STORE_FREE",(function(){return W})),n.d(t,"STORE_ALL_FREE_MORE",(function(){return Y})),n.d(t,"STORE_CATEGORIES",(function(){return q})),n.d(t,"STORE_LOAD_MORE",(function(){return j})),n.d(t,"LOAD_GOVERNMENT_AFFAIRS_READING_BANNER",(function(){return Q})),n.d(t,"REPORT_GOVERNMENT_AFFAIRS_READING_OSS_LOG",(function(){return z})),n.d(t,"LOAD_GOVERNMENT_AFFAIRS_READING_BOOK_LIST",(function(){return X})),n.d(t,"SHUFFLE_RECOMMENDATIONS",(function(){return J})),n.d(t,"SHUFFLE_NOVELS",(function(){return $})),n.d(t,"SHUFFLE_FREE",(function(){return Z})),n.d(t,"SHUFFLE_TRENDING",(function(){return ee})),n.d(t,"SIMILAR_BOOKS",(function(){return te})),n.d(t,"SHUFFLE_SIMILAR_BOOKS",(function(){return ne})),n.d(t,"STORE_SEARCH",(function(){return re})),n.d(t,"SEARCH_UNLOAD",(function(){return oe})),n.d(t,"STORE_SEARCH_AUTHOR",(function(){return ie})),n.d(t,"STORE_SEARCH_AUTHOR_MORE",(function(){return ae})),n.d(t,"STORE_SEARCH_PUBLISH",(function(){return ue})),n.d(t,"STORE_SEARCH_PUBLISH_MORE",(function(){return se})),n.d(t,"STORE_SEARCH_TAGS",(function(){return ce})),n.d(t,"INIT_ALL_CATEGORIES",(function(){return le})),n.d(t,"UPDATE_BOOKREADER_UNLOCK_STATUS",(function(){return fe})),n.d(t,"DECREASE_READER_FREE_CHAPTERS",(function(){return de})),n.d(t,"INIT_BOOKREADER_UNLOCK_STATUS",(function(){return _e})),n.d(t,"CHECK_READER_UNLOCK_DATE_WATERMARK",(function(){return Ee})),n.d(t,"LOAD_CATALOG_NEXT",(function(){return pe})),n.d(t,"LOAD_CATALOG_PRE",(function(){return he})),n.d(t,"LOAD_CATALOG_REVERSE",(function(){return Ie})),n.d(t,"LOAD_CATALOG_INIT",(function(){return me})),n.d(t,"CATEGORY_BOOKS",(function(){return ve})),n.d(t,"LASTPAGE_REVIEW",(function(){return Te})),n.d(t,"BALANCE",(function(){return ge})),n.d(t,"QUERY_INFINITE",(function(){return Ae})),n.d(t,"PAY_BALANCE",(function(){return Re})),n.d(t,"BUY_BOOK",(function(){return Oe})),n.d(t,"BUY_CHAPTER",(function(){return Se})),n.d(t,"INIT_SEARCH_HISTORY",(function(){return Ce})),n.d(t,"ADD_SEARCH_HISTORY",(function(){return ke})),n.d(t,"CLEAR_SEARCH_HISTORY",(function(){return be})),n.d(t,"INIT_CATEGORY_BOOKS",(function(){return Le})),n.d(t,"CATEGORY_BOOKS_MORE",(function(){return ye})),n.d(t,"BOOK_REVIEWLIST_ALL",(function(){return Ne})),n.d(t,"BOOK_REVIEWLIST_LIKE",(function(){return we})),n.d(t,"BOOK_REVIEWLIST_MORE",(function(){return De})),n.d(t,"BOOK_REVIEW_EXPANDED",(function(){return Me})),n.d(t,"REWARD_FROM_SHARE",(function(){return Pe})),n.d(t,"KV_LOG_REPORT",(function(){return Ge})),n.d(t,"REPORT_READER_FAIL",(function(){return Be})),n.d(t,"OSS_LOG_REPORT",(function(){return Ue})),n.d(t,"REAL_KV_LOG_REPORT",(function(){return Fe})),n.d(t,"INIT_REVIEW_DETAIL",(function(){return xe})),n.d(t,"PUBLISH_BOOK_REVIEW",(function(){return Ve})),n.d(t,"SAVE_REVIEW_DRAFT",(function(){return He})),n.d(t,"USER_PROFILE",(function(){return Ke})),n.d(t,"USER_PROFILE_SIMPLE",(function(){return We})),n.d(t,"USER_PROFILE_INIT",(function(){return Ye})),n.d(t,"USER_PROFILE_SHELF",(function(){return qe})),n.d(t,"USER_PROFILE_WORKS",(function(){return je})),n.d(t,"USER_PROFILE_WORKS_DETAIL",(function(){return Qe})),n.d(t,"USER_PROFILE_WORKS_INSHELF",(function(){return ze})),n.d(t,"USER_PROFILE_REVIEW",(function(){return Xe})),n.d(t,"USER_PROFILE_BOOKLISTS",(function(){return Je})),n.d(t,"USER_PROFILE_REVIEW_EXPANDED",(function(){return $e})),n.d(t,"USER_PROFILE_UN_LOAD",(function(){return Ze})),n.d(t,"USER_PROFILE_FOLLOW",(function(){return et})),n.d(t,"MIDAS_PAY_ITEMS",(function(){return tt})),n.d(t,"USER_CHARGE_PAY_ITEMS",(function(){return nt})),n.d(t,"REPORT_FORMID",(function(){return rt})),n.d(t,"FREE_3_BOOKS",(function(){return ot})),n.d(t,"FREE_3_BOOKS_RECEIVE",(function(){return it})),n.d(t,"FREE_3_BOOKS_SHUFFLE",(function(){return at})),n.d(t,"QUERY_USERACTIVETYPE",(function(){return ut})),n.d(t,"INIT_TOP100",(function(){return st})),n.d(t,"INIT_TOP100_BOOKS",(function(){return ct})),n.d(t,"TOP100_BOOKS_MORE",(function(){return lt})),n.d(t,"STORE_TOP100",(function(){return ft})),n.d(t,"TOP100_SHARE_INFO",(function(){return dt})),n.d(t,"TOP100_UNLOAD",(function(){return _t})),n.d(t,"TOP100_SHELF_ACTION",(function(){return Et})),n.d(t,"TOP100_MARK_FINISH",(function(){return pt})),n.d(t,"CHAT_SESSION_LIST",(function(){return ht})),n.d(t,"STOP_SHOW_FEEDBACK_TIP",(function(){return It})),n.d(t,"INIT_READER_CONTENT",(function(){return mt})),n.d(t,"THEME",(function(){return vt})),n.d(t,"SEND_GIFT_FROM_UNLOCK",(function(){return Tt})),n.d(t,"BOOK_READING_INFINITE",(function(){return gt})),n.d(t,"HIDE_READING_INFINITE",(function(){return At})),n.d(t,"RECEIVED_READING_INFINITE",(function(){return Rt})),n.d(t,"BOOK_READING_INFINITE_INFO",(function(){return Ot})),n.d(t,"RECEIVED_READING_INFINITE_SHOW",(function(){return St})),n.d(t,"NEW_INFINITE_DAY",(function(){return Ct})),n.d(t,"SENDREWARD_INVITEFRIEND",(function(){return kt})),n.d(t,"INFINITE_ACT_PAGE",(function(){return bt})),n.d(t,"SYNC_CONFIG",(function(){return Lt})),n.d(t,"INFINTE_COLLECTION_CLICKED",(function(){return yt})),n.d(t,"INFINTE_VIDEO_CLICKED",(function(){return Nt})),n.d(t,"GIFT_COLLECTION_ACTIVITY_LIST",(function(){return wt})),n.d(t,"UPBOOK_NOTIFY",(function(){return Dt})),n.d(t,"SUBMIT_UPBOOK_NOTIFY",(function(){return Mt})),n.d(t,"INFINITE_TRIAL_INIT",(function(){return Pt})),n.d(t,"INFINITE_TRIAL_REDEEM",(function(){return Gt})),n.d(t,"UPDATE_USERINFO",(function(){return Bt})),n.d(t,"TOP_200_LIST",(function(){return Ut})),n.d(t,"TOP_200_STYLE",(function(){return Ft})),n.d(t,"VIDEO_FEED_LIST",(function(){return xt})),n.d(t,"VIDEO_FEED_DETAIL",(function(){return Vt})),n.d(t,"VIDEO_FEED_LIKE",(function(){return Ht})),n.d(t,"INIT_LECTURE_CATEGORIES",(function(){return Kt})),n.d(t,"LECTURE_CATEGORIES_RECOMMEND_SHUFFLE",(function(){return Wt})),n.d(t,"LECTURE_CATEGORY_DETAIL",(function(){return Yt})),n.d(t,"LECTURE_CATEGORY_DETAIL_MORE",(function(){return qt})),n.d(t,"LOAD_MINI_BOOK_LIST",(function(){return jt})),n.d(t,"SET_MINI_BOOK_LIST",(function(){return Qt})),n.d(t,"LOAD_ARCHIVE_BOOK_LIST",(function(){return zt})),n.d(t,"SYNC_USER_SETTING",(function(){return Xt}));var r="INIT_MINE_USER_INFO",o="INIT_BOOKSHELF",i="BOOKSHELF_SYNC",a="BOOKSHELF_MORE",u="LAST_APP_LOGINTIME",s="LAST_WP_LOGINTIME",c="SET_UPDATE_LIST",l="CLEAR_UPDATE_LIST",f="INIT_RECENTREAD",d="INIT_BOOKDETAIL",_="INIT_BOOK_READER",E="STORE_RATING_BUTTON_STATUS",p="INIT_CHAPTERINFOS",h="READ_CHAPTER",I="PRELOAD_CHAPTER",m="CANCEL_AUTO_PAY",v="UPLOAD_READING_SCHEDULE_TIME",T="ON_UNLOAD_READER",g="READ_RECORD",A="LATEST_READ_BOOK",R="ADD_TO_BOOKSHELF",O="REMOVE_FROM_BOOKSHELF",S="REMOVE_SHELF_UPDATED_FLAG",C="INIT_BOOKSTORE",k="INIT_BOOKSTORE_COMBINED",b="INIT_BOOKSTORE_CATEGORIES",L="INIT_BOOKSTORE_RANKING",y="INIT_BOOKSTORE_RECOMMENDATION_CATEGORY",N="LOAD_BOOKSTORE_RECOMMENDATION_CATEGORY",w="LOAD_BOOKSTORE_RECOMMENDATION_BOOKS",D="INIT_CATEGORIES",M="STORE_RECOMMENDATION",P="STORE_NOVELS",G="STORE_ALL_NOVELS",B="STORE_ALL_NOVELS_MORE",U="STORE_TRENDING",F="STORE_ALL_TRENDING",x="STORE_ALL_TRENDING_MORE",V="STORE_TOPTATED",H="STORE_ALL_TOPRATED",K="STORE_ALL_TOPRATED_MORE",W="STORE_FREE",Y="STORE_ALL_FREE_MORE",q="STORE_CATEGORIES",j="STORE_LOAD_MORE",Q="LOAD_GOVERNMENT_AFFAIRS_READING_BANNER",z="REPORT_GOVERNMENT_AFFAIRS_READING_OSS_LOG",X="LOAD_GOVERNMENT_AFFAIRS_READING_BOOK_LIST",J="SHUFFLE_RECOMMENDATIONS",$="SHUFFLE_NOVELS",Z="SHUFFLE_FREE",ee="SHUFFLE_TRENDING",te="SIMILAR_BOOKS",ne="SHUFFLE_SIMILAR_BOOKS",re="STORE_SEARCH",oe="SEARCH_UNLOAD",ie="STORE_SEARCH_AUTHOR",ae="STORE_SEARCH_AUTHOR_MORE",ue="STORE_SEARCH_PUBLISH",se="STORE_SEARCH_PUBLISH_MORE",ce="STORE_SEARCH_TAGS",le="INIT_ALL_CATEGORIES",fe="UPDATE_BOOKREADER_UNLOCK_STATUS",de="DECREASE_READER_FREE_CHAPTERS",_e="INIT_BOOKREADER_UNLOCK_STATUS",Ee="CHECK_READER_UNLOCK_DATE_WATERMARK",pe="LOAD_CATALOG_NEXT",he="LOAD_CATALOG_PRE",Ie="LOAD_CATALOG_REVERSE",me="LOAD_CATALOG_INIT",ve="CATEGORY_BOOKS",Te="LASTPAGE_REVIEW",ge="BALANCE",Ae="QUERY_INFINITE",Re="PAY_BALANCE",Oe="BUY_BOOK",Se="BUY_CHAPTER",Ce="INIT_SEARCH_HISTORY",ke="ADD_SEARCH_HISTORY",be="CLEAR_SEARCH_HISTORY",Le="INIT_CATEGORY_BOOKS",ye="CATEGORY_BOOKS_MORE",Ne="BOOK_REVIEWLIST_ALL",we="BOOK_REVIEWLIST_LIKE",De="BOOK_REVIEWLIST_MORE",Me="BOOK_REVIEW_EXPANDED",Pe="REWARD_FROM_SHARE",Ge="KV_LOG_REPORT",Be="REPORT_READER_FAIL",Ue="OSS_LOG_REPORT",Fe="REAL_KV_LOG_REPORT",xe="INIT_REVIEW_DETAIL",Ve="PUBLISH_BOOK_REVIEW",He="SAVE_REVIEW_DRAFT",Ke="USER_PROFILE",We="USER_PROFILE_SIMPLE",Ye="USER_PROFILE_INIT",qe="USER_PROFILE_SHELF",je="USER_PROFILE_WORKS",Qe="USER_PROFILE_WORKS_DETAIL",ze="USER_PROFILE_WORKS_INSHELF",Xe="USER_PROFILE_REVIEW",Je="USER_PROFILE_BOOKLISTS",$e="USER_PROFILE_REVIEW_EXPANDED",Ze="USER_PROFILE_UN_LOAD",et="USER_PROFILE_FOLLOW",tt="MIDAS_PAY_ITEMS",nt="USER_CHARGE_PAY_ITEMS",rt="REPORT_FORMID",ot="FREE_3_BOOKS",it="FREE_3_BOOKS_RECEIVE",at="FREE_3_BOOKS_SHUFFLE",ut="QUERY_USERACTIVETYPE",st="INIT_TOP100",ct="INIT_TOP100_BOOKS",lt="TOP100_BOOKS_MORE",ft="STORE_TOP100",dt="TOP100_SHARE_INFO",_t="TOP100_UNLOAD",Et="TOP100_SHELF_ACTION",pt="TOP100_MARK_FINISH",ht="CHAT_SESSION_LIST",It="STOP_SHOW_FEEDBACK_TIP",mt="INIT_READER_CONTENT",vt="THEME",Tt="SEND_GIFT_FROM_UNLOCK",gt="BOOK_READING_INFINITE",At="HIDE_READING_INFINITE",Rt="RECEIVED_READING_INFINITE",Ot="BOOK_READING_INFINITE_INFO",St="RECEIVED_READING_INFINITE_SHOW",Ct="NEW_INFINITE_DAY",kt="SENDREWARD_INVITEFRIEND",bt="INFINITE_ACT_PAGE",Lt="SYNC_CONFIG",yt="INFINTE_COLLECTION_CLICKED",Nt="INFINTE_VIDEO_CLICKED",wt="GIFT_COLLECTION_ACTIVITY_LIST",Dt="UPBOOK_NOTIFY",Mt="SUBMIT_UPBOOK_NOTIFY",Pt="INFINITE_TRIAL_INIT",Gt="INFINITE_TRIAL_REDEEM",Bt="UPDATE_USERINFO",Ut="TOP_200_LIST",Ft="TOP_200_STYLE",xt="VIDEO_FEED_LIST",Vt="VIDEO_FEED_DETAIL",Ht="VIDEO_FEED_LIKE",Kt="INIT_LECTURE_CATEGORIES",Wt="LECTURE_CATEGORIES_RECOMMEND_SHUFFLE",Yt="LECTURE_CATEGORY_DETAIL",qt="LECTURE_CATEGORY_DETAIL_MORE",jt="LOAD_MINI_BOOK_LIST",Qt="SET_MINI_BOOK_LIST",zt="LOAD_ARCHIVE_BOOK_LIST",Xt="SYNC_USER_SETTING"},103:function(e,t,n){n.r(t),t.default=function(e){var t;return(t="number"!=typeof e?parseInt(e):e)>=1e4?{number:(t/1e4).toFixed(1),unit:"万"}:{number:t,unit:""}}},114:function(e,t,n){var r,o,i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{s(r.next(e))}catch(e){i(e)}}function u(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){e.done?o(e.value):new n((function(t){t(e.value)})).then(a,u)}s((r=r.apply(e,t||[])).next())}))},u=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var c=s(n(5)),l=s(n(9)),f=s(n(2)),d=s(n(3)),_=(s(n(42)),s(n(15))),E=s(n(126)),p=s(n(222));c.default.use(l.default),t.INIT_READING_GROUP="INIT_READING_GROUP",t.RECOMMENDATIONS_CONSENT="RECOMMENDATIONS_CONSENT",t.CREATE="CREATE",t.JOIN="JOIN",t.LEAVE="LEAVE",t.REDEEM="REDEEM",t.REDEEM_TASK_REWARD="REDEEM_TASK_REWARD",t.READ_ADMIN="READ_ADMIN",t.READ_RULES="READ_RULES",t.QUERY_USER_ATTRIBUTES="QUERY_USER_ATTRIBUTES",t.UPDATE="UPDATE",t.FOLLOW="FOLLOW",t.RESPOND_BRANDING_OFFER="RESPOND_BRANDING_OFFER",t.CELEBRITY_TIP_SHOWN="CELEBRITY_TIP_SHOWN",t.INIT_UPGRADE_NOTICE="INIT_UPGRADE_NOTICE",t.UPGRADE_NOTICE_SHOWN="UPGRADE_NOTICE_SHOWN",t.INIT_RULES_CHANGE_NOTICE="INIT_RULES_CHANGE_NOTICE",t.RULES_CHANGE_NOTICE_SHOWN="RULES_CHANGE_NOTICE_SHOWN",t.RULES_CHANGE_CURRENT_NOTICE_VERSION=1574859600,t.PREPARE_SHARE_IMAGE="PREPARE_SHARE_IMAGE";var h={actions:((r={})[t.INIT_READING_GROUP]=function(e,n){var r=e.commit,o=e.dispatch,i=n.groupId,s=n.inviteCode,c=n.queryVid;return a(this,void 0,void 0,(function(){var e,n,a,l,E,p,h,I;return u(this,(function(u){switch(u.label){case 0:return d.default.getUser().vid?[3,2]:[4,d.default.login({})];case 1:u.sent(),u.label=2;case 2:console.log("readingGroup INIT action",i,s,c),e={consent:!0,groupInfo:{},recommendations:null,theirGroupInfo:{},toastMsg:null},n=!0,a=!0,u.label=3;case 3:return u.trys.push([3,5,,6]),[4,f.default.readingGroupInfo({groupId:i,inviteCode:s,queryVid:c})];case 4:return e=u.sent(),[3,6];case 5:return l=u.sent(),[2,Promise.reject(l)];case 6:try{wx.getStorageSync("readingGroupAdminRead_1564727633")&&(n=!1)}catch(e){console.error(e)}try{wx.getStorageSync("readingGroupRulesRead_1564727633")&&(a=!1)}catch(e){console.error(e)}return r(t.INIT_READING_GROUP,{adminIndicator:n,groupInfo:e.groupInfo,recommendations:e.recommendations,rulesIndicator:a,theirGroupInfo:e.theirGroupInfo}),E=_.default.getStorageSync("celebrityTipShown"),r(t.CELEBRITY_TIP_SHOWN,{hasShown:parseInt(E,10)}),null!==e.consent&&void 0!==e.consent&&r(t.RECOMMENDATIONS_CONSENT,{consent:e.consent}),o(t.QUERY_USER_ATTRIBUTES),e.groupInfo&&(p=e.groupInfo,h=p.groupLevel,I=p.points,console.log("shareimage",h,I),h&&I&&o(t.PREPARE_SHARE_IMAGE,{level:h,score:I,maxScore:1===h?100:200})),[2,{errMsg:e.toastMsg,groupInfo:e.groupInfo}]}}))}))},r[t.RECOMMENDATIONS_CONSENT]=function(e,n){var r=e.commit,o=n.consent;return void 0===o?f.default.readingGroupConsent({}).then((function(e){r(t.RECOMMENDATIONS_CONSENT,e)})):f.default.readingGroupConsent({consent:o}).then((function(e){return e&&1===e.succ?r(t.RECOMMENDATIONS_CONSENT,{consent:o}):Promise.reject(e)}))},r[t.CREATE]=function(){return f.default.readingGroupCreate()},r[t.JOIN]=function(e,n){var r=e.commit,o=n.inviteCode;return r(t.PREPARE_SHARE_IMAGE,{imageURL:""}),f.default.readingGroupJoin({inviteCode:o})},r[t.LEAVE]=function(e,n){var r=e.commit,o=n.dismissVid,i=n.groupId;return r(t.PREPARE_SHARE_IMAGE,{imageURL:""}),f.default.readingGroupLeave({dismissVid:o,groupId:i}).then((function(e){if(1!==e.succ)return Promise.reject(new Error("[ReadingGroup] Leave Failed"));if(o)r(t.LEAVE,{dismissVid:o});else{var n=new Date,i=Math.floor(+new Date(n.getFullYear(),n.getMonth(),n.getDate())/1e3);_.default.setStorage({key:"readingGroupLastExitTime",data:i})}return Promise.resolve()}))},r[t.REDEEM]=function(e,n){var r=e.commit,o=n.rewardId;return f.default.readingGroupRedeem({rewardId:o}).then((function(e){r(t.REDEEM,e)}))},r[t.REDEEM_TASK_REWARD]=function(e,n){var r=e.commit,o=n.rewardId;return f.default.readingGroupRedeemTaskReward({rewardId:o}).then((function(){r(t.REDEEM_TASK_REWARD,o)}))},r[t.READ_ADMIN]=function(e){var n=e.commit;try{wx.setStorageSync("readingGroupAdminRead_1564727633",+new Date),n(t.READ_ADMIN)}catch(e){console.error(e)}},r[t.READ_RULES]=function(e){var n=e.commit;try{wx.setStorageSync("readingGroupRulesRead_1564727633",+new Date),n(t.READ_RULES)}catch(e){console.error(e)}},r[t.UPDATE]=function(e,n){var r=e.commit,o=n.groupId,i=n.groupName;return f.default.readingGroupUpdate({groupId:o,groupName:i}).then((function(e){return 1!==e.succ?Promise.reject(new Error("[ReadingGroup] Update Failed")):(r(t.UPDATE,{groupName:i}),Promise.resolve())}))},r[t.QUERY_USER_ATTRIBUTES]=function(e){var n=e.commit;return a(this,void 0,void 0,(function(){var e,r;return u(this,(function(o){switch(o.label){case 0:e=null,o.label=1;case 1:return o.trys.push([1,3,,4]),[4,f.default.infiniteGiftQuery()];case 2:return e=o.sent(),[3,4];case 3:return r=o.sent(),console.error("[readingGroup], QUERY_USER_ATTRIBUTES error:",r),e=null,[3,4];case 4:return e&&n(t.QUERY_USER_ATTRIBUTES,e),[2]}}))}))},r[t.FOLLOW]=function(e,n){var r=e.commit,o=n.vid;return f.default.followFriend({vid:o}).then((function(e){return e.applyVids&&-1!==e.applyVids.indexOf(o)?"applied":(r(t.FOLLOW,{vid:o}),"followed")}))},r[t.RESPOND_BRANDING_OFFER]=function(e,n){var r=e.commit,o=n.groupId,i=n.selection;return f.default.readingGroupRespondBrandingOffer({groupId:o,selection:i}).then((function(e){return 1!==e.succ?Promise.reject(new Error("[ReadingGroup] RESPOND_BRANDING_OFFER Failed")):r(t.RESPOND_BRANDING_OFFER)}))},r[t.CELEBRITY_TIP_SHOWN]=function(e,n){var r=e.commit,o=n.hasShown;_.default.setStorage({data:o,key:"celebrityTipShown",success:function(){r(t.CELEBRITY_TIP_SHOWN,{hasShown:o})}})},r[t.INIT_UPGRADE_NOTICE]=function(){return p.default.get("readingGroupUpgradeNotice").then((function(e){return{groupId:e.groupId,groupLevel:e.groupLevel}})).catch((function(e){console.log(e)}))},r[t.UPGRADE_NOTICE_SHOWN]=function(e,t){var n=t.groupId,r=t.groupLevel;p.default.set("readingGroupUpgradeNotice",{groupId:n,groupLevel:r}).catch((function(e){console.log(e)}))},r[t.INIT_RULES_CHANGE_NOTICE]=function(){return p.default.get("readingGroupRulesChangeNotice").then((function(e){return{noticeVersion:e.noticeVersion}})).catch((function(e){console.error(e)}))},r[t.RULES_CHANGE_NOTICE_SHOWN]=function(){p.default.set("readingGroupRulesChangeNotice",{noticeVersion:t.RULES_CHANGE_CURRENT_NOTICE_VERSION}).catch((function(e){console.error(e)}))},r[t.PREPARE_SHARE_IMAGE]=function(e,n){var r=e.commit,o=e.state,i=n.level,a=n.score,u=n.maxScore;o.shareImage?console.log("[ReadingGroup] 已经绘制过，不重复绘制"):E.default({templateId:"reading_group",cacheKey:"lv"+i+"_"+a+"_"+u,replacements:{"%LEVEL%":i,"%SCORE%":a,"%MAX_SCORE%":u}}).then((function(e){e&&r(t.PREPARE_SHARE_IMAGE,{imageURL:e})})).catch((function(){}))},r),getters:{},mutations:((o={})[t.INIT_READING_GROUP]=function(e,t){var n=t.groupInfo,r=t.theirGroupInfo,o=t.recommendations,i=t.adminIndicator,a=t.rulesIndicator;e.groupInfo=n,e.theirGroupInfo=r||null,e.recommendations.groups=o?o.groups:null,e.shouldShowAdminUpdatesIndicator=i,e.shouldShowRulesUpdatesIndicator=a},o[t.RECOMMENDATIONS_CONSENT]=function(e,t){var n=t.consent;return e.recommendations?(e.recommendations.consent=n,e.recommendations.consent):(e.recommendations={consent:n,groups:null},e.recommendations)},o[t.REDEEM]=function(e,t){e.groupInfo&&(e.groupInfo.redeemedRewards.push(t),e.groupInfo.rewardRedeemed=!0)},o[t.REDEEM_TASK_REWARD]=function(e,t){e.groupInfo&&(e.groupInfo.readingTasks=e.groupInfo.readingTasks.map((function(e){return e.rewardId===t&&(e.redeemed=1),e})))},o[t.READ_ADMIN]=function(e){e.shouldShowAdminUpdatesIndicator=!1},o[t.READ_RULES]=function(e){e.shouldShowRulesUpdatesIndicator=!1},o[t.QUERY_USER_ATTRIBUTES]=function(e,t){e.userAttributes=t},o[t.LEAVE]=function(e,t){var n=t.dismissVid;if(e.groupInfo){var r=e.groupInfo.individualSummary.findIndex((function(e){return e.userInfo.userVid===n}));e.groupInfo.individualSummary.splice(r,1)}},o[t.UPDATE]=function(e,t){var n=t.groupName;e.groupInfo&&(e.groupInfo=i({},e.groupInfo,{groupName:n}))},o[t.FOLLOW]=function(e,t){var n=t.vid;e.groupInfo&&(e.groupInfo.individualSummary=e.groupInfo.individualSummary.map((function(e){return e.userInfo.userVid===n&&(e.userInfo.isFollowing=1),e})))},o[t.RESPOND_BRANDING_OFFER]=function(e){e.groupInfo&&e.groupInfo.celebrity&&(e.groupInfo.celebrity.status=1)},o[t.CELEBRITY_TIP_SHOWN]=function(e,t){var n=t.hasShown;e.celebrityTipShown=n},o[t.PREPARE_SHARE_IMAGE]=function(e,t){var n=t.imageURL;e.shareImage=n},o),plugins:[],state:{celebrityTipShown:null,groupInfo:null,recommendations:{consent:!0,groups:null},shouldShowAdminUpdatesIndicator:!1,shouldShowRulesUpdatesIndicator:!1,theirGroupInfo:null,userAttributes:null,shareImage:null}};t.store=new l.default.Store(h)},117:function(e,t,n){n.r(t);var r=["零","一","二","三","四","五","六","七","八","九"],o=["","万","亿","万亿","亿亿"],i=["","十","百","千"];function a(e){for(var t="",n="",o=!1,a=0;e>0;){var u=e%10;0===u?o&&(o=!1,n=r[u]+n):(o=!0,t=r[u],n=(t+=i[a])+n),a++,e=Math.floor(e/10)}return n}t.default=function(e){var t=function(e){var t=e.toString().indexOf(".");if(-1!==t){for(var n=e.toString().slice(t),o="点",i=1;i<n.length;i++)o+=r[parseInt(n[i])];return o}return""}(e),n=0,i="",u="",s=!1;if(0===(e=Math.floor(e)))return r[0];for(;e>0;){var c=e%1e4;s&&(u=r[0]+u),i=a(c),u=(i+=0!==c?o[n]:o[0])+u,s=c<1e3&&c>0,e=Math.floor(e/1e4),n++}return u+t}},118:function(e,t,n){var r=n(298),o=n.n(r);function i(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:21,n="",r=0,o=e.length;r<o;r+=2)n+=String.fromCharCode(parseInt(e.slice(r,r+2),t));return n}function a(e){if(!e||"string"!=typeof e||e.length<=1)return"";var t=e.slice(1);return t=function(e){var t=function(){var t=e.length;if(t<4)return[];if(t<11)return[0,2];for(var n=Math.min(4,Math.ceil(t/10)),r="",o=t-1;o>t-1-n;o--){var i=e.charCodeAt(o);r+=parseInt(i.toString(2),4)}for(var a=t-n-2,u=a.toString().length,s=[],c=0;s.length<10&&c+u<r.length;c+=u){var l=parseInt(r.slice(c,c+u));s.push(l%a),l=parseInt(r.slice(c+1,c+1+u)),s.push(l%a)}return s}();return function(e,t){for(var n=e.split(""),r=t.length-1;r>=0;r-=2)for(var o=1;o>=0;o--){var i=n[t[r]+o];n[t[r]+o]=n[t[r-1]+o],n[t[r-1]+o]=i}return n.join("")}(e,t)}(t),o.a[i("334d5a4h2c2a")][i("4g4h4f564g4h")](t)}t.a={chk:function(e){if(!e||e.length<=32)return e;var t=e.slice(0,32),n=e.slice(32);return t?n:""},dT:function(e){return e&&0!==e.length?a(e):""},dH:function(e){return e&&0!==e.length?a(e):""},dS:function(e){return e&&0!==e.length?a(e):""},cs:i}},12:function(e,t,n){n.r(t);var r=n(2);t.default={reportExp:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"fun";r.default.reportKVLog({itemname:"wp|exp|"+t+"|"+e})},reportCustomerExp:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"fun";r.default.reportKVLog({itemname:"wp|exp|"+t+"|cus_"+e})},reportCardExp:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"fun";r.default.reportKVLog({itemname:"wp|exp|"+t+"|card_"+e})},reportCustomerPfClk:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"fun";r.default.reportKVLog({itemname:"wp|clk|"+t+"|cus_"+e})},reportCardPfClk:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"fun";r.default.reportKVLog({itemname:"wp|clk|"+t+"|card_"+e})},reportClk:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"fun";r.default.reportKVLog({itemname:"wp|clk|"+t+"|"+e})}}},126:function(e,t,n){n.r(t);var r=n(8),o=n.n(r),i=n(64),a=Object(i.default)(wx.request);t.default=function(e){var t=e.templateId,n=e.cacheKey,r=e.replacements,i=e.cacheControl,u=e.quality;return a({url:"https://weread.qq.com/shareimage/generate",data:{templateId:t,cacheKey:n,replacements:r,cacheControl:i,quality:void 0===u?75:u},method:"POST"}).then((function(e){return e&&e.data&&e.data.url?e.data.url:o.a.reject(e.data)})).catch((function(e){throw console.error("[ShareImageService]",e),e}))}},127:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){}},131:function(e,t,n){var r=n(8),o=n.n(r),i=n(48),a=n.n(i),u=n(59),s=n.n(u),c=function(){function e(){a()(this,e),console.log("FileManager constructor"),wx.getFileSystemManager?this.fileMananger=wx.getFileSystemManager():console.error("sdk did not support fileManager")}return s()(e,[{key:"readFile",value:function(e){var t=this;return console.log("start read file:",e),this.fileMananger?new o.a((function(n,r){t.fileMananger.readFile({filePath:e,encoding:"utf8",success:function(e){n(e)},fail:function(e){console.log("read file fail: ",e),r(e)}})})).catch((function(e){return console.log("readFile error:",e),null})):o.a.reject({errMsg:"SDK not support"})}},{key:"readDir",value:function(e){var t=this;return console.log("start read dir:",e),this.fileMananger?new o.a((function(n,r){t.fileMananger.readdir({dirPath:e,success:function(e){console.log("readdir success:",e.files),n(e&&e.files)},fail:function(e){console.log("readdir error:",e),r(e)}})})).catch((function(e){return console.log("readFile error:",e),null})):o.a.reject({errMsg:"SDK not support"})}},{key:"createDir",value:function(e){var t=this;return console.log("start createDir dir:",e),this.fileMananger?this.isFileExist(e)?(console.log("createDir: dir exist"),o.a.resolve()):new o.a((function(n,r){t.fileMananger.mkdir({dirPath:e,success:function(e){console.log("createDir success:",e),n({succ:1})},fail:function(e){console.log("createDir error:",e),r(e)}})})).catch((function(){return null})):o.a.reject({errMsg:"SDK not support"})}},{key:"isFileExist",value:function(e){if(!this.fileMananger)return console.log({errMsg:"SDK not support"}),!1;try{this.fileMananger.accessSync(e)}catch(e){return!1}return!0}},{key:"removeFile",value:function(e){var t=this;return console.log("removeFile:",e),this.fileMananger?new o.a((function(n,r){t.fileMananger.unlink({filePath:e,success:function(e){console.log("removeFile success:",e),n()},fail:function(e){console.log("removeFile error:",e),n()}})})):o.a.reject({errMsg:"SDK not support"})}},{key:"removeDir",value:function(e,t){var n=this;return console.log("start removeDir dir:",e),this.fileMananger?new o.a((function(r,o){n.fileMananger.rmdir({dirPath:e,recursive:t,success:function(e){console.log("removeDir success:",e),r()},fail:function(e){console.log("removeDir error:",e),o(e)}})})).catch((function(e){return console.log("removeDir error:",e),null})):o.a.reject({errMsg:"SDK not support"})}}]),e}();t.a=c},132:function(e,t,n){t.a=[{big:"https://weread-1258476243.file.myqcloud.com/miniprogram/assets/typo_game/levels/level_icon_1.png",small:"https://weread-1258476243.file.myqcloud.com/miniprogram/assets/typo_game/levels_small/level_1.png",levelUp:"https://weread-1258476243.file.myqcloud.com/miniprogram/mc_game/level_up_modal/level_1_3x_661a2d72.png"},{big:"https://weread-1258476243.file.myqcloud.com/miniprogram/assets/typo_game/levels/level_icon_2.png",small:"https://weread-1258476243.file.myqcloud.com/miniprogram/assets/typo_game/levels_small/level_2.png",levelUp:"https://weread-1258476243.file.myqcloud.com/miniprogram/mc_game/level_up_modal/level_2_3x_51554128.png"},{big:"https://weread-1258476243.file.myqcloud.com/miniprogram/assets/typo_game/levels/level_icon_3.png",small:"https://weread-1258476243.file.myqcloud.com/miniprogram/assets/typo_game/levels_small/level_3.png",levelUp:"https://weread-1258476243.file.myqcloud.com/miniprogram/mc_game/level_up_modal/level_3_3x_5cc7744d.png"},{big:"https://weread-1258476243.file.myqcloud.com/miniprogram/assets/typo_game/levels/level_icon_4.png",small:"https://weread-1258476243.file.myqcloud.com/miniprogram/assets/typo_game/levels_small/level_4.png",levelUp:"https://weread-1258476243.file.myqcloud.com/miniprogram/mc_game/level_up_modal/level_4_3x_8469cd4b.png"},{big:"https://weread-1258476243.file.myqcloud.com/miniprogram/assets/typo_game/levels/level_icon_5.png",small:"https://weread-1258476243.file.myqcloud.com/miniprogram/assets/typo_game/levels_small/level_5.png",levelUp:"https://weread-1258476243.file.myqcloud.com/miniprogram/mc_game/level_up_modal/level_5_3x_5f0e1a9e.png"},{big:"https://weread-1258476243.file.myqcloud.com/miniprogram/assets/typo_game/levels/level_icon_6.png",small:"https://weread-1258476243.file.myqcloud.com/miniprogram/assets/typo_game/levels_small/level_6.png",levelUp:"https://weread-1258476243.file.myqcloud.com/miniprogram/mc_game/level_up_modal/level_6_3x_1f91b445.png"},{big:"https://weread-1258476243.file.myqcloud.com/miniprogram/assets/typo_game/levels/level_icon_7.png",small:"https://weread-1258476243.file.myqcloud.com/miniprogram/assets/typo_game/levels_small/level_7.png",levelUp:"https://weread-1258476243.file.myqcloud.com/miniprogram/mc_game/level_up_modal/level_7_3x_f48860a9.png"},{big:"https://weread-1258476243.file.myqcloud.com/miniprogram/assets/typo_game/levels/level_icon_8.png",small:"https://weread-1258476243.file.myqcloud.com/miniprogram/assets/typo_game/levels_small/level_8.png",levelUp:"https://weread-1258476243.file.myqcloud.com/miniprogram/mc_game/level_up_modal/level_8_3x_c8c81e4d.png"},{big:"https://weread-1258476243.file.myqcloud.com/miniprogram/assets/typo_game/levels/level_icon_9.png",small:"https://weread-1258476243.file.myqcloud.com/miniprogram/assets/typo_game/levels_small/level_9.png",levelUp:"https://weread-1258476243.file.myqcloud.com/miniprogram/mc_game/level_up_modal/level_9_3x_1b424b61.png"},{big:"https://weread-1258476243.file.myqcloud.com/miniprogram/assets/typo_game/levels/level_icon_10.png",small:"https://weread-1258476243.file.myqcloud.com/miniprogram/assets/typo_game/levels_small/level_10.png",levelUp:"https://weread-1258476243.file.myqcloud.com/miniprogram/mc_game/level_up_modal/level_10_3x_6f9a2743.png"}]},134:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(2));t.default={reportExp:function(e){o.default.analysisLog("shareGift_exp",e)},reportInfo:function(e){o.default.analysisLog("shareGift_info",e)},reportError:function(e){o.default.analysisLog("shareGift_error",e)}}},145:function(e,t,n){var r,o,i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{s(r.next(e))}catch(e){i(e)}}function u(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){e.done?o(e.value):new n((function(t){t(e.value)})).then(a,u)}s((r=r.apply(e,t||[])).next())}))},u=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var c=s(n(5)),l=s(n(9)),f=s(n(2)),d=s(n(3)),_=(s(n(42)),s(n(270)));function E(e){return e.map((function(e){return e.bookId=e.bookId.toString(),e.price=_.default(parseFloat(e.price)),e}))}function p(e){return e&&e.recommendations&&e.recommendations.books&&(e.recommendations.books=E(e.recommendations.books)),e&&e.debut&&e.debut.books&&(e.debut.books=E(e.debut.books)),e&&e.works&&e.works.books&&(e.works.books=E(e.works.books)),e}c.default.use(l.default),t.INIT_INFINITEDAY="INIT_INFINITEDAY",t.INIT_INFINITEDAY_XIAOMI="INIT_INFINITEDAY_XIAOMI",t.INIT_INFINITEDAY_TCL="INIT_INFINITEDAY_TCL",t.INIT_INFINITEDAY_VIVO="INIT_INFINITEDAY_VIVO",t.INIT_INFINITEDAY_COSTA="INIT_INFINITEDAY_COSTA",t.VOTE="VOTE",t.REDEEM="REDEEM";var h=((r={})[t.INIT_INFINITEDAY_XIAOMI]=function(e,n){var r=e.commit,o=n.vol;return a(this,void 0,void 0,(function(){var e,n;return u(this,(function(i){switch(i.label){case 0:return(e=d.default.getUser())&&e.vid?[3,2]:[4,d.default.login({})];case 1:i.sent(),i.label=2;case 2:return[4,f.default.infiniteDayConfigsXiaomiVideoURL(e.vid)];case 3:return n=i.sent(),[2,f.default.infiniteDayConfigsXiaomi({issue:o,pr3view:e.previewInfiniteDay?1:0}).then((function(e){r(t.INIT_INFINITEDAY_XIAOMI,{vol:o,pageData:e,svpData:n})}))]}}))}))},r[t.INIT_INFINITEDAY_TCL]=function(e,n){var r=e.commit,o=n.vol;return a(this,void 0,void 0,(function(){var e,n;return u(this,(function(i){switch(i.label){case 0:return(e=d.default.getUser())&&e.vid?[3,2]:[4,d.default.login({})];case 1:i.sent(),i.label=2;case 2:return[4,f.default.infiniteDayConfigsTclVideoURL(e.vid)];case 3:return n=i.sent(),[2,f.default.infiniteDayConfigsTcl({issue:o,pr3view:e.previewInfiniteDay?1:0}).then((function(e){r(t.INIT_INFINITEDAY_TCL,{vol:o,pageData:e,svpData:n})}))]}}))}))},r[t.INIT_INFINITEDAY_VIVO]=function(e,n){var r=e.commit,o=n.vol;return a(this,void 0,void 0,(function(){var e,n;return u(this,(function(i){switch(i.label){case 0:return(e=d.default.getUser())&&e.vid?[3,2]:[4,d.default.login({})];case 1:i.sent(),i.label=2;case 2:return[4,f.default.loadReviewDetail("CM_iday"+o)];case 3:return n=i.sent(),[2,f.default.infiniteDayConfigsVivo({issue:o,pr3view:e.previewInfiniteDay?1:0}).then((function(e){e.comments=n.comments||[],r(t.INIT_INFINITEDAY_VIVO,{vol:o,pageData:e})}))]}}))}))},r[t.INIT_INFINITEDAY_COSTA]=function(e,n){var r=e.commit,o=n.vol;return a(this,void 0,void 0,(function(){var e;return u(this,(function(n){switch(n.label){case 0:return(e=d.default.getUser())&&e.vid?[3,2]:[4,d.default.login({})];case 1:n.sent(),n.label=2;case 2:return[2,f.default.infiniteDayConfigsCosta({issue:o,pr3view:e.previewInfiniteDay?1:0}).then((function(e){r(t.INIT_INFINITEDAY_VIVO,{vol:o,pageData:e})}))]}}))}))},r[t.INIT_INFINITEDAY]=function(e,n){var r=e.commit,o=n.vol;return a(this,void 0,void 0,(function(){var e;return u(this,(function(n){switch(n.label){case 0:return(e=d.default.getUser())&&e.vid?[3,2]:[4,d.default.login({})];case 1:n.sent(),n.label=2;case 2:return[2,f.default.infiniteDayConfigs({issue:o,pr3view:e.previewInfiniteDay?1:0}).then((function(e){r(t.INIT_INFINITEDAY,{vol:o,pageData:e})}))]}}))}))},r[t.VOTE]=function(e,n){var r=e.dispatch,o=n.vol;return f.default.infiniteDayLike(o).then((function(){return r(t.INIT_INFINITEDAY,{vol:o})})).catch((function(e){return Promise.reject(e)}))},r[t.REDEEM]=function(e,n){var r=e.commit,o=n.vol,i=n.giftIndices;return f.default.infiniteDaySendGift({giftIndices:i,issue:o}).then((function(e){return console.log(e),r(t.REDEEM,{giftIndices:i}),e})).catch((function(e){return Promise.reject(e)}))},r),I=((o={})[t.INIT_INFINITEDAY_TCL]=function(e,t){var n=t.vol,r=t.pageData,o=t.svpData;if(e.vol=n,!r||r.errCode<0||!r.wpGift)e.content=r;else if(r.wpGift.expirationTime=+new Date(r.wpGift.expirationTime),r.wpGift&&r.wpGift.gifts&&(r.wpGift.gifts=r.wpGift.gifts.map((function(e,t){var n=i({},e,{redeemed:!1});return r.participation&&r.participation.redemptionStatus&&r.participation.redemptionStatus[t]&&(n.redeemed=1===r.participation.redemptionStatus[t]),n}))),e.content=p(r.content)||null,e.cardRedemption=r.cardRedemption||null,e.relatedIssues=r.relatedIssues||[],e.gift=r.wpGift||null,e.participation=r.participation||null,e.content.config=r.config||null,o&&o.formatList&&o.formatList.length>0){var a=o.formatList.find((function(e){return 101e3===e.formatId}));e.content.video.videoURL=a.playUrl}},o[t.INIT_INFINITEDAY_XIAOMI]=function(e,t){var n=t.vol,r=t.pageData,o=t.svpData;if(e.vol=n,!r||r.errCode<0||!r.wpGift)e.content=r;else if(r.wpGift.expirationTime=+new Date(r.wpGift.expirationTime),r.wpGift&&r.wpGift.gifts&&(r.wpGift.gifts=r.wpGift.gifts.map((function(e,t){var n=i({},e,{redeemed:!1});return r.participation&&r.participation.redemptionStatus&&r.participation.redemptionStatus[t]&&(n.redeemed=1===r.participation.redemptionStatus[t]),n}))),e.content=p(r.content)||null,e.relatedIssues=r.relatedIssues||[],e.gift=r.wpGift||null,e.participation=r.participation||null,e.content.config=r.config||null,o&&o.formatList&&o.formatList.length>0){var a=o.formatList.find((function(e){return 1e5===e.formatId}));e.content.video.videoURL=a.playUrl}},o[t.INIT_INFINITEDAY_VIVO]=function(e,t){var n=t.pageData;n.content.recommendations&&n.content.recommendations.books&&n.content.recommendations.books.length&&n.content.recommendations.books.forEach((function(e){var t="linear-gradient(180deg, "+e.startBackgroundColor+" 0%, "+e.endBackgroundColor+" 100%)";e.style="background-image: "+t})),n.content.mpWhiteCommentIds&&n.content.mpWhiteCommentIds.length&&(n.comments=n.comments.filter((function(e){return n.content.mpWhiteCommentIds.findIndex((function(t){return t===e.commentId}))>-1}))),e.content=p(n.content)||null,e.relatedIssues=n.relatedIssues||[],e.participation=n.participation||null,e.comments=n.comments||[],e.cardRedemption=n.cardRedemptionData||null},o[t.INIT_INFINITEDAY]=function(e,t){var n=t.vol,r=t.pageData;e.vol=n,!r||r.errCode<0||!r.wpGift?e.content=r:(r.wpGift.expirationTime=+new Date(r.wpGift.expirationTime),r.wpGift&&r.wpGift.gifts&&(r.wpGift.gifts=r.wpGift.gifts.map((function(e,t){var n=i({},e,{redeemed:!1});return r.participation&&r.participation.redemptionStatus&&r.participation.redemptionStatus[t]&&(n.redeemed=1===r.participation.redemptionStatus[t]),n}))),e.content=p(r.content)||null,e.relatedIssues=r.relatedIssues||[],e.gift=r.wpGift||null,e.participation=r.participation||null)},o[t.REDEEM]=function(e,t){var n=t.giftIndices;if(e.gift&&e.gift.gifts)for(var r=0,o=n;r<o.length;r++){var i=o[r];e.gift.gifts[i].redeemed=!0}},o);t.store=new l.default.Store({actions:h,getters:{},mutations:I,plugins:[],state:{content:{},cardRedemption:{},gift:{},participation:{},relatedIssues:[],vol:0,comments:[]}})},149:function(e,t,n){n.r(t);var r=n(8),o=n.n(r),i=n(64),a=Object(i.default)(wx.request);t.default=function(e){var t=e.imageURL;return a({url:t,responseType:"arraybuffer",method:"GET"}).then((function(e){return e&&"request:ok"===e.errMsg?"data:image/jpeg;base64,"+wx.arrayBufferToBase64(e.data):o.a.reject(e)})).catch((function(e){throw console.error("[base64FromImageURL]",e),e}))}},15:function(e,t,n){n.r(t),t.default={getStorageSync:function(e){try{return wx.getStorageSync(e)}catch(t){return console.warn("getStorageSync key:",e," failed:",t),null}},setStorageSync:function(e,t){try{return wx.setStorageSync(e,t)}catch(n){return console.warn("setStorageSync key:",e," value:",t," failed:",n),null}},removeStorageSync:function(e){try{return wx.removeStorageSync(e)}catch(e){return console.warn("removeStorageSync failed:",e),null}},setStorage:function(e){var t=e.key,n=e.data,r=e.success,o=e.fail,i=e.complete;return wx.setStorage({key:t,data:n,success:r,fail:o,complete:i})},getStorage:function(e){var t=e.key,n=e.success,r=e.fail,o=e.complete;return wx.getStorage({key:t,success:n,fail:r,complete:o})}}},151:function(e,t,n){n.d(t,"a",(function(){return o})),n.d(t,"c",(function(){return i})),n.d(t,"b",(function(){return a}));var r={novice:[{type:"newuser",source:"clickget"},{type:"newuser",source:"shareget"}],appReceive:[{type:"renew",source:"renewget"},{type:"renew",source:"renewshare"}],renew:[{type:"renew",source:"renewget"},{type:"renew",source:"renewshare"}],back_new:[{type:"renew",source:"renewget"},{type:"renew",source:"renewshare"}],unactive:[{type:"unactive",source:"renewget"},{type:"renew",source:"renewshare"}],chat:[{type:"chat",source:"chatroomget"},{type:"chat",source:"chatroomshare"}],active:[{type:"share",source:"clickget"},{type:"share",source:"shareget"}],appActive:[{type:"share",source:"clickget"},{type:"share",source:"shareget"}],newuser:[{type:"newuser",source:"clickget"},{type:"newuser",source:"shareget"}],share:[{type:"share",source:"clickget"},{type:"share",source:"shareget"}]};function o(e){return r[e]?r[e][0].source:null}function i(e){return r[e]?r[e][1].type:null}function a(e){return r[e]?r[e][1].source:null}},152:function(e,t,n){var r=n(0),o=n(2),i=n(49),a=n(153),u=n(64);function s(){var e=Object(u.default)(wx.reLaunch);wx.showModal({title:"加载失败",content:"检测到白屏异常，请重试",confirmText:"重试",cancelText:"取消",success:function(t){t.confirm?(console.log("renderGuard 用户选择重启"),i.store.dispatch(r.KV_LOG_REPORT,{itemname:"Wp_rendering_issue_relanuch"}),wx.reportAnalytics("blank_detection_action",{relaunch:1}),e({url:"/"+Object(a.a)()}).catch((function(){i.store.dispatch(r.KV_LOG_REPORT,{itemname:"Wp_rendering_issue_reLaunch_error"})}))):(console.log("renderGuard 用户选择取消"),wx.reportAnalytics("blank_detection_action",{relaunch:0}),i.store.dispatch(r.KV_LOG_REPORT,{itemname:"Wp_rendering_issue_cancel"}))},fail:function(e){console.log("show Modal error:",e),i.store.dispatch(r.KV_LOG_REPORT,{itemname:"Wp_rendering_issue_modal_error"}),e.errMsg}})}t.a=function(e,t){if("login"===e)return console.log("renderGuard login"),void setTimeout((function(){console.log("renderGuard login start"),wx.createSelectorQuery().select(".authorization_prompt_checker").boundingClientRect((function(e){e&&e.left<0?(console.error("renderGuard","错误，登录可能没有显示出来！！！！"),wx.reportAnalytics("blank_detection",{page:"login"}),s(),o.default.reportRealKVLog({key:43980}),i.store.dispatch(r.KV_LOG_REPORT,{itemname:"Wp_rendering_author_issue"})):console.log("renderGuard","登录弹窗显示正常")})).exec()}),1250);setTimeout((function(){var n=Object(a.a)();console.log("renderGuard","要检查内容的页面",e,"当前所处页面",n),-1!==n.indexOf(e)&&t().then((function(t){console.error("renderGuard","错误，正文可能没有显示出来！！！！",e,t),wx.reportAnalytics("blank_detection",{page:"currentPageWithQuery"}),s(),o.default.monitor({code:500,action:"renderGuard_check_failed"}),i.store.dispatch(r.KV_LOG_REPORT,{itemname:"Wp_rendering_content_issue"})})).catch((function(){console.log("renderGuard","检查了没问题",e)}))}),4e3)}},153:function(e,t,n){t.a=function(){var e=getCurrentPages();if(e[e.length-1]){var t=e[e.length-1].route+"?",n=e[e.length-1].options;if(n){for(var r in n)n.hasOwnProperty(r)&&(t+=r+"="+n[r]+"&");t=t.slice(0,-1)}return t}return""}},167:function(e,t,n){var r,o,i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var u=a(n(5)),s=a(n(9)),c=a(n(222));a(n(42)),u.default.use(s.default),t.INIT_PIN_TIPS="INIT_PIN_TIPS",t.PIN_TIPS_SHOWN="PIN_TIPS_SHOWN",t.CLEAR_PIN_TIPS_SHOWN="CLEAR_PIN_TIPS_SHOWN";var l={actions:((r={})[t.INIT_PIN_TIPS]=function(e){var n=e.commit;c.default.get("pinTipsShown").then((function(e){n(t.PIN_TIPS_SHOWN,{hasShown:!!e})})).catch((function(e){console.log(e)}))},r[t.PIN_TIPS_SHOWN]=function(e,n){var r=e.commit,o=n.hasShown;r(t.PIN_TIPS_SHOWN,{hasShown:o}),c.default.set("pinTipsShown",1).catch((function(e){console.log(e)}))},r[t.CLEAR_PIN_TIPS_SHOWN]=function(e){(0,e.commit)(t.CLEAR_PIN_TIPS_SHOWN),c.default.remove("pinTipsShown").catch((function(e){console.log(e)}))},r),getters:{},mutations:((o={})[t.PIN_TIPS_SHOWN]=function(e,t){var n=t.hasShown;e.userConfig=i({},e.userConfig,{pinTipsShown:n})},o[t.CLEAR_PIN_TIPS_SHOWN]=function(e){e.userConfig=i({},e.userConfig,{pinTipsShown:!1})},o),plugins:[],state:{userConfig:{pinTipsShown:!0}}};t.store=new s.default.Store(l)},168:function(e,t,n){t.a=function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r="",o=t?"分":"分钟",i=t?"时":"小时",a=Math.ceil(e/60);if(a<60)a=Math.max(1,a),r=n?" "+a+" "+o:""+a+o;else{var u=Math.floor(a/60),s=a-60*u;r=0===s?n?" "+u+" "+i:""+u+i:n?" "+u+" "+i+" "+s+" "+o:""+u+i+s+o}return r}},19:function(e,t,n){n.r(t),n.d(t,"bookshelfParse",(function(){return l})),n.d(t,"freeBookParser",(function(){return f})),n.d(t,"transformSimilarBook",(function(){return d})),n.d(t,"recommendBookParse",(function(){return _})),n.d(t,"guessBookParse",(function(){return E})),n.d(t,"unlockGuessBookParse",(function(){return p})),n.d(t,"storeCagetoryParse",(function(){return h})),n.d(t,"storeRankingParse",(function(){return I})),n.d(t,"searchBookParse",(function(){return m})),n.d(t,"categoryParse",(function(){return v})),n.d(t,"categoryBooksParse",(function(){return T})),n.d(t,"categoryLectureBooksParse",(function(){return g})),n.d(t,"top100Parse",(function(){return A})),n.d(t,"top100BooksParse",(function(){return R})),n.d(t,"findCategoryById",(function(){return O})),n.d(t,"findSublistById",(function(){return S})),n.d(t,"bookDetailReviewlistParse",(function(){return C})),n.d(t,"isChapterFree",(function(){return k})),n.d(t,"chapterContentParse",(function(){return b})),n.d(t,"formatBookStar",(function(){return L})),n.d(t,"formatBookIntro",(function(){return y})),n.d(t,"reviewDetailParse",(function(){return N})),n.d(t,"friendShelfDataParse",(function(){return w})),n.d(t,"parseHotSearchBooks",(function(){return D})),n.d(t,"userProfileReviewList",(function(){return P})),n.d(t,"convertMidasPayItems",(function(){return G})),n.d(t,"free3book",(function(){return B})),n.d(t,"parseChapterInfos",(function(){return U})),n.d(t,"parseTop200Books",(function(){return F}));var r=n(98),o=n.n(r),i=n(6),a=n.n(i),u=n(33),s=n.n(u),c=n(60),l=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(!e)return[];var r=[],o=!0,i=!1,a=void 0;try{for(var u,c=s()(e);!(o=(u=c.next()).done);o=!0){var l=u.value,f=l.bookId,d=l.cover,_=l.title,E=l.secret,p=l.type,h=l.payType,I=l.updateTime,m=l.readUpdateTime,v=l.finished,T=l.finishReading,g=l.mpCover,A=l.paid;(b={bookId:f,cover:d,title:_,secret:E,type:p,readUpdateTime:m,finishReading:T,mpCover:g,payType:h}).hasUpdated=2&h&&0===v&&I>m,b.isTrial=!A&&0!=(h&1<<19),r.push(b)}}catch(e){i=!0,a=e}finally{try{!o&&c.return&&c.return()}finally{if(i)throw a}}var R=!0,O=!1,S=void 0;try{for(var C,k=s()(t);!(R=(C=k.next()).done);R=!0){var b,L=C.value,y=(f=L.bookId,d=L.cover,_=L.title,E=L.secret,p=L.type,h=L.payType,I=L.updateTime,v=L.finished,T=L.finishReading,L.hasLecture);(b={bookId:f,cover:d,title:_,secret:E,type:p,readUpdateTime:m=L.lectureReadUpdateTime,finishReading:T,isLecture:!0,hasLecture:y}).hasUpdated=n.includes(f),r.push(b)}}catch(e){O=!0,S=e}finally{try{!R&&k.return&&k.return()}finally{if(O)throw S}}return r.sort((function(e,t){return t.readUpdateTime-e.readUpdateTime}))},f=function(e){var t=e.books,n=e.needBookIntro,r=void 0!==n&&n,o=e.needStar,i=void 0!==o&&o,a=e.needCategory,u=void 0!==a&&a;return t&&t.length?t.map((function(e){var t=e.bookInfo,n=t.bookId,o=t.cover,a=t.title,s=t.author,c=t.intro,l=t.category,f=t.star,d={bookId:n,cover:o,title:a,author:s};if(r&&(d.intro=c.trim()),i&&(d.star=(f/10).toFixed(1)),u){var _=l.split("-"),E=_[_.length-1];"其他"===E&&(E=_[0]),d.category=E}return d})):[]},d=function(e){return{hasMore:e.booksHasMore,books:e.books.map((function(e){if(e.book&&e.book.bookInfo)return a()({hints:e.book.hints},e.book.bookInfo)})).filter((function(e){return e}))}},_=function(e){var t=e.books,n=e.needBookIntro,r=void 0!==n&&n,o=e.needStar,i=void 0!==o&&o,a=e.needCategory,u=void 0!==a&&a;return t&&t.length?t.map((function(e){var t=e.bookInfo,n=t.bookId,o=t.cover,a=t.title,s=t.author,c=t.category,l=t.intro,f=t.type,d=t.star,_={bookId:n,cover:o,title:a,author:s,type:f};if(u){var E=c.split("-"),p=E[E.length-1];"其他"===p&&(p=E[0]),_.category=p}return r&&(_.intro=l.trim()),i&&(_.star=(d/10).toFixed(1)),_})):[]},E=function(e){return e&&e.length?e.map((function(e){var t=e.bookId,n=e.cover,r=e.title,o=e.type,i=e.author,a=e.intro;return{bookId:t,cover:n,title:r,type:o,author:i,intro:e.reason||a}})):null},p=function(e){return e&&e.length?e.map((function(e){var t=e.bookId,n=e.cover,r=e.title,o=e.type,i=e.intro,a=e.author;return{bookId:t,cover:n,title:r,type:o,intro:i.trim(),author:a}})):null},h=function(e){var t=["400","7400","6100","6200","10000000","2400000"];return e.categories&&e.categories.length?e.categories.filter((function(e){return!~t.indexOf(e.CategoryId)})).map((function(e){return{CategoryId:e.CategoryId,bookTitles:e.bookTitles,covers:e.covers,title:e.title}})):[]},I=function(e){var t=e[0]&&e[0].data?e[0].data:[],n=e[1]&&e[1].data?e[1].data:[];if(!t.length&&!n.length)return[];var r=[].concat(t,n),o=["rising","newbook","all","novel_male_rising","novel_female_rising","novel_male_1","novel_female_1","novel_finished","novel_series"];return r.filter((function(e){return!!~o.indexOf(e.name)})).map((function(e){var t=e.type,n=e.name,r=e.style,o=e.categories[0]||{},i=o.CategoryId,a=o.title,u=o.ranklistCover,s=o.lectureBooks;return s&&s.length,{type:t,name:n,style:r,CategoryId:i,title:a,ranklistCover:u,lectureBooks:r&&25===r.view?s.slice(0,3):s.slice(0,4)}}))},m=function(e){var t=[];return t.books=e.books,t.books&&t.books.length&&(t.books=t.books.map((function(e){var t=e.bookInfo,n=t.bookId,r=t.cover,o=t.title,i=t.author,u=t.intro,s=t.type,c=t.soldout,l={bookId:n,cover:r,title:o,author:i,intro:u.trim(),type:s,soldout:c};return e.lectureInfo&&e.lectureInfo.user&&e.lectureInfo.user.userVid&&(l=a()({},l,{authorVid:e.lectureInfo.user.userVid})),e.lectureInfo&&e.lectureInfo.isTTS&&(l=a()({},l,{isTTS:e.lectureInfo.isTTS})),l.readingCount=e.readingCount,l.hasPaperBook=e.bookInfo.paperBook&&e.bookInfo.paperBook.skuId,l.isTrial=e.bookInfo&&!e.bookInfo.paid&&e.bookInfo.payType&1<<19,l})).filter((function(e){return!e.bookId.startsWith("W")}))),e.records?(t.authors=e.records.filter((function(e){return 1===e.type})),t.authors.map((function(e){delete e.categoryId})),t.publishes=e.records.filter((function(e){return 7===e.type})),t.publishes.map((function(e){delete e.categoryId})),t.categories=e.records.filter((function(e){return 3===e.type})),t):t},v=function(e){var t=new o.a(["10000000","1000","1100","1200","1300","2000","4000","400","7400","2400000","6100","6200"]);return e.categories.map((function(e){var t=e.CategoryId,n=e.title,r=e.totalCount,o=e.covers,i=e.books,a=e.sublist,u={categoryId:t,title:n,totalCount:r,covers:o,books:i,sublist:a};return u.sublist=u.sublist.map((function(e){var t=e.CategoryId,n=e.title,r=e.books,i=e.totalCount,a={categoryId:t,title:n,covers:o,books:r,totalCount:i};return a.parentId=u.categoryId,a})),u})).filter((function(e){return!t.has(e.categoryId)}))},T=function(e){return e&&e.books&&e.books.length?e.books.map((function(e){var t=e.bookInfo,n=t.bookId,r=t.cover,o=t.title,i=t.author,a=t.intro,u=t.type,s=t.newRating,c=t.newRatingCount,l=t.newRatingDetail,f=t.ratingCount,d=e.readingCount;return f=f>1e4?(f/1e4).toFixed(1)+"万":f,{bookId:n,cover:r,title:o,author:i,intro:a.trim(),type:u,newRating:s,newRatingCount:c,newRatingDetail:l,readingCount:d,ratingCount:f}})):[]},g=function(e){return e&&e.books&&e.books.length?e.books.map((function(e){var t=e.bookInfo,n=t.bookId,r=t.cover,o=t.title,i=t.author,a=t.intro,u=t.type,s=t.star,c=t.ratingCount,l=e.listenCount,f=e.lectureInfo;c=c>1e4?(c/1e4).toFixed(1)+"万":c,l=l>1e4?(l/1e4).toFixed(1)+"万":l,s=s?(s/10).toFixed(1):0;var d=f&&f.user&&f.user.name||"";return{bookId:n,cover:r,title:o,author:i,intro:a.trim(),type:u,star:s,listenCount:l,ratingCount:c,lectureAuthorName:d}})):[]},A=function(e){return e.categories.map((function(e){var t={categoryId:e.CategoryId,title:e.title,totalCount:e.totalCount,configs:e.ranklistCover,sublist:e.sublist};return t.sublist=t.sublist.map((function(e){var n={categoryId:e.CategoryId,title:e.title,configs:e.ranklistCover,totalCount:e.totalCount};return n.parentId=t.categoryId,n})),t}))},R=function(e,t){if(!e||!e.books||!e.books.length)return[];var n=new o.a;return t&&t.map((function(e){n.add(e.bookId)})),e.books.map((function(e){var t=e.bookInfo,r=t.bookId,o=t.cover,i=t.title,a=t.author,u=t.type,s=t.newRatingCount,c=t.newRating,l=t.newRatingDetail,f=t.finished,d=t.finishReading,_=e.bestMark,E=e.riseCount,p=n.has(r),h=c?(c/10).toFixed(1):"";return{bookId:r,cover:o,title:i,author:a,finished:f,bestMark:_.trim(),riseCount:E,newRatingCount:s,newRating:c,newRatingDetail:l,percentageNewRating:h,type:u,isOnBookShelf:p,isFinishedReading:d}}))},O=function(e,t){var n=null;return(!e||e.length<=0)&&(n=null),e.forEach((function(e){if(n||e.categoryId!==t||(n=e),!n&&e.sublist){var r=e.sublist.find((function(e){return e.categoryId===t}));r&&(n=r)}})),n},S=function(e,t){var n=null;return e.length<=0?(console.log("findSublistById null"),[]):(e.map((function(e){n||e.categoryId!==t||(n=e),!n&&e.sublist&&e.sublist.find((function(e){return e.categoryId===t}))&&(n=e)})),n?n.sublist:[])},C=function(e){if(!e)return{};var t=e.reviewData,n=void 0===t?{}:t,r=n.synckey,o=void 0===r?0:r,i=n.reviewsHasMore,a=void 0===i?0:i,u=n.reviewsHas1Star,s=void 0===u?0:u,l=n.reviewsHasRecent,f=void 0===l?0:l,d=n.reviewsHas5Star,_=void 0===d?0:d,E=n.reviews;return{hasMore:a,items:(void 0===E?[]:E).map((function(e){var t=e.review,n=void 0===t?{}:t,r=n.reviewId,o=n.likesCount,i=void 0===o?0:o,a=n.commentsCount,u=void 0===a?0:a,s=n.repostCount,l=void 0===s?0:s,f=n.review,d=f.createTime,_=f.content,E=void 0===_?"":_,p=f.isLike,h=void 0!==p&&p,I=f.isReposted,m=void 0!==I&&I,v=f.author,T=void 0===v?"":v,g=f.newRatingLevel,A=void 0===g?0:g,R=E.length>95,O=!R;return{reviewId:r,likesCount:i,commentsCount:u,repostCount:l,createTime:d=Object(c.default)(d),content:E,isReposted:m,isLike:h,author:T,expandable:R,expanded:O,newRatingLevel:A}})),has5Star:_,has1Star:s,hasRecent:f,synckey:o}},k=function(e,t,n){return t.chapterIdx<=e.maxFreeChapter||!(!(2&e.payType)||!t.paid&&0!==t.price)||!!(1&e.payType&&n.infiniteTime)||!(!n.freeBookIds||!n.freeBookIds.includes(t.bookId))||!!(32&e.payType)||!!(64&e.payType)||!!e.isPaid},b=function(e){return function(e){var t=e.split(/\n/),n=[],r=!0,o=!1,i=void 0;try{for(var a,u=s()(t);!(r=(a=u.next()).done);r=!0){var c=a.value.replace(/&nbsp;|&ensp;|&emsp;|&thinsp;|&zwnj;|&zwj;/g," ").trim();""!==c&&n.push(c)}}catch(e){o=!0,i=e}finally{try{!r&&u.return&&u.return()}finally{if(o)throw i}}return n}(e)},L=function(e){var t=e.star;e.star=t?(t/10).toFixed(1):-1,e.numericStar=Math.floor(e.star)},y=function(e){e.intro&&(e.intro=e.intro.trim())},N=function(e){var t=e.reviewId,n=e.review,r=n.type,o=n.content,i=n.createTime,a=n.isLike,u=n.author,s=n.newRatingLevel,l=e.likesCount,f=e.likes,d={bookId:e.review.book.bookId,title:e.review.book.title,cover:e.review.book.cover,author:e.review.book.author};return e.review.videoInfo?{reviewId:t,reviewType:r,content:o,createTime:Object(c.default)(i),isLike:a,author:u,likesCount:l,likes:f,book:d,videoInfo:e.review.videoInfo,newRatingLevel:s}:{reviewId:t,reviewType:r,content:o,createTime:Object(c.default)(i),isLike:a,author:u,likesCount:l,likes:f,book:d,newRatingLevel:s}},w=function(e,t){var n={},r=e.publishedBooks||[];n.publishedBookCount=e.publishedBookCount||0,t>0&&(r=r.splice(0,4)),n.publishedBooks=M(r),console.log(n);var o=e.recentBooks?e.recentBooks:[];n.recentReadingBookCount=e.recentBookCount||0,t>0&&(o=o.splice(0,4)),n.recentReadingBooks=M(o);var i=e.finishReadBooks||[];n.finishReadBookCount=e.finishReadBookCount||0,t>0&&(i=i.splice(0,4)),n.finishReadBooks=M(i);var a=e.commonReadBooks||[];return n.commonReadBookCount=e.commonReadBookCount||0,t>0&&(a=a.splice(0,4)),n.commonReadBooks=M(a),n},D=function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n],o={Id:r.bookId,title:r.title};r.lectureInfo&&r.lectureInfo.user&&r.lectureInfo.user.userVid&&(o.authorVid=r.lectureInfo.user.userVid),t.push(o)}return t};function M(e){return e.map((function(e){return{bookId:e.bookId,title:e.title,author:e.author,type:e.type,cover:e.cover,secret:e.secret}}))}var P=function(e,t,n){var r=e.filter((function(e){return e.review&&4===e.review.type&&e.review.book&&0===e.review.book.type})),o=r.length;r=r.splice(n,t);for(var i=0;i<r.length;i++){var a=r[i].review.content.length>95,u=!a;r[i].review.expandable=a,r[i].review.expanded=u}return{subReviewList:r,reviewCount:o}},G=function(e){for(var t=1===e.haswxdiscount?e.wxdiscount:100,n=e.items?e.items:[],r=[],o=0;o<n.length;o++)r.push({productid:n[o].productid,originPrice:(n[o].price/100).toFixed(2),payPrice:(n[o].price*t/100/100).toFixed(2)});return r},B=function(e){return e.books=e.books.map((function(e){return{bookId:e.bookId,cover:e.cover,title:e.title,price:e.price}})),e.receiveBooks=e.receiveBooks.map((function(e){return{bookId:e.bookId,cover:e.cover,title:e.title,price:e.price}})),e},U=function(e,t){var n=/\u2028|\u0008|\u0009|\u000A|\u000B|\u000C|\u000D|\u0022|\u0027|\u005C|\u00A0|\u2029|\uFEFF/g;return t.map((function(t){var r={chapterUid:t.chapterUid,chapterIdx:t.chapterIdx,title:t.title.replace(n," "),paid:t.paid,price:t.price,level:t.level,bookId:e.bookId,isFree:!0,hasImage:!!t.tar};return 1&e.payType&&(r.wordCount=t.wordCount),r}))},F=function(e){return e.map((function(e){var t=e.bookInfo,n=t.bookId,r=t.title,o=t.author,i=t.cover,a=t.newRatingCount,u=t.newRating,s=t.newRatingDetail;a>1e4&&(a=(a/1e4).toFixed(1)+"万");var c={bookId:n,title:r,author:o,cover:i,newRatingCount:a,newRating:u,newRatingDetail:s};return e.lectureInfo&&(c.lectureInfo=e.lectureInfo),e.listenCount&&(c.listenCount=e.listenCount),e.readingCount&&(c.readingCount=e.readingCount),c}))}},20:function(e,t,n){n.d(t,"c",(function(){return O})),n.d(t,"j",(function(){return S})),n.d(t,"k",(function(){return C})),n.d(t,"i",(function(){return k})),n.d(t,"d",(function(){return b})),n.d(t,"g",(function(){return L})),n.d(t,"f",(function(){return y})),n.d(t,"h",(function(){return N})),n.d(t,"e",(function(){return w})),n.d(t,"a",(function(){return D})),n.d(t,"b",(function(){return M})),n.d(t,"l",(function(){return U}));var r,o,i=n(27),a=n.n(i),u=n(1),s=n.n(u),c=n(6),l=n.n(c),f=n(8),d=n.n(f),_=n(4),E=n.n(_),p=n(10),h=n.n(p),I=n(5),m=n.n(I),v=n(9),T=(n(42),n(3)),g=n(117),A=n(55),R=n(64);m.a.use(v.default);var O="INIT",S="START_GAME",C="SUBMIT_ANSWER",k="NEXT_QUESTION",b="INIT_CONFIG",L="LOAD_RANKS",y="LOAD_GROUP_RANKS",N="MY_RANK_DETAILS",w="LEVEL_EXPAND",D="DEBUG_SET_GAMEINFO",M="HINT",P=(r={},s()(r,N,(function(e){var t=this,n=e.commit;return h()(E.a.mark((function e(){return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",A.a.mcGameMyLevel().then((function(e){n(N,e)})).catch((function(e){console.log("err mcGameMyLevel:",e)})));case 1:case"end":return e.stop()}}),e,t)})))()})),s()(r,O,(function(e){var t=this,n=e.commit;return e.state,e.dispatch,h()(E.a.mark((function e(){var r;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=T.default.getUser()).vid){e.next=4;break}return e.next=4,new d.a((function(e,t){T.default.login({success:function(){e()}})}));case 4:if(r&&r.vid){e.next=6;break}throw new Error("unauthenticated");case 6:return e.abrupt("return",A.a.mcGameUser({vid:r.vid,info:{name:r.name,avatar:r.avatar}}).then((function(e){console.log("[mcGame]","INIT",e),n("GAME_STATUS",{maintain:e.maintain||!1}),n("LOAD_AWARD_INFO",{awardInfo:e.awardInfo}),n("LOAD_PROGRESS",{progress:e.progress}),n(M,{leftCount:e.hints&&e.hints.leftCount?e.hints.leftCount:0})})).catch((function(e){console.error("[mcGame]","INIT",e)})));case 7:case"end":return e.stop()}}),e,t)})))()})),s()(r,S,(function(e){var t=this,n=e.state,r=e.commit,o=e.dispatch;return h()(E.a.mark((function e(){var i;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((i=T.default.getUser())&&i.vid){e.next=3;break}throw new Error("unauthenticated");case 3:if(r("LOAD_NEXT_QUESTION",{questionMap:{},nextQuestionID:-1}),-1!==n.progress.level&&-1!==n.progress.subLevel){e.next=7;break}return e.next=7,o([O]);case 7:return e.next=9,A.a.mcGameFailureCount();case 9:if(!(e.sent>0)){e.next=13;break}return A.a.mcGameResetFailureCount(),e.abrupt("return",o("LOAD_NEXT_QUESTION",{pass:0,reset:1}));case 13:return e.abrupt("return",o("LOAD_NEXT_QUESTION",{pass:0,reset:0}));case 14:case"end":return e.stop()}}),e,t)})))()})),s()(r,C,(function(e,t){var n=this,r=e.state,o=e.dispatch,i=e.getters,a=t.answerIndex,u=t.panelFadeOut;return h()(E.a.mark((function e(){var t,s,c,l;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!=((t=i.currentQuestion).answer===a?1:0)){e.next=14;break}return e.next=5,A.a.mcGameFailureCount();case 5:return s=e.sent,c="failed",l=r.hints&&r.hints.leftCount?r.hints.leftCount:0,0===s&&l>0&&(c="suspended"),A.a.mcGameIncreaseFailureCount(),o("ANSWER_WRONG_REPORT",{questionID:t.id,right:0}),e.abrupt("return",d.a.resolve({upgradeType:c,timedOut:-1===a}));case 14:o("ANSWER_WRONG_REPORT",{questionID:t.id,right:1}),A.a.mcGameResetFailureCount();case 16:return e.abrupt("return",d.a.all([o("LOAD_NEXT_QUESTION",{pass:1,reset:0}),u()]).then((function(e){return e[0]})));case 17:case"end":return e.stop()}}),e,n)})))()})),s()(r,"LOAD_NEXT_QUESTION",(function(e,t){var n=this,r=e.commit,o=(e.state,e.dispatch,t.pass),i=void 0===o?1:o,a=t.reset,u=void 0===a?0:a;return h()(E.a.mark((function e(){var t;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=T.default.getUser(),console.log("[mcGame]","LOAD_NEXT_QUESTION start",{pass:i,reset:u}),e.abrupt("return",A.a.mcGameQuestion({vid:t.vid,pass:i,reset:u}).then((function(e){return console.log("[mcGame]","LOAD_NEXT_QUESTION",e),console.log("mxd sendInfiniteError:",e.sendInfiniteError),r("LOAD_NEXT_QUESTION",{questionMap:e.quesMap,nextQuestionID:e.quesId}),0===i&&r(k),r("LOAD_PROGRESS",{progress:e.progress}),r("LOAD_AWARD_INFO",{awardInfo:e.awardInfo}),r("LOAD_UPGRADE_INFO",{upgradeInfo:e.upgradeInfo}),r(M,{leftCount:e.hints.leftCount}),{upgradeType:e.upgradeInfo.type,upgradeInfinite:e.upgradeInfo&&e.upgradeInfo.infinite?(e.upgradeInfo.infinite/10).toFixed(1):0,nextLevel:e.upgradeInfo.nextLevel,nextLevelName:e.upgradeInfo.nextLevelName,currentSubLevel:e.upgradeInfo.currentSubLevel||1,sumSubLevelCnt:e.upgradeInfo.sumSubLevelCnt||10,addHintCount:e.upgradeInfo.addHintCount||0,gamePropsGift:e.upgradeInfo.gameProps}})).catch((function(e){return console.error("[mcGame]","LOAD_NEXT_QUESTION",e),d.a.reject(e)})));case 3:case"end":return e.stop()}}),e,n)})))()})),s()(r,L,(function(e){var t=this,n=e.commit;return e.state,h()(E.a.mark((function e(){var r;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=T.default.getUser(),e.abrupt("return",A.a.mcGameTotalRank({vid:r.vid}).then((function(e){return console.log("[mcGame]","LOAD_RANKS",e.requestID,e),n(L,{users:e.heroes,me:e.mine}),e})).catch((function(e){return console.error("[mcGame]","LOAD_RANKS",e),d.a.reject(e)})));case 2:case"end":return e.stop()}}),e,t)})))()})),s()(r,y,(function(e,t){var n=this,r=e.commit,o=t.shareTicket,i=t.reportOnly,a=void 0!==i&&i;return h()(E.a.mark((function e(){var t,i,u;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((t=T.default.getUser()).vid){e.next=4;break}return e.next=4,new d.a((function(e,t){T.default.login({success:function(){e()}})}));case 4:return i=Object(R.default)(wx.getShareInfo),u=Object(R.default)(wx.login),e.abrupt("return",u().then((function(e){return i({shareTicket:o}).then((function(t){return l()({},t,e)}))})).then((function(e){return A.a.mcGameGroupRanks({vid:t.vid,encryptedData:e.encryptedData,iv:e.iv,wxCode:e.code,reportOnly:a,info:{name:t.name,avatar:t.avatar}})})).then((function(e){if(!a)return console.log("[mcGame]","LOAD_GROUP_RANKS",e),r(L,{users:e.heroes,me:e.mine}),e;console.log("[mcGame]","LOAD_GROUP_RANKS REPORT_ONLY",e)})).catch((function(e){return console.error("[mcGame]","LOAD_GROUP_RANKS",e),o&&void 0!==o&&"undefined"!==o||(e.message="等待好友加入中...."),d.a.reject(e)})));case 7:case"end":return e.stop()}}),e,n)})))()})),s()(r,M,(function(e){var t=this,n=e.commit,r=(e.state,e.getters);return h()(E.a.mark((function e(){var o,i;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=T.default.getUser(),i=r.currentQuestion,e.abrupt("return",A.a.mcGameHint({vid:o.vid,questId:i.id}).then((function(e){console.log("[mcGame]","HINT",e),n(M,{leftCount:e.leftCount})})).catch((function(e){return console.error("[mcGame]","HINT failed",e),d.a.reject(e)})));case 3:case"end":return e.stop()}}),e,t)})))()})),s()(r,"ANSWER_WRONG_REPORT",(function(e,t){var n=this,r=(e.commit,t.questionID),o=t.right;return h()(E.a.mark((function e(){var t;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=T.default.getUser(),e.abrupt("return",A.a.mcGameWrong({vid:t.vid,questId:r,right:o}).catch((function(e){console.log("err ANSWER_WRONG_REPORT",e)})));case 2:case"end":return e.stop()}}),e,n)})))()})),s()(r,w,(function(e,t){var n=this,r=e.commit,o=t.level,i=void 0===o?-1:o;return h()(E.a.mark((function e(){return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r(w,{level:i});case 1:case"end":return e.stop()}}),e,n)})))()})),s()(r,k,(function(e,t){var n=this,r=e.commit,o=t.panelFadeIn;return h()(E.a.mark((function e(){return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r(k),o&&o();case 2:case"end":return e.stop()}}),e,n)})))()})),s()(r,b,(function(e){var t=this,n=e.commit;return h()(E.a.mark((function e(){var r;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=T.default.getUser(),A.a.checkIsWhiteUser({vid:r.vid}).then((function(e){n("WHITE_USER_LIST",{isWhiteUser:e.isWhitelisted}),T.default.setIsWhiteUser(e.isWhitelisted)})).catch((function(e){console.log("err checkIsWhiteUser:",e)}));case 2:case"end":return e.stop()}}),e,t)})))()})),s()(r,D,(function(e,t){var n=this;return e.commit,h()(E.a.mark((function e(){return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",A.a.mcGameSettings(t));case 1:case"end":return e.stop()}}),e,n)})))()})),r),G={subLevelLabel:function(e){return"第"+Object(g.default)(e.progress.subLevel+1)+"关"},questionIndexLabel:function(e){return e.progress.questionIndex+1+"/"+e.progress.subLevelQuestionCnt},currentQuestion:function(e){return console.log("[mcGame] getters currentQuestion",e.questionID,a()(e.questionMap),e.questionMap),-1!==e.questionID&&e.questionMap[e.questionID]?e.questionMap[e.questionID]:{}}},B=(o={},s()(o,"GAME_STATUS",(function(e,t){var n=t.maintain;e.maintain=n})),s()(o,"LOAD_NEXT_QUESTION",(function(e,t){var n=t.questionMap,r=t.nextQuestionID;e.questionMap=l()({},e.questionMap,n),e.nextQuestionID=r})),s()(o,k,(function(e){-1!==e.nextQuestionID&&(e.questionID=e.nextQuestionID,e.nextQuestionID=-1)})),s()(o,L,(function(e,t){var n=t.users,r=t.me,o=t.invalidateCache;void 0!==o&&o?e.ranks.lastUpdated=0:(e.ranks.users=n,r.rank>=1e5?r.rank="10w+":r.rank>=1e4&&(r.rank="1w+"),e.ranks.me=r,e.ranks.lastUpdated=Math.floor((new Date).getTime()/1e3))})),s()(o,"LOAD_PROGRESS",(function(e,t){var n=t.progress;e.progress=n})),s()(o,"LOAD_AWARD_INFO",(function(e,t){var n=t.awardInfo,r=n&&n.accruedDays?n.accruedDays:0;e.awardInfo={accruedDays:(r/10).toFixed(1)}})),s()(o,"LOAD_UPGRADE_INFO",(function(e,t){var n=t.upgradeInfo;e.upgradeInfo.infinite=n&&n.infinite?(n.infinite/10).toFixed(1):0,e.upgradeInfo.nextLevel=n.nextLevel,e.upgradeInfo.nextLevelName=n.nextLevelName,e.upgradeInfo.percentile=Object(g.default)(n.percentile)})),s()(o,M,(function(e,t){var n=t.leftCount;e.hints.leftCount=n})),s()(o,N,(function(e,t){var n=t.userInfo,r=t.levels;n&&r&&(e.myLevelInfo=function(e,t){for(var n=e.level,r=e.subLevel,o=0;o<t.length;o++){var i=t[o];i.subLevelCnt<=20?(i.canExpand=i.level<=n,i.locked=i.level>n,i.expand=i.level===n,i.subLevels=x(i.subLevelCnt,i.level<n,i.expand?r:9999999),i.levelGotten=i.level<n,i.levelPlaying=i.level===n):(i.canExpand=!1,i.locked=i.level>n,i.expand=!1,i.levelGotten=i.level<n,i.levelPlaying=i.level===n,i.levelPlaying&&(i.name=e.levelName))}return e.levels=t,e.myLevelName=e.levelName,e}(n,r))})),s()(o,w,(function(e,t){var n=t.level,r=e.myLevelInfo.levels;if(n>=0&&n<r.length)for(var o=0;o<r.length;o++)r[o].canExpand&&(r[o].level===n?r[o].expand=!0:r[o].expand=!1);e.myLevelInfo.levels=r})),s()(o,"WHITE_USER_LIST",(function(e,t){var n=t.isWhiteUser,r=void 0!==n&&n;e.whiteUser=r})),o),U=new v.default.Store({state:{maintain:!1,hints:{leftCount:0},awardInfo:{accruedDays:0},upgradeInfo:{infinite:.1,nextLevel:"",nextLevelName:"",percentile:0},progress:{level:-1,levelTitle:"",subLevel:-1,questionIndex:-1,subLevelQuestionCnt:10},questionID:-1,nextQuestionID:-1,questionMap:{},ranks:{users:[],me:{}},myLevelInfo:{levelName:"",levels:[]},whiteUser:!0},getters:G,actions:P,mutations:B,plugins:[]}),F=["一","二","三","四","五","六","七","八","九","十"];function x(e,t,n){for(var r=[],o=0;o<e;o++){var i=o<n?1:o===n?0:-1;r.push({id:o,name:"第"+F[o]+"关",status:i})}return r}},222:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(3)),i=r(n(15)),a=r(n(16)),u=o.default.getUser();t.default={set:function(e,t){if(i.default.setStorageSync(e,t),wx.cloud){var n=wx.cloud.database();return n.collection("user_config").where({_id:u.vid}).limit(1).get().then((function(r){var o,i;if(r.data&&r.data.length>0){var a=((o={})[e]=t,o);return n.collection("user_config").doc(u.vid).update({data:a})}return(i={_id:u.vid})[e]=t,a=i,n.collection("user_config").add({data:a})})).catch((function(e){return console.log("userConfig","set",e),Promise.reject(new Error("user config db set error"))}))}return Promise.resolve()},get:function(e){var t=i.default.getStorageSync(e);return""!==t?Promise.resolve(t):wx.cloud?wx.cloud.database().collection("user_config").where({_id:u.vid}).limit(1).get().then((function(t){if(!t||!t.data||0===t.data.length||!t.data[0].hasOwnProperty(e))return Promise.resolve("");var n=t.data[0][e];return i.default.setStorageSync(e,n),Promise.resolve(n)})).catch((function(e){return console.log("userConfig","get",e),Promise.reject(new Error("user config db get error"))})):Promise.resolve("")},remove:function(e){return i.default.removeStorageSync(e),a.default({data:{vid:u.vid,action:{type:"remove",key:e}},name:"userConfigAction"})}}},227:function(e,t,n){n.r(t),n.d(t,"bookShelfBooks",(function(){return a})),n.d(t,"readerWithBookId",(function(){return u})),n.d(t,"getBookNotifyState",(function(){return s})),n.d(t,"bookWithBooId",(function(){return c})),n.d(t,"bookReviewsWithBookId",(function(){return l})),n.d(t,"bookReviewListWithBookId",(function(){return f})),n.d(t,"firstChapter",(function(){return d})),n.d(t,"chapterWithIndex",(function(){return _})),n.d(t,"nextChapter",(function(){return E})),n.d(t,"prevChapter",(function(){return p})),n.d(t,"lastFreeChapter",(function(){return h})),n.d(t,"hasPreCatalogChapter",(function(){return I})),n.d(t,"hasNextCatalogChapter",(function(){return m})),n.d(t,"bookStoreNovels",(function(){return v})),n.d(t,"bookStoreStructuredBooks",(function(){return T})),n.d(t,"bookStoreTrending",(function(){return g})),n.d(t,"bookStoreTopRated",(function(){return A})),n.d(t,"bookStoreRecommendations",(function(){return R})),n.d(t,"bookStoreCategories",(function(){return O})),n.d(t,"bookStoreCategoryList",(function(){return S})),n.d(t,"bookStoreRankingList",(function(){return C})),n.d(t,"bookStoreCategoryDetails",(function(){return k})),n.d(t,"bookStoreRecentRead",(function(){return b})),n.d(t,"searchTips",(function(){return L})),n.d(t,"bookStoreWxProfile",(function(){return y})),n.d(t,"bookStoreBanner",(function(){return N})),n.d(t,"bookStoreFree",(function(){return w})),n.d(t,"bookStoreTop100",(function(){return D})),n.d(t,"governmentAffairsReadingBanner",(function(){return M})),n.d(t,"governmentAffairsReadingBooks",(function(){return P})),n.d(t,"governmentAffairsReadingTitle",(function(){return G})),n.d(t,"searchHistory",(function(){return B})),n.d(t,"searchResultCategories",(function(){return U})),n.d(t,"searchResultAuthors",(function(){return F})),n.d(t,"searchResultPublishes",(function(){return x})),n.d(t,"searchResultBooks",(function(){return V})),n.d(t,"categoriesList",(function(){return H})),n.d(t,"currentSublist",(function(){return K})),n.d(t,"currentCategory",(function(){return W})),n.d(t,"infiniteRemainingDays",(function(){return Y})),n.d(t,"canSharedFree",(function(){return q})),n.d(t,"shouldShowUnlock",(function(){return j})),n.d(t,"isIpadSize",(function(){return Q})),n.d(t,"platform",(function(){return z})),n.d(t,"statusBarHeight",(function(){return X})),n.d(t,"navigationTitleBarHeight",(function(){return J})),n.d(t,"navigationBarHeight",(function(){return $})),n.d(t,"isAndroid",(function(){return Z})),n.d(t,"isLowPerformanceDevice",(function(){return ee})),n.d(t,"userProfileUserInfo",(function(){return te})),n.d(t,"userProfileShelfData",(function(){return ne})),n.d(t,"userProfileWorksHottestData",(function(){return re})),n.d(t,"userProfileWorksNewestData",(function(){return oe})),n.d(t,"userProfileReviews",(function(){return ie})),n.d(t,"userProfileBooklists",(function(){return ae})),n.d(t,"currentTop100List",(function(){return ue})),n.d(t,"currentTop100Sublist",(function(){return se})),n.d(t,"reviewWithId",(function(){return ce})),n.d(t,"themeSelector",(function(){return le})),n.d(t,"shouldShowGiftCollectionMoreGift",(function(){return fe})),n.d(t,"shouldShowGiftCollectionDot",(function(){return de})),n.d(t,"shouldShowVideoDot",(function(){return _e})),n.d(t,"giftActivityCardsInfo",(function(){return Ee})),n.d(t,"shouldBlockedUser",(function(){return pe})),n.d(t,"canShow30DayCard",(function(){return he})),n.d(t,"logAppWithin7Days",(function(){return Ie})),n.d(t,"shouldActiveUserShowPromt",(function(){return me})),n.d(t,"authorized",(function(){return ve})),n.d(t,"needAuthorized",(function(){return Te})),n.d(t,"top200List",(function(){return ge})),n.d(t,"top200Detail",(function(){return Ae})),n.d(t,"readerUnlockStatus",(function(){return Re})),n.d(t,"infiniteLabelText",(function(){return Oe})),n.d(t,"closeRecommend",(function(){return Se}));var r=n(19),o=n(3),i=n(15),a=function(e){return e.shelf.showing},u=function(e){return function(t){return e.books[t]?e.books[t].reader:null}},s=function(e){return e.upBookNotifyState},c=function(e){return function(t){return e.books[t]?e.books[t].bookInfo:null}},l=function(e){return function(t){return e.books[t]&&e.books[t].reviewList&&e.books[t].reviewList.items?e.books[t].reviewList.items:[]}},f=function(e){return function(t){return e.books[t]&&e.books[t].reviewList?e.books[t].reviewList:{}}},d=function(e){return function(t){return e.catalog&&e.catalog[t]&&e.catalog[t][0]?e.catalog[t][0]:null}},_=function(e){return function(t,n){var r=e.catalog[t];return!n||n>r.length||n<1?null:r[n-1]}},E=function(e){return function(t,n){var r=e.catalog[t];if(!r||!r.length||n.chapterIdx>=r[r.length-1].chapterIdx)return null;var o=e.catalog[t][0].chapterIdx;return e.catalog[t][n.chapterIdx-o+1]}},p=function(e){return function(t,n){if(!t||!e.catalog[t]||!e.catalog[t].length)return null;var r=e.catalog[t][0].chapterIdx;return n.chapterIdx<=r?null:e.catalog[t][n.chapterIdx-1-r]}},h=function(e){return function(t){if(!t||!e.catalog[t]||!e.catalog[t].length)return null;if(!e.books[t]||!e.books[t].bookInfo||!e.books[t].bookInfo.maxFreeChapter)return null;var n=e.catalog[t].filter((function(n){return n.chapterUid===e.books[t].bookInfo.maxFreeChapter}));return n&&n.length?n[0]:null}},I=function(e){return function(t){if(!(t&&e.books[t]&&e.books[t].reader.catalog&&e.catalog[t]))return!1;var n=e.books[t].reader.catalog,r=e.catalog[t];return!!(r&&r.length&&n)&&!!(n[0]&&r[0]&&r[r.length-1])&&(e.books[t].reader.isDescend?n[0].chapterIdx===r[r.length-1].chapterIdx:n[0].chapterIdx===r[0].chapterIdx)}},m=function(e){return function(t){if(!(t&&e.books[t]&&e.books[t].reader.catalog&&e.catalog[t]))return!1;var n=e.books[t].reader.catalog,r=e.catalog[t];if(!(r&&r.length&&n&&n.length))return!1;var o=e.books[t].reader.isDescend,i=n[n.length-1];return o?i.chapterIdx===r[0].chapterIdx:i.chapterIdx===r[r.length-1].chapterIdx}},v=function(e){return e.bookstore.novels},T=function(e){for(var t=e.bookstore.novel.all,n=[],r=0;r+7<=t.length;r+=7)n.push(t.slice(r,r+3)),n.push(t.slice(r+3,r+7));return n},g=function(e){return e.bookstore.trending},A=function(e){return e.bookstore.topRated},R=function(e){return e.bookstore.recommendation.map((function(e){return e.newRating&&(e.percentageNewRating=e.newRating?(e.newRating/10).toFixed(1):""),e}))},O=function(e){return e.bookstore.categories},S=function(e){return e.bookstore.categoryList},C=function(e){return e.bookstore.rankingList},k=function(e){return function(t){var n=e.bookstore.recommendationCategory;return e.bookstore.recommendationCategory&&e.bookstore.recommendationCategory[t]?n[t]:{books:[],hasMore:!1}}},b=function(e){return e.bookstore.recentRead},L=function(e){return e.bookstore.searchTips||"搜索"},y=function(e){return e.bookstore.wxProfile},N=function(e){return e.bookstore.banner},w=function(e){return e.bookstore.free},D=function(e){return e.bookstore.top100},M=function(e){return e.bookstore.governmentAffairsReadingBanner},P=function(e){return e.governmentAffairsReadingBookList.books.map((function(e){return e.star=e.star?(e.star/10).toFixed(1):6.1,e}))},G=function(e){return e.governmentAffairsReadingBookList.title},B=function(e){return e.search.history||[]},U=function(e){return e.search.resultItems.categories||[]},F=function(e){return e.search.resultItems.authors||[]},x=function(e){return e.search.resultItems.publishes||[]},V=function(e){return e.search.resultItems.books||[]},H=function(e){return e.categories.items},K=function(e){var t=e.categories.currentCategoryId;return r.findSublistById(e.categories.items,t)},W=function(e){var t=e.categories.currentCategoryId;return t?r.findCategoryById(e.categories.items,t):[]},Y=function(e){return 0===e.profile.infiniteTime&&1===e.profile.infiniteExpired?-1:0===e.profile.infiniteTime?-2:Math.floor(e.profile.infiniteTime/3600/24)},q=function(e){return function(){return!1}},j=function(e){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=o.default.getUser();if("brown"===n.userActiveType&&!n.isWhitelisted)return!1;if(t.needsPurchase){var r=n&&n.unlockReward&&n.unlockReward[e.bookId];return!r||r.remainCount<=0}return!1}},Q=function(e){return o.default.getUser().isIpadSize||!1},z=function(e){return o.default.getUser().OS||""},X=function(e){return o.default.getUser().statusBarHeight||0},J=function(e){return o.default.getUser().navigationTitleBarHeight||0},$=function(e){return o.default.getUser().navigationBarHeight||60},Z=function(e){return o.default.getUser().isAndroid||!1},ee=function(){return o.default.getUser().isLowPerformanceDevice||!1},te=function(e){return function(t){return e.userProfile[t]&&e.userProfile[t].userInfo||{}}},ne=function(e){return function(t){return e.userProfile[t]&&e.userProfile[t].shelfData||null}},re=function(e){return function(t){return e.userProfile[t]&&e.userProfile[t].worksHottest||null}},oe=function(e){return function(t){return e.userProfile[t]&&e.userProfile[t].worksNewest||null}},ie=function(e){return function(t){return e.userProfile[t]&&e.userProfile[t].reviews||[]}},ae=function(e){return function(t){return e.userProfile[t]&&e.userProfile[t].booklists||[]}},ue=function(e){var t=e.top100.currentCategoryId;return t?r.findCategoryById(e.top100.items,t):{}},se=function(e){var t=e.top100.currentCategoryId;return r.findSublistById(e.top100.items,t)},ce=function(e){return function(t){return e.reviews[t]||{}}},le=function(e){return"dark"===e.profile.user.theme?"wr_darkTheme":"wr_lightTheme"},fe=function(e){if(!e.profile||!e.profile.user||!e.profile.user.userActiveType)return!1;var t=e.profile.user.userActiveType;return e.profile.user.openInfiniteCollection?(console.log("打开了白名单开关"),!0):!("brown"===t||"appActive"===t)},de=function(e){return!(!e.profile.user||void 0===e.profile.user.hasShownGiftCollectionDot||e.profile.user.hasShownGiftCollectionDot)},_e=function(e){return!!e.profile.user&&void 0!==e.profile.user.hasShownVideoFeedDot&&!e.profile.user.hasShownVideoFeedDot},Ee=function(e){return e.giftActivity},pe=function(e){return!1},he=function(e){var t=e.profile.user;if("brown"===t.userActiveType)return!1;if(t&&t.appNewUserOr30DayBack)return!0;var n=t.lastAppLoginTime;if(void 0===n)return console.log("shouldShowPromtBtn has no lastAppLoginTime"),!1;var r=new Date/1e3|0;return r-n<2592e3?(console.log("30内有登录过app"),!1):!(n>0&&r-n>=2592e3&&e.profile.infiniteTime>0&&(console.log("30天回流，但是还有无限卡"),1))},Ie=function(e){var t=e.profile.user.lastAppLoginTime;return void 0===t?(console.log("[logAppWithin7Days] has no lastAppLoginTime"),!1):(new Date/1e3|0)-t<604800&&(console.log("7内有登录过app"),!0)},me=function(e){return function(t,n){if(!he(e))return!1;if(n<=e.books[t].bookInfo.maxFreeChapter)return console.log("免费章节不出"),!1;var r=e.profile.user,o=r&&r.isWhitelisted;if("active"!==r.userActiveType&&!o)return console.log("shouldActiveUserShowPromt 非活跃用户"),!1;var a=i.default.getStorageSync("promtShown_"+t);return!((new Date/1e3|0)-a<86400&&(console.log("shouldActiveUserShowPromt 间隔时间不足"),1))}},ve=function(e){var t=e.profile&&e.profile.user,n=t&&t.nickName,r=t&&t.name;return!!(n&&n.length||r&&r.length)},Te=function(e){var t=e.profile&&e.profile.user,n=t&&t.nickName,r=t&&t.name;return!(n&&n.length||r&&r.length)},ge=function(e){return e.top200.list&&e.top200.list.length?e.top200.list:[]},Ae=function(e){return e.top200.detail?e.top200.detail:{}},Re=function(e){return e.readerUnlockStatus.dateWatermark?e.readerUnlockStatus:{dateWatermark:0}},Oe=function(e){var t=e.profile.isPaying||0,n=t?"付费会员卡":"体验卡";if(e.profile.infinitePermanent)return"终身会员";if(0===e.profile.infiniteTime&&1===e.profile.infiniteExpired)return n+"已过期";var r=Math.floor(e.profile.payingRemainTime/3600/24),o=Math.floor(e.profile.infiniteTime/3600/24),i=t?r:o;return 0===i?n+"今日到期":i>0?n+"剩余 "+i+" 天":""},Se=function(e){var t=e.userSetting;return!(!t||!t.closeRecommend)}},228:function(e,t,n){n.r(t),n.d(t,"DEFAULT_AVATAR",(function(){return r})),n.d(t,"suitableAvatar",(function(){return i}));var r="https://res.mail.qq.com/node/wr/wrpage/style/images/independent/widget/common/avatar/Default.svg",o=void 0,i=function(e,t){var n=3*t;if(!e||"/0"===e)return r;var i="";if(-1!==e.indexOf("res.weread.qq.com"))n>0&&n<=96&&(i="96");else if(-1!==e.indexOf("wx.qlogo.cn")){o||(o=[0,46,64,96,132]);for(var a=0;a<o.length;a++)if(n<=o[a]){i=o[a].toString();break}}return i||(i="0"),e.replace(/^http:/,"https:").replace(/\/\d*$/,"/"+i)}},230:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r={"烂书一本":40,"不值一读":60,"褒贬不一":70,"值得一读":80,"脍炙人口":85,"好评如潮":90,"神作":100};t.getBookRatingInfo=function(e){var t=(e.newRating/10).toFixed(1),n=e.newRatingCount||0,o=e.newRatingDetail.title,i="image";return"待评分"!==o&&"评分不足"!==o||(i="text"),""===o&&(i="rate"),{type:i,title:o,score:r[o],rating:t,raters:n}}},25:function(e,t,n){n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return i}));var r=n(3),o={DIN_MEDIUM:"DIN-Medium",DIN_BOLD:"DIN-Bold",WECHAT_NUMBER:"WeChatNumber",MINION_PRO_IT:"MinionPro-It",SOURCE_HAN_SERIF_CN_BOLD:"SourceHanSerifCN-Bold",SOURCE_HAN_SERIF_CN_MEDIUM:"SourceHanSerifCN-Medium"},i=function(e){e&&e.fonts&&!r.default.getUser().isLowPerformanceDevice&&wx.loadFontFace&&e.fonts.forEach((function(e){wx.loadFontFace({family:e,source:'url("https://rescdn.qqmail.com/weread/assets/mini_program/'+e+'.ttf")',success:function(t){console.log("[特殊字体] 加载成功",e)},fail:function(t){console.log("[特殊字体] 加载失败",e,t)}})}))}},26:function(e,t,n){n.d(t,"d",(function(){return h})),n.d(t,"c",(function(){return I})),n.d(t,"e",(function(){return m})),n.d(t,"b",(function(){return v})),n.d(t,"a",(function(){return T})),n.d(t,"f",(function(){return R}));var r,o,i=n(1),a=n.n(i),u=n(4),s=n.n(u),c=n(10),l=n.n(c),f=n(5),d=n.n(f),_=n(9),E=(n(42),n(2)),p=n(3);d.a.use(_.default);var h="FLIP_CARD_INIT",I="FLIP_CARD_FLIP",m="FLIP_CARD_RECEIVE",v="FLIPCARD_FORCE_CANCEL_LAUNCHAPP",T="FLIPCARD_CLICK_TIME",g=(r={},a()(r,h,(function(e,t){var n=this,r=e.commit;return l()(s.a.mark((function e(){var o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(o=p.default.getCampaignDebugVol())&&(t.debugVol=o),e.abrupt("return",E.default.commonCloudFuncRequest("flipCardListV2",t).then((function(e){return e&&r(h,e),e})));case 3:case"end":return e.stop()}}),e,n)})))()})),a()(r,I,(function(e,t){var n=this,r=e.commit;return l()(s.a.mark((function e(){var o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.state.isFlipping){e.next=2;break}return e.abrupt("return");case 2:if(n.state.isFlipping=!0,!((o=n.state.cardList.findIndex((function(e){return 0===e.status})))>-1)){e.next=8;break}t.giftIndex=o,e.next=9;break;case 8:return e.abrupt("return",console.log("err FLIP_CARD_FLIP:","giftIndex undefined"));case 9:return e.abrupt("return",E.default.commonCloudFuncRequest("flipCardFlipV2",t).then((function(e){if(n.state.isFlipping=!1,e&&e.succ&&1===e.succ)return e.refresh?r(h,e.refresh):E.default.commonCloudFuncRequest("flipCardListV2",{vol:e.vol}).then((function(e){r(h,e)})),{succ:1}})).catch((function(e){return n.state.isFlipping=!1,console.log("err FLIP_CARD_FLIP:",e),e})));case 10:case"end":return e.stop()}}),e,n)})))()})),a()(r,"FLIP_CARD_SHARE",(function(e,t){var n=this,r=e.commit;return l()(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",E.default.commonCloudFuncRequest("flipCardShareV2",t).then((function(e){return e&&e.succ&&1===e.succ?(e.refresh?r(h,e.refresh):E.default.commonCloudFuncRequest("flipCardListV2",{vol:e.vol}).then((function(e){r(h,e)})),{succ:1}):{succ:0}})).catch((function(e){return console.log("err FLIP_CARD_FLIP:",e),e})));case 1:case"end":return e.stop()}}),e,n)})))()})),a()(r,m,(function(e,t){var n=this,r=e.commit;return l()(s.a.mark((function e(){var o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((o=n.state.cardList.findIndex((function(e){return e.cardIndex===t.cardIndex})))>-1)){e.next=5;break}t.giftIndex=o,e.next=6;break;case 5:return e.abrupt("return",console.log("err FLIP_CARD_FLIP:","giftIndex undefined"));case 6:return e.abrupt("return",E.default.commonCloudFuncRequest("flipCardReceiveV2",t).then((function(e){return e&&e.succ&&1===e.succ?(e.refresh?r(h,e.refresh):E.default.commonCloudFuncRequest("flipCardListV2",{vol:e.vol}).then((function(e){r(h,e)})),{succ:1}):{succ:0}})).catch((function(e){return console.log("err FLIP_CARD_RECEIVE:",e),e})));case 7:case"end":return e.stop()}}),e,n)})))()})),a()(r,"FLIP_CARD_UNLOAD",(function(e){var t=this,n=e.commit;return l()(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n("FLIP_CARD_UNLOAD");case 1:case"end":return e.stop()}}),e,t)})))()})),a()(r,v,(function(e,t){(0,e.commit)(v,t)})),a()(r,T,(function(e,t){(0,e.commit)(T,t)})),r),A=(o={},a()(o,h,(function(e,t){var n=t.isMySelf,r=t.initialList,o=t.cardList,i=t.flipList,a=t.remainingCount,u=t.userType,s=t.vol,c=t.invite;if(e.vol=s,e.isMySelf=n,e.initialList=r||[],e.cardList=o||[],e.flipList=i||[],e.remainingCount=a,e.userType=u,e.volNumInfo=function(e){if(!e)return null;var t=e.substr(0,4),n=e.substr(4,2),r=e.substr(6,2),o=new Date(t+"/"+n+"/"+r+" 12:00:00").getTime(),i=new Date(o+6048e5),a=21-3*Math.ceil(Math.abs((new Date).getTime()-o)/864e5)+1;return a<=0&&(a=1),{lackData:a,start:n+"."+r,end:i.getMonth()+1+"."+i.getDate()}}(s),e.normalList=[],e.initialList.length)for(var l=0;l<9;l++)e.normalList.push({status:0,cardIndex:l});else for(var f=function(t){var n=e.flipList.find((function(e){return e.cardIndex===t}));n?(n.cardIndex=t,e.normalList.push(n)):e.normalList.push({status:e.remainingCount?0:2,cardIndex:t})},d=0;d<9;d++)f(d);e.flipList.length>=6&&(e.normalList=e.normalList.map((function(e){return 0!==e.status&&2!==e.status||(e.status=4),e}))),!n&&c&&c.errcode&&-2677===c.errcode&&wx.showToast({title:"本周你已帮其他用户解锁过该福利",icon:"none",duration:2e3})})),a()(o,"FLIP_CARD_UNLOAD",(function(e){e.vol="20190326",e.superReceivedCardIndex=-1,e.normalList=[],e.isMySelf=!0,e.recipients=[],e.superLackMembers=5,e.superList=[],e.volNumInfo=null,e.forceCancelLaunchApp=!1})),a()(o,v,(function(e,t){var n=t.cancel,r=void 0===n||n;e.forceCancelLaunchApp=r})),a()(o,T,(function(e,t){var n=t.reset;void 0===n||n?e.launchAppClickTime=0:e.launchAppClickTime+=1})),o),R=new _.default.Store({state:{normalList:[],recipients:[],superLackMembers:5,superList:[],superReceivedCardIndex:-1,vol:"20190326",isMySelf:!0,volNumInfo:null,bottomGuardClick:{},forceCancelLaunchApp:!1,launchAppClickTime:0,cardList:[],initialList:[],flipList:[],remainingCount:0,userType:0,isFlipping:!1},actions:g,mutations:A,plugins:[]})},267:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){void 0===t&&(t=!1);var n=e;if(n>=1e4){var r=(n/1e4).toFixed(1);return{number:t?parseInt(r):r,unit:"万"}}return{number:n,unit:""}}},270:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return(e/100).toFixed(2)}},271:function(e,t,n){var r,o,i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{s(r.next(e))}catch(e){i(e)}}function u(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){e.done?o(e.value):new n((function(t){t(e.value)})).then(a,u)}s((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=u(n(5)),c=u(n(9)),l=(u(n(42)),u(n(3))),f=u(n(2));s.default.use(c.default),t.FREE_LIBRARY_INIT="FREE_LIBRARY_INIT",t.FREE_LIBRARY_UPDATE="FREE_LIBRARY_UPDATE",t.FREE_LIBRARY_RANKS="FREE_LIBRARY_RANKS",t.FREE_LIBRARY_CAMPAIGN="FREE_LIBRARY_CAMPAIGN",t.FREE_LIBRARY_RECEIVE="FREE_LIBRARY_RECEIVE";var d=((r={})[t.FREE_LIBRARY_INIT]=function(e,n){var r=e.commit;return i(this,void 0,void 0,(function(){var e;return a(this,(function(o){return(e=l.default.getCampaignDebugVol())&&(n.debugVol=e),[2,f.default.commonCloudFuncRequest("freeLibraryInitV2",n).then((function(e){r(t.FREE_LIBRARY_INIT,e)}))]}))}))},r[t.FREE_LIBRARY_UPDATE]=function(e,n){var r=e.commit;return i(this,void 0,void 0,(function(){var e;return a(this,(function(o){return(e=l.default.getCampaignDebugVol())&&(n.debugVol=e),[2,f.default.commonCloudFuncRequest("freeLibraryInitV2",n).then((function(e){r(t.FREE_LIBRARY_UPDATE,e)}))]}))}))},r[t.FREE_LIBRARY_RANKS]=function(e,n){var r=e.commit;return i(this,void 0,void 0,(function(){return a(this,(function(e){return console.log("FREE_LIBRARY_RANKS params",n),[2,f.default.commonCloudFuncRequest("freeLibraryInitRanksV2",n).then((function(e){r(t.FREE_LIBRARY_RANKS,e)}))]}))}))},r[t.FREE_LIBRARY_CAMPAIGN]=function(e,n){var r=e.commit;return i(this,void 0,void 0,(function(){return a(this,(function(e){return console.log("FREE_LIBRARY_CAMPAIGN params",n),[2,f.default.commonCloudFuncRequest("freeLibraryCampaign",n).then((function(e){r(t.FREE_LIBRARY_CAMPAIGN,e)}))]}))}))},r[t.FREE_LIBRARY_RECEIVE]=function(e,n){var r=e.commit;return i(this,void 0,void 0,(function(){return a(this,(function(e){return console.log("FREE_LIBRARY_RECEIVE params",n),[2,f.default.commonCloudFuncRequest("freeLibraryReceiveV2",n).then((function(){r(t.FREE_LIBRARY_RECEIVE,{bookId:n.bookId,authorVid:n.authorVid})}))]}))}))},r),_=((o={})[t.FREE_LIBRARY_INIT]=function(e,t){var n=t.vol,r=t.type,o=t.books,i=t.timestamp,a=t.scene,u=t.isPaying,s=t.maxRedeemCount;e.vol=n,e.type=r,e.books=o||[],e.timestamp=i||0,e.scene=a||"",e.isPaying=u,e.maxRedeemCount=s},o[t.FREE_LIBRARY_UPDATE]=function(e,t){var n=t.books;n&&n.length>0&&e.books&&e.books.length===n.length&&e.books.forEach((function(e,t){var r=n[t];e.received=r.received}))},o[t.FREE_LIBRARY_RANKS]=function(e,t){e.ranks=t||[]},o[t.FREE_LIBRARY_CAMPAIGN]=function(e,t){var n=t.vol,r=t.type,o=t.shareBook;e.vol=n,e.type=r,e.shareBook=o},o[t.FREE_LIBRARY_RECEIVE]=function(e,t){var n=t.bookId,r=t.authorVid,o=r?e.books.find((function(e){return e.bookInfo&&e.bookInfo.bookId===n&&e.lectureInfo&&e.lectureInfo.user&&e.lectureInfo.user.userVid===r})):e.books.find((function(e){return e.bookInfo&&e.bookInfo.bookId===n}));o&&(o.received=1)},o);t.store=new c.default.Store({state:{vol:"",type:"book",myUserInfo:null,volDateTimeStamp:0,volEndDateTimeStamp:0,books:[],ranks:[],scene:"",timestamp:0,shareBook:null,isPaying:0,maxRedeemCount:3},actions:d,mutations:_,plugins:[]})},285:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(528));t.default=function(e,t){void 0===t&&(t=!1);var n,r=new Date(1e3*e),i=((new Date).getTime()-1e3*e)/1e3,a=Math.floor(i/60),u=Math.floor(i/3600),s=(r.getMonth()+1).toString(),c=r.getDate().toString(),l=o.default(r.getHours().toString(),2),f=o.default(r.getMinutes().toString(),2);if(i>=0&&i<=60)n="刚刚";else if(i>0&&u<1)n=a+"分钟前";else if(i>0&&u>=1&&u<=3)n=u+"小时前";else{var d=new Date;n=r.getFullYear()===d.getFullYear()?r.getMonth()===d.getMonth()&&r.getDate()===d.getDate()?"":s+"月"+c+"日":r.getFullYear()+"年"+s+"月"+c+"日",t||(n+=" "+l+":"+f)}return n.trim()}},296:function(e,t,n){var r=n(63);t.a=function(e){if(!e.platform||!e.system)return!1;var t=e.platform,n=e.system.match(/\w* (\d+(.\d+)?(.\d+)?)/);if(n&&n.length>1){var o=n[1];if(o&&"string"==typeof o){if(-1!==t.indexOf("ios"))return Object(r.default)(o,"11.0.0")<0;if(-1!==t.indexOf("android"))return Object(r.default)(o,"7.0.0")<0}}return!1}},30:function(e,t,n){n.d(t,"d",(function(){return h})),n.d(t,"c",(function(){return I})),n.d(t,"e",(function(){return m})),n.d(t,"b",(function(){return v})),n.d(t,"a",(function(){return T})),n.d(t,"f",(function(){return R}));var r,o,i=n(1),a=n.n(i),u=n(4),s=n.n(u),c=n(10),l=n.n(c),f=n(5),d=n.n(f),_=n(9),E=(n(42),n(2)),p=n(3);d.a.use(_.default);var h="FLIP_CARD_INIT",I="FLIP_CARD_FLIP",m="FLIP_CARD_RECEIVE",v="FLIPCARD_FORCE_CANCEL_LAUNCHAPP",T="FLIPCARD_CLICK_TIME",g=(r={},a()(r,h,(function(e,t){var n=this,r=e.commit;return l()(s.a.mark((function e(){var o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(o=p.default.getCampaignDebugVol())&&(t.debugVol=o),e.abrupt("return",E.default.commonCloudFuncRequest("flipCardList",t).then((function(e){return e&&r(h,e),e})));case 3:case"end":return e.stop()}}),e,n)})))()})),a()(r,I,(function(e,t){var n=this,r=e.commit;return l()(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",E.default.commonCloudFuncRequest("flipCardFlip",t).then((function(e){if(e&&e.succ&&1===e.succ)return e.refresh?r(h,e.refresh):E.default.commonCloudFuncRequest("flipCardList",{vol:e.vol}).then((function(e){r(h,e)})),{succ:1}})).catch((function(e){return console.log("err FLIP_CARD_FLIP:",e),e})));case 1:case"end":return e.stop()}}),e,n)})))()})),a()(r,"FLIP_CARD_SHARE",(function(e,t){var n=this,r=e.commit;return l()(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",E.default.commonCloudFuncRequest("flipCardShare",t).then((function(e){return e&&e.succ&&1===e.succ?(e.refresh?r(h,e.refresh):E.default.commonCloudFuncRequest("flipCardList",{vol:e.vol}).then((function(e){r(h,e)})),{succ:1}):{succ:0}})).catch((function(e){return console.log("err FLIP_CARD_FLIP:",e),e})));case 1:case"end":return e.stop()}}),e,n)})))()})),a()(r,m,(function(e,t){var n=this,r=e.commit;return l()(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",E.default.commonCloudFuncRequest("flipCardReceive",t).then((function(e){return e&&e.succ&&1===e.succ?(e.refresh?r(h,e.refresh):E.default.commonCloudFuncRequest("flipCardList",{vol:e.vol}).then((function(e){r(h,e)})),{succ:1}):{succ:0}})).catch((function(e){return console.log("err FLIP_CARD_RECEIVE:",e),e})));case 1:case"end":return e.stop()}}),e,n)})))()})),a()(r,"FLIP_CARD_UNLOAD",(function(e){var t=this,n=e.commit;return l()(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n("FLIP_CARD_UNLOAD");case 1:case"end":return e.stop()}}),e,t)})))()})),a()(r,v,(function(e,t){(0,e.commit)(v,t)})),a()(r,T,(function(e,t){(0,e.commit)(T,t)})),r),A=(o={},a()(o,h,(function(e,t){var n=t.isMySelf,r=t.normalList,o=t.recipients,i=t.superLackMembers,a=t.superList,u=(t.superReceivedCardIndex,t.vol),s=t.volNum;e.vol=u,e.superReceivedCardIndex=function(e){var t=-1;if(e)for(var n=0;n<e.length;n++)3===e[n].status&&(t=e[n].cardIndex);return t}(a),e.normalList=r,e.isMySelf=n,e.recipients=o,e.superLackMembers=i,e.superList=a,e.volNumInfo=function(e,t){if(!e&&!t)return null;if(!e)return{volNum:t};var n=e.substr(0,4),r=e.substr(4,2),o=e.substr(6,2),i=new Date(n+"/"+r+"/"+o+" 12:00:00").getTime(),a=new Date(i+6048e5),u=21-3*Math.ceil(Math.abs((new Date).getTime()-i)/864e5)+1;return u<=0&&(u=1),{lackData:u,volNum:t,start:r+"."+o,end:a.getMonth()+1+"."+a.getDate()}}(u,s)})),a()(o,"FLIP_CARD_UNLOAD",(function(e){e.vol="20190326",e.superReceivedCardIndex=-1,e.normalList=[],e.isMySelf=!0,e.recipients=[],e.superLackMembers=5,e.superList=[],e.volNumInfo=null,e.forceCancelLaunchApp=!1})),a()(o,v,(function(e,t){var n=t.cancel,r=void 0===n||n;e.forceCancelLaunchApp=r})),a()(o,T,(function(e,t){var n=t.reset;void 0===n||n?e.launchAppClickTime=0:e.launchAppClickTime+=1})),o),R=new _.default.Store({state:{normalList:[],recipients:[],superLackMembers:5,superList:[],superReceivedCardIndex:-1,vol:"20190326",isMySelf:!0,volNumInfo:null,bottomGuardClick:{},forceCancelLaunchApp:!1,launchAppClickTime:0},actions:g,mutations:A,plugins:[]})},31:function(e,n,r){var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__decorate||function(e,n,r,o){var i,a=arguments.length,u=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==("undefined"==typeof Reflect?"undefined":(0,t.default)(Reflect))&&"function"==typeof Reflect.decorate)u=Reflect.decorate(e,n,r,o);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(u=(a<3?i(u):a>3?i(n,r,u):i(n,r))||u);return a>3&&u&&Object.defineProperty(n,r,u),u},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var s=u(r(5)),c=r(13),l=u(r(3));c.Component.registerHooks(["onLoad","onShow","onReady","onHide","onUnload","onPullDownRefresh","onReachBottom","onShareAppMessage","onPageScroll","onTabItemTap"]);var f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.scene=0,t.authorized=!1,t.shouldShowEmptyView=!1,t.loading=!1,t.loaded=!1,t}return i(t,e),Object.defineProperty(t.prototype,"currentUser",{get:function(){return l.default.getUser()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canLaunchApp",{get:function(){return 1036===this.scene||1069===this.scene&&!this.currentUser.isAndroid},enumerable:!0,configurable:!0}),t.prototype.hideLoading=function(e){console.log("hideLoading"),wx.hideLoading(),this.loaded=!0,this.loading=!1,e&&e()},t.prototype.hideAllModal=function(){for(var e=0,t=Object.entries(this.$refs);e<t.length;e++){var n=t[e],r=n[0],o=n[1];r.endsWith("Modal")&&o.closeModal&&o.closeModal()}},t.prototype.retryLoad=function(){this.loaded=!1,this.shouldShowEmptyView=!1,this.initData()},t.prototype.resetNeedsLoading=function(){this.loaded=!1},t.prototype.showLoading=function(e){void 0===e&&(e={title:"加载中…"}),this.loading=!0,console.log("showLoading"),wx.showLoading(e)},t.prototype.showLoadingIfNeed=function(e){var t=this;void 0===e&&(e=300),setTimeout((function(){t.loaded||(t.loading=!0,console.log("[showLoadingIfNeeded] showLoading"),wx.showLoading({title:"加载中…"}))}),e)},t.prototype.updateLaunchScene=function(){var e=this.$root.$mp.appOptions;this.scene=e.scene,console.log("当前场景值是",e.scene)},t.prototype.initData=function(){console.log("log when initData in MyBasePage")},a([c.Component],t)}(s.default);n.default=f},32:function(e,t,n){n.d(t,"a",(function(){return A})),n.d(t,"d",(function(){return R})),n.d(t,"f",(function(){return O})),n.d(t,"b",(function(){return S})),n.d(t,"e",(function(){return C})),n.d(t,"c",(function(){return k})),n.d(t,"g",(function(){return y}));var r,o,i=n(40),a=n.n(i),u=n(1),s=n.n(u),c=n(4),l=n.n(c),f=n(8),d=n.n(f),_=n(10),E=n.n(_),p=n(5),h=n.n(p),I=n(9),m=(n(42),n(2)),v=n(3),T=n(66),g=n(166);h.a.use(I.default);var A="GIVEONEGETONE",R="MINE_GIVEONEGETONE",O="UNLOAD_MINE_GIVEONEGETONE",S="GIVEONEGETONE_HISTORY",C="UNLOAD_GIVEONEGETONE_HISTORY",k="GIVEONEGETONE_RECEIVE",b=(r={},s()(r,A,(function(e,t){var n=this,r=e.commit;return E()(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",m.default.commonCloudFuncRequest("giveOneGetOneV2",t).then((function(e){return e&&r(A,e),d.a.resolve(e)})));case 1:case"end":return e.stop()}}),e,n)})))()})),s()(r,R,(function(e,t){var n=this,r=e.commit;return E()(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.needLatest=!0,t.innerPageData=!0,e.abrupt("return",m.default.commonCloudFuncRequest("giveOneGetOneV2",t).then((function(e){return e&&r(R,e),e})));case 3:case"end":return e.stop()}}),e,n)})))()})),s()(r,S,(function(e){var t=this,n=e.commit;return E()(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",m.default.commonCloudFuncRequest("giveOneGetOneHistory").then((function(e){n(S,e)})));case 1:case"end":return e.stop()}}),e,t)})))()})),s()(r,C,(function(e){(0,e.commit)(C)})),s()(r,k,(function(e,t){var n=this;return e.commit,E()(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",m.default.commonCloudFuncRequest("giveOneGetOneReceive",t).then((function(e){return e})));case 1:case"end":return e.stop()}}),e,n)})))()})),s()(r,O,(function(e){(0,e.commit)(O)})),r),L=(o={},s()(o,A,(function(e,t){var n=t.getLikeData,r=t.getLikeDataList,o=t.designsData,i=t.vol,a=t.infiniteGetLikeList,u=t.myData,s=t.getLikeUser,c=t.isExpired,l=t.endTime,f=t.isMySelf,d=t.activeInfinite;e.getLikeData=n,e.designsData=o,e.currentVol=i,e.isExpired=c,e.endTime=l;var _=w(i,T.default.safeParseJSON(o.designs,[]),r);e.designs=_;var E=function(e,t,n,r,o){var i=g.a.chooseMyBestShowCardIndex(e,t,n,r);return i.hasVote=o.hasVote,i.voteForVids=o.voteForVids,i.infiniteDay=o.infiniteDay,i}(i,function(e,t){for(var n=[],r=String(e),o=0;o<t.length;o++)t[o].designId.indexOf(r)>=0&&n.push(t[o]);return n}(i,a.list||[]),_,n?n.designId:"",u),p=N(E?E.designId:"");e.myData=function(e,t,n,r,o){return e.genericImageURL=t.genericImageURL,n?(e.voter=e.voter||r.voter,e.infiniteDay=e.infiniteDay||r.infiniteDay,e.needVoteCount=e.needVoteCount||r.needVoteCount):(e.voter=o.voter,e.infiniteDay=o.infiniteDay,e.needVoteCount=o.needVoteCount),e}(u,_[p],f,n,E),e.getLikeUser=s;var h=u&&u.voteForVids?u.voteForVids:[];e.isMyVote=function(e,t,n,r){var o=v.default.getUser().vid,i=0;if(e&&e.voter)for(var a=0;a<e.voter.length;a++)if(e.voter[a].user.userVid===o){i=1;break}if(0===i&&n&&n.length>0&&t)for(var u=0;u<n.length;u++)if(t===n[u]){i=1;break}if(1===i){for(var s=-1,c=0;c<r.length&&-1===s;c++)for(var l=r[c].voter,f=0;f<l.length;f++)if(l[f].user.userVid===o){s=c;break}(e&&e.designId?parseInt(e.designId.split("_")[1]):0)===s&&(i=2)}return i}(n,s.userVid,h,_),e.isMySelf=f;var I=N(n?n.designId:"");e.getLikeDesign=_[I]||{},e.activeInfinite=function(e){if(e&&e.clickGetInfo&&e.shareGetInfo){var t={};return t.clickGetInfoReceived=e.clickGetInfo.received,t.clickGetInfoDay=e.clickGetInfo.day,t.clickGetInfoDay<=0&&(t.clickGetInfoReceived=1),t.shareGetInfoReceived=e.shareGetInfo.received,t.shareGetInfoDay=e.shareGetInfo.day,t.shareGetInfoDay<=0&&(t.shareGetInfoReceived=1),t}return{clickGetInfoReceived:1,clickGetInfoDay:0,shareGetInfoReceived:1,shareGetInfoDay:0}}(d)})),s()(o,R,(function(e,t){var n=t.getLikeData,r=t.getLikeDataList,o=t.designsData,i=void 0===o?{}:o,u=t.vol,s=t.getLikeUser;e.mine.getLikeData=n,e.mine.getLikeDataList=function(e){if(!e||!e.list||e.list.length<=0)return null;var t={};return e.list.map((function(e){t[e.designId]=e})),t}(r),e.mine.currentVol=u,e.mine.getLikeUser=s;try{var c=w(u,T.default.safeParseJSON(i.designs,[]),r);c=function(e){return e.map((function(e){var t=e.voter,n=e.needVoteCount-e.voter.length,r=void 0;return r=n>0?[].concat(a()(t),a()(new Array(n).fill({}))):t,e.needVoterArray=r.slice(0,2),e}))}(c),e.mine.designs=c,e.mine.allFullZan=function(e){for(var t=0;t<e.length;t++)if(e[t].voter.length<e[t].needVoteCount)return!1;return!0}(c)}catch(e){console.log(e)}})),s()(o,S,(function(e,t){var n=t.vols,r=t.allVolDesignsData,o=t.gifts;e.giveOneGetOneCards=function(e,t,n){var r=[],o={},i={};return t.map((function(e){i[e.key]=e.value})),e.map((function(e){if(i[e]){var t=T.default.safeParseJSON(i[e],{designs:[]});if(t.designs)for(var n=T.default.safeParseJSON(t.designs,[]),r=0;r<n.length;r++)o[t.volday+"_"+r]=n[r]}})),n.map((function(e){var t=o[e.designId],n=e.designId.split("_")[0];t&&n&&(t.volday=n,t&&r.push(t))})),r}(n,r,o)})),s()(o,C,(function(e){e.giveOneGetOneCards=[]})),s()(o,O,(function(e){e.mine={getLikeData:null,getLikeDataList:null,getLikeDesign:null,currentVol:null,designs:[]}})),o),y=new I.default.Store({state:{getLikeData:null,getLikeDesign:null,getMyLikeDesign:null,myGetLikeDesign:null,currentVol:null,isExpired:!1,endTime:0,designsData:[],myData:null,getLikeUser:null,isMySelf:!1,isMyVote:0,designs:[],activeInfinite:{},mine:{getLikeData:null,getLikeDataList:null,getLikeDesign:null,currentVol:null,designs:[],getLikeUser:null,allFullZan:!1},giveOneGetOneCards:[]},actions:b,mutations:L,plugins:[]});function N(e){var t=e.split("_");return 2===t.length?parseInt(t[1]):0}function w(e,t,n){for(var r=n&&n.list?n.list:[],o=0;o<t.length;o++){for(var i=null,a=0;a<r.length;a++)parseInt(r[a].designId.split("_")[1])===o&&(i=r[a]);null!==i?(t[o].needVoteCount=i.needVoteCount,t[o].voter=i.voter,t[o].isOfficalVoted=i.isOfficalVoted&&1===i.isOfficalVoted):(t[o].needVoteCount=e>="20190502"?2:3,t[o].voter=[],t[o].isOfficalVoted=!1)}return t}},34:function(e,t,n){var r,o,i=n(1),a=n.n(i),u=n(4),s=n.n(u),c=n(10),l=n.n(c),f=n(5),d=n.n(f),_=n(9),E=(n(42),n(2)),p=function(e){return(e/100).toFixed(2)},h=n(116),I=n(103),m=n(3);n.d(t,"a",(function(){return v})),n.d(t,"e",(function(){return T})),n.d(t,"d",(function(){return g})),n.d(t,"f",(function(){return A})),n.d(t,"b",(function(){return R})),n.d(t,"c",(function(){return O})),n.d(t,"g",(function(){return k})),d.a.use(_.default);var v="FREE_LIBRARY_INIT",T="FREE_LIBRARY_REFRESH_LIMIT",g="FREE_LIBRARY_REFRESH_GUESS",A="FREE_LIBRARY_UNLOAD",R="FREE_LIBRARY_RECEIVE",O="FREE_LIBRARY_REFRESH_GIVEONEGETONE",S=(r={},a()(r,v,(function(e,t){var n=this,r=e.commit;return l()(s.a.mark((function e(){var o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(o=m.default.getCampaignDebugVol())&&(t.debugVol=o),e.abrupt("return",E.default.commonCloudFuncRequest("freeLibraryInitNew",t).then((function(e){return e&&(e.from=t.from||"",r(v,e)),e})));case 3:case"end":return e.stop()}}),e,n)})))()})),a()(r,T,(function(e){var t=this,n=e.commit;return l()(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n(T);case 1:case"end":return e.stop()}}),e,t)})))()})),a()(r,g,(function(e){var t=this,n=e.commit;return l()(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n(g);case 1:case"end":return e.stop()}}),e,t)})))()})),a()(r,A,(function(e){var t=this,n=e.commit;return l()(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n(A);case 1:case"end":return e.stop()}}),e,t)})))()})),a()(r,O,(function(e){var t=this,n=e.commit;return l()(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n(O);case 1:case"end":return e.stop()}}),e,t)})))()})),a()(r,R,(function(e,t){var n=this;return e.commit,l()(s.a.mark((function e(){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=m.default.getCampaignDebugVol())&&(t.debugVol=r),e.abrupt("return",E.default.commonCloudFuncRequest("freeLibraryReceive",t).then((function(e){return e})).catch((function(e){return console.log("err FREE_LIBRARY_RECEIVE:",e),{succ:0}})));case 3:case"end":return e.stop()}}),e,n)})))()})),r),C=(o={},a()(o,v,(function(e,t){var n=t.vol,r=t.type,o=t.receivedData,i=t.limitBookListData,a=t.infoData,u=t.guessULikeListData,s=t.isMySelf,c=t.shareBookInfo,l=t.maxShareCount,f=t.receiveCount,d=t.from,_=t.shareBookVol;if(e.vol=n,e.title="book"===r?"免费图书馆":"免费听书馆","detail"===d){var E=function(e,t,n,r){for(var o=n||[],i=r[e]||[],a=!1,u=0;u<o.length;u++){for(var s=b(t,o[u]),c=0;c<i.length;c++){var l=i[c],f="book"===t?s.bookId:s.lectureInfo.authorVid+"_"+s.bookId;String(l)===String(f)&&(s.received=1,a=!0)}s.parameter=h.a.scheme(t),o[u]=s}if("lecture"===t&&a)for(var d=0;d<o.length;d++)o[d].hasBookReceived=!0;return"lecture"===t?o.slice(0,6):function(e){for(var t=[],n=[],r=0;r<e.length;r++)null!=e[r]&&-1===n.indexOf(e[r].bookId)&&(t.push(e[r]),n.push(e[r].bookId));return t.slice(0,18)}(o)}(n,r,a?a.bookInfos:[],o);E=function(e){for(var t=e.concat(),n=60-t.length;n>=6;)n-=6;for(var r=0;r<n;r++)t.push({bookId:null});return t}(E),"book"===r&&E.length>6?(e.canRefreshGiveOneGetOneBooks=!0,e.giveOneGetOneBooks=E,e.giveOneGetOneShowIndex=0,e.giveOneGetOneBooksShow=E.slice(0,6)):(e.canRefreshGiveOneGetOneBooks=!1,e.giveOneGetOneBooksShow=E),e.giveOneGetOneBookCount=E.length;var m=function(e){if(!e)return Date.now();e=String(e);var t=parseInt(e.substr(0,4)),n=parseInt(e.substr(4,2)),r=parseInt(e.substr(6,2));return new Date(t,n-1,r,21,0,0).getTime()+6048e5}(a?a.date:null);if(function(e){return Date.now()<e}(m)){var v=function(e,t){var n=[],r=[];if("book"===e){r=t.data||[];for(var o=0;o<r.length;o++){var i=r[o].books;if(4===r[o].type)for(var a=0;a<i.length;a++)i[a].bookInfo&&i[a].bookInfo.centPrice&&i[a].bookInfo.centPrice>0&&0===i[a].type&&n.push(i[a])}}else{r=t.books||[];for(var u=0;u<r.length;u++)r[u].lectureInfo&&r[u].lectureInfo.price&&r[u].lectureInfo.price>0&&n.push(r[u])}for(var s=0;s<n.length;s++)n[s]=L(e,n[s]);return n.slice(0,12)}(r,i);e.limitBookListWithPriceChunk=y(v,3),e.limitBookListWithPrice=v,e.canLimitBookListRefresh=v.length>=6,e.limitBookEndTimeDate=function(e){var t=e-Date.now(),n=Math.floor(t/864e5);t%=864e5;var r=Math.floor(t/36e5);t%=36e5;var o=Math.floor(t/6e4),i="";return n>0&&(i=n+"天"),r>0&&(i+=r+"小时"),o>0&&(i+=o+"分"),i}(m)}else e.limitBookListWithPriceChunk=[],e.limitBookListWithPrice=[];var T=function(e,t){for(var n=[],r=0;r<t.length;r++)"book"===e?23===t[r].type&&(n=t[r].books):323===t[r].type&&(n=t[r].books);for(var o=0;o<n.length;o++)n[o]=L(e,n[o]);return n.slice(0,12)}(r,u);e.guessULikeListChunk=y(T,3),e.guessULikeList=T,e.canGuessULikeRefresh=T.length>=6}else{e.isMySelf=s;var g=function(e,t){var n=null;if(t&&t.bookInfo&&t.sender&&("book"===e||"lecture"===e&&t.authorInfo)){n={};var r=t.bookInfo,o=t.readingOrListenCnt;o=o>0?Object(I.default)(o):null,n.bookInfo={bookId:r.bookId,author:r.author,availables:r.availables,price:p(r.centPrice),cover:r.cover,title:r.title,isLecture:"lecture"===e,readingOrListenCnt:o?o.number+o.unit:null};var i=t.sender;if(n.sender={userVid:i.userVid,name:i.name,avatar:i.avatar},"lecture"===e){var a=t.authorInfo;n.author={userVid:a.author,name:a.author,avatar:a.author}}}return n}(r,c);e.shareBookInfo=g,g&&(e.maxShareCount=l,e.status=function(e,t,n,r,o,i){var a=(e[t]||[]).map((function(e){return String(e)})),u=function(e){var t=e,n=t.substr(0,4),r=t.substr(4,2),o=t.substr(6,2);return new Date(n+"-"+r+"-"+o+" 21:00:00").getTime()+6048e5}(t),s=String(r.bookInfo.bookId);"lecture"===n&&(s=s+"_"+r.author.userVid);var c=0;(a.indexOf(s)>-1?c=1:o>=i&&(c=2),1!==c&&2!==c)&&(Date.now()>u&&(c=3));return c}(o,_,r,g,f,l))}e.bookIds=function(e){for(var t=[],n=0;n<e.length;n++)e[n]&&e[n].bookId&&t.push(e[n].bookId);return t}(a?a.bookInfos:[])})),a()(o,T,(function(e){e.limitBookListWithPriceChunk=y(e.limitBookListWithPrice,3)})),a()(o,g,(function(e){e.guessULikeListChunk=y(e.guessULikeList,3)})),a()(o,O,(function(e){var t=Math.ceil(e.giveOneGetOneBooks.length/6),n=e.giveOneGetOneShowIndex;(n+=1)>=t&&(n=0),e.giveOneGetOneShowIndex=n,e.giveOneGetOneBooksShow=e.giveOneGetOneBooks.slice(6*n,6*(n+1))})),a()(o,A,(function(e){e.limitBookListWithPrice=[],e.limitBookListWithPriceChunk=[],e.guessULikeList=[],e.guessULikeListChunk=[],e.giveOneGetOneBooks=[],e.canLimitBookListRefresh=!1,e.canGuessULikeRefresh=!1,e.giveOneGetOneShowIndex=0,e.giveOneGetOneBooksShow=[],e.canRefreshGiveOneGetOneBooks=!1})),o),k=new _.default.Store({state:{vol:"",type:"book",title:"免费图书馆",limitBookListWithPrice:[],limitBookListWithPriceChunk:[],canLimitBookListRefresh:!1,guessULikeList:[],guessULikeListChunk:[],canGuessULikeRefresh:!1,giveOneGetOneBooks:[],giveOneGetOneBookCount:0,canRefreshGiveOneGetOneBooks:!1,giveOneGetOneBooksShow:[],giveOneGetOneShowIndex:0,isMySelf:!0,shareBookInfo:null,status:0,maxShareCount:1,limitBookEndTimeDate:"",bookIds:[]},actions:S,mutations:C,plugins:[]});function b(e,t){var n={title:t.title,cover:t.cover,bookId:t.bookId,author:t.author,free:t.free,hasLecture:t.hasLecture,price:p(t.centPrice)};return"lecture"===e&&t.lectureInfo&&(n.isLecture=!0,n.lectureInfo=t.lectureInfo),"lecture"===e&&t.lectureInfo?n.price=p(t.lectureInfo.price):n.price=p(t.centPrice),n}function L(e,t){var n=t.bookInfo,r={bookId:n.bookId,title:n.title,author:n.author,cover:n.cover,price:p(n.centPrice),type:n.type,free:n.free,reason:t.reason,readingCount:t.readingCount};return"lecture"===e&&t.lectureInfo&&(r.isLecture=!0,r.lectureInfo=t.lectureInfo),r}function y(e,t){if(e.length<=t)return e;for(var n=e.length,r=[];r.length<t;){var o=e[Math.floor(Math.random()*n)];-1===r.indexOf(o)&&r.push(o)}return r}},35:function(e,t,n){n.r(t),n.d(t,"INIT",(function(){return A})),n.d(t,"REDEEM",(function(){return R})),n.d(t,"store",(function(){return b}));var r,o=n(1),i=n.n(o),a=n(4),u=n.n(a),s=n(8),c=n.n(s),l=n(10),f=n.n(l),d=n(5),_=n.n(d),E=n(9),p=(n(42),n(0)),h=n(2),I=n(3),m=n(80),v=n(151),T=n(49),g=new m.a;_.a.use(E.default);var A="INIT",R="REDEEM";function O(e){var t=e.userActiveType,n=e.birdBox,r=e.birdBoxyw;I.default.saveUserInfo({userActiveType:t,birdBox:n,birdBoxyw:r}),T.default.commit(p.QUERY_USERACTIVETYPE,{activeType:t,birdBox:n,birdBoxyw:r})}var S=(r={},i()(r,A,(function(e,t){var n=this,r=e.commit,o=e.dispatch,i=t.autoRedeem,a=void 0!==i&&i;return f()(u.a.mark((function e(){var t,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.default.infiniteGiftQuery().catch((function(e){throw console.error("[infiniteCard] INIT queryInfiniteGiftInfo",e),e&&"I am a brownie."===e.errMsg&&O({userActiveType:"brown"}),e}));case 2:if(t=e.sent,O({userActiveType:i=t.userActiveType,birdBox:t.birdBox,birdBoxyw:t.birdBoxyw}),t.appClickDays&&t.appShareDays||g.tryConsumeAllCode(),"brown"!==i){e.next=8;break}return e.abrupt("return",c.a.reject(new Error("User is ineligible for this campaign.")));case 8:if(r(A,{redeemableInfiniteDays:t.redeemableInfiniteDays,redeemedInfiniteDays:t.redeemedInfiniteDays,appShareDays:t.appShareDays,appClickDays:t.appClickDays}),!a){e.next=11;break}return e.abrupt("return",o(R));case 11:return e.abrupt("return",{redeemableInfiniteDays:t.redeemableInfiniteDays,redeemedInfiniteDays:t.redeemedInfiniteDays,appShareDays:t.appShareDays,appClickDays:t.appClickDays});case 12:case"end":return e.stop()}}),e,n)})))()})),i()(r,R,(function(e){var t=this,n=e.state,r=e.commit;return f()(u.a.mark((function e(){var o,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.redeemableInfiniteDays){e.next=2;break}return e.abrupt("return",c.a.reject(new Error("User is ineligible for this campaign.")));case 2:return o=I.default.getUser(),i=o.userActiveType,e.abrupt("return",h.default.receiveInfinite(i,Object(v.a)(o.userActiveType)).then((function(e){return r(A,{redeemableInfiniteDays:0,redeemedInfiniteDays:e.day}),T.default.dispatch(p.QUERY_INFINITE),{redeemableInfiniteDays:0,redeemedInfiniteDays:e.day}})).catch((function(e){throw e})));case 5:case"end":return e.stop()}}),e,t)})))()})),r),C={appRedeemableDays:function(e){return Math.min(e.appClickDays,30)}},k=i()({},A,(function(e,t){var n=t.redeemableInfiniteDays,r=t.redeemedInfiniteDays,o=t.appClickDays,i=t.appShareDays;n>=0&&(e.redeemableInfiniteDays=n),r>=0&&(e.redeemedInfiniteDays=r),o>=0&&(e.appClickDays=o),i>=0&&(e.appShareDays=i)})),b=new E.default.Store({state:{redeemableInfiniteDays:0,redeemedInfiniteDays:0,appShareDays:0,appClickDays:0},getters:C,actions:S,mutations:k,plugins:[]})},36:function(e,t,n){n.d(t,"a",(function(){return I})),n.d(t,"b",(function(){return m})),n.d(t,"d",(function(){return v})),n.d(t,"f",(function(){return T})),n.d(t,"e",(function(){return g})),n.d(t,"c",(function(){return A})),n.d(t,"g",(function(){return R})),n.d(t,"h",(function(){return C}));var r,o,i=n(1),a=n.n(i),u=n(8),s=n.n(u),c=n(4),l=n.n(c),f=n(10),d=n.n(f),_=n(5),E=n.n(_),p=n(9),h=(n(42),n(2));E.a.use(p.default);var I="INIT",m="INIT_MINE",v="LOTTERY_HISTORY",T="UNLOAD_LOTTERY_HISTORY",g="LOTTERY_JOIN",A="LOTTERY_CREATE",R="UNLOAD_MINE_LOTTERY",O=(r={},a()(r,I,(function(e,t){var n=this,r=e.commit;return d()(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",h.default.commonCloudFuncRequest("lotteryInfo",t).then((function(e){return e&&e.collage&&r(I,e),e})));case 1:case"end":return e.stop()}}),e,n)})))()})),a()(r,m,(function(e,t){var n=this,r=e.commit;return d()(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",h.default.commonCloudFuncRequest("lotteryInfo",t).then((function(e){return e&&e.collage&&r(m,e),e})));case 1:case"end":return e.stop()}}),e,n)})))()})),a()(r,v,(function(e){var t=this,n=e.commit,r=e.state;return d()(l.a.mark((function e(){var o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=r.lotteryHistoryMaxIdx,e.abrupt("return",h.default.commonCloudFuncRequest("lotteryHistory",{maxIdx:o}).then((function(e){e&&n(v,e)})));case 2:case"end":return e.stop()}}),e,t)})))()})),a()(r,T,(function(e){(0,e.commit)(T)})),a()(r,g,(function(e,t){var n=this,r=e.commit;return d()(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",h.default.commonCloudFuncRequest("lotteryJoin",t).then((function(e){return e.collageId&&h.default.commonCloudFuncRequest("lotteryInfo",{collageId:e.collageId}).then((function(e){r(I,e)})),s.a.resolve(e)})).catch((function(e){return s.a.resolve(e)})));case 1:case"end":return e.stop()}}),e,n)})))()})),a()(r,A,(function(e){var t=this,n=e.commit;return d()(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",h.default.commonCloudFuncRequest("lotteryCreate",null).then((function(e){return h.default.commonCloudFuncRequest("lotteryInfo",{collegeId:e.collegeId}).then((function(e){n(I,e)})),s.a.resolve(e.collageId)})));case 1:case"end":return e.stop()}}),e,t)})))()})),a()(r,"GIFT_LOTTERY_CREATE",(function(e){var t=this,n=e.commit;return d()(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",h.default.commonCloudFuncRequest("lotteryCreate",null).then((function(e){return h.default.commonCloudFuncRequest("lotteryGiftInfo").then((function(e){n("GIFT_LOTTERY_INFO",e)})),s.a.resolve(e.collageId)})));case 1:case"end":return e.stop()}}),e,t)})))()})),a()(r,"GIFT_LOTTERY_INFO",(function(e){var t=this,n=e.commit;return d()(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",h.default.commonCloudFuncRequest("lotteryGiftInfo").then((function(e){n("GIFT_LOTTERY_INFO",e)})));case 1:case"end":return e.stop()}}),e,t)})))()})),a()(r,R,(function(e){(0,e.commit)(R)})),r),S=(o={},a()(o,I,(function(e,t){var n=t.collage,r=t.myCollage,o=t.isSelfCollage,i=t.userInfo,a=t.hasHistory,u=void 0!==a&&a;e.userInfo=i,e.hasHistory=u||!1,e.collage=n,e.myCollage=r||!1,e.isSelfCollage=o})),a()(o,m,(function(e,t){var n=t.collage,r=t.myCollage,o=t.isSelfCollage,i=t.userInfo,a=t.hasHistory,u=void 0!==a&&a;e.mine.userInfo=i,e.mine.hasHistory=u||!1,e.mine.collage=n,e.mine.myCollage=r||!1,e.mine.isSelfCollage=o})),a()(o,"GIFT_LOTTERY_INFO",(function(e,t){if(t){var n={collage:t.collage};t.lastCollage&&(n.lastCollageInfinite=t.lastCollage.infinite),n.lotteryPhase=(r=parseInt((new Date).getTime()/1e3),o=parseInt((r-1537588800)/604800)-1,a=(i=new Date).getTime(),u=i.getDay(),"第"+o+"期  "+((s=new Date(a-864e5*(u+1))).getMonth()+1+"."+s.getDate())+" - "+((c=new Date(a-864e5*(u-6))).getMonth()+1+"."+c.getDate())),e.giftLotteryInfo=n}var r,o,i,a,u,s,c})),a()(o,v,(function(e,t){var n=t.list,r=t.hasMore;e.lotteryHistoryList=e.lotteryHistoryList.concat(n||[]),e.hasMoreHistory=r||!1;var o=e.lotteryHistoryList.length;o>0&&(e.lotteryHistoryMaxIdx=e.lotteryHistoryList[o-1].idx)})),a()(o,T,(function(e){e.lotteryHistoryList=[],e.hasMoreHistory=!1,e.lotteryHistoryMaxIdx=0})),a()(o,R,(function(e){e.mine={userInfo:{},collage:{},myCollage:{},hasHistory:!1,isSelfCollage:!1,hasMoreHistory:!1,lotteryHistoryList:[],lotteryHistoryMaxIdx:0,giftLotteryInfo:null}})),o),C=new p.default.Store({state:{userInfo:{},collage:{},myCollage:{},hasHistory:!1,isSelfCollage:!1,hasMoreHistory:!1,lotteryHistoryList:[],lotteryHistoryMaxIdx:0,giftLotteryInfo:null,mine:{userInfo:{},collage:{},myCollage:{},hasHistory:!1,isSelfCollage:!1,hasMoreHistory:!1,lotteryHistoryList:[],lotteryHistoryMaxIdx:0,giftLotteryInfo:null}},getters:{},actions:O,mutations:S,plugins:[]})},38:function(e,t,n){n.d(t,"a",(function(){return h})),n.d(t,"b",(function(){return v}));var r=n(1),o=n.n(r),i=n(4),a=n.n(i),u=n(8),s=n.n(u),c=n(10),l=n.n(c),f=n(5),d=n.n(f),_=n(9),E=(n(42),n(2)),p=n(90);d.a.use(_.default);var h="INIT",I=o()({},h,(function(e,t){var n=this,r=e.commit,o=(e.state,t.inviterVid),i=t.inviterPf,u=t.type,c=t.packetId;return l()(a.a.mark((function e(){var t,l;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o){e.next=3;break}return t={errMsg:"invalid inviter"},e.abrupt("return",s.a.reject(t));case 3:return l={inviterVid:o,inviterPf:i,type:u,packetId:c},e.abrupt("return",E.default.commonCloudFuncRequest("invitationDataV2",l).then((function(e){r(h,e)})));case 5:case"end":return e.stop()}}),e,n)})))()})),m=o()({},h,(function(e,t){var n=t.inviter,r=t.invitee,o=t.infiniteGiftDay,i=t.infiniteAppClickDays,a=t.infiniteAppShareDays,u=t.recentBooks;r&&r.name&&(r.longName=Object(p.a)(r.name,20),r.name=Object(p.a)(r.name,10)),e.invitee=r,n&&n.name&&(n.name=Object(p.a)(n.name,12)),e.inviter=n,e.infiniteGiftDay=o,e.infiniteAppClickDays=i,e.infiniteAppShareDays=a,u&&u.length>=2?e.inviterRecentBooks=u.slice(0,3):e.inviterRecentBooks=null})),v=new _.default.Store({state:{isNewUser:!1,inviter:{},invitee:{},infiniteGiftDay:0,infiniteAppClickDays:0,infiniteAppShareDays:0,inviterRecentBooks:null},getters:{},actions:I,mutations:m,plugins:[]})},39:function(e,t,n){n.r(t);var r=n(2);t.default=function(e,t){e&&t?(console.log("reportLaunchAppFail act:",e+" options:",t),t.scene&&1036===parseInt(t.scene)?r.default.reportKVLog({itemname:"Wp_"+e+"_appError"}):r.default.reportKVLog({itemname:"Wp_"+e+"_errScene"}),r.default.reportKVLog({itemname:"Wp_"+e+"_launchAppError"})):console.error("has no options or no act")}},405:function(e,t,n){n(40);var r=n(27),o=n.n(r),i=n(17),a=n.n(i),u=n(48),s=n.n(u),c=n(59),l=n.n(c),f=n(236),d=n.n(f),_=function(){function e(t){s()(this,e),this.valueGetterOfDataItem=t,this.sectionLength=5e3,this.sections=[]}return l()(e,[{key:"getSection",value:function(e){return e>=0&&e<this.sections.length?this.sections[e]:null}},{key:"sectionsCount",value:function(){return this.sections.length}},{key:"_appendToCurrentSection",value:function(e){0===this.sections.length?this._appendToNewSection(e):this.sections[this.sections.length-1].data.push(e)}},{key:"_appendToNewSection",value:function(e){this.sections.push({data:[e]})}},{key:"appendDataItem",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(0===this.sections.length)this._appendToNewSection(e);else if(t)this._appendToCurrentSection(e);else{var n=(this.sections.length-1)*this.sectionLength,r=this.sections.length*this.sectionLength,o=this.valueGetterOfDataItem(e);o>=n&&o<r?this._appendToCurrentSection(e):this._appendToNewSection(e)}}},{key:"_findSectionIdx",value:function(e){for(var t=this.sections,n=0,r=t.length;n<r;n++)for(var o=t[n].data,i=0,a=o.length;i<a;i++)if(this.valueGetterOfDataItem(o[i])>e)return 0===i?0===n?n:n-1:n;if(t.length>0){var u=t[t.length-1].data;if(u.length>0&&e>=this.valueGetterOfDataItem(u[u.length-1]))return t.length-1}return 0}},{key:"calcTargetSectionIdx",value:function(e){var t=e.requestSectionIdx,n=e.isGetLastSection,r=e.progressChapterOffset,o=-1;return(o=t>=0?t:!0===n?this.sectionsCount()-1:r>=0?this._findSectionIdx(r):0)<0&&(o=0),this.sectionsCount()>0&&o>this.sectionsCount()-1&&(o=this.sectionsCount()-1),o}},{key:"sectionRanges",value:function(){for(var e=[],t=this.sections,n=this.valueGetterOfDataItem,r=0,o=t.length;r<o;r++){var i=t[r],a=r+1<o?t[r+1]:null;if(i.data.length>0){var u={start:n(i.data[0]),end:a?n(a.data[0]):Number.MAX_VALUE};e.push(u)}}return e}},{key:"toString",value:function(){var e=this;return"Sections { sectionLength:"+this.sectionLength+", sections("+this.sections.length+"): [ "+this.sections.map((function(t){return"["+t.data.map((function(t){return e.valueGetterOfDataItem(t)}))+"]"}))+" ] }"}}]),e}(),E=n(15),p=void 0,h=[],I=[],m=function(){function e(){s()(this,e),this._doms=[]}return l()(e,[{key:"push",value:function(e){return!!e&&(this._doms.push(e),!0)}},{key:"pop",value:function(){if(this.isEmpty())return null;var e=this.top();return this._doms.length=this._doms.length-1,e}},{key:"top",value:function(){if(this.isEmpty())return null;var e=this._doms.length;return this._doms[e-1]}},{key:"bottom",value:function(){return this.isEmpty()?null:this._doms[0]}},{key:"delete",value:function(){this._doms.length=0}},{key:"isEmpty",value:function(){return this._doms.length<=0}}]),e}(),v=["address","article","aside","audio","blockquote","body","canvas","dd","div","dl","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","noscript","ol","output","p","pre","section","table","tfoot","ul","br","code","li"],T=["br","hr","img","area","meta","base","link","input","frame","param","object","embed","keygen","source"],g=["video","audio"];function A(e){if(!e||"string"!=typeof e)return"";for(var t=e.split(/\n/),n=[],r=-1,o=0,i=t.length;o<i;o++){var a=t[o],u=a.trim();r+=1,u.length>0&&n.push({content:u,offset:r+a.indexOf(u)}),r+=a.length}for(var s="",c=0,l=n.length;c<l;c++)s+="<p>"+n[c].content+"</p>";return{html:'<div style="margin-top: 24px;">'+s+"</div>",sectionIndex:0,hasMore:!1}}t.a={parse:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments[3],i=arguments[4],u=arguments[5];if(-1===e.indexOf("<body"))return A(e);u&&E.default.setStorageSync(u,e);var s,c,l="EPUBXSSDATA_"+r+"_"+i,f=E.default.getStorageSync(l);if(o()(f).length>0)e=f.xssHtml,h=f.posData,I=f.contentLengthAndIndex;else{p||(c={whiteList:{body:(s=["class","id"]).concat(["class","style"]),a:s.concat(["target","href","title"]),abbr:s.concat(["title"]),address:s,area:s.concat(["shape","coords","href","alt"]),article:s,aside:s,audio:s.concat(["autoplay","controls","loop","preload","src"]),b:s,bdi:s.concat(["dir"]),bdo:s.concat(["dir"]),big:s,blockquote:s.concat(["cite"]),br:s,caption:s,center:s,cite:s,code:s,col:s.concat(["align","valign","span","width"]),colgroup:s.concat(["align","valign","span","width"]),dd:s,del:s.concat(["datetime"]),details:s.concat(["open"]),div:s,dl:s,dt:s,em:s,font:s.concat(["color","size","face"]),footer:s,h1:s,h2:s,h3:s,h4:s,h5:s,h6:s,header:s,hr:s,i:s,img:s.concat(["src","alt","title","width","height","data-w","data-ratio"]),ins:s.concat(["datetime"]),li:s,mark:s,nav:s,ol:s,p:s,pre:s,s:s,section:s,small:s,span:s,sub:s,sup:s,strong:s,table:s.concat(["width","border","align","valign"]),tbody:s.concat(["align","valign"]),td:s.concat(["width","rowspan","colspan","align","valign"]),tfoot:s.concat(["align","valign"]),th:s.concat(["width","rowspan","colspan","align","valign"]),thead:s.concat(["align","valign"]),tr:s.concat(["rowspan","align","valign"]),tt:s,u:s,ul:s,video:s.concat(["autoplay","controls","loop","preload","src","height","width"])},onTag:function(e,t,n){n.isWhite&&h.push({tag:e,srcHtml:t,isClosing:n.isClosing,pos:n.position,srcPos:n.sourcePosition})},onIgnoreTag:function(e,t,n){return n.isClosing||console.log("[chantlog] readerHtmlParser-onIgnoreTag",t),""},onIgnoreTagAttr:function(e,t,n){if("style"===t)return'style="'+n+'"'},safeAttrValue:function(e,t,n,r){var o=d.a.safeAttrValue(e,t,n,r);return"video"!==e&&"img"!==e||"src"!==t||""!==o||0!==n.indexOf("../")?"body"===e&&"class"===t?n:o:n}},p=new d.a.FilterXSS(c));var R=function(e){var t={allContentMerged:"",contentLengthAndIndex:[]};if(!e||0===e.length)return t;for(var n=/<body[^>]*>\s*([\s\S]*?)\s*<\/body>/g,r=n.exec(e);r;){if(r&&2===r.length){var o=r[0],i=r.index;t.allContentMerged=t.allContentMerged+o,t.contentLengthAndIndex.push({contentLength:o.length,indexInFullHtml:i})}r=n.exec(e)}return t}(e);e=R.allContentMerged,I=R.contentLengthAndIndex,h.length=0,e=p.process(e),E.default.setStorageSync(l,{xssHtml:e,posData:h,contentLengthAndIndex:I})}for(var O=new _((function(e){return e.pos})),S=0,C=h.length;S<C;S++){var k=h[S];if(!k.isClosing){var b=-1!==v.indexOf(k.tag);O.appendDataItem(k,!b)}}var L=O.sectionRanges(),y=n>L.length-1?L.length-1:n;e=function(e,t){for(var n="",r=0,o=/<body[^>]*>/g,i=/class="([^"]+)">/,a=o.exec(e);a;){if(1===a.length){var u=a[0],s=a.index,c=s+u.length,l=-1!==u.indexOf("background-image");if(!l){var f=i.exec(u);if(f&&2===f.length)for(var d=f[1].split(" "),_=0,E=d.length;_<E;_++){var p=d[_],h=t.indexOf(p);if(-1!==h){var I=t.indexOf("{",h);if(-1!==I){var m=t.indexOf("}",I);if(-1!==m&&-1!==t.slice(I,m).indexOf("background-image")){l=!0;break}}}}}n+=e.slice(r,s),n+=l?u.replace("<body",'<div data-wr-bd="1" data-wr-inset="1"'):u.replace("<body",'<div data-wr-bd="1"'),r=c}a=o.exec(e)}return r<e.length&&(n+=e.slice(r)),n.replace(/<\/body>/g,"</div>")}(e=function(e){var t=e.html,n=e.tagPosDatas,r=e.targetSectionRange,o=e.domStack;if(!t||0===t.length)return t;if(!n||0===n.length)return t;for(var i=[],u="",s=0,c=0,l=0,f=!1,d=!1,_=function(){var e=n[l];if(e.isClosing||-1===v.indexOf(e.tag)||(f=e.pos>=r.start&&e.pos<r.end,d=e.pos>=r.end),d)return s<e.pos&&(c=e.pos,u+=t.slice(s,c),s=c),"break";var _=f,p=-1===T.indexOf(e.tag),h=_||p;if(e.isClosing){if((E=o.top()).tag===e.tag?o.pop():console.error("Error: DomStack error, top="+a()(E)+", curTagData="+a()(e)),f)c=t.indexOf(">",e.pos)+1,h&&(u+=t.slice(s,c)),s=c;else{var I=i.pop();u=u.slice(0,I)}var m=l+1<n.length?n[l+1]:void 0;if(m){var A=m.pos;if(_){var R=t.slice(s,A);u+=R}s=A}l++}else if(p&&-1===g.indexOf(e.tag)&&o.push(e),c=e.pos+1+e.tag.length,h&&(i.push(u.length),u+=t.slice(s,c)),s=c,c=t.indexOf(">",e.pos)+1,h&&(u+=t.slice(s,c)),s=c,-1!==g.indexOf(e.tag)){var O=function(e,t,n){if(n>=e.length)return-1;for(var r=n;r<e.length;r++)if(t(e[r]))return r;return-1}(n,(function(t){return t.tag===e.tag&&t.isClosing}),l);if(-1!==O){var S=n[O];_&&(u+=t.slice(s,S.pos)),s=S.pos,l=O+1}else l++}else{var C=l+1<n.length?n[l+1]:void 0;if(C){var k=C.pos;if(_){var b=t.slice(s,k);u+=b}s=k}l++}};l<n.length;){var E;if("break"===_())break}for(;!o.isEmpty();){var p=o.pop();p.isClosing?log.info("parse html error",p):u+="</"+p.tag+">"}return u}({html:e,tagPosDatas:h,targetSectionRange:L[y],domStack:new m}),t);var N=new RegExp("<a[^>]*>|</a[^>]*>","gi");e=e.replace(N,"");var w=new RegExp('<img(?!<img).+?alt="(.+?)"(?!<img).+?qqreader-footnote(?!<img).+?>',"gi");return{html:(e=(e=(e=(e=e.replace(w,'<a href="javascript:;" class="reader_footer_note js_readerFooterNote" data-wr-footernote="$1"></a>')).replace(/\.\.\/video\/(.*?\.(mp4|wmv|3gp|rm|rmvb|mov|m4v|avi))/gi,"https://res.weread.qq.com/wrepub/web/"+r+"/$1")).replace(/\.\.\/images\/(.*?\.(png|jpg|jpeg|gif))/gi,"https://res.weread.qq.com/wrepub/web/"+r+"/$1")).replace(/&ensp;|&emsp;|&thinsp;|&zwnj;|&zwj;/g,"&nbsp;")).trim(),sectionIndex:y,hasMore:y<L.length-1}},parseTxt:A}},406:function(e,t,n){var r=n(8),o=n.n(r),i=n(27),a=n.n(i),u=n(100),s=n.n(u),c=n(17),l=n.n(c),f=n(53),d=n.n(f),_=n(57),E=n.n(_),p=n(56),h=n.n(p),I=n(225),m=n.n(I),v=n(23),T=n.n(v),g=n(106),A=n.n(g),R=n(67),O=n.n(R),S=function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||O()(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=17)}([function(e,t,n){var r="function"==typeof A.a&&"symbol"===T()(m.a)?function(e){return void 0===e?"undefined":T()(e)}:function(e){return e&&"function"==typeof A.a&&e.constructor===A.a&&e!==A.a.prototype?"symbol":void 0===e?"undefined":T()(e)},o=e.exports;o.fn={getParams:function(e){if(!e)return{};var t=e.replace(/.+?\?/,"").replace(/#.*/,"").split("&"),n={};for(var r in t){var o=t[r].split("=");2===o.length&&(n[o[0]]=o[1])}return n},each:function(e,t){var n,r=0,i=e.length;if(void 0===i&&o.lang.isObject(e)){for(var a in e)if(!1===t.call(e[a],e[a],a,e))break}else for(n=e[0];r<i&&!1!==t.call(n,n,r,e);n=e[++r]);return e},extend:function(e){for(var t=1;t<=arguments.length;t++)for(var n in arguments[t])e[n]=arguments[t][n];return e},formatFloat:function(e,t,n,r){return r=~~r?~~r:t+1,intNumber=Math.round(e*Math.pow(10,r)),Math[n](intNumber/Math.pow(10,r-t))/Math.pow(10,t)},uuid:function(e,t){var n,r,o="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),i=[];if(t=t||o.length,e)for(n=0;n<e;n++)i[n]=o[0|Math.random()*t];else for(i[8]=i[13]=i[18]=i[23]="-",i[14]="4",n=0;n<36;n++)i[n]||(r=0|16*Math.random(),i[n]=o[19==n?3&r|8:r]);return i.join("")},emptyFun:function(){},callFunc:function(e,t,n){if(o.lang.isFunction(e)){if(o.lang.isArray(t))return e.apply(n||null,t);var i=arguments.length,a=[].slice.call(arguments,1,i);return n="object"===r(arguments[i-1])?arguments[i-1]:null,e.apply(n,a)}}},o.lang={is:function(e,t){var n=Object.prototype.toString.call(t).slice(8,-1);return null!=t&&n===e},isNumber:function(e){return this.is("Number",e)},isString:function(e){return this.is("String",e)},isFunction:function(e){return this.is("Function",e)},isObject:function(e){return this.is("Object",e)},isDocument:function(e){return null!=e&&e.nodeType==e.DOCUMENT_NODE},isWindow:function(e){return null!=e&&e==e.window},isPlainObject:function(e){return o.lang.isObject(e)&&!o.lang.isWindow(e)&&h()(e)==Object.prototype},isArray:function(e){return this.is("Array",e)}},o.req={serializeParam:function(e){if(!e)return"";var t=[];for(var n in e)void 0===e[n]&&null==e[n]||t.push(n+"="+e[n]);return t.join("&")}},o.string={escHTML:function(e,t){var n=["&","&amp;","<","&lt;",">","&gt;"," ","&nbsp;",'"',"&quot;","'","&#39;","\\r","<br>","\\n","<br>"];t&&n.reverse();for(var r=0,o=e;r<n.length;r+=2)o=o.replace(new RegExp(n[r],"g"),n[1+r]);return o},tmpl:function(e,t){return"string"==typeof e?e.replace(/\$([a-zA-Z0-9_\.]*)\$/g,(function(e,n){if(-1!==n.indexOf(".")){n=n.split(/\./g);var r=t;return o.fn.each(n,(function(e){r=r[e]})),r||""}return void 0!==t[n]?t[n]:""})):e}},o.tmpl=o.string.tmpl,o.inherits=function(e,t){var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e,e._super=t},o.scene=function(){var e={isWxPlugin:!1,isComponent:!1,isOwnerMP:!1};try{e.isWxPlugin=WECHATAPP_PLUGIN}catch(e){}try{e.isComponent=STANDALONE_COMPONENT}catch(e){}try{e.isOwnerMP=PLUGIN_OWNER_MP}catch(e){}return e}();var i={};o.timer={start:function(e){(e=o.lang.isArray(e)?e:[e]).forEach((function(e){i[e]=(new Date).getTime()}))},get:function(e,t){var n=(e=o.lang.isArray(e)?e:[e]).map((function(e){var n=(new Date).getTime()-i[e];return t&&(i[e]=n),n}));return n.length>1?n:n[0]},stop:function(e){return o.timer.get(e,!0)},clear:function(e){(e=o.lang.isArray(e)?e:[e]).forEach((function(e){delete i[e]}))}}},function(e,t,n){var r=null;e.exports={setContext:function(e){r=e},getContext:function(){return r},getVersion:function(){return"1.4.0"},destroyContext:function(){r instanceof Object&&null!=r&&(r.destroyed=!0)}}},function(e,t,n){function r(e,t,n){return t in e?O()(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var o,i=t.code={SUCCESS:0,FAIL:-1,CANCEL:-2,INTERFACENOTEXIST:-3,PARAMS_ERROR:1e3};t.msg=(r(o={},i.SUCCESS,"支付成功"),r(o,i.FAIL,"支付失败"),r(o,i.CANCEL,"支付取消"),r(o,i.PARAMS_ERROR,"参数错误"),r(o,i.INTERFACENOTEXIST,"接口不存在"),r(o,"CHANNEL_NOT_SUPPORT","渠道不支持"),o)},function(e,t,n){var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),O()(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(0),i=function(){function e(t){var n=t.ret,r=t.err_code,o=t.msg;(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.result={resultCode:n,resultMsg:o,innerCode:r||""}}return r(e,[{key:"setExtra",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o.fn.extend(this.result,e)}},{key:"getResult",value:function(){return this.result}}]),e}();e.exports=i},function(e,t,n){function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.opt=e,this.params=null,this.callback=null,this.app=null}var o=n(0);o.fn.extend(r.prototype,{launchPay:function(e,t){if(this.params=e,!o.lang.isFunction(t))throw Error("callback must be a function");this.callback=t},destroy:function(){try{this.app&&this.app.destroy&&(this.app.destroy(),this.app=null),this.callback=null}catch(e){}}}),e.exports=r},function(e,t,n){function r(e){var t=e.params,n=e.callback,r=e.opt;if(this.params=t,this.opt=r,this.callback=n,this.env={},!a.lang.isFunction(this.callback))throw new Error("callback must be a function");this.payMod=null,i.setContext(this),a.fn.extend(this.params,{env:~~this.opt.env}),this.reportObj=new u,this.payStartTime=(new Date).getTime()}var o=n(11),i=n(1),a=n(0),u=n(14),s=n(2),c=n(3),l=n(8);r.hasContext=function(){var e=i.getContext();return!(e&&e.destroyed||!i.getContext())},a.fn.extend(r.prototype,{checkEnv:function(e){var t=this;wx.getSystemInfo({success:function(e){t.env=e||{}},complete:function(){a.lang.isFunction(e)&&e()}})},isEnterprise:function(){return!1},getPlatform:function(){var e=this.env;return e.model?e.model.indexOf("iPhone")>-1?"ios":"android":""},getVersion:function(){var e=this.env;return e&&e.version||""},getPayStartTime:function(){return this.payStartTime},report:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.reportObj.send(e,t,{3:this.params.openid,37:this.params.session_id,43:this.params.session_type,41:this.params.login_wx_appid,26:this.params.pf,7:n.resultCode||0,19:this.params.service_code||"",24:this.params.appid||this.params.offer_id,50:this.getPlatform()+"_"+this.getVersion(),51:this.params.aid||""})},clientLog:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this.report("client.log",{msg:e,line:t,file:n})},getPayMod:function(){return this.payMod},directPay:function(e){var t=this;return e&&o.hasOwnProperty(e)?(this.report("directpay",{channel:e}),o[e](null,(function(e){try{var n=(new Date).getTime();t.report("payduration",{time:n-t.getPayStartTime()})}catch(e){}t.callback(e)})),!0):(this.report("directpay.nosupport",{channel:e}),!1)},getBizAppid:function(){return 1!=this.opt.use_default_wxappid?this.params.biz_appid||"1":this.payMod.getDefaultBizAppid()},paramsError:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";setTimeout((function(){e.callback(new c({ret:s.code.PARAMS_ERROR,msg:t||s.msg[s.code.FAIL]}).getResult())}),0)},showPayLoading:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3;try{wx.showToast({title:"支付中...",icon:"loading",duration:1e3*e})}catch(e){}},hidePayLoading:function(){try{wx.hideToast()}catch(e){}},destroy:function(){i.destroyContext(),this.callback=a.fn.emptyFun,this.reportObj.destroy(),this.payMod=null,l.clearNetworkTask()}}),e.exports=r},function(e,t,n){e.exports=function(e,t,n){if("launchPay"!=t)return n;var r=n.value;return n.value=function(){for(var e=this,t=arguments.length,n=Array(t),o=0;o<t;o++)n[o]=arguments[o];~~this.opt.env?wx.showModal({content:"温馨提示：您即将进入测试环境，任何充值都无法在真实环境中使用。若您不是测试人员，请勿充值。",showCancel:!1,success:function(t){t.confirm&&r.apply(e,n)}}):r.apply(this,n)},n}},function(e,t,n){function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1];if(this.params=e,this.callback=t,!o.lang.isFunction(this.callback))throw new Error("callback must be a function")}var o=(n(1),n(0)),i=n(3);o.fn.extend(r.prototype,{buy:function(e){},handlerBuy:function(e){},getChannelName:function(){return""},constructResult:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=new i(e);return o.fn.extend(t,{channel:this.getChannelName()}),n.setExtra(t),n.result},getSecondErrcode:function(e){if(e.err_code){var t=e.err_code.split("-");return t[1]?t[1]:""}return""}}),r.ResultAdapter=i,e.exports=r},function(e,t,n){var r=void 0,o=r=n(0),i=(n(15),e.exports=function(e){e=e||{},this.pf=e.pf||"html5",this.pfkey=e.pfkey||"pfkey",this.appid=e.appid,this.sandbox=~~e.sandbox,this.sessionObj=e.sessionObj||null,this.mid=e.mid||"r",this.domain="api.unipay.qq.com",1==this.sandbox?this.domain="sandbox.api.unipay.qq.com":2==this.sandbox&&(this.domain="dev.api.unipay.qq.com"),this.domainq=this.sandbox?"sandbox.api.unipay.qq.com":"q.unipay.qq.com",this.sessionToken=e.sessionToken||o.fn.uuid()+(new Date).getTime(),e.extend&&(this.extend=e.extend)});for(var a in i.requestTask={},i.addNetworkTask=function(e,t,n){var r={task:t,timeout:n};i.requestTask[e]=r},i.clearNetworkTask=function(e){if(e){if(i.requestTask.hasOwnProperty(e)){var t=i.requestTask[e];try{t.timeout&&clearTimeout(t.timeout),t.task&&t.task.abort&&t.task.abort()}catch(e){}try{delete i.requestTask[e]}catch(e){}}}else{for(var n in i.requestTask){var r=i.requestTask[n];try{r.hasOwnProperty("timeout")&&clearTimeout(r.timeout),r.task&&r.task.abort&&r.task.abort()}catch(e){}}i.requestTask={}}},i.genTaskId=function(){return r.fn.uuid()+"_"+(new Date).getTime()},i.url={},i.url.mobileGoodsInfo={url:"$domain$$params$&",https:!0},i.url.mobileSaveGoods3={url:"$domain$$params$&",https:!0},i.url.wechatAppProc={url:"$domain$/v1/r/$appid$/wechatapp_proc?",https:!0},i.url.jiefenPayGoods={url:"https://m.jifen.qq.com/cgi-bin/pay_goods?",https:!0},i.isEnterprise=!1,i.prototype={setCrypto:function(){},setEnv:function(e){if(e&&this.sandbox)switch(this.env=e,e){case"dev":this.domain="dev.api.unipay.qq.com";break;case"sandbox":this.domain="sandbox.api.unipay.qq.com"}},restoreEnv:function(){this.sandbox&&this.setEnv("sandbox")},set isSandbox(e){this.sandbox=e,this.domain=this.sandbox?"sandbox.api.unipay.qq.com":"api.unipay.qq.com"},_getCgiUrl:function(e,t,n){return t=t||{},n=n||{},o.tmpl(e.url,o.fn.extend({appid:this.appid,mid:this.mid||"r",domain:["https:","//",n.domainq?this.domainq:this.domain].join("")},t))},setSession:function(e){this.sessionObj=e},_getSessionParam:function(){return o.fn.extend({pf:this.pf,pfkey:this.pfkey,from_h5:1,session_token:this.sessionToken,r:Math.random()},this.sessionObj.getSessionParam())},request:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments[2],o=arguments[3];if(o=o||{},wx){r.fn.extend(t,{webversion:"midaswxapp_1.4.0"});try{o.disableLoading||wx.showToast({title:"支付中",icon:"loading",duration:7e3})}catch(e){}var a={ret:-1},u=void 0,s=i.genTaskId(),c=wx.request({url:e,method:o.method||"GET",header:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded"},data:t,success:function(e){var t=void 0;e.statusCode>=200&&e.statusCode<=299&&(t=e.data),t||(t={ret:-9998,httpCode:e.statusCode,msg:"系统繁忙，请稍后再试！"}),a=t},fail:function(e){var t=e.errMsg;a={ret:-9999,msg:"请求超时！（"+(void 0===t?"":t)+"）"}},complete:function(){i.clearNetworkTask(s),u=null;try{o.disableLoading||wx.hideToast()}catch(e){}n(a)}});u=setTimeout((function(){u=null;try{c.abort()}catch(e){}}),7e3),i.addNetworkTask(s,c,u)}}},i.url)!function(e){i.prototype[e]=function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};t=t||{};var a={};o.fn.extend(a,this._getSessionParam()),o.fn.extend(a,t),this.request(this._getCgiUrl(i.url[e]),a,n,r)}}(a);i.prototype.mobileGoodsInfo=function(e,t,n){e=e||{};var r={};o.fn.extend(r,this._getSessionParam()),o.fn.extend(r,e);var a=e.params;delete e.params,a&&/\/mobile_goods_info\?/.test(a)&&(a=a.replace(/\/[a-z_]+\?/,"/wechatapp_proc?")),this.request(this._getCgiUrl(i.url.mobileGoodsInfo,{params:a}),r,t,n)},i.prototype.mobileSaveGoods=function(e,t,n){e=e||{};var r={biz_appid:this.sessionObj.appid||""},a=(e._url,e._mid,e._params);delete e._url,delete e._mid,delete e._params,o.fn.extend(r,this._getSessionParam()),o.fn.extend(r,e),a&&/\/mobile_goods_info\?/.test(a)&&(a=a.replace(/\/[a-z_]+\?/,"/wechatapp_proc?")),this.request(this._getCgiUrl(i.url.mobileSaveGoods3,{params:a}),r,t,n)}},function(e,t,n){function r(e){this.params=e,this.params.extend=e.extend||"",this.session=new o({openid:e.openid,openkey:e.openkey||"no_key",sessionid:e.session_id||"hy_gameid",sessiontype:e.session_type||"wc_actoken"}),this.processType="",this.cgi=null}var o=n(16),i=n(8),a=(n(2),n(0));n(1),a.fn.extend(r.prototype,{getPayParams:function(){return this.params},initCgi:function(){this.cgi=new i({pf:this.params.pf,pfkey:this.params.pfkey||"pfkey",appid:this.params.appid||this.params.offer_id,sandbox:~~this.params.env,sessionObj:this.session})},getInfoPublicParams:function(){var e={process_type:this.processType,page_type:"mall"};return this.params.login_wx_appid&&a.fn.extend(e,{wx_appid:this.params.login_wx_appid}),e},getSavePublicParams:function(){return{process_type:this.processType,page_type:"order",from_https:"1",from_h5:"1",extend:encodeURIComponent(this.params.extend||""),provide_uin:this.params.provide_uin||"",wx_appid:this.params.login_wx_appid||""}},getDefaultBizAppid:function(){return""},save:function(e,t){},checkPublicParams:function(){var e=this.params,t="",n={status:!0,msg:""};return a.fn.each(["offer_id","openid"],(function(n){if(!e[n])return t=n+"错误",!1})),t&&(n.status=!1,n.msg=t),n},getCurrencyType:function(){return this.params.currency_type||""},needCurrencyType:function(){return"wechat_app"==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"")&&!this.params.currency_type}}),e.exports=r},function(e,t,n){function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:["buy_quantity","pf","zoneid"];return function(t){t.prototype.checkGameParams=function(){var t=this,n={status:!0,msg:""},r=this.checkPublicParams();return r.status?(a.fn.each(e,(function(e){if(!t.params[e])return n.status=!1,n.msg=e+"错误",!1;var r=t.params[e];"string"==typeof r&&(t.params[e]=r)})),n):r}}}var o,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),O()(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(0),u=n(9),s=n(1),c=r()(o=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":T()(t))&&"function"!=typeof t?e:t}(this,(t.__proto__||h()(t)).call(this,e));return n.processType="save",n.initCgi(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":T()(t)));e.prototype=E()(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(d.a?d()(e,t):e.__proto__=t)}(t,u),i(t,[{key:"getBuyPage",value:function(e){this.cgi.wechatAppProc(a.fn.extend({},this.getInfoPublicParams(),{zoneid:this.getZoneid(),accounttype:"common",buy_quantity:this.params.buy_quantity||"1"}),e)}},{key:"getZoneid",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).zoneid||this.params.zoneid||"1"}},{key:"save",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1],n={};a.fn.extend(n,this.getSavePublicParams()),a.fn.extend(n,{buy_quantity:e.buy_quantity||this.params.buy_quantity||"1",zoneid:this.getZoneid(this.buyParams),accounttype:e.accounttype||"common",service_name:encodeURIComponent(this.params.service_name||""),discountid:this.params.discountid||""}),a.fn.extend(n,e),this.doSave(n,t)}},{key:"doSave",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1];s.getContext().report("startsave.pv");var n=(new Date).getTime();this.cgi.wechatAppProc(e,(function(e){s.getContext().report("savestatus",{httpCode:e.httpCode||"200",resultMsg:e.msg,times:(new Date).getTime()-n},{resultCode:e.ret}),t(e)}),{method:"POST"})}}]),t}())||o;c.decorators={checkGameParams:r},e.exports=c},function(e,t,n){var r=n(12),o=n(13);e.exports={wechat:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1];new r(e,t)},wechatapp:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1];new o(e,t)}}},function(e,t,n){function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1];u.call(this,e,t),this.buy(this.params)}var o=n(1),i=n(2),a=n(0),u=n(7);a.inherits(r,u),a.fn.extend(r.prototype,{buy:function(e){var t=this;o.getContext().report("wechat.buy");var n={biz_appid:o.getContext().getBizAppid(),wx_direct_pay:0,wx_publice_pay:1,pay_method:"wechat"};e=a.fn.extend({},n,e);var r=o.getContext().getPayMod();"1"==r.getPayParams().change_wx_openid&&(e.change_wx_openid="1"),r.save(e,(function(n){return t.handlerBuy(n,e)}))},getChannelName:function(){return"wechat"},handlerBuy:function(e,t){var n=this;if(o.getContext().report("wechat.handlebuy"),~~e.ret)this.callback.call(null,this.constructResult(e));else{var r=e.wx_info,u=(r.wx_sign_url,r.wx_appid,r.wx_time),s=r.wx_noncenum,c=r.wx_package,l=r.wx_signtype||"SHA1",f=r.wx_sign,d=!1,_="";o.getContext().report("wechatpay.start.pv"),a.scene.isOwnerMP||a.scene.isWxPlugin?this.callback.call(null,{resultCode:0,wx_info:r}):wx.requestPayment({timeStamp:u,nonceStr:s,package:c,signType:l,paySign:f,complete:function(e){o.getContext().report("wechatpay.complete.callback"),e.errMsg=e.errMsg||"";var t=e.errMsg.indexOf("cancel")>-1,r=d?i.code.SUCCESS:i.code.FAIL;!d&&t&&(r=i.code.CANCEL);var a=(_=e.errMsg)||i.msg[r];o.getContext().report("wechatpay.status",{msg:_,channel:n.getChannelName()},{resultCode:r}),n.callback.call(null,n.constructResult({ret:r,msg:a}))},success:function(e){o.getContext().report("wechatpay.success.callback"),d=!0},fail:function(e){o.getContext().report("wechatpay.fail.callback",{},{resultCode:"-9999"}),d=!1}})}}}),e.exports=r},function(e,t,n){var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),O()(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(1),i=n(2),a=n(0),u=n(7),s={5001:"buyQuantity参数错误，请参考虚拟支付教程中虚拟支付API接口说明",7007:"获取微信授权失败，请使用小游戏管理员账号重新授权登录",7006:"配置信息未发布沙箱，请在MP管理端将游戏币托管配置信息进行“沙箱发布”"},c=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments[1];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":T()(t))&&"function"!=typeof t?e:t}(this,(t.__proto__||h()(t)).call(this,e,n));return wx&&wx.requestVirtualPayment?r.buy(r.params):(o.getContext().report("requestVirtualPayment.notexist"),r.callback.call(null,r.constructResult({ret:i.code.INTERFACENOTEXIST,msg:i.msg[i.code.INTERFACENOTEXIST]}))),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":T()(t)));e.prototype=E()(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(d.a?d()(e,t):e.__proto__=t)}(t,u),r(t,[{key:"buy",value:function(e){var t=this;o.getContext().report("wechat_app.buy");var n=o.getContext().getPayMod();if(n.needCurrencyType(this.getChannelName()))return o.getContext().paramsError("需要currency_type参数");var r={currency_type:n.getCurrencyType(),pay_method:this.getChannelName()};e=a.fn.extend({},r,e),"1"==n.getPayParams().change_wx_openid&&(e.change_wx_openid="1"),n.save(e,(function(n){return t.handlerBuy(n,e)}))}},{key:"getChannelName",value:function(){return"wechatapp"}},{key:"handlerBuy",value:function(e,t){var n=this;if(o.getContext().report("wechat_app.handlebuy"),~~e.ret){if(1003==e.ret){var r=this.getSecondErrcode(e);s[r]&&(e.msg=s[r])}this.callback.call(null,this.constructResult(e))}else{var a=!1,u="",c=e.wechatapp_info||{};wx&&wx.requestVirtualPayment?(o.getContext().report("wechatapp_pay.start.pv"),wx.requestVirtualPayment({priceLevel:c.price_level,businessOrderId:c.orderid,outTradeNo:c.orderid,desc:c.desc||"",virtualPaySign:c.sign,complete:function(e){o.getContext().report("wechatapp_pay.complete.callback"),e.errMsg=e.errMsg||"";var t=a?i.code.SUCCESS:void 0!==e.errCode?e.errCode:i.code.FAIL,r=1==e.errCode;!a&&r&&(t=i.code.CANCEL);var s=u||i.msg[t]||"";o.getContext().report("wechatapp_pay.status",{channel:n.getChannelName(),msg:s},{resultCode:e.errCode||""}),n.callback.call(null,n.constructResult({ret:t,msg:s}))},success:function(e){o.getContext().report("wechatapp_pay.success.callback"),a=!0},fail:function(e){o.getContext().report("wechatapp_pay.fail.callback",{},{resultCode:"-9999"}),a=!1,u=e&&e.errMsg}})):(o.getContext().report("requestVirtualPayment.notexist"),this.callback.call(null,this.constructResult({ret:i.code.INTERFACENOTEXIST,msg:i.msg[i.code.INTERFACENOTEXIST]})))}}}]),t}();e.exports=c},function(e,t,n){function r(){this.reportQueue=[],this.pid=0,this.iformatPrefix="",this.transactionId=o.fn.uuid()+"_"+(new Date).getTime(),this.handleReportComplete=this.handleReportComplete.bind(this)}var o=n(0),i=n(1);o.fn.extend(r.prototype,{constructParams:function(e,t,n){var r={};o.fn.extend(r,{6:10,7:0,8:t?o.req.serializeParam(t):"",13:this.pid++,21:[this.iformatPrefix,e].join("."),31:"midas_wx_sdk_"+i.getVersion(),38:(new Date).getTime(),29:this.transactionId}),o.fn.extend(r,n);var a=[];return o.fn.each(r,(function(e,t){a.push(t+"="+encodeURIComponent(e))})),"https://api.unipay.qq.com/v1/900/15499/log_data?num=1&record0="+encodeURIComponent(a.join("|"))+[].join("")+"&rr"+Math.random()},doSend:function(){var e=this,t=void 0,n=this.reportQueue[0];if(n){var r=wx.request({url:n,method:"GET",complete:function(){clearTimeout(t),e.handleReportComplete()}});t=setTimeout((function(){try{r.abort()}catch(e){}}),3e3)}},handleReportComplete:function(){this.reportQueue.shift(),this.reportQueue.length>0&&this.doSend()},send:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=this.constructParams(e,t,r);this.reportQueue.push(o),1==this.reportQueue.length&&setTimeout((function(){n.doSend()}),0)},destroy:function(){},setIformatPrefix:function(e){this.iformatPrefix=e}}),e.exports=r},function(e,t,n){var r=n(0),o=function(e){e=e||{},this.opt=e,this.interval=null};o.prototype.stop=function(e){0==e?clearTimeout(this.interval):1==e&&clearInterval(this.interval),this.interval=null},t.CountDown=function(e){if(o.call(this,e=e||{}),!(e.time&&e.beforeCount&&e.counting&&e.countEnd))throw Error("can not use countDown");e.beforeCount();var t=e.time,n=function(){if(this.interval){if(e.counting(t),t<=0)return this.stop(1),void e.countEnd();t--}};n(),this.interval=setInterval(n.bind(this),1e3)},r.inherits(t.CountDown,o),t.Timeout=function(e){(e=e||{}).time=e.time||5,o.call(this,e),this.interval=setTimeout(function(){this.interval&&(this.stop(0),e.timeUp&&e.timeUp())}.bind(this),1e3*e.time)},r.inherits(t.Timeout,o)},function(e,t,n){var r=n(0),o=e.exports=function(e){this.openid=e.openid,this.openkey=e.openkey,this.sessionid=e.sessionid,this.sessiontype=e.sessiontype,this.sessionToken=this.openid+(new Date).getTime()};r.fn.extend(o.prototype,{getSessionParam:function(){return{openid:encodeURIComponent(this.openid),openkey:encodeURIComponent(this.openkey),session_id:encodeURIComponent(this.sessionid),session_type:encodeURIComponent(this.sessiontype)}},addSessionParam:function(e){return r.fn.addParam({openid:encodeURIComponent(this.openid),openkey:encodeURIComponent(this.openkey),sessionid:encodeURIComponent(this.sessionid),sessiontype:encodeURIComponent(this.sessiontype)},e)},getUin:function(){return""}})},function(e,t,n){var r=n(18),o=n(0);e.exports={getVersion:function(){return"1.4.0"},subscribe:n(21),game:n(24),pcGame:n(26),goods:r,enterprise:o.fn.extend({},r,{init:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.isEnterprise=!0,r.init(e)}})}},function(e,t,n){function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o.call(this,e)}var o=n(4),i=n(19),a=n(0),u=n(6);a.inherits(r,o),a.fn.extend(r.prototype,{launchPay:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1];if(!i._super.hasContext()){o.prototype.launchPay.call(this,e,t);var n=this.callTime=Date.now();this.app=new i({params:e,opt:this.opt,callback:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.callTime!=n);else try{this.app&&this.app.report("before.callback",{callbackRes:l()(e)}),t(e)}catch(e){this.app&&this.app.clientReport&&this.app.clientReport("callback to user exception, msg = "+e.message+";stack="+(e.stack||""),32,"midaspay/api/goods.js")}try{r.instance.destroy(),r.instance=null}catch(e){}}.bind(this)})}}}),Object.defineProperty(r.prototype,"launchPay",u(r.prototype,"launchPay",s()(r.prototype,"launchPay"))),r.instance=null,e.exports={init:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return null!=r.instance?r.instance:r.instance=new r(e)},get:function(){if(!r.instance)throw Error("goods not initalize");return r.instance},destroy:function(){r.instance&&(r.instance.destroy(),r.instance=null)}}},function(e,t,n){function r(e){var t=this,n=e.params,r=void 0===n?{}:n,c=e.callback,l=void 0===c?function(){}:c,f=e.opt,d=void 0===f?{}:f;o.call(this,{params:r,callback:l,opt:d}),this.IFORMAT_PREFIX="midaswechatpay."+(this.isEnterprise()?"enterprise":"goods"),this.reportObj.setIformatPrefix(this.IFORMAT_PREFIX),this.payMod=new u(r);var _=this.payMod.checkGoodsParams();this.report("before.checkenv"),this.checkEnv((function(){if(t.report("after.checkenv"),_.status){t.report("goodsinfo.pv");var e=(new Date).getTime();t.payMod.getGoodsInfo((function(n){s.fn.callFunc(t.params.onGoodsInfo,n),t.report("goodsinfo.status",{httpCode:n.httpCode||"200",resultMsg:n.msg,errCode:n.err_code||"",times:(new Date).getTime()-e},{resultCode:n.ret});var r=!1,o={ret:a.code.FAIL,msg:a.msg[a.code.FAIL]};if(~~n.ret)o.ret=n.ret,o.msg=n.msg||a.msg[a.code.FAIL],o.err_code=n.err_code;else if(n.info&&n.info.channel&&s.lang.isArray(n.info.channel))try{t.directPay(n.info.channel[0]&&n.info.channel[0].name)?r=!0:(o.ret=a.code.FAIL,o.msg=a.msg.CHANNEL_NOT_SUPPORT)}catch(e){o.ret=a.code.FAIL,o.msg=e.message||"",t.report("directpay.exception",{msg:e.message,stack:e.stack},{resultCode:"-9999"})}else t.report("channel.info.exception",{},{resultCode:"-9999"});r||t.callback(new i(o).getResult())}))}else t.paramsError(_.msg)}))}var o=n(5),i=n(3),a=n(2),u=n(20),s=n(0);s.inherits(r,o),s.fn.extend(r.prototype,{isEnterprise:function(){return this.opt.isEnterprise}}),e.exports=r},function(e,t,n){function r(e){i.call(this,e),this.initCgi(),this.processType="bg",this.goodsInfo=null}var o=n(0),i=n(9),a=n(1);o.inherits(r,i),o.fn.extend(r.prototype,{getMid:function(){return(this.params.goodstokenurl||"").split("/")[2]},getTokenId:function(){return o.fn.getParams(this.params.goodstokenurl).token_id},getGoodsInfo:function(e,t){this.cgi.mobileGoodsInfo(o.fn.extend({},this.getInfoPublicParams(),{zoneid:this.getZoneid(),params:this.params.goodstokenurl}),e,t)},getZoneid:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).zoneid||this.params.zoneid||"1"},save:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1],n={token_id:this.getTokenId()};o.fn.extend(n,this.getSavePublicParams()),o.fn.extend(n,{zoneid:this.getZoneid(this.buyParams),buy_quantity:this.params.buy_quantity||""}),o.fn.extend(n,e),n._params=this.params.goodstokenurl,this.doSave(n,t)},doSave:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1];a.getContext().report("startsave.pv");var n=(new Date).getTime();this.cgi.mobileSaveGoods(e,(function(e){a.getContext().report("savestatus",{httpCode:e.httpCode||"200",resultMsg:e.msg,errCode:e.err_code,times:(new Date).getTime()-n},{resultCode:e.ret}),t(e)}),{method:"POST"})},checkGoodsParams:function(){var e=this,t={status:!0,msg:""},n=this.checkPublicParams();return n.status?(o.fn.each(["goodstokenurl","zoneid","pf"],(function(n){if(!e.params[n])return t.status=!1,t.msg=n+"错误",!1;var r=e.params[n];"string"==typeof r&&(e.params[n]=r)})),t):n}}),e.exports=r},function(e,t,n){var r,o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),O()(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(4),u=n(22),c=n(6),f=(function(e,t,n,r,o){var i={};a()(r).forEach((function(e){i[e]=r[e]})),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce((function(n,r){return r(e,t,n)||n}),i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(O()(e,t,i),i=null)}((r=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":T()(t))&&"function"!=typeof t?e:t}(this,(t.__proto__||h()(t)).call(this,e))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":T()(t)));e.prototype=E()(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(d.a?d()(e,t):e.__proto__=t)}(t,i),o(t,[{key:"launchPay",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments[1];if(!u.hasContext()){(function e(t,n,r){null===t&&(t=Function.prototype);var o=s()(t,n);if(void 0===o){var i=h()(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(r):void 0})(t.prototype.__proto__||h()(t.prototype),"launchPay",this).call(this,e,n);var r=this.callTime=Date.now();this.app=new u({params:e,opt:this.opt,callback:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.callTime!=r);else try{this.app&&this.app.report("before.callback",{callbackRes:l()(e)}),n(e)}catch(e){this.app&&this.app.clientReport&&this.app.clientReport("callback to user exception, msg = "+e.message+";stack="+(e.stack||""),32,"midaspay/api/subscribe.js")}try{t.instance.destroy(),t.instance=null}catch(e){}}.bind(this)})}}}]),t}()).prototype,"launchPay",[c],s()(r.prototype,"launchPay"),r.prototype),r);f.instance=null,e.exports={init:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return null!=f.instance?f.instance:f.instance=new f(e)},get:function(){if(!f.instance)throw Error("subscribe not initalize");return f.instance},destroy:function(){f.instance&&(f.instance.destroy(),f.instance=null)}}},function(e,t,n){var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),O()(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(23),i=n(5),a=n(0),u=n(3),c=n(2),l=function(e){function t(e){var n=e.params,r=void 0===n?{}:n,i=e.callback,s=void 0===i?function(){}:i,l=e.opt,f=void 0===l?{}:l;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var d=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":T()(t))&&"function"!=typeof t?e:t}(this,(t.__proto__||h()(t)).call(this,{params:r,callback:s,opt:f}));d.IFORMAT_PREFIX="midaswechatpay.subscribe",d.reportObj.setIformatPrefix(d.IFORMAT_PREFIX),d.payMod=new o(r);var _=d.payMod.checkSubscribeParams();return d.report("before.checkenv"),d.checkEnv((function(){if(d.report("after.checkenv"),d.payMod.checkSubscribeParams().status){d.report("monthinfo.pv");var e=(new Date).getTime();d.payMod.getMonthInfo((function(t){d.report("monthinfo.status",{httpCode:t.httpCode||"200",resultMsg:t.msg,errCode:t.err_code||"",times:(new Date).getTime()-e},{resultCode:t.ret});var n=!1,r={ret:c.code.FAIL,msg:c.msg[c.code.FAIL]};if(~~t.ret)r.ret=t.ret,r.msg=t.msg||c.msg[c.code.FAIL];else if(t.info&&t.info.channel&&a.lang.isArray(t.info.channel))try{d.directPay(t.info.channel[0]&&t.info.channel[0].name)?n=!0:(r.ret=c.code.FAIL,r.msg=c.msg.CHANNEL_NOT_SUPPORT)}catch(e){r.ret=c.code.FAIL,r.msg=e.message||"",d.report("directpay.exception",{msg:e.message,stack:e.stack},{resultCode:"-9999"})}else d.report("channel.info.exception",{},{resultCode:"-9999"});n||d.callback(new u(r).getResult())}))}else d.paramsError(_.msg)})),d}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":T()(t)));e.prototype=E()(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(d.a?d()(e,t):e.__proto__=t)}(t,i),r(t,[{key:"destroy",value:function(){(function e(t,n,r){null===t&&(t=Function.prototype);var o=s()(t,n);if(void 0===o){var i=h()(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(r):void 0})(t.prototype.__proto__||h()(t.prototype),"destroy",this).call(this)}}]),t}();e.exports=l},function(e,t,n){var r,o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),O()(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(0),a=n(9),u=n(1),s=function(e){e.prototype.checkSubscribeParams=function(){var e=this,t={status:!0,msg:""},n=this.checkPublicParams();return n.status?(i.fn.each(["pf","service_code"],(function(n){if(!e.params[n])return t.status=!1,t.msg=n+"错误",!1})),t):n}}(r=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":T()(t))&&"function"!=typeof t?e:t}(this,(t.__proto__||h()(t)).call(this,e));n.processType="unimonth";var r=[];return n.params.aid&&r.push("aid="+n.params.aid),n.params.appremark=encodeURIComponent(r.join("&")),n.account=n.params.account||"wechat",n.initCgi(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":T()(t)));e.prototype=E()(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(d.a?d()(e,t):e.__proto__=t)}(t,a),o(t,[{key:"getProvideNoType",value:function(){return this.params.provide_uin?"uin":"wechatid"}},{key:"getMonthInfo",value:function(e){this.cgi.wechatAppProc(i.fn.extend({},this.getInfoPublicParams(),{service_code:this.params.service_code,product_id:this.params.product_id,buy_quantity:this.params.buy_quantity||"1",provide_no_type:this.getProvideNoType()}),e)}},{key:"getAutocoutFromExtend",value:function(){return!!this.params.extend&&"1"==i.fn.getParams(this.params.extend).auto_cont}},{key:"save",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1],n={buy_quantity:e.buy_quantity||this.params.buy_quantity||1,service_code:this.params.service_code,product_id:e.product_id||this.params.product_id,appremark:this.params.appremark||"",provide_no_type:this.getProvideNoType(),service_name:this.params.service_name||""};i.fn.extend(n,this.getSavePublicParams()),i.fn.extend(n,e),("1"==this.params.auto_cont||this.getAutocoutFromExtend())&&(n.auto_cont="1"),"wechatid"==this.getProvideNoType()&&delete n.provide_uin,u.getContext().report("startsave.pv",{serviceCode:n.service_code,productId:n.product_id});var r=(new Date).getTime();this.cgi.wechatAppProc(n,(function(e){u.getContext().report("savestatus",{httpCode:e.httpCode||"200",resultMsg:e.msg,errCode:e.err_code,times:(new Date).getTime()-r},{resultCode:e.ret}),t(e)}),{method:"POST"})}}]),t}())||r;e.exports=s},function(e,t,n){var r,o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),O()(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(4),u=n(25),c=n(6),f=(function(e,t,n,r,o){var i={};a()(r).forEach((function(e){i[e]=r[e]})),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce((function(n,r){return r(e,t,n)||n}),i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(O()(e,t,i),i=null)}((r=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":T()(t))&&"function"!=typeof t?e:t}(this,(t.__proto__||h()(t)).call(this,e))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":T()(t)));e.prototype=E()(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(d.a?d()(e,t):e.__proto__=t)}(t,i),o(t,[{key:"launchPay",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments[1];if(!u.hasContext()){(function e(t,n,r){null===t&&(t=Function.prototype);var o=s()(t,n);if(void 0===o){var i=h()(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(r):void 0})(t.prototype.__proto__||h()(t.prototype),"launchPay",this).call(this,e,n);var r=this.callTime=Date.now();this.app=new u({params:e,opt:this.opt,callback:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.callTime!=r);else try{this.app&&this.app.report("before.callback",{callbackRes:l()(e)}),n(e)}catch(e){this.app&&this.app.clientReport&&this.app.clientReport("callback to user exception, msg = "+e.message+";stack="+(e.stack||""),31,"midaspay/api/game.js")}try{t.instance.destroy(),t.instance=null}catch(e){}}.bind(this)})}}}]),t}()).prototype,"launchPay",[c],s()(r.prototype,"launchPay"),r.prototype),r);f.instance=null,e.exports={init:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return null!=f.instance?f.instance:f.instance=new f(e)},get:function(){if(!f.instance)throw Error("game not initalize");return f.instance},destroy:function(){f.instance&&(f.instance.destroy(),f.instance=null)}}},function(e,t,n){var r=n(5),o=n(3),i=n(2),a=n(10),u=n(0),s=function(e){function t(e){var n=e.params,r=void 0===n?{}:n,s=e.callback,c=void 0===s?function(){}:s,l=e.opt,f=void 0===l?{}:l;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var d=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":T()(t))&&"function"!=typeof t?e:t}(this,(t.__proto__||h()(t)).call(this,{params:r,callback:c,opt:f}));d.IFORMAT_PREFIX="midaswechatpay.game",d.reportObj.setIformatPrefix(d.IFORMAT_PREFIX),d.payMod=new a(r);var _=d.payMod.checkGameParams();return d.report("before.checkenv"),d.checkEnv((function(){if(d.report("after.checkenv"),_.status){d.report("buypage.pv");var e=(new Date).getTime();d.payMod.getBuyPage((function(t){d.report("buypage.status",{httpCode:t.httpCode||"200",resultMsg:t.msg,errCode:t.err_code||"",times:(new Date).getTime()-e},{resultCode:t.ret});var n=!1,r={ret:i.code.FAIL,msg:i.msg[i.code.FAIL]};if(~~t.ret)r.ret=t.ret,r.msg=t.msg||i.msg[i.code.FAIL];else if(t.info&&t.info.channel&&u.lang.isArray(t.info.channel))try{d.directPay(t.info.channel[0]&&t.info.channel[0].name)?n=!0:(r.ret=i.code.FAIL,r.msg=i.msg.CHANNEL_NOT_SUPPORT)}catch(e){r.ret=i.code.FAIL,r.msg=e.message||"",d.report("directpay.exception",{msg:e.message,stack:e.stack},{resultCode:"-9999"})}else d.report("channel.info.exception",{},{resultCode:"-9999"});n||d.callback(new o(r).getResult())}))}else d.paramsError(_.msg)})),d}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":T()(t)));e.prototype=E()(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(d.a?d()(e,t):e.__proto__=t)}(t,r),t}();e.exports=s},function(e,t,n){var r,o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),O()(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(4),u=n(27),c=n(6),f=(function(e,t,n,r,o){var i={};a()(r).forEach((function(e){i[e]=r[e]})),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce((function(n,r){return r(e,t,n)||n}),i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(O()(e,t,i),i=null)}((r=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":T()(t))&&"function"!=typeof t?e:t}(this,(t.__proto__||h()(t)).call(this,e))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":T()(t)));e.prototype=E()(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(d.a?d()(e,t):e.__proto__=t)}(t,i),o(t,[{key:"launchPay",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments[1];if(!u.hasContext()){(function e(t,n,r){null===t&&(t=Function.prototype);var o=s()(t,n);if(void 0===o){var i=h()(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(r):void 0})(t.prototype.__proto__||h()(t.prototype),"launchPay",this).call(this,e,n);var r=this.callTime=Date.now();this.app=new u({params:e,opt:this.opt,callback:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.callTime!=r);else try{this.app&&this.app.report("before.callback",{callbackRes:l()(e)}),n(e)}catch(e){this.app&&this.app.clientReport&&this.app.clientReport("callback to user exception, msg = "+e.message+";stack="+(e.stack||""),31,"midaspay/api/pcgame.js")}try{t.instance.destroy(),t.instance=null}catch(e){}}.bind(this)})}}}]),t}()).prototype,"launchPay",[c],s()(r.prototype,"launchPay"),r.prototype),r);f.instance=null,e.exports={init:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return null!=f.instance?f.instance:f.instance=new f(e)},get:function(){if(!f.instance)throw Error("pcgame not initalize");return f.instance},destroy:function(){f.instance&&(f.instance.destroy(),f.instance=null)}}},function(e,t,n){var r=n(5),o=n(3),i=n(2),a=n(28),u=n(0),s=function(e){function t(e){var n=e.params,r=void 0===n?{}:n,s=e.callback,c=void 0===s?function(){}:s,l=e.opt,f=void 0===l?{}:l;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var d=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":T()(t))&&"function"!=typeof t?e:t}(this,(t.__proto__||h()(t)).call(this,{params:r,callback:c,opt:f}));d.IFORMAT_PREFIX="midaswechatpay.pcgame",d.reportObj.setIformatPrefix(d.IFORMAT_PREFIX),d.payMod=new a(r);var _=d.payMod.checkGameParams();return d.report("before.checkenv"),d.checkEnv((function(){if(d.report("after.checkenv"),_.status){d.report("buypage.pv");var e=(new Date).getTime();d.payMod.getBuyPage((function(t){d.report("buypage.status",{httpCode:t.httpCode||"200",resultMsg:t.msg,errCode:t.err_code||"",times:(new Date).getTime()-e},{resultCode:t.ret});var n=!1,r={ret:i.code.FAIL,msg:i.msg[i.code.FAIL]};if(~~t.ret)r.ret=t.ret,r.msg=t.msg||i.msg[i.code.FAIL];else if(t.info&&t.info.channel&&u.lang.isArray(t.info.channel))try{d.directPay(t.info.channel[0]&&t.info.channel[0].name)?n=!0:(r.ret=i.code.FAIL,r.msg=i.msg.CHANNEL_NOT_SUPPORT)}catch(e){r.ret=i.code.FAIL,r.msg=e.message||"",d.report("directpay.exception",{msg:e.message,stack:e.stack},{resultCode:"-9999"})}else d.report("channel.info.exception",{},{resultCode:"-9999"});n||d.callback(new o(r).getResult())}))}else d.paramsError(_.msg)})),d}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":T()(t)));e.prototype=E()(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(d.a?d()(e,t):e.__proto__=t)}(t,r),t}();e.exports=s},function(e,t,n){var r,o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),O()(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=(n(0),n(1),n(10)),a=i.decorators.checkGameParams(["buy_quantity","provide_uin"])(r=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":T()(t))&&"function"!=typeof t?e:t}(this,(t.__proto__||h()(t)).call(this,e));return n.initCgi(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":T()(t)));e.prototype=E()(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(d.a?d()(e,t):e.__proto__=t)}(t,i),o(t,[{key:"getZoneid",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).zoneid||this.params.zoneid||"1"}}]),t}())||r;e.exports=a}]),C={chargeByMidasPay:function(e,t,n){return new o.a((function(r,o){var i=S.game.init({env:0,autoDestroy:!1}),a=function(e,t,n){return{openid:e,offer_id:"1450013078",pf:t?"android":"iap",buy_quantity:parseFloat(n),zoneid:"1"}}(e,t,n);i.launchPay(a,(function(e){0===e.resultCode?r(e):o(e),S.game.destroy()}))}))}};t.a=C},42:function(e,t,n){n.r(t);var r=n(27),o=n.n(r),i=n(23),a=n.n(i);function u(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(null===e||"object"!==(void 0===e?"undefined":a()(e)))return e;var n,r=(n=function(t){return t.original===e},t.filter(n)[0]);if(r)return r.copy;var i=Array.isArray(e)?[]:{};return t.push({original:e,copy:i}),o()(e).forEach((function(n){i[n]=u(e[n],t)})),i}function s(e,t){return"0",n=t-e.toString().length,new Array(n+1).join("0")+e;var n}function c(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.collapsed,n=void 0===t||t,r=e.filter,o=void 0===r?function(e,t,n){return!0}:r,i=e.transformer,a=void 0===i?function(e){return e}:i,c=e.mutationTransformer,l=void 0===c?function(e){return e}:c,f=e.logger,d=void 0===f?console:f;return function(e){var t=u(e.state);e.subscribe((function(e,r){if(void 0!==d){var i=u(r);if(o(e,t,i)){var c=new Date,f=" @ "+s(c.getHours(),2)+":"+s(c.getMinutes(),2)+":"+s(c.getSeconds(),2)+"."+s(c.getMilliseconds(),3),_=l(e),E="mutation "+e.type+f,p=n?d.groupCollapsed:d.group;try{p.call(d,E)}catch(e){console.log(E)}d.log("%c prev state","color: #9E9E9E; font-weight: bold",a(t)),d.log("%c mutation","color: #03A9F4; font-weight: bold",_),d.log("%c next state","color: #4CAF50; font-weight: bold",a(i));try{d.groupEnd()}catch(e){d.log("—— log end ——")}}t=i}}))}}n.d(t,"default",(function(){return c}))},46:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(3));!function(e){e.DIN_MEDIUM="DIN-Medium",e.DIN_BOLD="DIN-Bold",e.WECHAT_NUMBER="WeChatNumber",e.MINION_PRO_IT="MinionPro-It",e.TTTGBMedium="TTTGBMedium",e.SOURCE_HAN_SERIF_CN_BOLD="SourceHanSerifCN-Bold",e.SOURCE_HAN_SERIF_CN_MEDIUM="SourceHanSerifCN-Medium"}(t.CustomFontFace||(t.CustomFontFace={})),t.loadFontFace=function(e){e&&e.fonts&&!o.default.getUser().isLowPerformanceDevice&&wx.loadFontFace&&e.fonts.forEach((function(e){wx.loadFontFace({family:e,source:'url("https://rescdn.qqmail.com/weread/assets/mini_program/'+e+'.ttf")',success:function(){console.log("[特殊字体] 加载成功",e)},fail:function(t){console.log("[特殊字体] 加载失败",e,t.errMsg)}})}))}},469:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){var t=[];if(e&&e.length>0)for(var n=0;n<e.length;n++){var r=parseInt(e[n]/100+""),o=e[n]%100,i=o>0;t[r]={index:r,score:o,right:i}}return t},o=function(e){if(!e)return{userVid:0};var t={};t.userVid=e.userVid,t.avatar=e.avatar,t.name=e.name,t.online=e.online?e.online:0,t.startBattle=e.startBattle?e.startBattle:0,t.userLevel=e.userLevel?e.userLevel:0,t.battleLevel=e.battleLevel?e.battleLevel:0,t.type=e.type?e.type:"",t.successRadio=e.successRadio?e.successRadio:0,t.inviteInfiniteScore=e.inviteInfiniteScore?e.inviteInfiniteScore:{},t.score=e.score?e.score:0,t.result=e.result?e.result:[],t.message=e.message||"",t.rank=e.rank||1,t.rankScore=e.rankScore||100011,t.rankInfo=e.rankInfo||{},t.raceGameType=e.raceGameType||"",t.gameScore=e.roundScore||0;var n=function(e){for(var t=0,n=0,r=e&&e.length>0?e:[],o=0,i=0;i<r.length;i++){var a=r[i]%100;a>0?t+=1:n+=1,o+=a}return t>0||n>0?{wrong:n,right:t,gameScore:o}:{wrong:0,right:0,gameScore:0}}(e.result);return n&&(t.wrong=n.wrong,t.right=n.right),t},i=function(e,t,n){return t&&e in t?t[e]:n};t.default={ParseBattleSnapshot:function(e){console.log("mxd snapshot原始数据:",e);var t="";e&&e.docChanges&&e.docChanges.length>0&&e.docChanges[0]&&(t=e.docChanges[0].dataType),"init"===t?console.log("实时DB监听初始化成功."):"remove"===t&&console.log("监听到对战记录被移除.");var n=null;e&&e.docs&&e.docs.length>0&&e.docs[0]&&(n=e.docs[0]),console.log("mxd实时DB监听情况:",t,n);var a=function(e,t){var n={};return"remove"===e?(n.battleStatus="timeout",n):(t&&(n.battleStatus=t.status,n.roundStartTime=t.roundStartTime,n.startTime=t.startTime,n.progress=t.progress,n.gameType=t.type,n.battleVol=t.battleVol,n.activityId=t.activityId,n.questionCount=t.questionCount),n)}(t,n),u=i("sponsor",n,null),s=o(u),c=i("challenger",n,null),l=o(c),f=i("question",n,null),d=function(e,t){return{sponsor:r(e),challenger:r(t)}}(i("result",s,[]),i("result",l,[]));return s.roundResult=d.sponsor,l.roundResult=d.challenger,{battleInfo:a,sponsor:s,challenger:l,question:f,battleResult:i("result",n,null),dbDataType:t}}}},47:function(e,t,n){var r,o,i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{s(r.next(e))}catch(e){i(e)}}function u(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){e.done?o(e.value):new n((function(t){t(e.value)})).then(a,u)}s((r=r.apply(e,t||[])).next())}))},u=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},c=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});var l=s(n(93)),f=(s(n(42)),s(n(3))),d=s(n(15)),_=s(n(2)),E=s(n(127)),p=s(n(498)),h=s(n(49)),I=c(n(0)),m=s(n(5)),v=s(n(9)),T=n(499);m.default.use(v.default),t.INIT_RACE_GAME="INIT_RACE_GAME",t.INIT_USER_INFO="INIT_USER_INFO",t.RACE_GAME_SHARE_INFO="RACE_GAME_SHARE_INFO",t.RACE_GAME_ANSWER_CORRECT="RACE_GAME_ANSWER_CORRECT",t.RACE_GAME_ANSWER_WRONG="RACE_GAME_ANSWER_WRONG",t.RACE_GAME_PROGRESS="RACE_GAME_PROGRESS",t.RACE_GAME_ANSWER="RACE_GAME_ANSWER",t.RACE_GAME_RESET_GAME="RACE_GAME_RESET_GAME",t.RACE_GAME_START="RACE_GAME_START",t.RACE_GAME_CONTINUE="RACE_GAME_CONTINUE",t.RACE_GAME_TO_PROP_CHECK="RACE_GAME_TO_PROP_CHECK",t.RACE_GAME_UPDATE_STATUS="RACE_GAME_UPDATE_STATUS",t.RACE_GAME_LOAD_QUESTION="RACE_GAME_LOAD_QUESTION",t.RACE_GAME_NEXT_QUESTION="RACE_GAME_NEXT_QUESTION",t.RACE_GAME_PRELOAD_QUESTION="RACE_GAME_PRELOAD_QUESTION",t.RACE_GAME_LOAD_SPECIFIC_QUESTION="RACE_GAME_LOAD_SPECIFIC_QUESTION",t.RACE_GAME_SET_SPECIFIC_QUESTION="RACE_GAME_SET_SPECIFIC_QUESTION",t.RACE_GAME_UPGRADE_QUESTION_LEVEL="RACE_GAME_UPGRADE_QUESTION_LEVEL",t.RACE_GAME_WHITELIST_USER="RACE_GAME_WHITELIST_USER",t.RACE_GAME_LOGIN_TIME="RACE_GAME_LOGIN_TIME",t.RACE_GAME_OPEN_APP="RACE_GAME_OPEN_APP",t.RACE_GAME_ACTIVE_TYPE="RACE_GAME_ACTIVE_TYPE",t.RACE_GAME_UPDATE_USERINFO="RACE_GAME_UPDATE_USERINFO",t.RACE_GAME_TOGGLE_VOICE="RACE_GAME_TOGGLE_VOICE",t.RACE_GAME_UPDATE_VOICE="RACE_GAME_UPDATE_VOICE",t.RACE_GAME_INVITE="RACE_GAME_INVITE",t.RACE_GAME_COIN="RACE_GAME_COIN",t.RACE_GAME_AD="RACE_GAME_AD",t.RACE_GAME_SHARE_RESURRECTION="RACE_GAME_SHARE_RESURRECTION",t.RACE_GAME_RENEWUSER_RESURRECTION="RACE_GAME_RENEWUSER_RESURRECTION",t.RACE_GAME_UPDATE_COIN="RACE_GAME_UPDATE_COIN",t.RACE_GAME_UPDATE_AD_TIME="RACE_GAME_UPDATE_AD_TIME",t.RACE_GAME_DECREASE_REMAINTIME="RACE_GAME_DECREASE_REMAINTIME",t.RACE_GAME_INCREASE_REMAINTIME="RACE_GAME_INCREASE_REMAINTIME",t.RACE_GAME_DEBUG_INFO="RACE_GAME_DEBUG_INFO",t.RACE_GAME_TRUCE_INFO="RACE_GAME_TRUCE_INFO",t.RACE_GAME_SHARE="RACE_GAME_SHARE",t.RACE_GAME_SUCC_CNT="RACE_GAME_SUCC_CNT",t.RACE_GAME_ANSWER_SUCC="RACE_GAME_ANSWER_SUCC",t.RACE_GAME_UPDATE_LEVEL="RACE_GAME_UPDATE_LEVEL",t.RACE_GAME_REVERTING_INIT="RACE_GAME_REVERTING_INIT",t.RACE_GAME_REVERTING_UPDATE="RACE_GAME_REVERTING_UPDATE",t.RACE_GAME_REVERTING_START="RACE_GAME_REVERTING_START",t.RACE_GAME_LOCAL_PROGRESS_UPDATE="RACE_GAME_LOCAL_PROGRESS_UPDATE",t.RACE_GAME_SET_TARGET_QUESTION="RACE_GAME_SET_TARGET_QUESTION",t.RACE_GAME_REPORT_WRONG_QUESTION="RACE_GAME_REPORT_WRONG_QUESTION",t.RACE_GAME_REPORT_ANALYSIS_LOG="RACE_GAME_REPORT_ANALYSIS_LOG",t.RACE_GAME_LOAD_LOCAL_WHITE_CONFIG="RACE_GAME_LOAD_LOCAL_WHITE_CONFIG",t.RACE_GAME_RANK_INIT="RACE_GAME_RANK_INIT",t.RACE_GAME_UPDATE_RANK="RACE_GAME_UPDATE_RANK",t.RACE_GAME_UPDATE_RANK_TYPE="RACE_GAME_UPDATE_RANK_TYPE",t.RACE_GAME_REPORT_QUESTION_RESULT="RACE_GAME_REPORT_QUESTION_RESULT",t.RACE_GAME_PROPS_INIT="RACE_GAME_PROPS_INIT",t.RACE_GAME_PROPS_UPDATE="RACE_GAME_PROPS_UPDATE",t.RACE_GAME_PROPS_CONSUME="RACE_GAME_PROPS_CONSUME",t.RACE_GAME_PROPS_PURCHASE="RACE_GAME_PROPS_PURCHASE",t.RACE_GAME_UPDATE_CHANGE_QUESTION="RACE_GAME_UPDATE_CHANGE_QUESTION",t.RACE_GAME_PROP_SHARE_INFO="RACE_GAME_PROP_SHARE_INFO",t.RACE_GAME_MCGAME_UPGRADE_SHARE_INFO="RACE_GAME_MCGAME_UPGRADE_SHARE_INFO",t.RACE_GAME_UPDATE_GAME_TYPE="RACE_GAME_UPDATE_GAME_TYPE",t.RACE_GAME_UPDATE_GAME_INFO="RACE_GAME_UPDATE_GAME_INFO";var g=!1;t.EMPTY_QUESTION={answer:-1,_id:""};var A={actions:((r={})[t.INIT_RACE_GAME]=function(e){var n=e.state,r=e.commit,o=e.dispatch;return a(this,void 0,void 0,(function(){var e,a,s;return u(this,(function(u){switch(u.label){case 0:return(e=f.default.getUser()).vid?[3,2]:[4,new Promise((function(t){f.default.login({success:function(){e=f.default.getUser(),t()}})}))];case 1:u.sent(),u.label=2;case 2:return a={avatar:e.avatar,lastAppLoginTime:e.lastAppLoginTime,name:e.name,vid:e.vid,isBlack:!1},r(t.INIT_USER_INFO,a),r(t.RACE_GAME_ANSWER_SUCC,!1),[4,l.default.raceGameInitUser(i({},a))];case 3:return s=u.sent(),o(t.RACE_GAME_ACTIVE_TYPE),s&&s.gameStatus&&("playing"!==s.gameStatus&&r(t.RACE_GAME_UPDATE_STATUS,s.gameStatus),"truce"===s.gameStatus&&s.userGameInfo&&r(t.RACE_GAME_TRUCE_INFO,s.userGameInfo),"playing"===s.gameStatus&&s.vol!==n.game.vol&&r(t.RACE_GAME_UPDATE_STATUS,"ready"),r(t.INIT_RACE_GAME,{gameStatus:s.gameStatus,gameTime:s.gameTime||{startTime:"",endTime:""},level:s.level,questionCnt:s.questionCnt,remainTime:s.remainTime,remainAdTime:s.remainAdTime,adType:s.adType,vol:s.vol,gameType:s.gameType,doubleReward:!!s.doubleReward}),"reverting"===s.gameStatus&&(o(t.RACE_GAME_REVERTING_INIT,i({},s.share,{count:0})),o(t.RACE_GAME_LOCAL_PROGRESS_UPDATE,{currentQuestion:s.startIndex}),o(t.RACE_GAME_SET_TARGET_QUESTION,s.startIndex)),s.reNewUser&&r(t.RACE_GAME_RENEWUSER_RESURRECTION,s.reNewUser)),s&&s.debugInfo&&r(t.RACE_GAME_DEBUG_INFO,s.debugInfo),o(t.RACE_GAME_PROGRESS),o(t.RACE_GAME_PROPS_INIT),_.default.userProfile(e.vid).then((function(e){var n=e.recentLoginTime||0;r(t.RACE_GAME_LOGIN_TIME,n),n&&Date.now()-1e3*n<864e5&&s.reNewUser&&"click"===s.reNewUser.state&&(o(t.RACE_GAME_REPORT_ANALYSIS_LOG,{itemname:"mp_raceGame_login_resurrection_Succ"}),l.default.raceGameLoginResurrectionUse().then((function(){o(t.RACE_GAME_PROGRESS)})).catch(E.default))})),[2,s]}}))}))},r[t.RACE_GAME_START]=function(e){var n=e.commit,r=e.dispatch;return a(this,void 0,void 0,(function(){return u(this,(function(e){return[2,r(t.RACE_GAME_LOAD_QUESTION).then((function(){n(t.RACE_GAME_START),r(t.RACE_GAME_LOAD_QUESTION),r(t.RACE_GAME_SHARE),r(t.RACE_GAME_PROPS_INIT)}))]}))}))},r[t.RACE_GAME_CONTINUE]=function(e){var n=e.commit,r=e.dispatch;return a(this,void 0,void 0,(function(){return u(this,(function(e){return[2,r(t.RACE_GAME_LOAD_QUESTION).then((function(){n(t.RACE_GAME_CONTINUE),r(t.RACE_GAME_LOAD_QUESTION)}))]}))}))},r[t.RACE_GAME_LOAD_LOCAL_WHITE_CONFIG]=function(e){var n=e.commit,r=!!d.default.getStorageSync("RACE_GAME_SHOW_ANSWER");n(t.RACE_GAME_LOAD_LOCAL_WHITE_CONFIG,r)},r[t.RACE_GAME_ANSWER_CORRECT]=function(e,n){var r,o=e.commit,i=e.dispatch,a=e.state,u=a.game.questionCnt,s=a.questions.length,c=(r=0,function(){if(!g){g=!0;var e=setTimeout((function(){wx.showLoading({title:"连接中……"})}),2e3),u=function(e){console.log("[RaceGameReportSucccess] Network Changed Rertying……",e),e.isConnected&&c()};return l.default.raceGameReportSuccess(a.game.level,0===r?0:1).then((function(r){clearTimeout(e),wx.hideLoading(),r&&(o(t.RACE_GAME_UPDATE_STATUS,"victory"),o(t.RACE_GAME_UPDATE_LEVEL,r.level),console.log("[RaceGameReportSucccess] Successfully reported!"));var u="mp_raceGame_reportVictory_afterFailed",s="Wp_raceGame_victory_AfterFailed";9===a.game.coin.count&&3===a.game.invite.count&&(u="mp_raceGame_reportVictory",s="Wp_raceGame_Victory"),i(t.RACE_GAME_REPORT_ANALYSIS_LOG,{index:n,itemname:u}),h.default.dispatch(I.KV_LOG_REPORT,{itemname:s}),g=!1;try{wx.offNetworkStatusChange()}catch(e){console.log(e)}})).catch((function(){g=!1,r<4?(c(),console.log("[RaceGameReportSucccess] Rertying……",r),r++):(i(t.RACE_GAME_REPORT_ANALYSIS_LOG,{itemname:"mp_raceGame_reportVictory_retryFailed"}),wx.onNetworkStatusChange(u))}))}});return n>=u-1?(c(),o(t.RACE_GAME_UPDATE_STATUS,"reportVictory"),o(t.RACE_GAME_ANSWER_SUCC,!0),i(t.RACE_GAME_PROGRESS),new Promise((function(e){e()}))):(o(t.RACE_GAME_NEXT_QUESTION,n+1),s<u?a.questions[n+1]?(i(t.RACE_GAME_LOAD_QUESTION),Promise.resolve()):i(t.RACE_GAME_LOAD_QUESTION):Promise.resolve())},r[t.RACE_GAME_ANSWER_WRONG]=function(e,n){var r=e.commit,o=e.state,i=e.dispatch,a=o.questions.length;return r(t.RACE_GAME_UPDATE_STATUS,"failed"),r(t.RACE_GAME_DECREASE_REMAINTIME),r(t.RACE_GAME_REVERTING_UPDATE,{count:1,qId:"",state:""}),l.default.raceGameReportFail(o.game.level,n.questionID,n.userSelection,a-2).then((function(e){return e&&(r(t.RACE_GAME_UPDATE_LEVEL,e.level),e.gift)?(i(t.RACE_GAME_PROPS_INIT),e.gift):null}))},r[t.RACE_GAME_LOAD_QUESTION]=function(e){var n=e.state,r=e.commit,o=e.dispatch,i=n.questions,a=n.game,u=n.user,s=i.length;if(n.game.questionCnt&&s>=n.game.questionCnt)return Promise.resolve();var c={index:s,level:a.upgrade?a.level+1:a.level,vid:u.vid},f=l.default.raceGameGetQuestion(c).then((function(e){if(e)if("playing"===n.game.status)r(t.RACE_GAME_UPDATE_STATUS,e.gameStatus);else if("truce"===e.gameStatus)o(t.INIT_RACE_GAME);else{if(n.questions&&n.questions.length&&n.questions.some((function(t){return t._id===e.question._id})))return l.default.raceGameGetQuestion(c).then((function(e){e&&e.question&&r(t.RACE_GAME_LOAD_QUESTION,e.question)}));r(t.RACE_GAME_LOAD_QUESTION,e.question)}})),d=new Promise((function(e,t){setTimeout((function(){t(new Error("load question timeout"))}),8e3)}));return Promise.race([f,d])},r[t.RACE_GAME_SHARE]=function(e){var t=e.state;return a(this,void 0,void 0,(function(){var e,n,r;return u(this,(function(o){return e=t.shareInfo.shareVid,n=t.shareInfo.propShare,e&&t.user&&t.user.vid&&e!==t.user.vid&&l.default.raceGameShare(e,t.user.name).then((function(n){n&&0===n.errCode&&(p.default.saveCanHelpShareRemainInfo(e,"SHARE_VID_INFO"),t.shareInfo=i({},t.shareInfo,{shareVid:0}))})),n.propShareVid&&n.propShareType&&n.propShareType.length&&n.propShareVid!==t.user.vid?l.default.raceGamePropsShare({shareVid:n.propShareVid,requestType:n.propShareType}).then((function(e){e&&0===e.errCode&&(p.default.saveCanHelpShareRemainInfo(n.propShareVid,"PROP_SHARE_VID_INFO"),t.shareInfo=i({},t.shareInfo,{propShare:{propShareType:"",propShareVid:0}}))})):console.log("[raceGame] send prop share error",n),(r=t.shareInfo.mcGameShareTicket||null)&&l.default.raceGamePropsShare({requestType:"mcGameUpgradeShare",ticket:r}),[2]}))}))},r[t.RACE_GAME_SHARE_INFO]=function(e,n){(0,e.commit)(t.RACE_GAME_SHARE_INFO,n)},r[t.RACE_GAME_RESET_GAME]=function(e){var n=e.commit;n(t.RACE_GAME_UPDATE_CHANGE_QUESTION,!1),n(t.RACE_GAME_RESET_GAME)},r[t.RACE_GAME_COIN]=function(e){var n=e.commit,r=e.state;return l.default.raceGameCoinByAndConsume().then((function(e){return console.log("[raceGame]","raceGameCoin",e),e&&e.reConsume&&l.default.raceGameCoinConsume(),e&&0===e.errCode&&(n(t.RACE_GAME_INCREASE_REMAINTIME),n(t.RACE_GAME_UPDATE_COIN,{count:r.game.coin.count-1})),e})).catch((function(e){return console.log("[raceGame]","raceGameCoin err",e),e}))},r[t.RACE_GAME_AD]=function(e){var n=e.commit,r=e.state;return r.game.remainAdTime>0?l.default.raceGameReportAdWatched().then((function(e){return e&&0===e.errCode?(n(t.RACE_GAME_INCREASE_REMAINTIME),n(t.RACE_GAME_UPDATE_AD_TIME,r.game.remainAdTime-1),Promise.resolve()):Promise.reject(new Error("remain ad time exceed error"))})):Promise.reject(new Error("query use ad error"))},r[t.RACE_GAME_WHITELIST_USER]=function(e,n){var r=e.commit;l.default.checkIsWhiteUser(n).then((function(e){f.default.setIsWhiteUser(e.isWhitelisted),e.isWhitelisted?r(t.RACE_GAME_WHITELIST_USER,!0):r(t.RACE_GAME_WHITELIST_USER,!1)})).catch(E.default)},r[t.RACE_GAME_PROGRESS]=function(e){var n=e.commit,r="infinite";return"money"===e.state.game.gameType&&(r="money"),l.default.raceGameProgress(r).then((function(e){return n(t.RACE_GAME_PROGRESS,e),e}))},r[t.RACE_GAME_UPDATE_RANK]=function(e,n){var r=e.commit,o=e.state,i=o.rank.globalRank;"friend"===n&&(i=o.rank.friendRank);var a=i.rankTime;Date.now()-a>3e5&&l.default.raceGameRank(n).then((function(e){e&&e.rank&&("friend"===n&&e.rank&&e.rank.length&&e.rank.forEach((function(t,n){t._id===e.self._id&&(e.self.pos=n+1)})),r(t.RACE_GAME_UPDATE_RANK,{type:n,self:e.self,rank:e.rank}))}))},r[t.RACE_GAME_RANK_INIT]=function(e){var n=e.commit;return a(this,void 0,void 0,(function(){return u(this,(function(e){return[2,l.default.raceGameRank("friend").then((function(e){return e&&e.rank&&(e.rank.forEach((function(t,n){t._id===e.self._id&&(e.self.pos=n+1)})),n(t.RACE_GAME_UPDATE_RANK,{type:"friend",self:e.self,rank:e.rank}),e.rank.length>=5)?(n(t.RACE_GAME_UPDATE_RANK_TYPE,"friend"),Promise.resolve()):l.default.raceGameRank("global").then((function(e){return e&&e.rank?(n(t.RACE_GAME_UPDATE_RANK,{type:"global",self:e.self,rank:e.rank}),n(t.RACE_GAME_UPDATE_RANK_TYPE,"global"),Promise.resolve()):Promise.reject(new Error("rank data error"))}))}))]}))}))},r[t.RACE_GAME_UPDATE_RANK_TYPE]=function(e,n){(0,e.commit)(t.RACE_GAME_UPDATE_RANK_TYPE,n||"global")},r[t.RACE_GAME_REPORT_WRONG_QUESTION]=function(e,t){var n=e.state;return l.default.raceGameReportWrongQuestion(n.user.vid,t)},r[t.RACE_GAME_SUCC_CNT]=function(e){var n=e.commit;return l.default.raceGameSuccCnt().then((function(e){return n(t.RACE_GAME_SUCC_CNT,e),e}))},r[t.RACE_GAME_REPORT_ANALYSIS_LOG]=function(e,t){var n=e.state,r=n.game.vol,o=n.game.level,a=t.itemname,u=i({},t,{level:o,vol:r});l.default.analysisLog(a,i({},u))},r[t.RACE_GAME_REVERTING_START]=function(e){(0,e.commit)(t.RACE_GAME_REVERTING_UPDATE,{count:0,state:"wait"})},r[t.RACE_GAME_REVERTING_UPDATE]=function(e){var n=e.dispatch,r=e.state,o=e.commit;return l.default.raceGameRevertUpdate().then((function(e){if("reverting"===e.gameStatus&&"reverting"===r.progress.status){var a=e.share;n(t.RACE_GAME_REVERTING_INIT,i({count:0},a)),n(t.RACE_GAME_LOCAL_PROGRESS_UPDATE,{currentQuestion:a.startIndex}),n(t.RACE_GAME_SET_TARGET_QUESTION,a.startIndex)}"reverting"===r.progress.status&&"failed"===e.gameStatus&&o(t.RACE_GAME_UPDATE_STATUS,"failed")}))},r[t.RACE_GAME_REVERTING_INIT]=function(e,n){(0,e.commit)(t.RACE_GAME_REVERTING_UPDATE,i({},n))},r[t.RACE_GAME_LOCAL_PROGRESS_UPDATE]=function(e,n){(0,e.commit)(t.RACE_GAME_LOCAL_PROGRESS_UPDATE,i({},n))},r[t.RACE_GAME_OPEN_APP]=function(e,n){(0,e.commit)(t.RACE_GAME_OPEN_APP,n)},r[t.RACE_GAME_SET_TARGET_QUESTION]=function(e,n){(0,e.commit)(t.RACE_GAME_SET_TARGET_QUESTION,n)},r[t.RACE_GAME_RENEWUSER_RESURRECTION]=function(e,n){(0,e.commit)(t.RACE_GAME_RENEWUSER_RESURRECTION,n)},r[t.RACE_GAME_REPORT_QUESTION_RESULT]=function(e,t){return l.default.raceGameReportQuestionAnsResult(t.questId,t.success)},r[t.RACE_GAME_ACTIVE_TYPE]=function(e){var n=e.commit;l.default.raceGameUserType().then((function(e){n(t.RACE_GAME_UPDATE_USERINFO,{isBlack:e})}))},r[t.RACE_GAME_PROPS_INIT]=function(e){var n=e.commit;return l.default.raceGamePropsInit().then((function(e){if(e){var r=T.raceGamePropsFormat(e);n(t.RACE_GAME_PROPS_INIT,r)}}))},r[t.RACE_GAME_LOAD_SPECIFIC_QUESTION]=function(e,n){var r=e.state,o=e.commit;void 0===n&&(n=0);var i=r.progress.currentQuestion;o(t.RACE_GAME_SET_SPECIFIC_QUESTION,{index:i,question:t.EMPTY_QUESTION});var a=r.game.level+n;return i+1<=11&&l.default.raceGameGetQuestion({onlyQues:!0,level:a,index:i+1}).then((function(e){e&&e.question&&o(t.RACE_GAME_SET_SPECIFIC_QUESTION,{index:i+1,question:e.question})})),l.default.raceGameGetQuestion({onlyQues:!0,level:a,index:i}).then((function(e){e&&e.question&&o(t.RACE_GAME_SET_SPECIFIC_QUESTION,{index:i,question:e.question})}))},r[t.RACE_GAME_PROPS_PURCHASE]=function(e,n){var r=e.dispatch;return l.default.raceGamePropsPurchase(n).then((function(){r(t.RACE_GAME_PROPS_INIT)}))},r[t.RACE_GAME_PROPS_CONSUME]=function(e,n){var r=e.commit,o=e.dispatch;return 0===n&&r(t.RACE_GAME_UPDATE_CHANGE_QUESTION,!0),l.default.raceGamePropsConsume(n).then(E.default).catch(E.default).finally((function(){o(t.RACE_GAME_PROPS_INIT)}))},r[t.RACE_GAME_PROP_SHARE_INFO]=function(e,n){(0,e.commit)(t.RACE_GAME_PROP_SHARE_INFO,n)},r[t.RACE_GAME_MCGAME_UPGRADE_SHARE_INFO]=function(e,n){(0,e.commit)(t.RACE_GAME_MCGAME_UPGRADE_SHARE_INFO,n)},r[t.RACE_GAME_UPDATE_STATUS]=function(e,n){(0,e.commit)(t.RACE_GAME_UPDATE_STATUS,n)},r[t.RACE_GAME_TOGGLE_VOICE]=function(e){(0,e.commit)(t.RACE_GAME_TOGGLE_VOICE)},r[t.RACE_GAME_UPDATE_VOICE]=function(e,n){(0,e.commit)(t.RACE_GAME_UPDATE_USERINFO,{voice:n})},r[t.RACE_GAME_TO_PROP_CHECK]=function(e){(0,e.commit)(t.RACE_GAME_UPDATE_STATUS,"propCheck")},r[t.RACE_GAME_UPDATE_GAME_TYPE]=function(e,n){var r=e.commit,o=e.dispatch;l.default.raceGameUpdateGameType(n).then((function(){r(t.RACE_GAME_UPDATE_GAME_INFO,{gameType:n}),o(t.RACE_GAME_TO_PROP_CHECK)}))},r[t.RACE_GAME_UPGRADE_QUESTION_LEVEL]=function(e){(0,e.commit)(t.RACE_GAME_UPDATE_GAME_INFO,{upgrade:!0})},r),getters:{voiceStatus:function(e){return e.user.voice},gameType:function(e){var t=e.game.gameType;return"money"===t?"money":"infinite"===t?"infinite":""},sessionSuccessCnt:function(e){return e.game.progress.sessionSuccessCnt},userLevel:function(e){return e.game.level}},mutations:((o={})[t.INIT_RACE_GAME]=function(e,t){console.log(t),e.game=i({},e.game,t,{upgrade:!1})},o[t.INIT_USER_INFO]=function(e,t){e.user=i({},e.user,t)},o[t.RACE_GAME_START]=function(e){e.progress={currentQuestion:0,status:"playing",offSiteAssistance:{isOffSiteAssistance:!1},usedSkipQuestion:!1}},o[t.RACE_GAME_CONTINUE]=function(e){e.progress=i({},e.progress,{status:"playing"})},o[t.RACE_GAME_UPDATE_STATUS]=function(e,t){t!==e.progress.status&&(e.progress=i({},e.progress,{status:t}))},o[t.RACE_GAME_LOAD_QUESTION]=function(e,t){if(t){var n=e.questions.concat([t]);e.questions=n}},o[t.RACE_GAME_NEXT_QUESTION]=function(e,t){e.progress=i({},e.progress,{currentQuestion:t})},o[t.RACE_GAME_PROGRESS]=function(e,t){e.game=i({},e.game,{coin:t.coin,invite:t.invite,progress:{infiniteDays:t.infiniteDays,succCnt:t.succCnt||{},surplusMS:t.surplusMS,sessionSuccessCnt:t.sessionSuccessCnt},remainTime:t.remainTime})},o[t.RACE_GAME_COIN]=function(e,t){e.game.coin=t},o[t.RACE_GAME_INVITE]=function(e,t){e.game.invite=t},o[t.RACE_GAME_SHARE_RESURRECTION]=function(e,t){e.game.share=t},o[t.RACE_GAME_RESET_GAME]=function(e){e.questions=[],e.game.upgrade=!1},o[t.RACE_GAME_WHITELIST_USER]=function(e,t){e.user=i({},e.user,{isWhiteUser:t})},o[t.RACE_GAME_UPDATE_RANK]=function(e,t){var n=t.type,r=t.self,o=t.rank;e.rank=i({},e.rank,"friend"===n?{friendRank:{rankList:o,rankSelf:r,rankTime:Date.now()}}:{globalRank:{rankList:o,rankSelf:r,rankTime:Date.now()}})},o[t.RACE_GAME_UPDATE_RANK_TYPE]=function(e,t){e.rank=i({},e.rank,{rankType:t})},o[t.RACE_GAME_DECREASE_REMAINTIME]=function(e){e.game=i({},e.game,{remainTime:e.game.remainTime-1>=0?e.game.remainTime-1:0})},o[t.RACE_GAME_INCREASE_REMAINTIME]=function(e){e.game=i({},e.game,{remainTime:e.game.remainTime+1})},o[t.RACE_GAME_DEBUG_INFO]=function(e,t){e.debugInfo=i({},e.debugInfo,t)},o[t.RACE_GAME_TRUCE_INFO]=function(e,t){e.game.truceInfo=t},o[t.RACE_GAME_SHARE_INFO]=function(e,t){p.default.checkCanHelpShareRemain(t.shareVid,"SHARE_VID_INFO")&&(e.shareInfo=i({},e.shareInfo,{shareVid:t.shareVid}))},o[t.RACE_GAME_SUCC_CNT]=function(e,t){e.game.progress=i({},e.game.progress,{succCnt:t})},o[t.RACE_GAME_LOGIN_TIME]=function(e,t){e.user=i({},e.user,{lastAppLoginTime:t})},o[t.RACE_GAME_ANSWER_SUCC]=function(e,t){e.game.answerSucc=t},o[t.RACE_GAME_UPDATE_LEVEL]=function(e,t){t>=0&&(e.game.level=t)},o[t.RACE_GAME_RENEWUSER_RESURRECTION]=function(e,t){e.game.reNewUser=i({},t)},o[t.RACE_GAME_OPEN_APP]=function(e,t){e.user=i({},e.user,{canOpenApp:t})},o[t.RACE_GAME_REVERTING_UPDATE]=function(e,t){e.game.share=i({},e.game.share,t)},o[t.RACE_GAME_LOCAL_PROGRESS_UPDATE]=function(e,t){e.progress=i({},e.progress,t)},o[t.RACE_GAME_SET_TARGET_QUESTION]=function(e,t){if(0!==t){for(var n={},r=[],o=0;o<t;o++)r.push(n);e.questions=r}},o[t.RACE_GAME_LOAD_LOCAL_WHITE_CONFIG]=function(e,t){e.debugInfo=i({},e.debugInfo,{showAnswer:t})},o[t.RACE_GAME_UPDATE_COIN]=function(e,t){e.game.coin=i({},e.game.coin,t)},o[t.RACE_GAME_UPDATE_AD_TIME]=function(e,t){e.game.remainAdTime=t},o[t.RACE_GAME_UPDATE_USERINFO]=function(e,t){e.user=i({},e.user,t)},o[t.RACE_GAME_PROPS_INIT]=function(e,t){e.props=t},o[t.RACE_GAME_SET_SPECIFIC_QUESTION]=function(e,t){var n=t.index,r=t.question,o=e.questions;o[n]=r,e.questions=o.slice()},o[t.RACE_GAME_UPDATE_CHANGE_QUESTION]=function(e,t){e.progress=i({},e.progress,{usedSkipQuestion:t})},o[t.RACE_GAME_PROP_SHARE_INFO]=function(e,t){p.default.checkCanHelpShareRemain(t.propShareVid,"PROP_SHARE_VID_INFO")&&(e.shareInfo=i({},e.shareInfo,{propShare:t}))},o[t.RACE_GAME_MCGAME_UPGRADE_SHARE_INFO]=function(e,t){e.shareInfo=i({},e.shareInfo,{mcGameShareTicket:t})},o[t.RACE_GAME_TOGGLE_VOICE]=function(e){var t=e.user.voice;d.default.setStorage({data:!t,key:"RACE_GAME_VOICE",complete:E.default,success:E.default,fail:E.default}),e.user=i({},e.user,{voice:!t})},o[t.RACE_GAME_UPDATE_GAME_INFO]=function(e,t){e.game=i({},e.game,t)},o),plugins:[],state:{debugInfo:{currentLevel:0,currentVol:0,realLevel:0,recentVictoryInfo:{failed:0,victory:0},recentVol:0,showAnswer:!1,userType:""},game:{answerSucc:!1,coin:{coinPurchasePrice:{},count:0},gameStatus:"",gameTime:{endTime:"",startTime:""},invite:{count:0},level:0,progress:{infiniteDays:0,succCnt:{cnt:0,maxCnt:0},surplusMS:0,sessionSuccessCnt:{money:0,infinite:0}},questionCnt:0,remainTime:0,remainAdTime:0,adType:"normal",reNewUser:{state:"use"},share:{count:1,friend:{name:"",avatar:""},qId:"",state:"",expireTime:0},truceInfo:{status:"",volInfiniteDay:0,volMoney:0,gameType:""},vol:0,gameType:"",upgrade:!1,doubleReward:!1},progress:{currentQuestion:0,offSiteAssistance:{isOffSiteAssistance:!1},status:"ready",usedSkipQuestion:!1},questions:[],rank:{rankType:"",globalRank:{rankList:[],rankSelf:null,rankTime:0},friendRank:{rankList:[],rankSelf:null,rankTime:0}},shareInfo:{shareVid:0,propShare:{propShareVid:0,propShareType:""},mcGameShareTicket:""},user:{avatar:"",canOpenApp:!1,isWhiteUser:!1,lastAppLoginTime:0,name:"",vid:null,isBlack:!1,voice:!1},props:[]}};t.store=new v.default.Store(A)},478:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(479));t.palette=function(e,t,n){var r=function(e,t){if(void 0!==e&&Number.isInteger(e)){if(1===e)throw new Error("count should be between 2 and 20. To get one color, call getColor() instead of getPalette()");e=Math.max(e,2),e=Math.min(e,20)}else e=10;return(void 0===t||!Number.isInteger(t)||t<1)&&(t=10),{count:e,quality:t}}(t,n),i=function(e,t){for(var n=[],r=0,o=void 0,i=void 0,a=void 0,u=void 0,s=void 0;r<e.length/4;r+=t)i=e[0+(o=4*r)],a=e[o+1],u=e[o+2],(void 0===(s=e[o+3])||s>=125)&&(i>250&&a>250&&u>250||n.push([i,a,u]));return n}(e,r.quality),a=o.default(i,r.count);return a?a.palette():[]},t.getColor=function(e,n){return void 0===n&&(n=10),t.palette(e,5,n)[0]},t.getHexColors=function(e){return Array.isArray(e)?e.map((function(e){return"#"+((1<<24)+(e[0]<<16)+(e[1]<<8)+e[2]).toString(16).slice(1)})):[]}},480:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(481));t.getImageDominantColorGradient=function(e,t){void 0===t&&(t="rgb(27, 136, 238)");var n=(e?o.default(e):o.default(t)).toHsl(),r=n.h,i=n.s,a=n.l,u=r/360;return[o.default({h:360*(u>=.07?u-.07:1-(.07-u)),s:1,l:Math.max(.45,a-.35)}).toHex(),o.default({h:360*u,s:Math.max(i,.8),l:Math.max(.48,a-.35)}).toHex()].map((function(e){return"#"+e}))}},482:function(e,t){var n=function(e,t){return e<<t|e>>>32-t},r=function(e,t){var n,r,o,i,a;return o=2147483648&e,i=2147483648&t,a=(1073741823&e)+(1073741823&t),(n=1073741824&e)&(r=1073741824&t)?2147483648^a^o^i:n|r?1073741824&a?3221225472^a^o^i:1073741824^a^o^i:a^o^i},o=function(e,t,o,i,a,u,s){return e=r(e,r(r(function(e,t,n){return e&t|~e&n}(t,o,i),a),s)),r(n(e,u),t)},i=function(e,t,o,i,a,u,s){return e=r(e,r(r(function(e,t,n){return e&n|t&~n}(t,o,i),a),s)),r(n(e,u),t)},a=function(e,t,o,i,a,u,s){return e=r(e,r(r(function(e,t,n){return e^t^n}(t,o,i),a),s)),r(n(e,u),t)},u=function(e,t,o,i,a,u,s){return e=r(e,r(r(function(e,t,n){return t^(e|~n)}(t,o,i),a),s)),r(n(e,u),t)},s=function(e){var t,n="",r="";for(t=0;t<=3;t++)n+=(r="0"+(e>>>8*t&255).toString(16)).substr(r.length-2,2);return n};e.exports.md5=function(e){var t,n,c,l,f,d,_,E,p,h=Array();for(h=function(e){for(var t,n=e.length,r=n+8,o=16*((r-r%64)/64+1),i=Array(o-1),a=0,u=0;u<n;)a=u%4*8,i[t=(u-u%4)/4]=i[t]|e.charCodeAt(u)<<a,u++;return a=u%4*8,i[t=(u-u%4)/4]=i[t]|128<<a,i[o-2]=n<<3,i[o-1]=n>>>29,i}(e=function(e){e=e.replace(/\x0d\x0a/g,"\n");for(var t="",n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t+=String.fromCharCode(r):r>127&&r<2048?(t+=String.fromCharCode(r>>6|192),t+=String.fromCharCode(63&r|128)):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128),t+=String.fromCharCode(63&r|128))}return t}(e)),d=1732584193,_=4023233417,E=2562383102,p=271733878,t=0;t<h.length;t+=16)n=d,c=_,l=E,f=p,d=o(d,_,E,p,h[t+0],7,3614090360),p=o(p,d,_,E,h[t+1],12,3905402710),E=o(E,p,d,_,h[t+2],17,606105819),_=o(_,E,p,d,h[t+3],22,3250441966),d=o(d,_,E,p,h[t+4],7,4118548399),p=o(p,d,_,E,h[t+5],12,1200080426),E=o(E,p,d,_,h[t+6],17,2821735955),_=o(_,E,p,d,h[t+7],22,4249261313),d=o(d,_,E,p,h[t+8],7,1770035416),p=o(p,d,_,E,h[t+9],12,2336552879),E=o(E,p,d,_,h[t+10],17,4294925233),_=o(_,E,p,d,h[t+11],22,2304563134),d=o(d,_,E,p,h[t+12],7,1804603682),p=o(p,d,_,E,h[t+13],12,4254626195),E=o(E,p,d,_,h[t+14],17,2792965006),_=o(_,E,p,d,h[t+15],22,1236535329),d=i(d,_,E,p,h[t+1],5,4129170786),p=i(p,d,_,E,h[t+6],9,3225465664),E=i(E,p,d,_,h[t+11],14,643717713),_=i(_,E,p,d,h[t+0],20,3921069994),d=i(d,_,E,p,h[t+5],5,3593408605),p=i(p,d,_,E,h[t+10],9,38016083),E=i(E,p,d,_,h[t+15],14,3634488961),_=i(_,E,p,d,h[t+4],20,3889429448),d=i(d,_,E,p,h[t+9],5,568446438),p=i(p,d,_,E,h[t+14],9,3275163606),E=i(E,p,d,_,h[t+3],14,4107603335),_=i(_,E,p,d,h[t+8],20,1163531501),d=i(d,_,E,p,h[t+13],5,2850285829),p=i(p,d,_,E,h[t+2],9,4243563512),E=i(E,p,d,_,h[t+7],14,1735328473),_=i(_,E,p,d,h[t+12],20,2368359562),d=a(d,_,E,p,h[t+5],4,4294588738),p=a(p,d,_,E,h[t+8],11,2272392833),E=a(E,p,d,_,h[t+11],16,1839030562),_=a(_,E,p,d,h[t+14],23,4259657740),d=a(d,_,E,p,h[t+1],4,2763975236),p=a(p,d,_,E,h[t+4],11,1272893353),E=a(E,p,d,_,h[t+7],16,4139469664),_=a(_,E,p,d,h[t+10],23,3200236656),d=a(d,_,E,p,h[t+13],4,681279174),p=a(p,d,_,E,h[t+0],11,3936430074),E=a(E,p,d,_,h[t+3],16,3572445317),_=a(_,E,p,d,h[t+6],23,76029189),d=a(d,_,E,p,h[t+9],4,3654602809),p=a(p,d,_,E,h[t+12],11,3873151461),E=a(E,p,d,_,h[t+15],16,530742520),_=a(_,E,p,d,h[t+2],23,3299628645),d=u(d,_,E,p,h[t+0],6,4096336452),p=u(p,d,_,E,h[t+7],10,1126891415),E=u(E,p,d,_,h[t+14],15,2878612391),_=u(_,E,p,d,h[t+5],21,4237533241),d=u(d,_,E,p,h[t+12],6,1700485571),p=u(p,d,_,E,h[t+3],10,2399980690),E=u(E,p,d,_,h[t+10],15,4293915773),_=u(_,E,p,d,h[t+1],21,2240044497),d=u(d,_,E,p,h[t+8],6,1873313359),p=u(p,d,_,E,h[t+15],10,4264355552),E=u(E,p,d,_,h[t+6],15,2734768916),_=u(_,E,p,d,h[t+13],21,1309151649),d=u(d,_,E,p,h[t+4],6,4149444226),p=u(p,d,_,E,h[t+11],10,3174756917),E=u(E,p,d,_,h[t+2],15,718787259),_=u(_,E,p,d,h[t+9],21,3951481745),d=r(d,n),_=r(_,c),E=r(E,l),p=r(p,f);return(s(d)+s(_)+s(E)+s(p)).toLowerCase()}},49:function(e,t,n){n.r(t);var r,o,i=n(5),a=n.n(i),u=n(9),s=n(227),c=n(130),l=n.n(c),f=n(1),d=n.n(f),_=n(65),E=n.n(_),p=n(6),h=n.n(p),I=n(27),m=n.n(I),v=n(40),T=n.n(v),g=n(299),A=n.n(g),R=n(33),O=n.n(R),S=n(4),C=n.n(S),k=n(98),b=n.n(k),L=n(8),y=n.n(L),N=n(10),w=n.n(N),D=n(2),M=n(0),P=n(19),G=n(3),B=n(15),U=n(89),F=(n(16),G.default.getUser()),x=function(e){var t=B.default.getStorageSync(e);return""!==t?y.a.resolve(t):wx.cloud?wx.cloud.database().collection("user_config").where({_id:F.vid}).limit(1).get().then((function(t){if(!t||!t.data||0===t.data.length||!t.data[0].hasOwnProperty(e))return y.a.resolve("");var n=t.data[0][e];return B.default.setStorageSync(e,n),y.a.resolve(n)})).catch((function(e){return console.log("userConfig","get",e),y.a.reject(new Error("user config db get error"))})):y.a.resolve("")},V=(o=w()(C.a.mark((function e(){var t,n,r;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.a.all([x("closeRecommend")]);case 2:return t=e.sent,n=l()(t,1),r=n[0],e.abrupt("return",{closeRecommend:r});case 6:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)}),H=0;function K(e){if(e&&e.length)for(var t=e.length-1;t>0;t--){var n=Math.floor(Math.random()*(t+1)),r=[e[n],e[t]],o=r[0],i=r[1];e[t]=o,e[n]=i}}var W,Y=(r={},d()(r,M.INIT_BOOKSTORE_COMBINED,(function(e){var t=this,n=e.commit,r=(e.state,e.dispatch);return w()(C.a.mark((function e(){return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",D.default.loadStore().then((function(e){U.default.instance.loadEnd();var t=e.data;if(!t)return y.a.reject({errCode:-1,errMsg:"数据格式不对"});var o=t.recommendationBookList,i=t.recommendationCategories,a=t.searchTips,u=t.banner,s=t.userProfile,c=i||[];if((c=c.filter((function(e,t){return 24e5!==e.categoryid}))).length<2)c=[];else{var l=[],f=new b.a;c.forEach((function(e){f.has(e.categoryid)||(l.push(e),f.add(e.categoryid))})),c=l.slice(0,2)}0===o.length&&r(M.LOAD_BOOKSTORE_RECOMMENDATION_BOOKS,{isInit:!0}),n(M.INIT_BOOKSTORE,{recommendation:o,categories:c,searchTips:a,banner:u,userProfile:s})})));case 1:case"end":return e.stop()}}),e,t)})))()})),d()(r,M.INIT_BOOKSTORE_CATEGORIES,(function(e){var t=this,n=e.commit;return e.state,w()(C.a.mark((function e(){return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",D.default.loadCategories().then((function(e){var t=P.storeCagetoryParse(e);n(M.INIT_BOOKSTORE_CATEGORIES,{categories:t})})));case 1:case"end":return e.stop()}}),e,t)})))()})),d()(r,M.INIT_BOOKSTORE_RANKING,(function(e){var t=this,n=e.commit;return e.state,w()(C.a.mark((function e(){return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",y.a.all([D.default.loadBookStoreRanking(),D.default.loadBookStoreNovelRanking()]).then((function(e){var t=P.storeRankingParse(e);n(M.INIT_BOOKSTORE_RANKING,{ranking:t})})));case 1:case"end":return e.stop()}}),e,t)})))()})),d()(r,M.INIT_BOOKSTORE_RECOMMENDATION_CATEGORY,(function(e,t){var n=this,r=e.commit,o=(e.state,t.categoryId);return w()(C.a.mark((function e(){return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",D.default.loadCategoryBooks(o,10).then((function(e){var t=(e&&e.books||[]).map((function(e){return e.bookInfo&&(e.readingCount>1e4&&(e.readingCount=(e.readingCount/1e4).toFixed(1)+"万"),e.bookInfo.ratingCount>1e4&&(e.bookInfo.ratingCount=(e.bookInfo.ratingCount/1e4).toFixed(1)+"万")),e}));r(M.INIT_BOOKSTORE_RECOMMENDATION_CATEGORY,{categoryId:o,categoryBooks:t,hasMore:!!e.hasMore||!1})})));case 1:case"end":return e.stop()}}),e,n)})))()})),d()(r,M.LOAD_BOOKSTORE_RECOMMENDATION_CATEGORY,(function(e,t){var n=this,r=e.commit,o=(e.state,t.categoryId),i=t.maxIdx;return w()(C.a.mark((function e(){return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",D.default.loadCategoryBooks(o,10,i).then((function(e){var t=(e&&e.books||[]).map((function(e){return e.bookInfo&&e.bookInfo.star&&(e.bookInfo.star=(e.bookInfo.star/10).toFixed(1),e.readingCount>1e4&&(e.readingCount=(e.readingCount/1e4).toFixed(1)+"万"),e.bookInfo.ratingCount>1e4&&(e.bookInfo.ratingCount=(e.bookInfo.ratingCount/1e4).toFixed(1)+"万")),e}));r(M.LOAD_BOOKSTORE_RECOMMENDATION_CATEGORY,{categoryId:o,categoryBooks:t,hasMore:!!e.hasMore||!1})})));case 1:case"end":return e.stop()}}),e,n)})))()})),d()(r,M.LOAD_BOOKSTORE_RECOMMENDATION_BOOKS,(function(e,t){var n=this,r=e.commit,o=(e.state,t.isInit),i=void 0!==o&&o;return w()(C.a.mark((function e(){return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",D.default.loadBookstoreRecommendationBook().then((function(e){var t=e&&e.books||[];r(M.LOAD_BOOKSTORE_RECOMMENDATION_BOOKS,{recommendation:t,isInit:i})})));case 1:case"end":return e.stop()}}),e,n)})))()})),d()(r,M.LOAD_GOVERNMENT_AFFAIRS_READING_BANNER,(function(e,t){var n=this,r=e.commit,o=(e.state,t.industry);return w()(C.a.mark((function e(){return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",D.default.loadGovernmentAffairsReadingData({type:"banner",industry:o}).then((function(e){var t=e&&e.data.src||"";r(M.LOAD_GOVERNMENT_AFFAIRS_READING_BANNER,{src:t})})));case 1:case"end":return e.stop()}}),e,n)})))()})),d()(r,M.LOAD_GOVERNMENT_AFFAIRS_READING_BOOK_LIST,(function(e,t){var n=this,r=e.commit,o=t.industry;return w()(C.a.mark((function e(){return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",D.default.loadGovernmentAffairsReadingData({industry:o}).then((function(e){var t=e&&e.data.books||[],n=e&&e.data.title||"";r(M.LOAD_GOVERNMENT_AFFAIRS_READING_BOOK_LIST,{title:n,books:t})})));case 1:case"end":return e.stop()}}),e,n)})))()})),d()(r,M.REPORT_GOVERNMENT_AFFAIRS_READING_OSS_LOG,(function(e,t){var n=this;return e.commit,w()(C.a.mark((function e(){return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",D.default.reportGovernmentAffairsReadingOssLog(t));case 1:case"end":return e.stop()}}),e,n)})))()})),d()(r,M.LOAD_MINI_BOOK_LIST,(function(e,t){var n=this,r=e.commit;return w()(C.a.mark((function e(){return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",D.default.loadMiniBookList({listName:t}).then((function(e){var t=e&&e.data.books||[],n=e&&e.data.title||"";r(M.SET_MINI_BOOK_LIST,{title:n,books:t})})));case 1:case"end":return e.stop()}}),e,n)})))()})),d()(r,M.LOAD_ARCHIVE_BOOK_LIST,(function(e,t){var n=this,r=e.state,o=e.commit;return e.dispatch,w()(C.a.mark((function e(){var i,a,u,s,c,l,f;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=r&&r.shelf&&r.shelf.archive||[],a=!0,u=!1,s=void 0,e.prev=4,c=O()(i);case 6:if(a=(l=c.next()).done){e.next=13;break}if((f=l.value).archiveId!==Number(t)){e.next=10;break}return e.abrupt("return",o(M.SET_MINI_BOOK_LIST,{title:f.name||"书籍分组",books:f.allBookInfos||[]}));case 10:a=!0,e.next=6;break;case 13:e.next=19;break;case 15:e.prev=15,e.t0=e.catch(4),u=!0,s=e.t0;case 19:e.prev=19,e.prev=20,!a&&c.return&&c.return();case 22:if(e.prev=22,!u){e.next=25;break}throw s;case 25:return e.finish(22);case 26:return e.finish(19);case 27:case"end":return e.stop()}}),e,n,[[4,15,19,27],[20,,22,26]])})))()})),d()(r,M.SYNC_CONFIG,(function(e){var t=e.commit;return D.default.readConfig().then((function(e){var t=G.default.getUser();if(!e||!e.configs.length)return t&&t.userConfig?y.a.resolve(t.userConfig):y.a.resolve({});var n={synckey:e.synckey,configs:{}};return e.configs.forEach((function(e){"showGiftCollectionDot"===e._id&&!0===e.value?t.hasShownGiftCollectionDot=!1:"autoReportLogRecord"===e._id&&e.value?e.value.indexOf(t.vid)>=0&&(n.configs.needAutoReportLog=!0):e._id&&e.value&&(n.configs[e._id]=e.value)})),t.userConfig||(t.userConfig={}),t.userConfig=E()(t.userConfig,n),G.default.saveUserInfo(t),y.a.resolve(t.userConfig)})).then((function(e){return e?(t(M.SYNC_CONFIG,{userConfig:e}),y.a.resolve(e)):y.a.reject({error:"Sync User Config Error"})}))})),d()(r,M.INIT_RECENTREAD,(function(e){var t=this,n=e.commit,r=e.state;return w()(C.a.mark((function e(){var o,i,a,u,s,c;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((o=B.default.getStorageSync("latestRead")||[])&&!Array.isArray(o)&&(B.default.removeStorageSync("latestRead"),o=[]),i=r.shelf.all.filter((function(e){return"book"===e.type})),(a=i.slice(0,4))&&a.length){e.next=9;break}return e.next=7,D.default.loadLimitBookShelf({count:4}).catch((function(){return null}));case 7:u=e.sent,a=u&&u.data;case 9:a&&a.length&&(o=o.concat(a.slice(0,4))),s=new A.a,c=[],o.forEach((function(e){if(e&&e.bookId){var t=s.get(e.bookId);console.log(t,e),(!t||t.readUpdateTime<e.readUpdateTime||t.isLecture!==e.isLecture)&&(s.set(e.bookId,e),c.push(e))}})),c.sort((function(e,t){return t.readUpdateTime-e.readUpdateTime})),n(M.INIT_RECENTREAD,{recentRead:c.slice(0,4)});case 15:case"end":return e.stop()}}),e,t)})))()})),d()(r,M.SHUFFLE_RECOMMENDATIONS,(function(e){var t=this,n=e.commit,r=e.state;return w()(C.a.mark((function e(){var o,i,a,u,s;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=r.bookstore.recommendation.shuffleCount+1,i=r.bookstore.recommendation.all,!(3*o+3>=i.length)){e.next=7;break}return e.next=5,D.default.loadGuessBooks(20,i.length).catch((function(){return null}));case 5:(a=e.sent)&&(u=P.guessBookParse(a.books))&&(i=i.concat(u));case 7:3+(s=3*o)>i.length&&(s=0,o=0),n(M.SHUFFLE_RECOMMENDATIONS,{shuffleCount:o,all:i,showing:i.slice(s,s+3)});case 10:case"end":return e.stop()}}),e,t)})))()})),d()(r,M.SHUFFLE_FREE,(function(e){var t=this,n=e.commit,r=e.state;return w()(C.a.mark((function e(){var o,i,a,u,s,c;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=r.bookstore.free.shuffleCount+1,i=r.bookstore.free.all,!(o<=1)){e.next=14;break}return e.next=5,D.default.loadHotReadingBooks(40,i.length);case 5:if(!(a=e.sent)){e.next=12;break}a.books.splice(0,4),K(a.books),i=P.freeBookParser({books:a.books,needCategory:!0,needBookIntro:!0}),e.next=14;break;case 12:return u={error:"network error"},e.abrupt("return",y.a.reject(u));case 14:return s=!1,i.length>4*(o+2)&&(s=!0),c=r.bookstore.novel.showing,i.length>=4*(o+1)&&(c=[i.slice(4*o,4*o+2),i.slice(4*o+2,4*o+4)]),n(M.SHUFFLE_FREE,{shuffleCount:o,showing:c,all:i,canShuffle:s}),e.abrupt("return",y.a.resolve());case 20:case"end":return e.stop()}}),e,t)})))()})),d()(r,M.STORE_ALL_FREE_MORE,(function(e){var t=e.commit,n=e.state.bookstore.free.all.length;return D.default.loadHotReadingBooks(20,n).then((function(e){if(!e||!e.books)return y.a.reject({errCode:-1,errMsg:"数据格式不对"});var n=P.freeBookParser({books:e.books,needCategory:!0,needBookIntro:!0}),r=1===e.hasMore;t(M.STORE_ALL_FREE_MORE,{free:n,hasMore:r})}))})),d()(r,M.SHUFFLE_TRENDING,(function(e){var t=this,n=e.commit,r=e.state;return w()(C.a.mark((function e(){var o,i,a,u,s,c;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=r.bookstore.trending.shuffleCount+1,i=r.bookstore.trending.all,!(o<=1)){e.next=12;break}return e.next=5,D.default.loadSelectedNovels(40,i.length).catch((function(){return null}));case 5:if(!(a=e.sent)){e.next=10;break}i=P.recommendBookParse({books:a.books,needBookIntro:!0}),e.next=12;break;case 10:return u={error:"network error"},e.abrupt("return",y.a.reject(u));case 12:return s=!1,i.length>4*(o+2)&&(s=!0),c=r.bookstore.trending.showing,i.length>=4*(o+1)&&(c=i.slice(4*o,4*o+4)),n(M.SHUFFLE_TRENDING,{shuffleCount:o,showing:c,all:i,canShuffle:s}),e.abrupt("return",y.a.resolve());case 18:case"end":return e.stop()}}),e,t)})))()})),d()(r,M.STORE_ALL_TRENDING_MORE,(function(e){var t=e.commit,n=e.state.bookstore.trending.all.length;return D.default.loadRecommendBooks(1,20,n).then((function(e){var n=P.recommendBookParse({books:e.books,needBookIntro:!0});t(M.STORE_ALL_TRENDING_MORE,{trending:n,hasMore:1===e.hasMore})}))})),d()(r,M.STORE_ALL_TOPRATED,(function(e){var t=e.commit;return e.state,D.default.loadTopReadingBooks(20).then((function(e){var n=P.recommendBookParse({books:e.books,needBookIntro:!0,needStar:!0});t(M.STORE_TOPTATED,{topRated:n,hasMore:1===e.hasMore})}))})),d()(r,M.STORE_ALL_TOPRATED_MORE,(function(e){var t=e.commit,n=e.state.bookstore.topRated.all.length;return D.default.loadTopReadingBooks(20,n).then((function(e){var n=P.recommendBookParse({books:e.books,needBookIntro:!0});t(M.STORE_ALL_TOPRATED_MORE,{topRated:n,hasMore:1===e.hasMore})}))})),d()(r,M.STORE_LOAD_MORE,(function(e){var t=e.commit,n=e.state.bookstore.novel.all.length;return D.default.loadRecommendBooks(1,20,n).then((function(e){if(!e||!e.books)return y.a.reject({errCode:-1,errMsg:"数据格式不对"});var n=P.recommendBookParse({books:e.books,needBookIntro:!0});t(M.STORE_LOAD_MORE,{novel:n,hasMore:e.hasMore})}))})),d()(r,M.INIT_BOOKSHELF,(function(e){var t=e.commit,n=e.state;return Y[M.BOOKSHELF_SYNC]({commit:t}).then((function(e){Y[M.BALANCE]({commit:t,state:n},!0),Y[M.LAST_APP_LOGINTIME]({commit:t,state:n})}))})),d()(r,M.BOOKSHELF_SYNC,(function(e){var t=e.commit;return D.default.loadBookShelf().then((function(e){var n=e&&e.books,r=e&&e.lectureBooks,o=e&&e.lectureUpdate,i=e&&e.archive||[],a=[];if(n){var u=P.bookshelfParse(n,r,o);console.warn("test",u);var s=u.filter((function(e){return 3===e.type})).map((function(e){return e.bookId}));if(!s.length){if(i.length>0){var c=!0,l=!1,f=void 0;try{for(var d,_=O()(i);!(c=(d=_.next()).done);c=!0){for(var E=d.value,p=E.bookIds||[],h=E.lectureBookIds||[],I=[],m=[],v=0;v<u.length;v++){var g=u[v];p.includes(g.bookId)?I.push(g):h.includes(g.bookId)&&m.push(g)}a=[].concat(T()(a),T()(p),T()(h)),E.bookInfos=I.sort((function(e,t){return t.readUpdateTime-e.readUpdateTime})),E.lectureBookIds=m,E.lectureBookInfos=m,E.allBookInfos=[].concat(I,m).sort((function(e,t){return t.readUpdateTime-e.readUpdateTime})),E.allBookInfos.length&&E.allBookInfos[0].readUpdateTime?E.readUpdateTime=E.allBookInfos[0].readUpdateTime:E.readUpdateTime=0}}catch(e){l=!0,f=e}finally{try{!c&&_.return&&_.return()}finally{if(l)throw f}}u=u.filter((function(e){return!a.includes(e.bookId)}))}return void t(M.INIT_BOOKSHELF,{simpleBooks:u,archives:i})}D.default.loadMpCover({bookIds:s}).then((function(e){(e&&e.covers||[]).forEach((function(e){var t=u.find((function(t){return t.bookId===e.bookId}));t&&(t.mpCover=e)}))})).finally((function(){if(i.length>0){var e=!0,n=!1,r=void 0;try{for(var o,s=O()(i);!(e=(o=s.next()).done);e=!0){for(var c=o.value,l=c.bookIds||[],f=c.lectureBookIds||[],d=[],_=[],E=0;E<u.length;E++){var p=u[E];l.includes(p.bookId)?d.push(p):f.includes(p.bookId)&&_.push(p)}a=[].concat(T()(a),T()(l),T()(f)),c.bookInfos=d.sort((function(e,t){return t.readUpdateTime-e.readUpdateTime})),c.lectureBookIds=_,c.lectureBookInfos=_,c.allBookInfos=[].concat(d,_).sort((function(e,t){return t.readUpdateTime-e.readUpdateTime})),c.allBookInfos.length&&c.allBookInfos[0].readUpdateTime?c.readUpdateTime=c.allBookInfos[0].readUpdateTime:c.readUpdateTime=0}}catch(e){n=!0,r=e}finally{try{!e&&s.return&&s.return()}finally{if(n)throw r}}}u=u.filter((function(e){return!a.includes(e.bookId)})),t(M.INIT_BOOKSHELF,{simpleBooks:u,archives:i})}))}}))})),d()(r,M.LAST_APP_LOGINTIME,(function(e){var t=e.commit,n=G.default.getUser(),r=n.vid;return D.default.userProfile(r).then((function(e){n.lastAppLoginTime=e.recentLoginTime,t(M.LAST_APP_LOGINTIME,e.recentLoginTime||0)}))})),d()(r,M.LAST_WP_LOGINTIME,(function(e){var t=e.commit,n=G.default.getUser(),r=n.vid;return D.default.userProfile(r).then((function(e){n.lastWpLoginTime=e.recentWPLoginTime,t(M.LAST_WP_LOGINTIME,e.recentWPLoginTime||0)}))})),d()(r,M.BOOK_REVIEWLIST_ALL,(function(e,t){var n=e.commit,r=t.bookId;return D.default.loadReviewList(r,20).then((function(e){var t=P.bookDetailReviewlistParse(e);n(M.BOOK_REVIEWLIST_ALL,{bookId:r,reviewList:t})}))})),d()(r,M.BOOK_REVIEWLIST_LIKE,(function(e,t){var n=e.commit,r=t.bookId,o=t.reviewId,i=t.isLike?0:1;return D.default.reviewLike(o,i).then((function(e){return e&&1===e.succ&&n(M.BOOK_REVIEWLIST_LIKE,{bookId:r,reviewId:o}),e})).catch((function(e){return e}))})),d()(r,M.BOOK_REVIEWLIST_MORE,(function(e,t){var n=e.commit,r=e.state,o=t.bookId;if(!o)return y.a.reject({errMsg:"invalid bookId"});var i,a=r.books[o]&&r.books[o].reviewList;return i=a&&r.books[o].reviewList.items.length,D.default.loadReviewList(o,10,i).then((function(e){var t=P.bookDetailReviewlistParse(e),r=t.items,i=void 0===r?[]:r,u=t.hasMore,s=void 0===u?0:u;a.items=a.items.concat(i),a.hasMore=s,n(M.BOOK_REVIEWLIST_MORE,{bookId:o,reviewlist:a})}))})),d()(r,M.READ_CHAPTER,(function(e,t){var n=e.commit,r=e.state,o=e.dispatch,i=t.bookId,a=t.chapter,u=t.section,s=void 0===u?0:u,c=t.format,l=t.pageLevel;if(!i)return y.a.reject({errMsg:"invalid bookId"});var f=r.readerUnlockStatus;return f.readerFreeBookId,f.readerFreeChapters,new y.a((function(e,t){if(!l&&r.books[i]&&r.books[i].reader&&r.books[i].reader.preloadChapter&&r.books[i].reader.preloadChapter.content){var u=r.books[i].reader.preloadChapter,f=u.content,d=u.chapter,_=u.ePubData||{};if(d.chapterUid===a.chapterUid&&f)return n(M.READ_CHAPTER,{bookId:i,chapter:a,content:f,ePubData:_}),r.similarBooks&&m()(r.similarBooks).includes(i)||o(M.SIMILAR_BOOKS,{bookId:i}),void e({isPreload:!0})}l?D.default.loadChapterEPubContent(i,a.chapterUid,s).then((function(t){n(M.READ_CHAPTER,{bookId:i,chapter:a,ePubData:t}),e({isPreload:!1})})).catch((function(e){n(M.READ_CHAPTER,{bookId:i,chapter:a}),t(e)})):D.default.loadChapterContent(i,a.chapterUid,"none",s,c).then((function(t){var u=P.chapterContentParse(t.content);a.needsPurchase=0!==t.price,n(M.READ_CHAPTER,{bookId:i,chapter:a,content:u,ePubData:t.ePubData}),r.similarBooks&&m()(r.similarBooks).includes(i)||o(M.SIMILAR_BOOKS,{bookId:i}),o(M.CHECK_READER_UNLOCK_DATE_WATERMARK),e({isPreload:!1})})).catch((function(e){console.error("READ_CHAPTER error:",e),n(M.READ_CHAPTER,{bookId:i,chapter:a}),t(e)}))}))})),d()(r,M.PRELOAD_CHAPTER,(function(e,t){var n=e.commit,r=e.state,o=e.dispatch,i=t.bookId,a=t.chapter,u=t.section,s=void 0===u?0:u,c=t.format;if(!i)return y.a.reject({errMsg:"invalid bookId"});var l=r.readerUnlockStatus;return l.readerFreeBookId,l.readerFreeChapters,D.default.loadChapterContent(i,a.chapterUid,"none",s,c).then((function(e){var t=P.chapterContentParse(e.content),r=e.ePubData||{};return a.needsPurchase=0!==e.price,n(M.PRELOAD_CHAPTER,{bookId:i,chapter:a,content:t,ePubData:r}),o(M.CHECK_READER_UNLOCK_DATE_WATERMARK),y.a.resolve(t)}))})),d()(r,M.CANCEL_AUTO_PAY,(function(e,t){var n=e.commit,r=(e.state,t.bookId),o=t.type;return D.default.cancelAutoBuy(r,o).then((function(e){e&&1===e.succ&&n(M.CANCEL_AUTO_PAY,{bookId:r,type:o})})).catch((function(e){console.log("error CANCEL_AUTO_PAY:",e)}))})),d()(r,M.INIT_CHAPTERINFOS,(function(e,t){var n=e.commit,r=(e.state,t.book),o=r.bookId,i=r.catalog;return D.default.loadChapterInfos(o).then((function(e){var t=e&&e.data&&e.data[0].updated;t=P.parseChapterInfos(r,t),n(M.INIT_CHAPTERINFOS,{bookId:o,chapterInfos:t,catalog:i})})).catch((function(e){console.log(e)}))})),d()(r,M.DECREASE_READER_FREE_CHAPTERS,(function(e){var t=this,n=e.commit,r=e.state;return w()(C.a.mark((function e(){var o;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(o=r.readerUnlockStatus.readerFreeChapters)>0?(n(M.UPDATE_BOOKREADER_UNLOCK_STATUS,h()({},r.readerUnlockStatus,{readerFreeChapters:o-1})),D.default.decreaseFreeChapter().then((function(){})).catch((function(){}))):n(M.UPDATE_BOOKREADER_UNLOCK_STATUS,h()({},r.readerUnlockStatus,{readerFreeChapters:0}));case 2:case"end":return e.stop()}}),e,t)})))()})),d()(r,M.CHECK_READER_UNLOCK_DATE_WATERMARK,(function(e){var t=this,n=e.dispatch,r=e.state;return w()(C.a.mark((function e(){var o,i,a;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=function(e){var t=new Date(e);return 1e4*t.getFullYear()+100*(t.getMonth()+1)+t.getDate()},i=r.readerUnlockStatus.dateWatermark,a=o(Date.now()),i<a&&n(M.INIT_BOOKREADER_UNLOCK_STATUS).catch((function(e){console.log("[reader]: get reader unlock status error",e)}));case 4:case"end":return e.stop()}}),e,t)})))()})),d()(r,M.INIT_BOOKREADER_UNLOCK_STATUS,(function(e){var t=this,n=e.commit;return w()(C.a.mark((function e(){return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",D.default.getReaderUnlockStatus().then((function(e){n(M.UPDATE_BOOKREADER_UNLOCK_STATUS,e)})));case 1:case"end":return e.stop()}}),e,t)})))()})),d()(r,M.INIT_BOOK_READER,(function(e,t){var n=this,r=e.commit,o=e.dispatch,i=t.bookId,a=t.chapterUid,u=void 0===a?null:a,s=t.section,c=void 0===s?0:s;return w()(C.a.mark((function e(){var t,a,s,l,f,d,_,E,p;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i){e.next=3;break}return t={errMsg:"invalid bookId"},e.abrupt("return",y.a.reject(t));case 3:return a=B.default.getStorageSync(i),s=B.default.getStorageSync("readerUnlockStatus"),s.readerFreeChapters,s.readerFreeBookId,e.next=9,D.default.loadBookChapterInfo({bookId:i,localReadChapterUid:a,chapterUid:u,useToken:!1,section:c});case 9:if(l=e.sent,o(M.CHECK_READER_UNLOCK_DATE_WATERMARK),U.default.instance.loadEnd().injectExtra({bookId:i,chapterCount:l&&l.book&&l.book.chapterSize||0,chapterUid:l&&l.targetChapter&&l.targetChapter.chapterUid||u||0}),!(l&&l.errCode||!l)){e.next=14;break}return e.abrupt("return",y.a.reject(l));case 14:if(f=l.book,o(M.SIMILAR_BOOKS,{bookId:f.bookId}),(d=l.chapterContent)&&d.errCode&&(D.default.reportRealKVLog({key:44038}),l.chapterContent=null),(!f||0===f.type)&&l.chapterContent){e.next=21;break}return r(M.INIT_BOOK_READER,{book:f,reviewList:l.reviewList,catalog:l.catalog,allCatalog:[],chapter:l.targetChapter}),e.abrupt("return",y.a.resolve());case 21:return _=l.targetChapter,E=P.chapterContentParse(d.content),p=l.ePubData||{},_.needsPurchase=0!==d.price,r(M.INIT_BOOK_READER,{book:f,reviewList:l.reviewList,catalog:l.catalog,allCatalog:[],chapter:l.targetChapter,content:E,ePubData:p,wpChapterOffset:l.wpChapterOffset||0}),e.abrupt("return",y.a.resolve());case 27:case"end":return e.stop()}}),e,n)})))()})),d()(r,M.SIMILAR_BOOKS,(function(e,t){var n=e.commit,r=e.state,o=t.bookId,i=t.count,a=void 0===i?6:i;return o?D.default.loadPodcastRecommends(o,1,30).then((function(e){r.similarBooks[o];var t=P.transformSimilarBook(e),i=[];if(t.books&&t.books.length>0)for(var u=t.books,s=u.length,c=Math.floor(Math.random()*s),l=0;l<a;l++)i.push(u[c]),c=(c+1)%s;var f={bookId:o,books:i,hasMore:t.hasMore};n(M.SIMILAR_BOOKS,f)})):y.a.reject({errMsg:"invalid bookId"})})),d()(r,M.UPLOAD_READING_SCHEDULE_TIME,(function(e,t){var n=e.commit,r=t.book,o=t.chapter,i=void 0===o?{}:o,a=t.progress,u=void 0===a?0:a,s=t.readingTime,c=void 0===s?0:s,l=t.ttsTime,f=void 0===l?0:l,d=t.scrollTop,_=void 0===d?0:d,p=t.ePubPageIndex,h=r.bookId,I={bookId:h,readingTime:c,ttsTime:f};return n(M.READ_RECORD,{bookId:h,chapter:i,scrollTop:_,ePubPageIndex:p}),(c>60||f>60||r.isOnBookShelf)&&n(M.LATEST_READ_BOOK,r),i.chapterIdx&&i.chapterUid&&(I=E()({},I,{chapterIdx:i.chapterIdx,chapterUid:i.chapterUid,progress:u,chapterOffset:_})),(c>360||f>360)&&(c=0,f=0),D.default.uploadReadProgressAndTime(I)})),d()(r,M.ADD_TO_BOOKSHELF,(function(e,t){var n=e.commit,r=t.bookId,o=t.markAsSecret,i=void 0===o||o,a=t.isLecture,u=void 0!==a&&a;if(!r)return y.a.reject({errMsg:"invalid bookId"});var s=[D.default.addToBookShelf(r,u)];return i&&s.push(D.default.secretBook({bookId:r,secret:!0})),y.a.all(s).then((function(e){n(M.ADD_TO_BOOKSHELF,r)}))})),d()(r,M.REMOVE_FROM_BOOKSHELF,(function(e,t){var n=e.commit,r=t.bookId,o=t.isLecture,i=void 0!==o&&o;return y.a.all([D.default.deleteFromBookshelf(r,i),D.default.secretBook({bookId:r,secret:!1})]).then((function(e){n(M.REMOVE_FROM_BOOKSHELF,r)}))})),d()(r,M.QUERY_INFINITE,(function(e){var t=this,n=e.commit;return w()(C.a.mark((function e(){return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",D.default.infiniteTime().then((function(e){var t=e.expired,r=e.remainTime,o=e.freeBookIds,i=e.permanent,a=e.isPaying;n(M.QUERY_INFINITE,{infiniteExpired:t,infiniteTime:r,freeBookIds:o,infinitePermanent:i,isPaying:a})})));case 1:case"end":return e.stop()}}),e,t)})))()})),d()(r,M.BALANCE,(function(e){var t=e.commit,n=e.state;return y.a.all([D.default.queryBalance(),D.default.infiniteTime()]).then((function(e){console.log(e[0]),console.log(e[1]);var r=e[0].balance,o=e[0].giftBalance,i=(100*r-100*o)/100,a=e[1].expired,u=e[1].remainTime,s=e[1].freeBookIds,c=e[1].payingRemainTime,l=G.default.getUser();l=E()(n.profile.user,l),t(M.BALANCE,{balance:r,giftBalance:o,paidBalance:i,infiniteExpired:a,infiniteTime:u,payingRemainTime:c,freeBookIds:s,user:l})})).catch((function(e){return e}))})),d()(r,M.PAY_BALANCE,(function(e){var t=e.commit;e.state,D.default.queryBalance().then((function(e){var n=e.balance,r=e.giftBalance,o=(100*n-100*r)/100;t(M.PAY_BALANCE,{balanceMoney:n,giftBalance:r,paidBalance:o})})).catch((function(e){return e}))})),d()(r,M.INIT_MINE_USER_INFO,(function(e){var t=e.commit,n=(e.state,G.default.getUser());return null!=n&&n.vid?D.default.userProfileInfo(n.vid).then((function(e){t(M.INIT_MINE_USER_INFO,E()(n,e))})).catch((function(e){console.log("INIT_MINE_USER_INFO err:",e)})):y.a.reject({errCode:-1,errMsg:"查不到用户信息"})})),d()(r,M.BUY_BOOK,(function(e,t){var n=this,r=(e.commit,t.bookId),o=t.price;return w()(C.a.mark((function e(){return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(r&&void 0!==o,"error: bookId和price不能为空"),e.next=3,D.default.buyBook(r&&o);case 3:e.sent.succ;case 5:case"end":return e.stop()}}),e,n)})))()})),d()(r,M.BUY_CHAPTER,(function(e,t){var n=this;return e.commit,w()(C.a.mark((function e(){return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log(t.bookId&&t.chapterUid,"error：bookId和chapterUid不能为空！！！！！");case 1:case"end":return e.stop()}}),e,n)})))()})),d()(r,M.STORE_SEARCH,(function(e,t){var n=e.commit;return D.default.searchBook({keyword:t}).then((function(e){var t=P.searchBookParse(e);n(M.STORE_SEARCH,t)}))})),d()(r,M.STORE_SEARCH_PUBLISH,(function(e,t){var n=e.commit;return D.default.searchBook({keyword:t,outer:0}).then((function(e){var r=P.searchBookParse(e);n(M.STORE_SEARCH_PUBLISH,{name:t,books:r.books,hasMore:1===e.hasMore})}))})),d()(r,M.STORE_SEARCH_PUBLISH_MORE,(function(e,t){var n=e.commit,r=e.state.search.searchPublish.books.length;return D.default.searchBook({keyword:t,outer:0,maxIdx:r}).then((function(e){var t=P.searchBookParse(e);n(M.STORE_SEARCH_PUBLISH_MORE,{books:t.books,hasMore:e.hasMore})}))})),d()(r,M.STORE_SEARCH_AUTHOR,(function(e,t){var n=e.commit,r=t.author,o=t.fromBookId,i=void 0===o?"":o;return D.default.searchBook({keyword:r,outer:0,fromBookId:i}).then((function(e){var t=P.searchBookParse(e);n(M.STORE_SEARCH_AUTHOR,{name:r,books:t.books,hasMore:1===e.hasMore})}))})),d()(r,M.STORE_SEARCH_AUTHOR_MORE,(function(e,t){var n=e.commit,r=e.state,o=t.author,i=t.fromBookId,a=void 0===i?"":i,u=r.search.searchAuthor.books.length;return D.default.searchBook({keyword:o,outer:0,fromBookId:a,maxIdx:u}).then((function(e){var t=P.searchBookParse(e);n(M.STORE_SEARCH_AUTHOR_MORE,{books:t.books,hasMore:1===e.hasMore})}))})),d()(r,M.STORE_SEARCH_TAGS,(function(e){var t=this,n=e.commit,r=e.state;return w()(C.a.mark((function e(){var o,i,a,u;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=r.search.tags.shuffleCount,i=r.search.tags.all,!(8*o+8>r.search.tags.all.length)){e.next=7;break}return e.next=5,D.default.loadSearchTags({count:50});case 5:a=e.sent,i=P.parseHotSearchBooks(a.books);case 7:8*o+8>i.length&&(o=0),u=i.slice(8*o,8*o+8),n(M.STORE_SEARCH_TAGS,{shuffleCount:o,showing:u,all:i});case 10:case"end":return e.stop()}}),e,t)})))()})),d()(r,M.INIT_ALL_CATEGORIES,(function(e){var t=e.commit;return D.default.loadCategories().then((function(e){var n=P.categoryParse(e);t(M.INIT_ALL_CATEGORIES,n)}))})),d()(r,M.INIT_CATEGORY_BOOKS,(function(e,t){var n=this,r=e.commit,o=e.state,i=t.categoryId,a=t.count,u=void 0===a?10:a;return w()(C.a.mark((function e(){var t;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("INIT_CATEGORY_BOOKS categoryId:",i),i){e.next=4;break}return t={errMsg:"invalid categoryId"},e.abrupt("return",y.a.reject(t));case 4:if(o.categories.items.length){e.next=7;break}return e.next=7,Y[M.INIT_ALL_CATEGORIES]({commit:r,state:o});case 7:return e.abrupt("return",D.default.loadCategoryBooks(i,u,0).then((function(e){var t=P.categoryBooksParse(e);r(M.INIT_CATEGORY_BOOKS,{categoryId:i,books:t})})));case 8:case"end":return e.stop()}}),e,n)})))()})),d()(r,M.CATEGORY_BOOKS_MORE,(function(e,t){var n=e.commit,r=e.state,o=t.categoryId,i=t.count,a=void 0===i?10:i;if(!o)return y.a.reject({errMsg:"invalid categoryId"});var u=P.findCategoryById(r.categories.items,o);if(u){var s=u.books&&u.books.length;return D.default.loadCategoryBooks(o,a,s).then((function(e){var t=P.categoryBooksParse(e);n(M.CATEGORY_BOOKS_MORE,{categoryId:o,books:t})}))}return y.a.reject({errMsg:"can not find categoryId"})})),d()(r,M.INIT_SEARCH_HISTORY,(function(e){var t=e.commit;return new y.a((function(e,n){B.default.getStorage({key:"search_history",success:function(e){if(e&&e.data){var n=e.data.reverse();t(M.INIT_SEARCH_HISTORY,n)}},fail:function(e){n(new Error({error:e}))}})}))})),d()(r,M.ADD_SEARCH_HISTORY,(function(e,t){var n=e.commit,r=t.keyword;return Y[M.KV_LOG_REPORT]({commit:n},{itemname:"Wp_Search_Confirm"}),new y.a((function(e,t){var o=B.default.getStorageSync("search_history");o||(o=[]),(o=o.filter((function(e){return e!==r}))).push(r),B.default.setStorage({key:"search_history",data:o,success:function(e){n(M.INIT_SEARCH_HISTORY,o)},fail:function(e){t({error:e})}})}))})),d()(r,M.CLEAR_SEARCH_HISTORY,(function(e){var t=e.commit;return new y.a((function(e,n){B.default.setStorage({key:"search_history",data:[],success:function(e){t(M.CLEAR_SEARCH_HISTORY)},fail:function(e){n({error:e})}})}))})),d()(r,M.REWARD_FROM_SHARE,(function(e,t){e.commit;var n=t.bookId;if(!n)return y.a.reject({errMsg:"invalid bookId"});var r=G.default.getUser(),o=r&&r.shareReward,i=Math.floor(Date.now()/1e3);if(o||((o={}).lastShareTime=0,o.shareCount=0),o[n]||(o[n]={remainCount:0}),i-o.lastShareTime>86400&&(o.shareCount=0),o.shareCount>=3){return y.a.reject({msg:"失败：分享已达上限，每天最多可分享3次"})}return o.lastShareTime=i,o.shareCount++,o[n].remainCount+=10,r.shareReward=o,G.default.saveUserInfo(r),y.a.resolve()})),d()(r,M.LOAD_CATALOG_NEXT,(function(e,t){var n=e.commit,r=t.bookId;return r?new y.a((function(e,t){n(M.LOAD_CATALOG_NEXT,{bookId:r}),e()})):y.a.reject({errMsg:"invalid bookId"})})),d()(r,M.LOAD_CATALOG_PRE,(function(e,t){var n=e.commit,r=t.bookId;return r?new y.a((function(e,t){n(M.LOAD_CATALOG_PRE,{bookId:r}),e()})):y.a.reject({errMsg:"invalid bookId"})})),d()(r,M.QUERY_USERACTIVETYPE,(function(e){var t=e.commit;return D.default.queryUserInfiniteActiveType().then((function(e){var n=G.default.getUser();console.log("userType",e),n.userActiveType=e.activeType,n.birdBox=e.birdBox,G.default.saveUserInfo(n),t(M.QUERY_USERACTIVETYPE,{activeType:n.userActiveType,birdBox:n.birdBox})}))})),d()(r,M.SENDREWARD_INVITEFRIEND,(function(e,t){e.commit,e.state;var n=t.inviter,r=t.invitee;return D.default.acceptInvite({inviter:n,invitee:r})})),d()(r,M.KV_LOG_REPORT,(function(e,t){e.commit;var n=t.itemname,r=t.value,o=void 0===r?1:r;return D.default.reportKVLog({itemname:n,value:o})})),d()(r,M.REPORT_READER_FAIL,(function(e){return e.commit,D.default.reportRealKVLog({key:43696})})),d()(r,M.OSS_LOG_REPORT,(function(e,t){return e.commit,D.default.reportOsslog(t)})),d()(r,M.INIT_REVIEW_DETAIL,(function(e,t){var n=e.commit,r=t.reviewId;return D.default.loadReviewDetail(r).then((function(e){var t=P.reviewDetailParse(e);n(M.INIT_REVIEW_DETAIL,t)}))})),d()(r,M.PUBLISH_BOOK_REVIEW,(function(e,t){e.commit;var n=t.bookId,r=t.content,o=t.newRatingLevel;return D.default.publishBookReview({bookId:n,content:r,newRatingLevel:o})})),d()(r,M.USER_PROFILE,(function(e,t){var n=e.commit,r=t.userVid;return y.a.all([D.default.userProfileInfo(r),D.default.userPersonalProfile({userVid:r})]).then((function(e){n(M.USER_PROFILE,{userVid:r,userProfileInfo:h()({},e[0],e[1])})}))})),d()(r,M.INFINITE_ACT_PAGE,(function(e){var t=this;return e.commit,w()(C.a.mark((function e(){var n,r;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D.default.queryUserInfiniteActiveType().catch((function(e){return e}));case 2:if(!(n=e.sent).errCode){e.next=5;break}return e.abrupt("return",y.a.reject(n));case 5:return r=G.default.getUser(),e.abrupt("return",D.default.userProfileSimple({userVid:r.vid}).then((function(e){return e.userVid=r.userVid,e})));case 7:case"end":return e.stop()}}),e,t)})))()})),d()(r,M.USER_PROFILE_SHELF,(function(e,t){var n=e.commit,r=t.userVid,o=t.minCnt,i=void 0===o?0:o;return D.default.friendShelfCommon(r,i).then((function(e){var t=P.friendShelfDataParse(e,i);n(M.USER_PROFILE_SHELF,{userVid:r,shelfData:t,minCount:i})}))})),d()(r,M.USER_PROFILE_WORKS,(function(e,t){var n=e.commit,r=t.userVid,o=t.count,i=void 0===o?3:o,a={},u={},s=[],c=[];return y.a.all([D.default.userProfileWorks(r,i,0),D.default.userProfileWorks(r,i,1)]).then((function(e){return e[0]&&e[0].totalCount&&(a=e[0]),e[1]&&e[1].totalCount&&(u=e[1]),a&&a.data&&a.data.map&&a.data.map((function(e){e.meta&&1===e.meta.type?c.push(e.bookInfo.bookId):s.push(e.bookInfo.bookId)})),u&&u.data&&u.data.map&&u.data.map((function(e){e.meta&&1===e.meta.type?c.push(e.bookInfo.bookId):s.push(e.bookInfo.bookId)})),y.a.all([s.length?D.default.fetchBookIdsInShelf(s):y.a.resolve({}),c.length?D.default.fetchLectureBookIdsInShelf(c):y.a.resolve({})])})).then((function(e){var t=e[0],o=e[1];a.data&&a.data.forEach&&a.data.forEach((function(e){e.meta&&1===e.meta.type?e.inShelf=!!o[e.bookInfo.bookId]:e.inShelf=!!t[e.bookInfo.bookId]})),u.data&&u.data.forEach&&u.data.forEach((function(e){e.meta&&1===e.meta.type?e.inShelf=!!o[e.bookInfo.bookId]:e.inShelf=!!t[e.bookInfo.bookId]})),n(M.USER_PROFILE_WORKS,{userVid:r,hottest:a,newest:u})}))})),d()(r,M.USER_PROFILE_WORKS_DETAIL,(function(e,t){var n=e.commit,r=t.userVid,o=t.listType,i={},a=[],u=[];return D.default.userProfileWorks(r,0,o).then((function(e){return(i=e)&&i.data&&i.data.map&&i.data.map((function(e){e.meta&&1===e.meta.type?u.push(e.bookInfo.bookId):a.push(e.bookInfo.bookId)})),y.a.all([a.length?D.default.fetchBookIdsInShelf(a):y.a.resolve({}),u.length?D.default.fetchLectureBookIdsInShelf(u):y.a.resolve({})])})).then((function(e){var t=e[0],a=e[1];i.data.forEach((function(e){e.meta&&1===e.meta.type?e.inShelf=!!a[e.bookInfo.bookId]:e.inShelf=!!t[e.bookInfo.bookId]})),n(M.USER_PROFILE_WORKS_DETAIL,{userVid:r,listData:i,listType:o})}))})),d()(r,M.USER_PROFILE_REVIEW,(function(e,t){var n=e.commit,r=t.userVid,o=t.mine,i=t.pageSize,a=t.curReviewCount;return D.default.userProfileReviews(r,o).then((function(e){var t=P.userProfileReviewList(e.reviews,i,a);n(M.USER_PROFILE_REVIEW,{userVid:r,reviewList:t.subReviewList,totalCount:t.reviewCount})}))})),d()(r,M.USER_PROFILE_BOOKLISTS,(function(e,t){var n=e.commit,r=t.userVid;return D.default.userProfileBooklists(r).then((function(e){n(M.USER_PROFILE_BOOKLISTS,{userVid:r,booklistsData:e})}))})),d()(r,M.USER_PROFILE_FOLLOW,(function(e,t){var n=e.commit,r=t.vid,o=t.isfollow;return D.default.followFriend({vid:r,isUnfollow:o?0:1}).then((function(e){return e.applyVids&&-1!==e.applyVids.indexOf(r)?"applied":(n(M.USER_PROFILE_FOLLOW,{userVid:r,isFollow:o}),"followed")}))})),d()(r,M.REPORT_FORMID,(function(e,t){e.commit;var n=t.formId,r=t.scene;return D.default.reportFormId({formId:n,scene:r})})),d()(r,M.USER_CHARGE_PAY_ITEMS,(function(e){var t=e.commit;return D.default.getPayItem().then((function(e){var n=P.convertMidasPayItems(e);t(M.USER_CHARGE_PAY_ITEMS,n)}))})),d()(r,M.FREE_3_BOOKS,(function(e,t){var n=e.commit,r=t.count,o=void 0===r?3:r,i=t.maxIdx,a=void 0===i?0:i;return D.default.free3books({count:o,maxIdx:a}).then((function(e){if(!e)return null;var t=P.free3book(e),r=t.receiveBooks;if(r&&r.length>=3)return null;var o={allReceived:r.length>=3,received:r,all:t.books,showing:t.books.slice(0,3),shuffleCount:0};n(M.FREE_3_BOOKS,o)}))})),d()(r,M.FREE_3_BOOKS_RECEIVE,(function(e,t){var n=e.commit,r=e.state,o=t.bookId;return o?D.default.free3booksReceive({bookId:o}).then((function(e){Y[M.INIT_RECENTREAD]({commit:n,state:r}),n(M.FREE_3_BOOKS_RECEIVE,t)})):y.a.reject({errCode:-1,errMsg:"参数错误"})})),d()(r,M.FREE_3_BOOKS_SHUFFLE,(function(e){var t=this,n=e.commit,r=e.state;return w()(C.a.mark((function e(){var o,i,a,u,s;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=r.free3book.shuffleCount+1,i=r.free3book.all,!(3*o+3>=i.length)){e.next=7;break}return e.next=5,D.default.free3books({count:20,maxIdx:i.length});case 5:(a=e.sent)&&(u=P.free3book(a))&&u.books&&(i=i.concat(u.books));case 7:3+(s=3*o)>i.length&&(s=0,o=0),n(M.FREE_3_BOOKS_SHUFFLE,{shuffleCount:o,all:i,showing:i.slice(s,s+3)});case 10:case"end":return e.stop()}}),e,t)})))()})),d()(r,M.INIT_TOP100,(function(e){var t=e.commit;return e.state,D.default.loadTop100().then((function(e){var n=P.top100Parse(e);t(M.INIT_TOP100,n)}))})),d()(r,M.INIT_TOP100_BOOKS,(function(e,t){var n=this,r=e.commit,o=e.state,i=t.categoryId,a=t.count,u=void 0===a?100:a;return w()(C.a.mark((function e(){return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o.top100.items.length){e.next=3;break}return e.next=3,Y[M.INIT_TOP100]({commit:r,state:o});case 3:if(o.shelf.all.length){e.next=6;break}return e.next=6,Y[M.BOOKSHELF_SYNC]({commit:r});case 6:return e.abrupt("return",D.default.loadCategoryBooks(i,u,0,!0).then((function(e){var t=P.top100BooksParse(e,o.shelf.all);r(M.INIT_TOP100_BOOKS,{categoryId:i,books:t,hasMore:!0})})));case 7:case"end":return e.stop()}}),e,n)})))()})),d()(r,M.TOP100_SHELF_ACTION,(function(e,t){var n=e.commit,r=e.state,o=t.categoryId,i=t.bookId,a=t.add,u=void 0===a?0:a,s=t.del,c=void 0===s?0:s;if(!o||!i)return console.error("TOP100_SHELF_ACTION invalid categoryId bookId"),y.a.reject({errCode:-1,errMsg:"参数错误"});if(u){var l=P.findCategoryById(r.top100.items,o);return l.books.map((function(e){return e.bookId===i&&(e.isOnBookShelf=!0),e})),n(M.INIT_TOP100_BOOKS,{categoryId:o,books:l.books,hasMore:l.hasMore}),Y[M.ADD_TO_BOOKSHELF]({commit:n},i),Y[M.BOOKSHELF_SYNC]({commit:n}),y.a.resolve()}if(c){var f=P.findCategoryById(r.top100.items,o);return f.books.map((function(e){return e.bookId===i&&(e.isOnBookShelf=!1),e})),n(M.INIT_TOP100_BOOKS,{categoryId:o,books:f.books,hasMore:f.hasMore}),Y[M.REMOVE_FROM_BOOKSHELF]({commit:n},i),Y[M.BOOKSHELF_SYNC]({commit:n}),y.a.resolve()}})),d()(r,M.TOP100_MARK_FINISH,(function(e,t){var n=e.commit,r=(e.state,t.categoryId),o=t.bookId,i=t.isCancel,a=void 0===i?0:i;return D.default.markBookFinished({bookId:o,isCancel:a}).then((function(e){n(M.TOP100_MARK_FINISH,{categoryId:r,bookId:o,isCancel:a})}))})),d()(r,M.TOP100_SHARE_INFO,(function(e,t){var n=e.commit,r=e.state,o=t.categoryId,i=t.finishCount,a=void 0===i?0:i;return D.default.top100RankShareInfo({categoryId:o,finishCount:a}).then((function(e){P.findCategoryById(r.top100.items,o)&&e.title&&n(M.TOP100_SHARE_INFO,{categoryId:o,shareInfo:e})}))})),d()(r,M.FREE_3_BOOKS,(function(e,t){var n=e.commit,r=t.count,o=void 0===r?3:r,i=t.maxIdx,a=void 0===i?0:i;return D.default.free3books({count:o,maxIdx:a}).then((function(e){if(!e)return null;var t=P.free3book(e),r=t.receiveBooks;if(r&&r.length>=3)return null;var o={allReceived:r.length>=3,received:r,all:t.books,showing:t.books.slice(0,3),shuffleCount:0};o.showing.length&&D.default.reportKVLog({itemname:"Wp_free3book_showed"}),n(M.FREE_3_BOOKS,o)}))})),d()(r,M.FREE_3_BOOKS_RECEIVE,(function(e,t){var n=e.commit,r=e.state,o=t.bookId;return o?D.default.free3booksReceive({bookId:o}).then((function(e){Y[M.INIT_RECENTREAD]({commit:n,state:r}),n(M.FREE_3_BOOKS_RECEIVE,t)})):(console.error("invalid bookId"),y.a.reject({errCode:-1,errMsg:"参数错误"}))})),d()(r,M.FREE_3_BOOKS_SHUFFLE,(function(e){var t=this,n=e.commit,r=e.state;return w()(C.a.mark((function e(){var o,i,a,u,s;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=r.free3book.shuffleCount+1,i=r.free3book.all,!(3*o+3>=i.length)){e.next=7;break}return e.next=5,D.default.free3books({count:20,maxIdx:i.length});case 5:(a=e.sent)&&(u=P.free3book(a))&&u.books&&(i=i.concat(u.books));case 7:3+(s=3*o)>i.length&&(s=0,o=0),n(M.FREE_3_BOOKS_SHUFFLE,{shuffleCount:o,all:i,showing:i.slice(s,s+3)});case 10:case"end":return e.stop()}}),e,t)})))()})),d()(r,M.INIT_TOP100,(function(e){var t=this,n=e.commit,r=e.state;return w()(C.a.mark((function e(){return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.shelf.all.length){e.next=3;break}return e.next=3,Y[M.BOOKSHELF_SYNC]({commit:n});case 3:return e.abrupt("return",D.default.loadTop100().then((function(e){var t=P.top100Parse(e);n(M.INIT_TOP100,t)})));case 4:case"end":return e.stop()}}),e,t)})))()})),d()(r,M.TOP100_MARK_FINISH,(function(e,t){var n=e.commit,r=(e.state,t.categoryId),o=t.bookId,i=t.isCancel,a=void 0===i?0:i;return D.default.markBookFinished({bookId:o,isCancel:a}).then((function(e){n(M.TOP100_MARK_FINISH,{categoryId:r,bookId:o,isCancel:a})}))})),d()(r,M.BOOK_READING_INFINITE,(function(e){var t=e.commit,n=e.state;return new y.a((function(e,r){D.default.readingInfinite().then((function(r){r&&r.nextTimer&&(r.curInfiniteDay>0&&(r.shouldShowTips=!0,r.shouldHide=!1,r.shouldShow=!0,Y[M.KV_LOG_REPORT]({commit:t},{itemname:"Wp_Reading_infinite_Exp"})),t(M.BOOK_READING_INFINITE,{res:r}),r.curInfiniteDay>0&&setTimeout((function(){Y[M.HIDE_READING_INFINITE]({commit:t,state:n}),setTimeout((function(){Y[M.RECEIVED_READING_INFINITE_SHOW]({commit:t,state:n})}),700),1===r.curTotalInfiniteDay&&t(M.NEW_INFINITE_DAY,{hasNewDay:!0})}),7e3)),e(r)})).catch((function(e){r(e)}))}))})),d()(r,M.HIDE_READING_INFINITE,(function(e){e.commit;var t=e.state;t.readingInfinite.shouldHide=!0,t.readingInfinite.shouldShow=!1})),d()(r,M.RECEIVED_READING_INFINITE,(function(e){e.commit,e.state.readingInfinite.shouldHide=!1})),d()(r,M.RECEIVED_READING_INFINITE_SHOW,(function(e){e.commit,e.state.readingInfinite.shouldShowTips=!1})),d()(r,M.BOOK_READING_INFINITE_INFO,(function(e){e.commit;var t=e.state;return D.default.readingInfiniteInfo().then((function(e){e&&(t.readingInfinite.curTotalInfiniteDay=e.curTotalInfiniteDay)}))})),d()(r,M.GIFT_COLLECTION_ACTIVITY_LIST,(function(e){e.commit;var t=e.state;return D.default.giftCollectionActivity().then((function(e){e&&(e.cards&&(t.giftActivity.cards=e.cards),e.rules&&(t.giftActivity.rules=e.rules))}))})),d()(r,M.UPBOOK_NOTIFY,(function(e,t){e.commit;var n=e.state;return D.default.checkUpBookNotifyState(t).then((function(e){e&&(n.upBookNotifyState=e.status)})).catch((function(e){n.upBookNotifyState=!1,console.log("err UPBOOK_NOTIFY:",e)}))})),d()(r,M.SUBMIT_UPBOOK_NOTIFY,(function(e,t){e.commit;var n=e.state,r=t.bookId,o=t.open;return D.default.addUpBookNotification(r,o).then((function(e){return e&&1===e.succ&&(n.upBookNotifyState=o?1:0),e})).catch((function(e){console.log("err SUBMIT_UPBOOK_NOTIFY:",e)}))})),d()(r,M.UPDATE_USERINFO,(function(e){var t=e.commit;e.state,t(M.UPDATE_USERINFO)})),d()(r,M.TOP_200_LIST,(function(e,t){var n=e.commit,r=(e.state,t.categoryId);return D.default.top200List({categoryId:r}).then((function(e){if(e&&e.books&&e.books.length){var t=P.parseTop200Books(e.books);n(M.TOP_200_LIST,{list:t})}}))})),d()(r,M.TOP_200_STYLE,(function(e,t){var n=e.commit,r=(e.state,t.categoryId);return D.default.top200Style({categoryId:r}).then((function(e){e&&e.ranklistCover&&n(M.TOP_200_STYLE,{detail:h()({},e.ranklistCover,{title:e.title})})})).catch((function(e){console.log("top 200 get style config error",e)}))})),d()(r,M.VIDEO_FEED_DETAIL,(function(e,t){var n=e.commit,r=(e.state,t.reviewId),o=t.hints,i=[D.default.loadReviewDetail(r).then((function(e){return console.log("VIDEO_FEED_DETAIL api.loadReviewDetail res: ",e),e})).catch((function(e){return console.log("VIDEO_FEED_DETAIL api.loadReviewDetail error: ",e),e})),D.default.getRelatedArticles(r,3,20,o).then((function(e){return console.log("VIDEO_FEED_DETAIL api.getRelatedArticles res: ",e),e})).catch((function(e){return console.log("VIDEO_FEED_DETAIL api.getRelatedArticles error: ",e),e}))];return y.a.all(i).then((function(e){console.log("VIDEO_FEED_DETAIL res: ",e);var t=e[0],o=e[1],i=o.reviews,a=o.metas;i.forEach((function(e){var t=a.find((function(t){return t.reviewId===e.reviewId}));!e.review.videoInfo&&t.videoInfo&&(e.review.videoInfo=t.videoInfo,e.review.mpInfo&&(e.review.videoInfo.mediaName=e.review.mpInfo.mp_name,e.review.videoInfo.mediaIcon=e.review.mpInfo.avatar,e.review.videoInfo.coverBig=e.review.videoInfo.cover));var n=a.find((function(t){return t.reviewId===e.reviewId})).hints;e.hints=n})),(i=i.filter((function(e){return!!e.review.videoInfo}))).length>0&&D.default.videoFeedReport({type:1,reviewIds:i.map((function(e){return e.reviewId})),metas:i.map((function(e){return{hints:e.hints}}))}).then((function(e){return console.log("[actions config.VIDEO_FEED_DETAIL] videoFeedReport: ",e)})).catch((function(e){return console.log("[actions config.VIDEO_FEED_DETAIL] videoFeedReport: ",e)}));var u={reviewId:r,reviewDetail:t,relatedReviews:i};return n(M.VIDEO_FEED_DETAIL,u),u})).catch((function(e){return console.log("VIDEO_FEED_DETAIL err: ",e),e}))})),d()(r,M.VIDEO_FEED_LIST,(function(e,t){var n=e.commit;return e.state,D.default.videoFeedList().then((function(e){if(console.log("get VIDEO_FEED_LIST res",e),e&&e.reviews&&e.metas){var r=e.reviews,o=e.metas;r.forEach((function(e){var t=o.find((function(t){return t.reviewId===e.reviewId}));!e.review.videoInfo&&t.videoInfo&&(e.review.videoInfo=t.videoInfo,e.review.mpInfo&&(e.review.videoInfo.mediaName=e.review.mpInfo.mp_name,e.review.videoInfo.mediaIcon=e.review.mpInfo.avatar,e.review.videoInfo.coverBig=e.review.videoInfo.cover));var n=o.find((function(t){return t.reviewId===e.reviewId})).hints;e.hints=n})),r=r.filter((function(e){return!!e.review.videoInfo})),e.reviews=r,e.refresh=t,r.length>0&&D.default.videoFeedReport({type:1,reviewIds:r.map((function(e){return e.reviewId})),metas:r.map((function(e){return{hints:e.hints}}))}).then((function(e){return console.log("[actions config.VIDEO_FEED_LIST] videoFeedReport: ",e)})).catch((function(e){return console.log("[actions config.VIDEO_FEED_LIST] videoFeedReport: ",e)})),n(M.VIDEO_FEED_LIST,e)}return e})).catch((function(e){return console.log("get VIDEO_FEED_LIST error",e),e}))})),d()(r,M.VIDEO_FEED_LIKE,(function(e,t){var n=e.commit,r=t.reviewId,o=t.isUnlike;return D.default.reviewLike(r,o).then((function(e){return e&&1===e.succ&&n(M.VIDEO_FEED_LIKE,{reviewId:r}),e})).catch((function(e){return e}))})),d()(r,M.INIT_LECTURE_CATEGORIES,(function(e){var t=this,n=e.commit;return w()(C.a.mark((function e(){var r;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D.default.loadLecturesRecommend(18).catch((function(){return[]}));case 2:return r=e.sent,e.abrupt("return",D.default.loadBookStoreLectureCategories().then((function(e){return e&&e.data&&e.data.length&&n(M.INIT_LECTURE_CATEGORIES,{marketList:e.data,lecturesRecommend:r}),e})));case 4:case"end":return e.stop()}}),e,t)})))()})),d()(r,M.LECTURE_CATEGORIES_RECOMMEND_SHUFFLE,(function(e){var t=this,n=e.commit,r=e.state;return w()(C.a.mark((function e(){var o,i,a,u;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=r.indexLectureListGuess.shuffleCount+1,i=r.indexLectureListGuess.all,!(3*o+3>=i.length)){e.next=7;break}return e.next=5,D.default.loadLecturesRecommend(12).catch((function(){return[]}));case 5:(a=e.sent)&&a.books&&(i=i.concat(a.books));case 7:3+(u=3*o)>i.length&&(u=0,o=0),n(M.LECTURE_CATEGORIES_RECOMMEND_SHUFFLE,{shuffleCount:o,all:i,showing:i.slice(u,u+3)});case 10:case"end":return e.stop()}}),e,t)})))()})),d()(r,M.LECTURE_CATEGORY_DETAIL,(function(e,t){var n=e.commit,r=t.categoryId;return D.default.loadCategoryBooks(r,20,H).then((function(e){var t=P.categoryLectureBooksParse(e);return n(M.LECTURE_CATEGORY_DETAIL,{categoryId:r,books:t,hasMore:e.hasMore}),e}))})),d()(r,M.LECTURE_CATEGORY_DETAIL_MORE,(function(e){var t=e.commit,n=e.state.currentLectureCategory.categoryId;return H++,D.default.loadCategoryBooks(n,20,20*H).then((function(e){var r=P.categoryLectureBooksParse(e),o=e.hasMore;return t(M.LECTURE_CATEGORY_DETAIL_MORE,{categoryId:n,books:r,hasMore:o}),e}))})),d()(r,M.SYNC_USER_SETTING,(function(e){var t=e.commit;return e.state,V().then((function(e){return t(M.SYNC_USER_SETTING,{userSetting:e}),e}))})),r),q=n(60),j=(W={},d()(W,M.BOOK_REVIEWLIST_ALL,(function(e,t){var n=t.bookId,r=t.reviewList;e.books[n]||(e.books=h()({},e.books,d()({},n,{}))),e.books[n]=h()({},e.books[n],{reviewList:r})})),d()(W,M.BOOK_REVIEWLIST_LIKE,(function(e,t){for(var n=t.bookId,r=t.reviewId,o=e.books[n].reviewList||[],i=0;i<o.items.length;i++)if(o.items[i].reviewId===r){o.items[i].isLike=0===o.items[i].isLike?1:0;var a=o.items[i].likesCount?o.items[i].likesCount:0;o.items[i].likesCount=0===o.items[i].isLike?a-1:a+1;break}e.books[n]=h()({},e.books[n],{reviewList:o})})),d()(W,M.BOOK_REVIEWLIST_MORE,(function(e,t){var n=t.bookId,r=t.reviewlist;e.books[n]=h()({},e.books[n],{reviewList:r})})),d()(W,M.BOOK_REVIEW_EXPANDED,(function(e,t){var n=t.bookId,r=t.reviewId,o=t.expanded,i=e.books[n].reviewList?e.books[n].reviewList.items:[];i=i.map((function(e){return e.reviewId===r&&(e.expanded=o),e})),e.books[n].reviewList.items=i})),d()(W,M.INIT_BOOKSHELF,(function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,u=O()(t.simpleBooks);!(r=(a=u.next()).done);r=!0){var s=a.value;n.push(h()({},s,{itemType:"book"}))}}catch(e){o=!0,i=e}finally{try{!r&&u.return&&u.return()}finally{if(o)throw i}}if(t.archives){var c=!0,l=!1,f=void 0;try{for(var d,_=O()(t.archives);!(c=(d=_.next()).done);c=!0){var E=d.value;n.push(h()({},E,{itemType:"archive"}))}}catch(e){l=!0,f=e}finally{try{!c&&_.return&&_.return()}finally{if(l)throw f}}}n=n.sort((function(e,t){return t.readUpdateTime-e.readUpdateTime})),e.shelf=h()({},e.shelf,{all:n}),e.shelf=h()({},e.shelf,{showing:n.slice(0,100)}),e.shelf=h()({},e.shelf,{archive:t.archives||[]})})),d()(W,M.BOOKSHELF_MORE,(function(e){var t=e.shelf.showing.length,n=e.shelf.all;e.shelf=h()({},e.shelf,{showing:n.slice(0,t+100)})})),d()(W,M.REMOVE_SHELF_UPDATED_FLAG,(function(e,t){e.shelf.all=e.shelf.all.map((function(e){return e.bookId===t&&(e.hasUpdated=!1),e})),e.shelf.showing=e.shelf.showing.map((function(e){return e.bookId===t&&(e.hasUpdated=!1),e})),e.bookstore.recentRead=e.bookstore.recentRead.map((function(e){return e.bookId===t&&(e.hasUpdated=!1),e}))})),d()(W,M.LAST_APP_LOGINTIME,(function(e,t){e.profile.user=h()({},e.profile.user,{lastAppLoginTime:t})})),d()(W,M.LAST_WP_LOGINTIME,(function(e,t){e.profile.user=h()({},e.profile.user,{lastWpLoginTime:t})})),d()(W,M.INIT_RECENTREAD,(function(e,t){var n=t.recentRead,r=t.shelfBooks,o=void 0===r?null:r;e.bookstore=h()({},e.bookstore,{recentRead:n}),o&&(e.shelf=h()({},e.shelf,{all:o}),e.shelf=h()({},e.shelf,{showing:o}))})),d()(W,M.QUERY_INFINITE,(function(e,t){var n=t.infiniteExpired,r=t.infiniteTime,o=t.freeBookIds,i=t.infinitePermanent,a=t.isPaying;e.profile.infiniteExpired=n,e.profile.infiniteTime=r,e.profile.freeBookIds=o,e.profile.infinitePermanent=i,e.profile.isPaying=a})),d()(W,M.BALANCE,(function(e,t){var n=t.balance,r=t.giftBalance,o=t.paidBalance,i=t.infiniteExpired,a=t.infiniteTime,u=t.payingRemainTime,s=t.freeBookIds,c=t.user;e.profile=h()({},e.profile,{user:c}),e.profile=h()({},e.profile,{freeBookIds:s}),e.profile=h()({},e.profile,{infiniteExpired:i}),e.profile=h()({},e.profile,{infiniteTime:a}),e.profile=h()({},e.profile,{payingRemainTime:u}),e.profile=h()({},e.profile,{balance:n}),e.profile=h()({},e.profile,{giftBalance:r}),e.profile=h()({},e.profile,{paidBalance:o})})),d()(W,M.PAY_BALANCE,(function(e,t){e.profile.balance=t.balanceMoney,e.profile.paidBalance=t.paidBalance,e.profile.giftBalance=t.giftBalance})),d()(W,M.SET_UPDATE_LIST,(function(e,t){e.shelf.imports=[].concat(T()(e.shelf.imports),T()(t))})),d()(W,M.CLEAR_UPDATE_LIST,(function(e,t){if(t&&t.path)for(var n=0;n<e.shelf.imports.length;n++)e.shelf.imports[n].path===t.path&&e.shelf.imports.splice(n,1);else e.shelf.imports=[]})),d()(W,M.INIT_MINE_USER_INFO,(function(e,t){e.profile=h()({},e.profile,{user:t})})),d()(W,M.INIT_READER_CONTENT,(function(e,t){var n=t.bookId,r=t.content,o=t.chapter;e.books[n]&&e.books[n].reader&&(e.books[n].reader=h()({},e.books[n].reader,{content:r}),e.books[n].reader=h()({},e.books[n].reader,{chapter:o}))})),d()(W,M.INIT_BOOK_READER,(function(e,t){var n=t.book,r=t.reviewList,o=t.catalog,i=void 0===o?[]:o,a=t.chapter,u=void 0===a?{}:a,s=t.content,c=t.ePubData,l=t.wpChapterOffset,f=void 0===l?0:l,_=n.bookId;P.formatBookStar(n),P.formatBookIntro(n),r.items=[],e.books=h()({},e.books,d()({},_,{bookInfo:n,reader:{catalog:i,readChapterCount:1,chapter:u,content:s,ePubData:c,wpChapterOffset:f},reviewList:r})),e.catalog=h()({},e.catalog,d()({},_,i)),n.isOnBookShelf&&(e.shelf.all=e.shelf.all.map((function(e){return e.bookId===_&&(e.hasUpdated=!1),e})),e.shelf.showing=e.shelf.showing.map((function(e){return e.bookId===_&&(e.hasUpdated=!1),e})),e.bookstore.recentRead=e.bookstore.recentRead.map((function(e){return e.bookId===_&&(e.hasUpdated=!1),e})))})),d()(W,M.UPDATE_BOOKREADER_UNLOCK_STATUS,(function(e,t){t&&(e.readerUnlockStatus=h()({},t),B.default.setStorage({key:"readerUnlockStatus",data:h()({},e.readerUnlockStatus)}))})),d()(W,M.INIT_CHAPTERINFOS,(function(e,t){var n=t.bookId,r=t.chapterInfos;e.books[n]||(e.books=h()({},e.books,d()({},n,{bookInfo:{},reader:{},reviewList:{}}))),e.catalog=h()({},e.catalog,d()({},n,r))})),d()(W,M.LOAD_CATALOG_NEXT,(function(e,t){var n=t.bookId,r=e.books[n].reader.catalog,o=e.catalog[n],i=o[0].chapterIdx,a=e.books[n].reader.isDescend,u=Math.min(50,o.length-r.length);if(0!==u){var s=r[0].chapterIdx-i,c=o.slice(s,s+r.length+u);a&&(c=(c=o.slice(-r.length-u)).reverse()),e.books[n].reader=h()({},e.books[n].reader,{catalog:c})}})),d()(W,M.LOAD_CATALOG_PRE,(function(e,t){var n=t.bookId,r=e.books[n].reader.catalog,o=e.catalog[n];if(!e.books[n].reader.isDescend&&r[0].chapterIdx!==o[0].chapterIdx){var i=Math.min(50,r[0].chapterIdx-o[0].chapterIdx),a=o.slice(r[0].chapterIdx-i-1,r[0].chapterIdx+r.length-1);e.books[n].reader=h()({},e.books[n].reader,{catalog:a})}})),d()(W,M.LOAD_CATALOG_REVERSE,(function(e,t){var n=t.bookId,r=e.catalog[n];if(r){var o=r.slice(r.length-30);o=o.reverse(),e.books[n].reader=h()({},e.books[n].reader,{catalog:o}),e.books[n].reader=h()({},e.books[n].reader,{isDescend:1})}})),d()(W,M.LOAD_CATALOG_INIT,(function(e,t){var n=t.bookId,r=e.catalog[n];if(r){var o=r.slice(0,30);e.books[n].reader=h()({},e.books[n].reader,{catalog:o}),e.books[n].reader=h()({},e.books[n].reader,{isDescend:0})}})),d()(W,M.READ_CHAPTER,(function(e,t){var n=t.bookId,r=t.chapter,o=t.content,i=void 0===o?null:o,a=t.ePubData,u=void 0===a?null:a;e.books[n]||(e.books[n]={}),e.books[n].reader=h()({},e.books[n].reader,{chapter:r}),i&&(e.books[n].reader=h()({},e.books[n].reader,{content:i}),e.books[n].reader.readChapterCount++),u&&(e.books[n].reader=h()({},e.books[n].reader,{ePubData:u}))})),d()(W,M.PRELOAD_CHAPTER,(function(e,t){var n=t.bookId,r=t.chapter,o=t.content,i=void 0===o?null:o,a=t.ePubData,u=void 0===a?{}:a;i&&(e.books[n].reader=h()({},e.books[n].reader,{preloadChapter:{chapter:r,content:i,ePubData:u}}))})),d()(W,M.THEME,(function(e,t){var n=t.theme;e.profile.user=h()({},e.profile,{theme:n}),G.default.saveUserInfo({theme:n})})),d()(W,M.CANCEL_AUTO_PAY,(function(e,t){var n=t.bookId,r=t.type;e.books[n]&&e.books[n].bookInfo.type===r&&(e.books[n].bookInfo.isAutoPay=0)})),d()(W,M.ON_UNLOAD_READER,(function(e,t){if(0===e.bookstore.recentRead.length&&e.books[t]&&e.books[t].bookInfo){var n=e.books[t].bookInfo,r=Math.floor(Date.now()/1e3);j[M.LATEST_READ_BOOK](e,{bookId:t,cover:n.cover,readUpdateTime:r})}(function(e){return getCurrentPages().slice(0,-1).find((function(t){if(t.route&&t.route.includes("pages/reader")&&t.options.bookId===e)return!0}))})(t)||(e.books[t]=void 0,e.catalog[t]=void 0,e.similarBooks&&e.similarBooks[t]&&(e.similarBooks[t]={}))})),d()(W,M.READ_RECORD,(function(e,t){var n=t.bookId,r=t.chapter,o=t.scrollTop,i=t.ePubPageIndex,a=r.chapterUid;B.default.setStorageSync(n,{chapterUid:a,scrollTop:o,ePubPageIndex:i})})),d()(W,M.LATEST_READ_BOOK,(function(e,t){var n=t.bookId,r=t.cover,o=t.isOnBookShelf,i=void 0!==o&&o,a=t.secret,u=void 0!==a&&a,s=t.isLecture,c=void 0!==s&&s,l=t.hasLecture,f=void 0!==l&&l,d=Math.floor(Date.now()/1e3),_=e.bookstore.recentRead.filter((function(e){return e.bookId!==n}));if(_.unshift({bookId:n,cover:r,secret:u,readUpdateTime:d,isLecture:c,hasLecture:f}),_=_.sort((function(e,t){return t.readUpdateTime-e.readUpdateTime})),e.bookstore.recentRead=_.slice(0,4),!i){var E=B.default.getStorageSync("latestRead")||[];(E=E.filter((function(e){return e.bookId!==n}))).unshift({bookId:n,cover:r,secret:u,readUpdateTime:d,isLecture:c,hasLecture:f}),B.default.setStorageSync("latestRead",E.slice(0,4))}})),d()(W,M.ADD_TO_BOOKSHELF,(function(e,t){var n=e.books[t]&&e.books[t].bookInfo;if(n){e.books[t].bookInfo=h()({},e.books[t].bookInfo,{isOnBookShelf:!0});var r={bookId:t,cover:n.cover,title:n.title,secret:n.secret,type:n.type};e.shelf.all.unshift(r),e.shelf.showing.unshift(r)}})),d()(W,M.REMOVE_FROM_BOOKSHELF,(function(e,t){e.books[t]&&e.books[t].bookInfo&&(e.books[t].bookInfo=h()({},e.books[t].bookInfo,{isOnBookShelf:!1})),e.shelf.all=e.shelf.all.filter((function(e){return e.bookId!==t})),e.shelf.showing=e.shelf.showing.filter((function(e){return e.bookId!==t}))})),d()(W,M.SIMILAR_BOOKS,(function(e,t){var n=t.bookId,r=t.books,o=t.hasMore,i=h()({},e.similarBooks);i[n]={books:r},e.similarBooks=i,e.books[n].reader=h()({},e.books[n].reader,{similarBook:{hasMore:o,books:r}})})),d()(W,M.SHUFFLE_SIMILAR_BOOKS,(function(e,t){var n=t.bookId,r=e.similarBooks&&e.similarBooks[n]&&e.similarBooks[n].books;if(r&&!(r.length<=4)){e.similarBooks[n].shuffleCount++;var o=4*e.similarBooks[n].shuffleCount;o+4>r.length&&(o=0,e.similarBooks[n].shuffleCount=0),e.books[n].reader.similarBook=h()({},e.books[n].reader.similarBook,{books:r.slice(o,o+4)})}})),d()(W,M.INIT_BOOKSTORE,(function(e,t){var n=t.recommendation,r=t.categories,o=t.banner,i=void 0===o?{}:o,a=t.searchTips,u=t.userProfile,s=void 0===u?{}:u;e.bookstore=h()({},e.bookstore,{recommendation:n,categories:r,banner:i,searchTips:a,wxProfile:s})})),d()(W,M.INIT_BOOKSTORE_CATEGORIES,(function(e,t){var n=t.categories,r=void 0===n?[]:n;e.bookstore=h()({},e.bookstore,{categoryList:r})})),d()(W,M.INIT_BOOKSTORE_RANKING,(function(e,t){var n=t.ranking,r=void 0===n?[]:n;e.bookstore=h()({},e.bookstore,{rankingList:r})})),d()(W,M.LOAD_BOOKSTORE_RECOMMENDATION_BOOKS,(function(e,t){var n=t.recommendation,r=void 0===n?[]:n,o=t.isInit,i=void 0!==o&&o;e.bookstore=i?h()({},e.bookstore,{recommendation:r}):h()({},e.bookstore,{recommendation:e.bookstore.recommendation.concat(r)})})),d()(W,M.INIT_BOOKSTORE_RECOMMENDATION_CATEGORY,(function(e,t){var n=t.categoryId,r=t.categoryBooks,o=void 0===r?[]:r,i=t.hasMore,a=void 0!==i&&i,u=e.bookstore.recommendationCategory;e.bookstore.recommendationCategory=h()({},u,d()({},n,{books:o,hasMore:a}))})),d()(W,M.LOAD_BOOKSTORE_RECOMMENDATION_CATEGORY,(function(e,t){var n=t.categoryId,r=t.categoryBooks,o=void 0===r?[]:r,i=t.hasMore,a=void 0!==i&&i,u=e.bookstore.recommendationCategory,s=u[n].books;e.bookstore.recommendationCategory=h()({},u,d()({},n,{books:s.concat(o),hasMore:a}))})),d()(W,M.STORE_RECOMMENDATION,(function(e,t){var n=t.shuffleCount,r=t.all,o=t.showing;e.bookstore=h()({},e.bookstore,{recommendation:{shuffleCount:n,all:r,showing:o}})})),d()(W,M.SHUFFLE_RECOMMENDATIONS,(function(e,t){var n=t.shuffleCount,r=t.showing,o=t.all;e.bookstore=h()({},e.bookstore,{recommendation:{shuffleCount:n,showing:r,all:o}})})),d()(W,M.STORE_FREE,(function(e,t){var n=t.shuffleCount,r=t.all,o=t.showing,i=t.canShuffle,a=void 0===i||i,u=t.hasMore,s=void 0===u||u;e.bookstore=h()({},e.bookstore,{free:{shuffleCount:n,all:r,showing:o,canShuffle:a,hasMore:s}})})),d()(W,M.SHUFFLE_FREE,(function(e,t){var n=t.shuffleCount,r=t.showing,o=t.all,i=t.canShuffle,a=t.hasMore,u=void 0===a||a;e.bookstore=h()({},e.bookstore,{free:{shuffleCount:n,all:o,showing:r,canShuffle:i,hasMore:u}})})),d()(W,M.STORE_ALL_FREE_MORE,(function(e,t){var n=t.free,r=t.hasMore;n&&(e.bookstore.free.all=e.bookstore.free.all.concat(n)),e.bookstore.free.hasMore=r})),d()(W,M.STORE_TRENDING,(function(e,t){var n=t.shuffleCount,r=t.all,o=t.showing,i=t.canShuffle,a=void 0===i||i,u=t.hasMore,s=void 0===u||u;e.bookstore=h()({},e.bookstore,{trending:{shuffleCount:n,all:r,showing:o,canShuffle:a,hasMore:s}})})),d()(W,M.SHUFFLE_TRENDING,(function(e,t){var n=t.shuffleCount,r=t.all,o=t.showing,i=t.canShuffle,a=void 0===i||i,u=t.hasMore,s=void 0===u||u;e.bookstore=h()({},e.bookstore,{trending:{shuffleCount:n,all:r,showing:o,canShuffle:a,hasMore:s}})})),d()(W,M.STORE_ALL_TRENDING_MORE,(function(e,t){var n=t.trending,r=t.hasMore;n&&(e.bookstore.trending.all=e.bookstore.trending.all.concat(n)),e.bookstore.trending.hasMore=r})),d()(W,M.STORE_TOPTATED,(function(e,t){var n=t.topRated,r=t.hasMore,o=void 0===r||r;e.bookstore.topRated=h()({},e.bookstore.topRated,{all:n}),e.bookstore.topRated.hasMore=o})),d()(W,M.STORE_ALL_TOPRATED_MORE,(function(e,t){var n=t.topRated,r=t.hasMore,o=void 0===r||r;n&&(e.bookstore.topRated.all=e.bookstore.topRated.all.concat(n)),e.bookstore.topRated.hasMore=o})),d()(W,M.STORE_NOVELS,(function(e,t){var n=t.novel,r=t.hasMore;e.bookstore=h()({},e.bookstore,{novel:{all:n,hasMore:r}})})),d()(W,M.STORE_LOAD_MORE,(function(e,t){var n=t.novel,r=t.hasMore;n&&(e.bookstore.novel.all=e.bookstore.novel.all.concat(n)),e.bookstore.novel.hasMore=r})),d()(W,M.STORE_CATEGORIES,(function(e,t){e.bookstore=h()({},e.bookstore,{categories:t})})),d()(W,M.STORE_TOP100,(function(e,t){e.bookstore=h()({},e.bookstore,{top100:t})})),d()(W,M.LOAD_GOVERNMENT_AFFAIRS_READING_BANNER,(function(e,t){var n=t.src;e.bookstore=h()({},e.bookstore,{governmentAffairsReadingBanner:n})})),d()(W,M.LOAD_GOVERNMENT_AFFAIRS_READING_BOOK_LIST,(function(e,t){var n=t.title,r=t.books;e.governmentAffairsReadingBookList={title:n,books:r}})),d()(W,M.SET_MINI_BOOK_LIST,(function(e,t){var n=t.title,r=t.books;e.miniBookList={title:n,books:r}})),d()(W,M.STORE_SEARCH,(function(e,t){e.search=h()({},e.search,{resultItems:t})})),d()(W,M.SEARCH_UNLOAD,(function(e){e.search=h()({},e.search,{resultItems:{authors:[],categories:[],books:[],publishes:[]}})})),d()(W,M.STORE_SEARCH_PUBLISH,(function(e,t){var n=t.name,r=t.books,o=t.hasMore,i=void 0!==o&&o;e.search=h()({},e.search,{searchPublish:{name:n,books:r,hasMore:i}})})),d()(W,M.STORE_SEARCH_PUBLISH_MORE,(function(e,t){var n=t.books,r=t.hasMore,o=void 0===r||r;n&&(e.search.searchPublish.books=e.search.searchPublish.books.concat(n)),e.search.searchPublish.hasMore=o})),d()(W,M.STORE_SEARCH_AUTHOR,(function(e,t){var n=t.name,r=t.books,o=t.hasMore,i=void 0!==o&&o;e.search=h()({},e.search,{searchAuthor:{name:n,books:r,hasMore:i}})})),d()(W,M.STORE_SEARCH_AUTHOR_MORE,(function(e,t){var n=t.books,r=t.hasMore,o=void 0===r||r;n&&(e.search.searchAuthor.books=e.search.searchAuthor.books.concat(n)),e.search.searchAuthor.hasMore=o})),d()(W,M.STORE_SEARCH_TAGS,(function(e,t){var n=t.shuffleCount,r=t.showing,o=t.all;n++,e.search=h()({},e.search,{tags:{shuffleCount:n,showing:r,all:o}})})),d()(W,M.INIT_SEARCH_HISTORY,(function(e,t){e.search=h()({},e.search,{history:t})})),d()(W,M.CLEAR_SEARCH_HISTORY,(function(e){e.search=h()({},e.search,{history:[]})})),d()(W,M.INIT_ALL_CATEGORIES,(function(e,t){e.categories=h()({},e.categories,{items:t})})),d()(W,M.INIT_CATEGORY_BOOKS,(function(e,t){var n=t.categoryId,r=t.books;e.categories=h()({},e.categories,{currentCategoryId:n});var o=e.categories.items;P.findCategoryById(o,n).books=r,e.categories=h()({},e.categories,{items:o})})),d()(W,M.CATEGORY_BOOKS_MORE,(function(e,t){var n=t.categoryId,r=t.books;if(r){var o=e.categories.items,i=P.findCategoryById(o,n);i.books=i.books.concat(r),e.categories=h()({},e.categories,{items:o})}})),d()(W,M.QUERY_USERACTIVETYPE,(function(e,t){var n=t.activeType,r=t.birdBox;e.profile.user=h()({},e.profile.user,{userActiveType:n,birdBox:r})})),d()(W,M.NEW_INFINITE_DAY,(function(e,t){var n=t.hasNewDay,r=void 0!==n&&n;e.profile.newInfiniteDay=r})),d()(W,M.INIT_REVIEW_DETAIL,(function(e,t){e.reviews=h()({},e.reviews,d()({},t.reviewId,t))})),d()(W,M.SAVE_REVIEW_DRAFT,(function(e,t){e.reviews=h()({},e.reviews,{draft:t})})),d()(W,M.USER_PROFILE_INIT,(function(e,t){var n=t.userVid;if(!e.userProfile[n]){var r={};r[n]={userInfo:{},shelfData:{recentReadingBooks:[],finishReadBooks:[],commonReadBooks:[],publishedBooks:[],recentReadingBookCount:0,finishReadBookCount:0,commonReadBookCount:0,publishedBookCount:0},reviews:[],reviewTotalCount:0,booklists:{totalCount:0,booklists:[]}},e.userProfile=h()({},e.userProfile,r)}})),d()(W,M.USER_PROFILE,(function(e,t){var n=t.userVid,r=t.userProfileInfo;e.userProfile[n]=h()({},e.userProfile[n],{userInfo:r})})),d()(W,M.USER_PROFILE_SHELF,(function(e,t){var n=t.userVid,r=t.shelfData;t.minCount,e.userProfile[n]=h()({},e.userProfile[n],{shelfData:r})})),d()(W,M.USER_PROFILE_WORKS,(function(e,t){var n=t.userVid,r=t.hottest,o=t.newest,i=h()({},o);o&&o.data&&o.data.map&&i.data.forEach((function(e){e&&e.meta&&e.meta.updateTime&&(e.meta.updateTimeStr="更新于 "+Object(q.default)(e.meta.updateTime))})),r.showing=r.data&&r.data.slice(0,3),i.showing=i.data&&i.data.slice(0,3),e.userProfile[n]=h()({},e.userProfile[n],{worksHottest:r,worksNewest:i})})),d()(W,M.USER_PROFILE_WORKS_DETAIL,(function(e,t){var n=t.userVid,r=t.listData,o=t.listType,i=h()({},r);1==+o&&r&&r.data&&r.data.map&&i.data.forEach((function(e){e&&e.meta&&e.meta.updateTime&&(e.meta.updateTimeStr="更新于 "+Object(q.default)(e.meta.updateTime))})),i.showing=i.data.slice(0,3),e.userProfile[n]=1==+o?h()({},e.userProfile[n],{worksNewest:i}):h()({},e.userProfile[n],{worksHottest:i})})),d()(W,M.USER_PROFILE_WORKS_INSHELF,(function(e,t){var n=t.userVid,r=t.bookId,o=t.isLecture,i=t.inShelf,a=e.userProfile[n]&&e.userProfile[n].worksHottest,u=e.userProfile[n]&&e.userProfile[n].worksNewest;a.data&&(a.data.map&&(a.data=a.data.map((function(e){return(o&&e.bookInfo&&e.bookInfo.bookId===r&&e.meta&&1===e.meta.type||e.bookInfo&&e.bookInfo.bookId===r)&&(e.inShelf=i),e}))),a.showing=a.data.slice(0,3)),u.data&&(u.data.map&&(u.data=u.data.map((function(e){return(o&&e.bookInfo&&e.bookInfo.bookId===r&&e.meta&&1===e.meta.type||e.bookInfo&&e.bookInfo.bookId===r)&&(e.inShelf=i),e}))),u.showing=u.data.slice(0,3)),e.userProfile[n]=h()({},e.userProfile[n],{worksHottest:a,worksNewest:u})})),d()(W,M.USER_PROFILE_REVIEW_EXPANDED,(function(e,t){var n=t.userVid,r=t.reviewId,o=t.expanded,i=e.userProfile[n].reviews;i.map((function(e){e.review.reviewId===r&&(e.review.expanded=o)})),e.userProfile[n]=h()({},e.userProfile[n],{reviews:i})})),d()(W,M.USER_PROFILE_REVIEW,(function(e,t){var n=t.userVid,r=t.reviewList,o=t.totalCount,i=e.userProfile[n].reviews;r&&(i=e.userProfile[n].reviews.concat(r)),e.userProfile[n]=h()({},e.userProfile[n],{reviews:i}),e.userProfile[n]=h()({},e.userProfile[n],{reviewTotalCount:o})})),d()(W,M.USER_PROFILE_BOOKLISTS,(function(e,t){var n=t.userVid,r=t.booklistsData,o=r.totalCount,i=r.booklists?r.booklists:[];e.userProfile[n]=h()({},e.userProfile[n],{booklists:i}),e.userProfile[n].totalCount=o})),d()(W,M.USER_PROFILE_UN_LOAD,(function(e,t){e.userProfile[t]=null})),d()(W,M.USER_CHARGE_PAY_ITEMS,(function(e,t){e.payItemsInfo=t})),d()(W,M.USER_PROFILE_FOLLOW,(function(e,t){var n=t.userVid,r=t.isFollow;e.userProfile[n]&&e.userProfile[n].userInfo&&(e.userProfile[n].userInfo.isFollowing=r?1:0)})),d()(W,M.FREE_3_BOOKS,(function(e,t){e.free3book=t})),d()(W,M.FREE_3_BOOKS_RECEIVE,(function(e,t){t&&(e.free3book.showing.map((function(e){return e.bookId===t.bookId&&(e.received=!0),t})),e.free3book.received&&(e.free3book=h()({},e.free3book,{received:[t].concat(e.free3book.received)})),e.free3book.allReceived=e.free3book.received.length>=3)})),d()(W,M.FREE_3_BOOKS_SHUFFLE,(function(e,t){var n=t.shuffleCount,r=t.all,o=t.showing;e.free3book=h()({},e.free3book,{all:r}),e.free3book=h()({},e.free3book,{showing:o}),e.free3book.shuffleCount=n,e.free3book.allReceived=e.free3book.received.length>=3})),d()(W,M.INIT_TOP100,(function(e,t){e.top100.items=t})),d()(W,M.INIT_TOP100_BOOKS,(function(e,t){var n=t.categoryId,r=t.books,o=t.hasMore;e.top100.currentCategoryId=n;var i=e.top100.items,a=P.findCategoryById(i,n);a.showing=r.slice(0,10),a.books=r,a.hasMore=o,e.top100=h()({},e.top100,{items:i})})),d()(W,M.TOP100_BOOKS_MORE,(function(e,t){var n=t.categoryId,r=e.top100.items,o=P.findCategoryById(r,n),i=o.showing.length;o.showing=o.books.slice(0,i+20),o.hasMore=o.books.length>o.showing.length,e.top100=h()({},e.top100,{items:r})})),d()(W,M.TOP100_MARK_FINISH,(function(e,t){var n=t.categoryId,r=t.bookId,o=t.isCancel,i=e.top100.items,a=P.findCategoryById(i,n);a.books=a.books.map((function(e){return e.bookId===r&&(e.isFinishedReading=0===o),e})),e.top100=h()({},e.top100,{items:i})})),d()(W,M.TOP100_SHARE_INFO,(function(e,t){var n=t.categoryId,r=t.shareInfo,o=e.top100.items;P.findCategoryById(o,n).shareInfo=r,e.top100=h()({},e.top100,{items:o})})),d()(W,M.TOP100_UNLOAD,(function(e,t){t.categoryId,e.top100.currentCategoryId=""})),d()(W,M.STOP_SHOW_FEEDBACK_TIP,(function(e){e.stopShowFeedbackTip=!0})),d()(W,M.BOOK_READING_INFINITE,(function(e,t){t&&t.res&&(e.readingInfinite=t.res)})),d()(W,M.SYNC_CONFIG,(function(e,t){var n=t.userConfig;e.profile.user.userConfig||(e.profile.user.userConfig={}),e.profile.user=h()({},e.profile.user,{userConfig:n})})),d()(W,M.INFINTE_COLLECTION_CLICKED,(function(e){e.profile.user=h()({},e.profile.user,{hasShownGiftCollectionDot:!0}),G.default.saveUserInfo({hasShownGiftCollectionDot:!0})})),d()(W,M.INFINTE_VIDEO_CLICKED,(function(e){e.profile.user=h()({},e.profile.user,{hasShownVideoFeedDot:!0}),G.default.saveUserInfo({hasShownVideoFeedDot:!0})})),d()(W,M.UPDATE_USERINFO,(function(e){var t=G.default.getUser();G.default.saveUserInfo(t),e.profile=h()({},e.profile,{user:t})})),d()(W,M.TOP_200_LIST,(function(e,t){var n=t.list;e.top200=h()({},e.top200,{list:n})})),d()(W,M.TOP_200_STYLE,(function(e,t){var n=t.detail;e.top200=h()({},e.top200,{detail:n})})),d()(W,M.VIDEO_FEED_DETAIL,(function(e,t){var n=t.reviewId,r=t.reviewDetail,o=t.relatedReviews,i={};i[n]={reviewDetail:r,relatedReviews:o},e.videoFeedDetailMap=h()({},e.videoFeedDetailMap,i)})),d()(W,M.VIDEO_FEED_LIST,(function(e,t){e.videoFeedList.synckey=t.synckey,e.videoFeedList.sid=t.sid,t.refresh?(e.videoFeedList.reviews=t.reviews.concat(e.videoFeedList.reviews),e.videoFeedList.metas=t.metas.concat(e.videoFeedList.metas)):(e.videoFeedList.reviews=e.videoFeedList.reviews.concat(t.reviews),e.videoFeedList.metas=e.videoFeedList.metas.concat(t.metas))})),d()(W,M.VIDEO_FEED_LIKE,(function(e,t){var n=t.reviewId,r=e.videoFeedList.reviews;r.find((function(e){return e.reviewId===n}))&&(r.forEach((function(e){if(e.reviewId===n){e.review.isLike=0===e.review.isLike?1:0;var t=e.likesCount?e.likesCount:0;e.likesCount=0===e.review.isLike?t-1:t+1}})),e.videoFeedList.reviews=r);var o=e.videoFeedDetailMap[n];if(o&&o.reviewDetail){o.reviewDetail.review.isLike=0===o.reviewDetail.review.isLike?1:0;var i=o.reviewDetail.likesCount?o.reviewDetail.likesCount:0;o.reviewDetail.likesCount=0===o.reviewDetail.review.isLike?i-1:i+1}else m()(e.videoFeedDetailMap).forEach((function(t){var r=e.videoFeedDetailMap[t].relatedReviews.slice(0);r.find((function(e){return e.reviewId===n}))&&(r.forEach((function(e){if(e.reviewId===n){e.review.isLike=0===e.review.isLike?1:0;var t=e.likesCount?e.likesCount:0;e.likesCount=0===e.review.isLike?t-1:t+1}})),e.videoFeedDetailMap[t].relatedReviews=r)}))})),d()(W,M.INIT_LECTURE_CATEGORIES,(function(e,t){var n=t.marketList,r=t.lecturesRecommend,o=function(e){return e.map((function(e){return e.books?{title:e.name,type:e.type,books:e.books}:e.categories&&e.categories[0]?{title:e.categories[0].title,categoryId:e.categories[0].CategoryId,type:e.type,titleImg:e.categories[0].ranklistCover&&e.categories[0].ranklistCover.chart_title,books:e.categories[0].lectureBooks}:{}})).filter((function(e){return e.title&&e.books.length}))}(n);e.lectureCategories=o.filter((function(e){return 323!==e.type})),e.indexLectureList=e.lectureCategories.map((function(e){return e.books=e.books.slice&&e.books.slice(0,3),e})),r&&r.books&&(e.indexLectureListGuess={shuffleCount:0,showing:r.books.slice(0,3),all:r.books})})),d()(W,M.LECTURE_CATEGORIES_RECOMMEND_SHUFFLE,(function(e,t){var n=t.shuffleCount,r=t.showing,o=t.all;e.indexLectureListGuess={shuffleCount:n,showing:r,all:o}})),d()(W,M.LECTURE_CATEGORY_DETAIL,(function(e,t){var n=t.categoryId,r=t.books,o=t.hasMore,i=e.lectureCategories.find((function(e){return e&&e.categoryId===n}));e.currentLectureCategory=h()({},i,{books:r,hasMore:o})})),d()(W,M.LECTURE_CATEGORY_DETAIL_MORE,(function(e,t){var n=t.books,r=t.hasMore,o=e.currentLectureCategory.books;e.currentLectureCategory.books=[].concat(T()(o),T()(n)),e.currentLectureCategory.hasMore=r})),d()(W,M.STORE_RATINGS_BUTTON_STATUS,(function(e,t){var n=t.grade;e.ratingsButtonStatus=n})),d()(W,M.SYNC_USER_SETTING,(function(e,t){var n=t.userSetting;e.userSetting=h()({},e.userSetting,n)})),W);n(42),n.d(t,"store",(function(){return Q})),a.a.use(u.default);var Q=new u.default.Store({state:{books:{},shelf:{all:[],showing:[],imports:[],archive:[]},catalog:{},readerUnlockStatus:{},similarBooks:{books:[],shuffleCount:0},reviews:{},bookstore:{governmentAffairsReadingBanner:"",banner:{},recentRead:[],recommendation:[],categories:[],categoryList:[],rankingList:[],recommendationCategory:{},wxProfile:{}},miniBookList:{title:"",books:[]},free3book:{allReceived:!1,received:[],all:[],showing:[],shuffleCount:0},search:{history:[],resultItems:{authors:[],categories:[],books:[],publishes:[]},tags:{shuffleCount:0,showing:[],all:[]}},categories:{currentCategoryId:"",items:[]},profile:{user:{nickName:"",avatarUrl:"",avatar:"",theme:"light"},isPaying:0,balance:0,giftBalance:0,paidBalance:0,infiniteTime:0,infiniteExpired:0,infinitePermanent:0,newInfiniteDay:!1},userProfile:{},top100:{currentCategoryId:"",items:[]},top200:{list:[],detail:{}},lectureCategories:[],indexLectureList:[],indexLectureListGuess:{shuffleCount:0,showing:[],all:[]},currentLectureCategory:{},videoFeedList:{synckey:0,sid:0,reviews:[],metas:[],extMiniVideos:[]},videoFeedDetailMap:{},payItemsInfo:[],stopShowFeedbackTip:!1,readingInfinite:{shouldShowTips:!1,shouldShow:!1,shouldHide:!1,nextTimer:0,curInfiniteDay:0,curTotalInfiniteDay:0,sendInfiniteDay:0},giftActivity:{cards:[],rules:[]},upBookNotifyState:!1,readerEPubWithExtraPages:!1,governmentAffairsReadingBookList:{title:"",books:[]},ratingsButtonStatus:"",userSetting:{closeRecommend:!1}},getters:s,actions:Y,mutations:j,plugins:[]});t.default=Q},498:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(15));t.default={_getLocalVolDate:function(){var e=new Date;return 1e4*e.getFullYear()+100*(e.getMonth()+1)+e.getDate()},checkCanHelpShareRemain:function(e,t){var n=this._getLocalVolDate(),r=o.default.getStorageSync(t);return!(r&&r.vol===n&&r.vids&&r.vids.indexOf(e)>-1)},saveCanHelpShareRemainInfo:function(e,t){var n=this._getLocalVolDate(),r=o.default.getStorageSync(t);if(r&&r.vol===n){var i=r.vids;i.push(e),o.default.setStorageSync(t,{vol:n,vids:i})}else o.default.setStorageSync(t,{vol:n,vids:[e]})}}},499:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=["tiao","xu","huan"],o=["邀请一位新好友参与游戏","连续登录3天","邀请一位好友参与游戏"],i=function(e){if(!e)return"";var t=new Date(e);return t.getFullYear()+"."+(t.getMonth()+1)+"."+t.getDate()};t.raceGamePropsFormat=function(e){return e&&e[0]?Object.keys(e).map((function(t){var n=e[+t],a=n.card,u=Math.min.apply(Math,n.expiredTimes);return{cnt:n.cnt,clazz:r[a.type],latestExpiredDate:i(u),type:a.type,name:a.name,backgroundImage:a.backgroundImage,backgroundImageLarge:a.backgroundImageLarge,cover:a.cover,desc:a.desc,subDesc:a.subDesc,fullDesc:a.subDesc.join(""),price:a.price,acquisitionMethod:o[a.type],maxCount:!!n.maxCount,newGetProp:!!n.newGetProp,scorePrice:a.scorePrice,adUnitId:a.adUnitId,adRemainTime:a.adRemainTime}})):[]}},50:function(e,t,n){n.r(t);var r=n(2);t.default=function(e){if(console.log("reportSource options:",e),e){var t=e.query,n=e.path,o=e.scene;if(t&&t.from)r.default.reportKVLog({itemname:"Wp_source_"+e.query.from});else if(t&&t.redirect)r.default.reportKVLog({itemname:"Wp_source_"+t.redirect});else if(n){var i=n.split("/");console.log("log paths:",i);var a=i[i.length-2];i.length>=4&&(a=""+i[i.length-3]+i[i.length-2]),a&&r.default.reportKVLog({itemname:"Wp_source_"+a})}o&&r.default.reportKVLog({itemname:"Wp_scene_"+o})}}},51:function(e,t,n){var r=n(33),o=n.n(r),i=n(130),a=n.n(i),u=n(325),s=n.n(u);t.a={data:function(){return{authorized:!1,loading:!1,loaded:!1,shouldShowEmptyView:!1}},methods:{showLoading:function(){this.loading=!0,console.log("showLoading"),wx.showLoading({title:"加载中…"})},showLoadingIfNeed:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:300;setTimeout((function(){e.loaded||(e.loading=!0,console.log("[showLoadingIfNeeded] showLoading"),wx.showLoading({title:"加载中…"}))}),t)},hideLoading:function(e){console.log("hideLoading"),wx.hideLoading(),this.loaded=!0,this.loading=!1,e&&e()},hideAllModal:function(){var e=s()(this.$refs),t=!0,n=!1,r=void 0;try{for(var i,u=o()(e);!(t=(i=u.next()).done);t=!0){var c=i.value,l=a()(c,2),f=l[0],d=l[1];f.endsWith("Modal")&&d.closeModal&&d.closeModal()}}catch(e){n=!0,r=e}finally{try{!t&&u.return&&u.return()}finally{if(n)throw r}}},initData:function(){},retryLoad:function(){this.shouldShowEmptyView=!1,this.initData()}}}},528:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){var r=e;return null==r||"function"==typeof r?r="":r+="",r.length>=t?r:new Array(t-r.length+1).join(n||"0")+r}},60:function(e,t,n){n.r(t);var r=function(e,t,n){var r=e;return null==r||"function"==typeof r?r="":r+="",r.length>=t?r:new Array(t-r.length+1).join(n||0)+r};t.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=new Date(1e3*e),i=((new Date).getTime()-1e3*e)/1e3,a=Math.floor(i/60),u=Math.floor(i/3600),s=void 0,c=o.getMonth()+1,l=o.getDate(),f=r(o.getHours(),2),d=r(o.getMinutes(),2);if(i>=0&&i<=60)s="刚刚";else if(i>0&&u<1)s=a+"分钟前";else if(i>0&&u>=1&&u<=3)s=u+"小时前";else{var _=new Date;s=o.getFullYear()===_.getFullYear()?o.getMonth()===_.getMonth()&&o.getDate()===_.getDate()?"":n?c+"/"+l:c+"月"+l+"日":n?o.getFullYear()+"/"+c+"/"+l:o.getFullYear()+"年"+c+"月"+l+"日",t||(s+=" "+f+":"+d)}return s.trim()}},62:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.setStyleDefault=function(){wx.setNavigationBarColor({animation:{duration:400,timingFunc:"easeIn"},backgroundColor:"#ffffff",frontColor:"#000000"})},e.setStyleLightContent=function(){wx.setNavigationBarColor({animation:{duration:400,timingFunc:"easeIn"},backgroundColor:"#000000",frontColor:"#ffffff"})},e.setColorWithTheme=function(t){"dark"===t?e.setStyleLightContent():e.setStyleDefault()},e}();t.default=r},63:function(e,t,n){n.r(t),t.default=function(e,t,n){var r=n&&n.lexicographical,o=n&&n.zeroExtend,i=e.split("."),a=t.split(".");function u(e){return(r?/^\d+[A-Za-z]*$/:/^\d+$/).test(e)}if(!i.every(u)||!a.every(u))return NaN;if(o){for(;i.length<a.length;)i.push("0");for(;a.length<i.length;)a.push("0")}r||(i=i.map(Number),a=a.map(Number));for(var s=0,c=0;c<i.length;++c){if(a.length===c){s=1;break}if(i[c]>a[c]){s=1;break}if(i[c]<a[c]){s=-1;break}}return s}},64:function(e,t,n){n.r(t);var r=n(8),o=n.n(r);t.default=function(e){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new o.a((function(n,r){t.success=function(e){n(e)},t.fail=function(e){r(e)},e(t)}))}}},66:function(e,t,n){function r(e){var t=e.toString();return t[1]?t:"0"+t}function o(e){return e.getFullYear()+"-"+(e.getMonth()+1<10?"0"+(e.getMonth()+1):""+(e.getMonth()+1))+"-"+(e.getDate()<10?"0"+e.getDate():e.getDate())+" "+e.getHours()+":"+(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())+":"+(e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds())}function i(e){var t=e.getFullYear(),n=e.getMonth()+1,o=e.getDate(),i=e.getHours(),a=e.getMinutes(),u=e.getSeconds();return[t,n,o].map(r).join("/")+" "+[i,a,u].map(r).join(":")}n.r(t),n.d(t,"formatOssLogTime",(function(){return o})),n.d(t,"formatTime",(function(){return i})),t.default={formatNumber:r,formatTime:i,genPostData:function(e){var t="{";for(var n in e)if(e.hasOwnProperty(n)){var r=e[n];t+="number"==typeof r?'"'+n+'":'+r+",":'"'+n+'":"'+r+'",'}return(t=t.slice(0,-1))+"}"},compareVersion:function(e,t){e=e.split("."),t=t.split(".");for(var n=Math.max(e.length,t.length);e.length<n;)e.push("0");for(;t.length<n;)t.push("0");for(var r=0;r<n;r++){var o=parseInt(e[r]),i=parseInt(t[r]);if(o>i)return 1;if(o<i)return-1}return 0},safeParseJSON:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=null;try{n=JSON.parse(e)}catch(t){console.log("err JSON.parse:",t,e)}return null==n?t:n}}},76:function(e,t,n){n.r(t),n.d(t,"INIT",(function(){return h})),n.d(t,"CHECK_COUPON",(function(){return I})),n.d(t,"RECEIVE_INFINITE",(function(){return m})),n.d(t,"RECEIVE_BOOKS",(function(){return v})),n.d(t,"CONSUME_CARD",(function(){return T})),n.d(t,"GET_WECHAT_PAY_V2_SIGN",(function(){return g})),n.d(t,"store",(function(){return O}));var r,o=n(65),i=n.n(o),a=n(1),u=n.n(a),s=n(4),c=n.n(s),l=n(10),f=n.n(l),d=n(5),_=n.n(d),E=n(9),p=(n(42),n(2));_.a.use(E.default);var h="INIT",I="CHECK_COUPON",m="RECEIVE_INFINITE",v="RECEIVE_BOOKS",T="CONSUME_CARD",g="GET_WECHAT_PAY_V2_SIGN",A=(r={},u()(r,g,(function(e,t){var n=this;return e.commit,f()(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",p.default.getWeChatPayV2Sign(t).then((function(e){return e.sign})));case 1:case"end":return e.stop()}}),e,n)})))()})),u()(r,h,(function(e,t){var n=this,r=e.commit;return e.state,f()(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",p.default.collaborationInfo(t).then((function(e){var n=e.data;if(n.errMsg)throw n;var o=n.actionName,i=n.infiniteCard&&n.infiniteCard.day||0,a=n.sortBooks,u=n.sortBookAuthors,s=u[0]&&u[0].receive||!1,c=a[0]&&a[0].receive||s||!1,l=n.logogramData&&n.logogramData.banner3x||"",f=[];"CM"===t&&(f=[{avatar:"https://rescdn.qqmail.com/weread/assets/mini_program/yangyin.png",name:"杨颖",intro:"“养成阅读习惯，让生活更美好。”"},{avatar:"https://rescdn.qqmail.com/weread/assets/mini_program/junmi.png",name:"张钧甯",intro:"“在书里寻找爱情的答案。”"},{avatar:"https://rescdn.qqmail.com/weread/assets/mini_program/jinchen.png",name:"金晨",intro:"“进入江湖世界，重温武侠经典。”"},{avatar:"https://rescdn.qqmail.com/weread/assets/mini_program/zhangjianing.png",name:"张佳宁",intro:"“科技讲述未来，探索不一样的世界。”"},{avatar:"https://rescdn.qqmail.com/weread/assets/mini_program/wangxiao.png",name:"王潇",intro:"“阅读让我们的心灵与状态得到宁静。”"},{avatar:"https://rescdn.qqmail.com/weread/assets/mini_program/machongma.png",name:"马红漫",intro:"“阅读造就永不贬值的财富。”"}]);var d=0;n.infiniteCard&&!0===n.infiniteCard.alreadyGot?d=1:n.infiniteCard&&!1===n.infiniteCard.hasInfinite&&(d=2);var _=n.infiniteChannelId,E=n.logogramData.logo3x,p=n.logogramData.title,I=n.logogramData.hideShare||0,m=!!n.logogramData.canAllUserInfinite,v=[],T=a.map((function(e,t){var n={book:{}},r=e.bookInfo,o=r.bookId,i=r.cover,a=r.title,u=r.author,s=r.intro;return n.book={bookId:o,cover:i,title:a,author:u,intro:s},n.user=f[t],n}));v=v.concat(T);var g=u.map((function(e,t){var n={book:{}},r=e.book,o=r.bookId,i=r.cover,a=r.title,u=r.author,s=r.intro;return n.book={bookId:o,cover:i,title:a,author:u,intro:s},n.book.isLecture=!0,n.bookAuthorVid=e.bookAuthorVid,n.price=e.price,n}));v=v.concat(g),r(h,{actionName:o,infiniteStatus:d,list:v,hasBookReceived:c,banner:l,infiniteDay:i,channelId:_,shareImage:E,shareTitle:p,hideShare:I,needToBeVerified:m})})));case 1:case"end":return e.stop()}}),e,n)})))()})),u()(r,I,(function(e,t){var n=this,r=(e.commit,e.state),o=t.wxOpenId,i=t.nonce,a=t.associate,u=t.ciphertext;return f()(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",p.default.checkCoupon(o,i,a,u).then((function(e){r.couponState=e.state})));case 1:case"end":return e.stop()}}),e,n)})))()})),u()(r,m,(function(e,t){var n=this,r=(e.commit,e.state),o=t.isCouponCard,i=t.wxOpenId,a=t.nonce,u=t.associate,s=t.ciphertext;return f()(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",p.default.collaborationReceiveInfinite(r.actionName,r.channelId,o,i,a,u,s).then((function(e){if(e.result&&e.result.errCode<0)throw{errCode:e.result.errCode,errMsg:"领取失败"};r.infiniteStatus=1})));case 1:case"end":return e.stop()}}),e,n)})))()})),u()(r,v,(function(e){var t=this,n=(e.commit,e.state);return f()(c.a.mark((function e(){var r,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=[],o=[],n.list.forEach((function(e){if(r.push(e.book.bookId),e.bookAuthorVid){var t=+e.bookAuthorVid.split("$$")[1];o.push(t)}})),e.abrupt("return",p.default.collaborationReceiveBook(n.actionName,r,o).then((function(e){n.hasBookReceived=!0})));case 4:case"end":return e.stop()}}),e,t)})))()})),u()(r,T,(function(e,t){var n=this,r=(e.commit,e.state,t.code);return f()(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",p.default.consumeCard({code:r}).then((function(){console.log("核销成功")})).catch((function(e){console.error("核销失败",e)})));case 1:case"end":return e.stop()}}),e,n)})))()})),r),R=u()({},h,(function(e,t){e=i()(e,t)})),O=new E.default.Store({state:{actionName:"",channelId:"",banner:"",list:[],hasBookReceived:!1,infiniteDay:0,infiniteStatus:0,shareTitle:"",shareImage:""},getters:{},actions:A,mutations:R,plugins:[]})},80:function(e,t,n){var r=n(8),o=n.n(r),i=n(33),a=n.n(i),u=n(4),s=n.n(u),c=n(17),l=n.n(c),f=n(10),d=n.n(f),_=n(48),E=n.n(_),p=n(59),h=n.n(p),I=n(3),m=n(16),v=function(){function e(){E()(this,e),console.log("WxCard constructor")}return h()(e,[{key:"openWxCard",value:function(){var e=d()(s.a.mark((function e(t){var n,r,o,i,a,u,c,f,d,_,E,p,h;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return wx.showLoading({title:"加载中",mask:!0}),n=this,r=this.cardIdWithInfiniteDay(t),o=I.default.getUser(),i=o.vid,e.next=7,this.getValidCardRecord({vid:i,cardId:r});case 7:return a=e.sent,console.log("queryDBRecordCard:",a),u=a?a.code:o.vid.toString()+"_"+ +new Date,console.log("code:",u),e.next=13,this.getAccessToken();case 13:return c=e.sent,e.next=16,this.checkCode(r,u,c);case 16:if((f=e.sent).newAccessToken&&(c=f.newAccessToken),!(d=f.received)){e.next=25;break}console.log("[卡包] 已领取",d),n.openCard(r,u),wx.hideLoading(),e.next=42;break;case 25:return console.log("[卡包] 未领取",d),_=(new Date/1e3|0).toString(),E=_+"a",p="",e.prev=29,e.next=32,Object(m.default)({name:"wxCardSign",data:{timestamp:_,nonceStr:E,cardId:r,code:u,accessToken:c}});case 32:p=e.sent,e.next=39;break;case 35:return e.prev=35,e.t0=e.catch(29),console.log("WxCardSign error:",e.t0),e.abrupt("return");case 39:h={code:u,openid:"",timestamp:_,nonce_str:E,signature:p},console.log("cardId:",r," cardExt:",h),wx.addCard({cardList:[{cardId:r,cardExt:l()(h)}],success:function(e){console.log("add card succ:",e.cardList),n.saveCardRecord({vid:i,cardId:r,code:u,infiniteDay:t}),n.openCard(r,u)},fail:function(e){console.log("add card error:",e)},complete:function(){wx.hideLoading()}});case 42:case"end":return e.stop()}}),e,this,[[29,35]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getAccessToken",value:function(e){var t=I.default.getUser().Platform;return Object(m.default)({name:"getMpAccessToken",data:{isForce:e,platform:t}})}},{key:"checkCode",value:function(e,t,n){return console.log("checkCode token:",n),Object(m.default)({name:"wxCardCheckCode",data:{code:t,cardId:e,token:n}})}},{key:"openCard",value:function(e,t){console.log("start openCard code:",t),wx.openCard({cardList:[{cardId:e,code:t}],success:function(e){console.log("openCard res:",e)},fail:function(e){console.log("openCard fail:",e)}})}},{key:"getValidCardRecord",value:function(e){var t=e.vid,n=e.cardId,r=+new Date-2592e6,o=wx.cloud.database();return o.collection("wxCard_record").where({cardId:n,consumed:!1,vid:t,receiveTime:o.command.gt(r)}).limit(1).get().then((function(e){return e.data[0]})).catch((function(e){return console.log("getValidCardRecord res:",e),null}))}},{key:"saveCardRecord",value:function(e){var t=e.vid,n=e.cardId,r=e.code,o=e.infiniteDay;return wx.cloud.database().collection("wxCard_record").add({data:{vid:t,cardId:n,code:r,infiniteDay:o,receiveTime:+new Date,consumed:!1}}).then((function(e){console.log(e)})).catch(console.error)}},{key:"updateCardConsumed",value:function(e){e.cardId,e.code;var t=e._id;return wx.cloud.database().collection("wxCard_record").doc(t).update({data:{consumed:!0}}).then((function(e){return console.log("update consumed succ"),e})).catch((function(e){return console.log("update consumed error:",e),e}))}},{key:"consumedCode",value:function(){var e=d()(s.a.mark((function e(t){var n,r=t.cardId,o=t.code,i=t._id;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(m.default)({name:"wxCardConsumeCode",data:{code:o,cardId:r}}).catch((function(e){console.log("wxCardConsumeCodeRes error: ",e)}));case 2:return n=e.sent,console.log("wxCardConsumeCode res:",n),e.next=6,this.updateCardConsumed({cardId:r,code:o,_id:i});case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"tryConsumeAllCode",value:function(){var e=d()(s.a.mark((function e(){var t,n,r,i,u,c,l,f,d,_,E;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=I.default.getUser(),n=t.vid,r=+new Date-2592e6,i=wx.cloud.database(),e.next=6,i.collection("wxCard_record").where({consumed:!1,vid:n,receiveTime:i.command.gt(r)}).get().then((function(e){return e.data})).catch((function(e){return console.log("get All code Records errors:",e),null}));case 6:if(u=e.sent,console.log("allRecord:",u),!u||!u.length){e.next=37;break}c=!0,l=!1,f=void 0,e.prev=12,d=a()(u);case 14:if(c=(_=d.next()).done){e.next=21;break}return E=_.value,e.next=18,this.consumedCode(E);case 18:c=!0,e.next=14;break;case 21:e.next=27;break;case 23:e.prev=23,e.t0=e.catch(12),l=!0,f=e.t0;case 27:e.prev=27,e.prev=28,!c&&d.return&&d.return();case 30:if(e.prev=30,!l){e.next=33;break}throw f;case 33:return e.finish(30);case 34:return e.finish(27);case 35:e.next=38;break;case 37:console.log("has no wxcard code to consume");case 38:return e.abrupt("return",o.a.resolve());case 39:case"end":return e.stop()}}),e,this,[[12,23,27,35],[28,,30,34]])})));return function(){return e.apply(this,arguments)}}()},{key:"cardIdWithInfiniteDay",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(console.log("cardIdWithInfiniteDay day:",e),e<=0)return console.error("Invalid days");var t=["pnfe5uBLUipfpDw-64rRRdWKHD6A","pnfe5uNSWGeTIpe0oZoOt7evZ2H4","pnfe5uAT17eCAFwiDd1xb5AeB_pk","pnfe5uCq2dIJzkysIegKUWeYO0EQ","pnfe5uAi69NtwfdP3Y2Ki1lnIGlc","pnfe5uA9cvqJrWWKZR_mCua2Lm2Q","pnfe5uJ-kafxtkwGP-9hYe_GvreQ","pnfe5uKuNBsYUzcvaq9m2rYTnfXU","pnfe5uG07_pZDf7arIMUS8na3A1o","pnfe5uC50ooqRphHXDefg6OORC58","pnfe5uL3GgJiXJTe1cCeKvKfZmMI","pnfe5uFpxV1SvW7DCesX6rZNozRo","pnfe5uAjzXFw9bihDhEWER72rCRY","pnfe5uBOV-L-4IxrGQLowQBPOMjQ","pnfe5uE8DSOftRc_e0TucdVFK9IA","pnfe5uEinT2kVbd7kum1fGBCwnz0","pnfe5uJS7pXIq8JAzTyefUCkI30c","pnfe5uKPb6h5OTUGcDeSZ2s60wjk","pnfe5uCCe66cAk1u5jnaVd2zglsQ","pnfe5uM5rnAUWh1ixJ04BXCOUK4E","pnfe5uIBmeYI2V8sIlPasHJFU4Pg","pnfe5uEdnXiKsklAH2ENrt-Chb1A","pnfe5uM_QekbsddQWFMZr9GyjQ-s","pnfe5uGqSH90IUZjJAnvgGQSdpt4","pnfe5uHBn0ZCmSY-yhEYTCJBtjzg","pnfe5uElyhTaeD7DmnTrve-gw6Ok","pnfe5uPPc8CqSsQyzlxrCK6ofp88","pnfe5uPjvP8hhB23Yy-TmddpKiGE","pnfe5uBksMlmJKvO2k4QBZkkfyAA","pnfe5uLiEsSfJv-CIrYSrE47p-0I"];return e>30?t[0]:t[30-e]}}]),e}();t.a=v},83:function(e,t,n){n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return m}));var r=n(1),o=n.n(r),i=n(4),a=n.n(i),u=n(8),s=n.n(u),c=n(10),l=n.n(c),f=n(5),d=n.n(f),_=n(9),E=(n(42),n(2));d.a.use(_.default);var p="INIT",h=o()({},p,(function(e,t){var n=this,r=e.commit,o=(e.state,t.shareVid);return l()(a.a.mark((function e(){var t;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Date,e.abrupt("return",E.default.trendWeeklyData(o).then((function(e){console.log("trendWeeklyData loadtime:",new Date-t);var n=(new Date-t)/1e3;if(wx.reportAnalytics("trendweekly_time",{time:n}),!e.trendInfo)return console.log("request trendWeeklyData error:",e),s.a.reject(e);r(p,{trendInfo:e.trendInfo,infiniteInfo:e.infiniteInfo,splashIcon:e.splashIcon})})));case 2:case"end":return e.stop()}}),e,n)})))()})),I=o()({},p,(function(e,t){var n=t.trendInfo,r=t.infiniteInfo,o=t.splashIcon;e.trendInfo=n,e.infiniteInfo=r,e.splashIcon=o})),m=new _.default.Store({state:{trendInfo:{books:[],shareTitle:"",date:""},infiniteInfo:{day:0,received:0},splashIcon:null},getters:{},actions:h,mutations:I,plugins:[]})},86:function(e,t,n){var r,o,i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{s(r.next(e))}catch(e){i(e)}}function u(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){e.done?o(e.value):new n((function(t){t(e.value)})).then(a,u)}s((r=r.apply(e,t||[])).next())}))},u=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var c=s(n(72)),l=s(n(469)),f=s(n(3)),d=s(n(5)),_=s(n(9));d.default.use(_.default);var E="",p=wx.cloud.database();t.BATTLE_GAME_INIT="BATTLE_GAME_INIT",t.BATTLE_GAME_SPONSOR_INVITE="BATTLE_GAME_SPONSOR_INVITE",t.BATTLE_GAME_RE_SPONSOR_INVITE="BATTLE_GAME_RE_SPONSOR_INVITE",t.BATTLE_GAME_SPONSOR_AUTO_MATCH="BATTLE_GAME_SPONSOR_AUTO_MATCH",t.BATTLE_GAME_SPONSOR_BATTLE="BATTLE_GAME_SPONSOR_BATTLE",t.BATTLE_GAME_JOIN_FRIEND="BATTLE_GAME_JOIN_FRIEND",t.BATTLE_GAME_REPORT_RESULT="BATTLE_GAME_REPORT_RESULT",t.BATTLE_GAME_REPORT_ROUND_FINISH="BATTLE_GAME_REPORT_ROUND_FINISH",t.BATTLE_GAME_REPORT_QUIT="BATTLE_GAME_REPORT_QUIT",t.BATTLE_GAME_CANCEL_AUTO_MATCH="BATTLE_GAME_CANCEL_AUTO_MATCH",t.BATTLE_GAME_DISMISS_BATTLE="BATTLE_GAME_DISMISS_BATTLE",t.BATTLE_GAME_WATCH_MODEL="BATTLE_GAME_WATCH_MODEL",t.BATTLE_GAME_BATTLE_DB_WATCHER="BATTLE_GAME_BATTLE_DB_WATCHER",t.BATTLE_GAME_BATTLE_DB_WATCHER_CLOSE="BATTLE_GAME_BATTLE_DB_WATCHER_CLOSE",t.BATTLE_GAME_UNLOAD="BATTLE_GAME_UNLOAD",t.BATTLE_GAME_ACTIVITY_ID="BATTLE_GAME_ACTIVITY_ID",t.BATTLE_GAME_ADD_BATTLE_ROBOT="BATTLE_GAME_ADD_BATTLE_ROBOT",t.BATTLE_GAME_UPDATE_BATTLE_ROBOT="BATTLE_GAME_UPDATE_BATTLE_ROBOT",t.BATTLE_GAME_START_BATTLE="BATTLE_GAME_START_BATTLE",t.BATTLE_GAME_CANCEL_BATTLE="BATTLE_GAME_CANCEL_BATTLE",t.BATTLE_GAME_CLEAR_BATTLE="BATTLE_GAME_CLEAR_BATTLE",t.BATTLE_GAME_TRANSFORM_TO_RACEGAME_DOUBLE="BATTLE_GAME_TRANSFORM_TO_RACEGAME_DOUBLE",t.BATTLE_GAME_INFO="BATTLE_GAME_INFO",t.BATTLE_GAME_SPONSOR_INFO="BATTLE_GAME_SPONSOR_INFO",t.BATTLE_GAME_CHALLENGER_INFO="BATTLE_GAME_CHALLENGER_INFO",t.BATTLE_GAME_QUESTION="BATTLE_GAME_QUESTION",t.BATTLE_GAME_RESULT="BATTLE_GAME_RESULT",t.BATTLE_GAME_UPDATE_SELFINFO="BATTLE_GAME_UPDATE_SELFINFO",t.BATTLE_GAME_USER="BATTLE_GAME_USER",t.BATTLE_GAME_WHITELIST="BATTLE_GAME_WHITELIST",t.BATTLE_GAME_RACE_GAME_STATUS="BATTLE_GAME_RACE_GAME_STATUS",t.BATTLE_GAME_TOGGLE_ONSHOW_FLAG="BATTLE_GAME_TOGGLE_ONSHOW_FLAG",t.BATTLE_GAME_REPORT_ONLINE="BATTLE_GAME_REPORT_ONLINE",t.BATTLE_GAME_MARKET_INIT="BATTLE_GAME_MARKET_INIT",t.BATTLE_GAME_MARKET_CLEAR="BATTLE_GAME_MARKET_CLEAR",t.BATTLE_GAME_MARKET_UPDATE_TYPE="BATTLE_GAME_MARKET_UPDATE_TYPE",t.BATTLE_GAME_MARKET_LOTTREY_INIT="BATTLE_GAME_MARKET_LOTTREY_INIT",t.BATTLE_GAME_AD_FINISH="BATTLE_GAME_AD_FINISH",t.BATTLE_GAME_RANK_PROTECT_AD_FINISH="BATTLE_GAME_RANK_PROTECT_AD_FINISH",t.BATTLE_GAME_DOUBLE_SCORE_AD_FINISH="BATTLE_GAME_DOUBLE_SCORE_AD_FINISH",t.BATTLE_GAME_FETCH_MESSAGES="BATTLE_GAME_FETCH_MESSAGES",t.BATTLE_GAME_SEND_MESSAGE="BATTLE_GAME_SEND_MESSAGE",t.BATTLE_GAME_CLEAR_MESSAGE="BATTLE_GAME_CLEAR_MESSAGE",t.REPORT_LOG="REPORT_LOG";var h={battleId:"",battleStatus:"ready",roundStartTime:0,startTime:0,progress:-1,gameType:0,gameModel:"join",vol:0,gameStatus:"playing",battleVol:0,activityId:"",questionCount:0},I={userVid:0,avatar:"",name:"",wrong:0,right:0,online:1,startBattle:0,gameScore:0,userLevel:0,battleLevel:0,score:0,type:"",successRadio:0,roundResult:[],inviteInfiniteScore:{},rank:1,rankScore:100011,raceGameType:""},m={questions:[]},v={questionStatus:[],questionTimes:[]},T={winner:0},g={sponsor:i({},I),challenger:i({},I),self:{userVid:0,avatar:"",name:"",score:0,userLevel:2,battleLevel:2,isWhiteList:!1,raceGameVictory:!1,onShowFlag:!0,rankInfo:{rank:1,subRank:1,stars:1},rankScore:100011,scoreObtain:0,dailyLimitScore:0,outage:{status:"open",message:""},autoMatchCount:0},info:i({},h),battleResult:i({},T),quesQueue:i({},m),robot:i({},v),market:{type:"",book:[],card:[],money:[],prop:[],score:0,scoreConsume:0},lottery:{_id:"",awards:[],name:"",price:0,status:"closed"},messages:[]},A=null,R={actions:((r={})[t.BATTLE_GAME_INIT]=function(e,n){var r=e.commit,o=e.dispatch,i=n.isBattlePage;return a(this,void 0,void 0,(function(){var e,n,a,s,l,d;return u(this,(function(u){switch(u.label){case 0:return(e=f.default.getUser()).vid?[3,3]:[4,new Promise((function(t){f.default.login({success:function(n){e=n,t()}})}))];case 1:return u.sent(),[4,new Promise((function(t){wx.request({url:"https://i.weread.qq.com/user?userVid="+e.vid+"&vid="+e.vid+"&skey="+e.skey+"&platform="+e.Platform,success:function(n){n&&n.data&&n.data.name&&(e.name=n.data.name,e.avatar=n.data.avatar,t())}})}))];case 2:u.sent(),u.label=3;case 3:return[4,c.default.initBattleGameUserInfo(e.name,e.avatar)];case 4:return(n=u.sent())&&n.user&&r(t.BATTLE_GAME_UPDATE_SELFINFO,n.user),a=n.gameStatus?n.gameStatus:"playing",n&&n.vol&&(s=n.vol,r(t.BATTLE_GAME_INFO,{vol:s,gameStatus:a})),"truce"!==a&&i?[4,c.default.queryBattle().catch((function(e){return e&&-201===e.errCode?r(t.BATTLE_GAME_INFO,{gameStatus:"truce"}):console.log("err queryBattle:",e),{errCode:0}}))]:(console.log("HGL: isBattlePage",i),[2,n]);case 5:return l=u.sent(),console.log("mxd battleResult:",l),0===l.errCode&&(l.battleInfo&&l.battleInfo.battleId?(d=l.battleInfo.battleId,l&&l.battleInfo&&r(t.BATTLE_GAME_INFO,l.battleInfo),l&&l.question&&r(t.BATTLE_GAME_QUESTION,l.question),l&&l.battleResult&&r(t.BATTLE_GAME_RESULT,l.battleResult),l&&l.challenger&&r(t.BATTLE_GAME_CHALLENGER_INFO,l.challenger),l&&l.sponsor&&r(t.BATTLE_GAME_SPONSOR_INFO,l.sponsor),d&&o(t.BATTLE_GAME_BATTLE_DB_WATCHER,{battleId:d})):r(t.BATTLE_GAME_UNLOAD),console.log(l),l.battleInfo&&l.battleInfo.activityId&&r(t.BATTLE_GAME_ACTIVITY_ID,l.battleInfo.activityId)),o(t.BATTLE_GAME_WHITELIST,e.vid),o(t.BATTLE_GAME_RACE_GAME_STATUS),o(t.BATTLE_GAME_FETCH_MESSAGES),[2,l]}}))}))},r[t.BATTLE_GAME_WATCH_MODEL]=function(e,n){var r=e.commit,o=e.dispatch;n&&(o(t.BATTLE_GAME_BATTLE_DB_WATCHER,{battleId:n}),r(t.BATTLE_GAME_INFO,{gameModel:"watch"}))},r[t.BATTLE_GAME_SPONSOR_INVITE]=function(e,n){var r=e.commit,o=e.dispatch,i=n.battleId,s=n.activityId,l=n.source,f=n.raceGameType;return a(this,void 0,void 0,(function(){var e,n;return u(this,(function(a){switch(a.label){case 0:return[4,c.default.sponsorFriend1V1Battle(i,s,{source:l,raceGameType:f}).catch((function(e){return e&&-201===e.errCode&&r(t.BATTLE_GAME_INFO,{gameStatus:"truce"}),Promise.reject(e)}))];case 1:return 0===(e=a.sent()).errCode&&e.battle&&(r(t.BATTLE_GAME_SPONSOR_BATTLE,e.battle),(n=e.battle.battleId)&&o(t.BATTLE_GAME_BATTLE_DB_WATCHER,{battleId:n})),[2,e]}}))}))},r[t.BATTLE_GAME_TRANSFORM_TO_RACEGAME_DOUBLE]=function(e,t){var n=e.state,r=t.battleId,o=t.raceGameType;return console.log(n.info.battleId),c.default.transformBattleToRaceGameDouble(r,o).catch((function(e){return Promise.reject(e)}))},r[t.BATTLE_GAME_SPONSOR_AUTO_MATCH]=function(e){var n=e.commit,r=e.dispatch,o=e.state;r(t.BATTLE_GAME_BATTLE_DB_WATCHER_CLOSE);var i=o.self.userLevel,a=o.self.battleLevel;return c.default.sponsorAutoMatch1V1Battle(i,a).then((function(e){if(0===e.errCode&&e.battle){n(t.BATTLE_GAME_SPONSOR_BATTLE,e.battle);var o=e.battle.battleId;o&&r(t.BATTLE_GAME_BATTLE_DB_WATCHER,{battleId:o})}return e})).catch((function(e){return e&&-201===e.errCode&&n(t.BATTLE_GAME_INFO,{gameStatus:"truce"}),Promise.reject(e)}))},r[t.BATTLE_GAME_RE_SPONSOR_INVITE]=function(e){var n=e.commit,r=e.state;return a(this,void 0,void 0,(function(){var e,o,i;return u(this,(function(a){switch(a.label){case 0:return e=r.self.userLevel,o=r.info.battleId,[4,c.default.reSponsorFriend1V1Battle(o,e).catch((function(e){return e&&-201===e.errCode&&n(t.BATTLE_GAME_INFO,{gameStatus:"truce"}),Promise.reject(e)}))];case 1:return i=a.sent(),n(t.BATTLE_GAME_SPONSOR_INFO,{gameScore:0}),n(t.BATTLE_GAME_CHALLENGER_INFO,{gameScore:0}),0===i.errCode&&i.battle&&i.battle.battleId&&n(t.BATTLE_GAME_SPONSOR_BATTLE,i.battle),[2,i]}}))}))},r[t.BATTLE_GAME_JOIN_FRIEND]=function(e,n){var r=e.commit,o=e.dispatch,i=e.state;return a(this,void 0,void 0,(function(){var e,a;return u(this,(function(u){switch(u.label){case 0:return e=i.self.userLevel,[4,c.default.joinFriendBattleGame(n,e).catch((function(e){return e&&-201===e.errCode&&r(t.BATTLE_GAME_INFO,{gameStatus:"truce"}),Promise.reject(e)}))];case 1:return 0===(a=u.sent()).errCode&&n?(r(t.BATTLE_GAME_SPONSOR_BATTLE,{battleId:n}),o(t.BATTLE_GAME_BATTLE_DB_WATCHER,{battleId:n})):-201===a.errCode&&r(t.BATTLE_GAME_INFO,{gameStatus:"truce"}),[2,a]}}))}))},r[t.BATTLE_GAME_REPORT_ROUND_FINISH]=function(e){var t=e.state,n=t.info.battleId,r=t.info.progress,o=t.info.battleVol;return c.default.reportBattleFinish(n,o,r)},r[t.BATTLE_GAME_REPORT_QUIT]=function(e){var t=e.state;return a(this,void 0,void 0,(function(){var e;return u(this,(function(n){switch(n.label){case 0:return(e=t.info.battleId)?[4,c.default.reportBattleQuit(e)]:[3,2];case 1:return[2,n.sent()];case 2:return[2,{errCode:-1,errMsg:"小程序本地battleId为空"}]}}))}))},r[t.BATTLE_GAME_CANCEL_AUTO_MATCH]=function(e){var t=e.state;console.log(t.info);var n=t.info.battleId;return c.default.cancelAutoMatch1V1Battle(n)},r[t.BATTLE_GAME_DISMISS_BATTLE]=function(e){var n=e.state,r=e.commit;return a(this,void 0,void 0,(function(){var e,o;return u(this,(function(i){switch(i.label){case 0:return e=n.info.battleId,console.warn(JSON.stringify(n.info)),[4,c.default.dismissInvite1V1Battle(e,n.info.activityId)];case 1:return o=i.sent(),console.warn(o),o&&o.battleInfo&&o.battleInfo.activityId&&r(t.BATTLE_GAME_ACTIVITY_ID,o.battleInfo.activityId),[2,o]}}))}))},r[t.BATTLE_GAME_ADD_BATTLE_ROBOT]=function(e){var n=e.state,r=e.commit,o=n.info.battleId,i=n.self.userLevel,a=n.self.battleLevel;return c.default.addBattleRobot(o,i,a).catch((function(e){return e&&-201===e.errCode&&r(t.BATTLE_GAME_INFO,{gameStatus:"truce"}),Promise.reject(e)}))},r[t.BATTLE_GAME_UPDATE_BATTLE_ROBOT]=function(e,n){(0,e.commit)(t.BATTLE_GAME_UPDATE_BATTLE_ROBOT,n)},r[t.BATTLE_GAME_BATTLE_DB_WATCHER]=function(e,n){var r=e.commit,o=e.dispatch,a=e.state,u=n.battleId||null,s=n.retry||0;if(!u||s>=2)return console.error("实时DB监听重试2次失败！"),void c.default.battleGameMonitor("battleGame_listen_error");console.log("实时DB开始监听: ",u);var f=p.collection("battleGame_queue").where({_id:u}).watch({onChange:function(e){var n=e&&e.docs&&e.docs.length&&e.docs[0]?e.docs[0]._id:0,s=l.default.ParseBattleSnapshot(e);if("init"===(s&&s.dbDataType?s.dbDataType:"")&&(E=n,o(t.BATTLE_GAME_BATTLE_DB_WATCHER_CLOSE).then((function(){A=f}))),""!==E&&E!==n&&n)console.log("dbWatcher: docId 与 监听的 battleId 不一致，battleId: "+u+"docId: "+n);else{if(console.log("实时DB数据Parse结果:",s),s&&s.battleInfo&&r(t.BATTLE_GAME_INFO,i({},s.battleInfo,{battleId:n})),s&&s.question&&r(t.BATTLE_GAME_QUESTION,s.question),s&&s.battleResult){console.log("监听到游戏结束:",s.battleResult);var c=s.battleResult[a.self.userVid];c&&c.rankScore&&c.rankInfo&&(r(t.BATTLE_GAME_UPDATE_SELFINFO,{rankScore:c.rankScore,rankInfo:c.rankInfo}),console.log("段位已更新",c.rankInfo))}r(t.BATTLE_GAME_RESULT,s.battleResult),s&&s.challenger&&(s.challenger.userVid!==a.self.userVid||!a.self.onShowFlag||s.challenger.online&&!s.challenger.offlineSuspect||o(t.BATTLE_GAME_REPORT_ONLINE,u),r(t.BATTLE_GAME_CHALLENGER_INFO,s.challenger)),s&&s.sponsor&&(s.sponsor.userVid!==a.self.userVid||!a.self.onShowFlag||s.sponsor.online&&!s.sponsor.offlineSuspect||o(t.BATTLE_GAME_REPORT_ONLINE,u),r(t.BATTLE_GAME_SPONSOR_INFO,s.sponsor));var d=a.self.userVid;s&&s.challenger&&s.challenger.userVid===d&&r(t.BATTLE_GAME_UPDATE_SELFINFO,{battleLevel:s.challenger.battleLevel}),s&&s.sponsor&&s.sponsor.userVid===d&&r(t.BATTLE_GAME_UPDATE_SELFINFO,{battleLevel:s.sponsor.battleLevel})}},onError:function(e){console.error("实时DB监听失败:",e);var n=s+1;o(t.REPORT_LOG,{itemname:"mp_battleGame_dbWatch_Error",battleId:u,retry:n}),wx.showToast({title:"网络异常，请检查您的网络连接",icon:"none"}),wx.getNetworkType({success:function(e){return console.log("当前网络类型：",e)}});var r=wx.connectSocket({url:"wss://tcb-ws.tencentcloudapi.com",success:function(){return console.log("开始测试与云接入层的连通性")},fail:function(e){return console.log("建立连接失败",e)}});r.onOpen((function(){console.log("云接入层连接正常(Websocket-Open)"),r.close({code:1e3})})),r.onError((function(e){return console.log("云接入层无法连接(Websocket-Error)",e)})),console.log("重试实时DB监听: ",u,n),o(t.BATTLE_GAME_BATTLE_DB_WATCHER,{battleId:u,retry:n})}})},r[t.BATTLE_GAME_REPORT_RESULT]=function(e,t){var n=e.state,r=n.info.battleId,o=n.info.roundStartTime,i=n.info.progress,a=n.info.battleVol;return c.default.reportBattleResult(r,a,o,t.right,i,t.type)},r[t.BATTLE_GAME_START_BATTLE]=function(e){var n=e.state,r=e.commit,o=n.info.battleId,i=n.sponsor.battleLevel,a=n.challenger.battleLevel;return c.default.startInviteBattle(o,i,a).catch((function(e){return e&&-201===e.errCode&&r(t.BATTLE_GAME_INFO,{gameStatus:"truce"}),Promise.reject(e)}))},r[t.BATTLE_GAME_CANCEL_BATTLE]=function(e){var n=e.state,r=e.commit,o=n.info.battleId;return c.default.quitInviteBattle(o,n.info.activityId).then((function(e){return e&&e.battleInfo&&e.battleInfo.activityId&&r(t.BATTLE_GAME_ACTIVITY_ID,e.battleInfo.activityId),e}))},r[t.BATTLE_GAME_CLEAR_BATTLE]=function(e){var n=e.state,r=e.commit;r(t.BATTLE_GAME_INFO,i({},h,{activityId:n.info.activityId})),r(t.BATTLE_GAME_SPONSOR_INFO,i({},I)),r(t.BATTLE_GAME_CHALLENGER_INFO,i({},I))},r[t.BATTLE_GAME_UNLOAD]=function(e){var n=e.commit;return a(this,void 0,void 0,(function(){return u(this,(function(e){return n(t.BATTLE_GAME_UNLOAD),[2]}))}))},r[t.BATTLE_GAME_BATTLE_DB_WATCHER_CLOSE]=function(){return a(this,void 0,void 0,(function(){return u(this,(function(e){switch(e.label){case 0:return console.log("尝试关闭实时DB."),A?[4,A.close()]:[3,2];case 1:e.sent(),A=null,e.label=2;case 2:return[2]}}))}))},r[t.BATTLE_GAME_WHITELIST]=function(e,n){var r=e.commit;c.default.checkIsWhiteUser(n).then((function(e){f.default.setIsWhiteUser(e.isWhitelisted),r(t.BATTLE_GAME_UPDATE_SELFINFO,{isWhiteList:!!e.isWhitelisted})}))},r[t.BATTLE_GAME_MARKET_INIT]=function(e){var n=e.commit;return c.default.getUserScore().then((function(e){n(t.BATTLE_GAME_MARKET_INIT,{score:e.score,scoreConsume:e.scoreConsume})})),c.default.fetchMarketDetail().then((function(e){n(t.BATTLE_GAME_MARKET_INIT,e)}))},r[t.BATTLE_GAME_MARKET_UPDATE_TYPE]=function(e,n){(0,e.commit)(t.BATTLE_GAME_MARKET_UPDATE_TYPE,n)},r[t.BATTLE_GAME_MARKET_LOTTREY_INIT]=function(e,n){var r=e.commit;return c.default.getMarketLottery(n).then((function(e){return r(t.BATTLE_GAME_MARKET_LOTTREY_INIT,e),e}))},r[t.BATTLE_GAME_AD_FINISH]=function(e){var t=e.state,n={battleId:"",userRole:""};return t.info.battleId&&(n.battleId=t.info.battleId,t.sponsor.userVid===t.self.userVid?n.userRole="sponsor":t.challenger.userVid===t.self.userVid&&(n.userRole="challenger")),c.default.reportAdWatched(n).then((function(e){return t.self.adsScoreCnt=t.self.adsScoreCnt-1,0===e.errCode&&(t.self.score=t.self.score+20),e}))},r[t.BATTLE_GAME_RANK_PROTECT_AD_FINISH]=function(e,n){var r=e.commit,o=n.rankScore;return a(this,void 0,void 0,(function(){var e;return u(this,(function(n){switch(n.label){case 0:return[4,c.default.reportRankProtect(o)];case 1:return(e=n.sent())&&0===e.errCode&&e.rankData?(r(t.BATTLE_GAME_UPDATE_SELFINFO,e.rankData),[2,e]):(Promise.reject(e),[2])}}))}))},r[t.BATTLE_GAME_DOUBLE_SCORE_AD_FINISH]=function(e,t){var n=e.state,r=t.score,o=t.userVid;return c.default.reportAdDoubleScore(r).then((function(e){return 0===e.errCode&&(n.battleResult[o]=i({},n.battleResult[o],{score:n.battleResult[o].score+r,bonusScore:n.battleResult[o].bonusScore+r}),n.self.score=n.self.score+r),e}))},r[t.BATTLE_GAME_RACE_GAME_STATUS]=function(e){var n=e.commit;c.default.raceGameStatus().then((function(e){n(t.BATTLE_GAME_UPDATE_SELFINFO,{raceGameVictory:!(!e||!e.victory)})}))},r[t.BATTLE_GAME_TOGGLE_ONSHOW_FLAG]=function(e,n){(0,e.commit)(t.BATTLE_GAME_TOGGLE_ONSHOW_FLAG,n)},r[t.BATTLE_GAME_REPORT_ONLINE]=function(e,t){c.default.reportBattleOnline(t).catch((function(){console.log("battleGame report online error")}))},r[t.BATTLE_GAME_FETCH_MESSAGES]=function(e){var n=e.commit;c.default.fetchBattleGameMessages().then((function(e){n(t.BATTLE_GAME_FETCH_MESSAGES,e)}))},r[t.BATTLE_GAME_SEND_MESSAGE]=function(e,t){var n=e.state.info.battleId;c.default.sendBattleGameMessage({battleId:n,battleGameMessage:t}).catch((function(e){console.log(e)}))},r[t.BATTLE_GAME_CLEAR_MESSAGE]=function(e){var t=e.state.info.battleId;c.default.clearBattleGameMessage({battleId:t}).catch((function(e){console.log(e)}))},r[t.REPORT_LOG]=function(e,t){return c.default.reportLog(t)},r),getters:{isWhiteListUser:function(e){return e.self.isWhiteList},battleStatus:function(e){return e.info.battleStatus},gameType:function(e){return 1===e.info.gameType?"friendInvite":2===e.info.gameType?"autoMatch":"unknown"},gameUser:function(e){return e.self.userVid===e.sponsor.userVid?{self:e.sponsor,opponent:e.challenger}:{self:e.challenger,opponent:e.sponsor}},currentQuestion:function(e){var t=e.info.progress;return{currentQuestionIndex:t,currentQuestion:e.quesQueue.questions[t]}},userIdentity:function(e){var t=e.self.userVid;return t===e.sponsor.userVid?"sponsor":t===e.challenger.userVid?"challenger":"unknown"},battleResult:function(e){var t=e.battleResult.winner;if(t){var n=Object.keys(e.battleResult),r={},o={},a="";return n.forEach((function(e){"winner"!==e&&e+""!=t+""&&(a=e)})),t===e.sponsor.userVid?(r=e.sponsor,o=e.challenger):(r=e.challenger,o=e.sponsor),{winner:i({},r,e.battleResult[t]),loser:i({},o,e.battleResult[a])}}return{winner:i({},e.sponsor,e.battleResult[e.sponsor.userVid]),loser:i({},e.challenger,e.battleResult[e.challenger.userVid])}},extraBonusData:function(e){return e.sponsor&&e.sponsor.inviteInfiniteScore?i({},e.sponsor.inviteInfiniteScore,{sponsorVid:e.sponsor.userVid}):{sponsorVid:e.sponsor.userVid}},isDrawFinish:function(e){return"finish"===e.info.battleStatus&&!e.battleResult.winner}},mutations:((o={})[t.BATTLE_GAME_SPONSOR_BATTLE]=function(e,t){e.info=i({},e.info,t)},o[t.BATTLE_GAME_INFO]=function(e,t){e.info=i({},e.info,t)},o[t.BATTLE_GAME_CHALLENGER_INFO]=function(e,t){e.challenger=i({},e.challenger,t)},o[t.BATTLE_GAME_SPONSOR_INFO]=function(e,t){e.sponsor=i({},e.sponsor,t)},o[t.BATTLE_GAME_RESULT]=function(e,t){e.battleResult=t?i({},e.battleResult,t):i({},T)},o[t.BATTLE_GAME_QUESTION]=function(e,t){var n=e.info.progress,r=e.quesQueue.questions;r[n]=t,e.quesQueue=i({},e.quesQueue,{questions:r.slice()})},o[t.BATTLE_GAME_UPDATE_SELFINFO]=function(e,t){""===t.name&&(t.name=void 0),""===t.avatar&&(t.avatar=void 0),console.log("BATTLE_GAME_UPDATE_SELFINFO: ",t),e.self=i({},e.self,t)},o[t.BATTLE_GAME_UPDATE_BATTLE_ROBOT]=function(e,t){e.robot=i({},e.robot,t)},o[t.BATTLE_GAME_UNLOAD]=function(e){e.sponsor=i({},I),e.info=i({},h),e.challenger=i({},I),e.battleResult=i({},T),e.quesQueue=i({},m),e.robot=i({},v)},o[t.BATTLE_GAME_MARKET_INIT]=function(e,t){e.market=i({},e.market,t)},o[t.BATTLE_GAME_MARKET_LOTTREY_INIT]=function(e,t){e.lottery=i({},e.lottery,t)},o[t.BATTLE_GAME_MARKET_UPDATE_TYPE]=function(e,t){e.market=i({},e.market,{type:t})},o[t.BATTLE_GAME_TOGGLE_ONSHOW_FLAG]=function(e,t){e.self=i({},e.self,{onShowFlag:t})},o[t.BATTLE_GAME_ACTIVITY_ID]=function(e,t){console.log("ACTIVITY_ID ",t),e.info.activityId=t},o[t.BATTLE_GAME_FETCH_MESSAGES]=function(e,t){t&&t.length&&(e.messages=t)},o),state:g};t.store=new _.default.Store(R)},88:function(e,t,n){var r,o,i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{s(r.next(e))}catch(e){i(e)}}function u(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){e.done?o(e.value):new n((function(t){t(e.value)})).then(a,u)}s((r=r.apply(e,t||[])).next())}))},u=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},c=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});var l=s(n(5)),f=s(n(9)),d=s(n(2)),_=s(n(264)),E=(s(n(42)),c(n(19))),p=s(n(3)),h=s(n(49)),I=n(0),m=s(n(15)),v=n(265);l.default.use(f.default),t.INIT_LECTURE_PAGE="INIT_LECTURE_PAGE",t.INIT_LECTURE_PAGE_DYNAMIC_INFO="INIT_LECTURE_PAGE_DYNAMIC_INFO",t.INIT_LECTURE_PLAYER="INIT_LECTURE_PLAYER",t.INIT_BOOK_INFO="INIT_BOOK_INFO",t.INIT_LECTURE_INFO="INIT_LECTURE_INFO",t.INIT_TTS_CHAPTER_INFO="INIT_TTS_CHAPTER_INFO",t.INIT_LECTURER_LIST="INIT_LECTURER_LIST",t.INIT_AUDIO_MANAGER="INIT_AUDIO_MANAGER",t.SET_LECTURE_TYPE="SET_LECTURE_TYPE",t.INIT_CHAPTER_IDX="INIT_CHAPTER_IDX",t.SET_PLAY_BACK_RATE="SET_PLAY_BACK_RATE",t.SET_MINI_PLAYER_STATE="SET_MINI_PLAYER_STATE",t.SET_PLAYING_CHAPTERS="SET_PLAYING_CHAPTERS",t.SET_ERROR_STATE="SET_ERROR_STATE",t.SET_PAUSE_ON_END="SET_PAUSE_ON_END",t.RESET_PAGE_INFO="RESET_PLAY_INFO",t.SET_LECTURER="SET_LECTURER",t.SET_PROGRESS_RECORD="SET_PROGRESS_RECORD",t.INIT_LISTEN_COUNT="INIT_LISTEN_COUNT",t.SET_LISTEN_COUNT="SET_LISTEN_COUNT",t.UPLOAD_LECTURE_SCHEDULE_TIME="UPLOAD_LECTURE_SCHEDULE_TIME",t.INIT_BOOK_IN_SHELF="INIT_BOOK_IN_SHELF",t.ADD_TO_BOOKSHELF="ADD_TO_BOOKSHELF",t.REMOVE_FROM_BOOKSHELF="REMOVE_FROM_BOOKSHELF",t.INIT_BOOK_REVIEW_LIST="INIT_BOOK_REVIEW_LIST",t.INIT_BOOK_REVIEW_COUNT="INIT_BOOK_REVIEW_COUNT",t.INIT_BOOK_LIKE_LIST="INIT_BOOK_LIKE_LIST",t.INIT_BOOK_LIKE_COUNT="INIT_BOOK_LIKE_COUNT",t.LIKE_BOOK="LIKE_BOOK",t.UNLIKE_BOOK="UNLIKE_BOOK",t.LIKE_REVIEW="LIKE_REVIEW",t.SEND_REVIEW="SEND_REVIEW",t.DELETE_REVIEW="DELETE_REVIEW",t.RESET_DISPLAY="RESET_DISPLAY",t.SET_CHAPTER_LIKED="SET_CHAPTER_LIKED",t.REPORT_LOG="REPORT_LOG";var T={bookId:"",title:"",author:"",cover:"",format:"",bookStatus:0,payType:0,finished:0,maxFreeChapter:0,type:0,free:0,centPrice:0,hasLecture:0,intro:"",paid:0,isChapterPaid:0,showLectureButton:0,wxtts:0,lectureInShelf:!1,soldout:0},g={userVid:0,totalCount:0,soldoutTotalCount:0,recentUploadTime:0,finished:0,free:0,limitedFree:0,discount:0,autobuy:0,userInfo:{userVid:0,name:"",avatar:"",isFollowing:0,isFollower:0,nick:"",isV:0,vDesc:""}},A={bookInfo:T,lectureType:"LECTURE",currentLecturer:g,lecturers:[],chapters:[],playingChapters:[],audioManager:null,reviews:[],reviewCount:0,likes:[],likeCount:0,originalLikeCount:0,chapterLiked:!1,playBackRate:1,showMiniPlayer:!1,isError:!1,pauseOnEnd:!1,progressRecord:null,listenCount:0},R=[{userVid:3,totalCount:0,userInfo:{userVid:3,name:"AI男声",avatar:"https://weread-1258476243.file.myqcloud.com/miniprogram/lecture/lecturePlayer_Lecturer_default.png"}},{userVid:4,totalCount:0,userInfo:{userVid:4,name:"AI女声",avatar:"https://weread-1258476243.file.myqcloud.com/miniprogram/lecture/lecturePlayer_Lecturer_default.png"}}],O=((r={})[t.INIT_LECTURE_PAGE]=function(e,n){var r=e.dispatch,o=e.commit,i=n.bookId,s=n.lecturerVid,c=n.lectureType,l=n.progressRecord;return a(this,void 0,void 0,(function(){return u(this,(function(e){switch(e.label){case 0:return i===A.bookInfo.bookId&&c===A.lectureType||o(t.SET_PROGRESS_RECORD,l),o(t.RESET_DISPLAY),o(t.RESET_PAGE_INFO),o(t.SET_LECTURE_TYPE,c),[4,h.default.dispatch(I.QUERY_INFINITE)];case 1:return e.sent(),[4,r(t.INIT_BOOK_INFO,i)];case 2:return e.sent(),"LECTURE"!==c?[3,4]:[4,r(t.INIT_LECTURE_INFO,{bookId:i,lecturerVid:s})];case 3:return e.sent(),[3,6];case 4:return"TTS"!==c?[3,6]:(s=s||3,[4,r(t.INIT_TTS_CHAPTER_INFO,{bookId:i,lecturerVid:s})]);case 5:e.sent(),e.label=6;case 6:return[2]}}))}))},r[t.INIT_LECTURE_PAGE_DYNAMIC_INFO]=function(e,n){var r=e.dispatch,o=e.state,i=n.bookId,s=n.lectureType;return a(this,void 0,void 0,(function(){return u(this,(function(e){return o.chapters&&o.chapters.length?("LECTURE"===s?r(t.INIT_BOOK_REVIEW_LIST,{reviewId:o.chapters[0].reviewId}):"TTS"===s&&r(t.INIT_BOOK_REVIEW_LIST,{bookId:i,chapterUid:o.chapters[0].chapterUid}),[2]):[2]}))}))},r[t.INIT_LECTURE_PLAYER]=function(e,n){var r=e.commit,o=e.state,i=e.dispatch,s=e.getters,c=n.chapterIdx,l=n.paragraphIdx,f=n.lecturerVid;return a(this,void 0,void 0,(function(){var e;return u(this,(function(n){return e=s.currentProgressRecord,r(t.SET_PLAYING_CHAPTERS,o.chapters),"LECTURE"===o.lectureType?r(t.INIT_AUDIO_MANAGER,new v.LectureAudioManager(o.bookInfo.bookId,o.playBackRate,c||0,o.bookInfo.title,o.bookInfo.cover,e)):"TTS"===o.lectureType&&r(t.INIT_AUDIO_MANAGER,new v.TTSAudioManager(o.bookInfo.bookId,o.playBackRate,c||0,l,o.bookInfo.title,o.bookInfo.cover,o.bookInfo.format,f||o.currentLecturer.userVid,e)),r(t.SET_PROGRESS_RECORD,null),o.audioManager.setPauseOnChapterEnd(o.pauseOnEnd),o.audioManager.onChapterEnd((function(){r(t.SET_PAUSE_ON_END,!1);var e=h.default.getters.infiniteRemainingDays>0,n=o.audioManager.chapterIdx,a=o.playingChapters[n];return!a||a.paid||!a.price||a.isFree||e&&"TTS"!==o.lectureType?!(s.isTrialRead&&!s.isTrialPlayingChapter(n+1)&&(wx.showToast({icon:"none",title:"试听已结束，感谢您的收听"}),console.log("[Trial] 试读结束",o.bookId),i(t.REPORT_LOG,{itemname:"mp_lecturePlayer_trial_End",bookId:o.bookId}),1)):(wx.showToast({icon:"none",title:"试听结束，未购买章节暂不支持在小程序播放"}),i(t.REPORT_LOG,{itemname:"mp_lecturePlayer_needPay"}),!1)})),[2]}))}))},r[t.INIT_BOOK_INFO]=function(e,n){var r=e.commit;return a(this,void 0,void 0,(function(){return u(this,(function(e){return[2,d.default.loadBookInfo(n).then((function(e){e&&e.bookId?r(t.INIT_BOOK_INFO,e):r(t.SET_ERROR_STATE,!0)})).catch((function(){r(t.SET_ERROR_STATE,!0)}))]}))}))},r[t.INIT_LECTURE_INFO]=function(e,n){var r=e.commit,o=e.dispatch,i=n.bookId,a=n.lecturerVid;return _.default.loadLectureInfo(i,a).then((function(e){if(!(e&&e.reviews&&e.userVid&&e.lecturers))return console.warn("Invalid lecture, bookId has no lecture",i),void r(t.SET_ERROR_STATE,!0);var n=e.reviews,a=e.userVid,u=e.lecturers.filter((function(e){return e.userVid===a}))[0];if(!u){if(e.lecturers&&e.lecturers.length){var s=e.lecturers[0].userVid;return console.warn("Invalid lecturer, switch to ",s),o(t.INIT_LECTURE_INFO,{bookId:i,lecturerVid:s})}return console.warn("Invalid lecture, bookId has no lecture",i),r(t.SET_ERROR_STATE,!0)}r(t.INIT_LECTURE_INFO,{chapters:n,lecturer:u}),r(t.INIT_LECTURER_LIST,e.lecturers)})).catch((function(){r(t.SET_ERROR_STATE,!0)}))},r[t.INIT_TTS_CHAPTER_INFO]=function(e,n){var r=e.commit,o=n.bookId,a=n.lecturerVid;return d.default.loadChapterInfos(o).then((function(e){if(e&&e.data&&e.data.length){var n=e&&e.data&&e.data[0].updated;n=E.parseChapterInfos(A.bookInfo,n);var o=R.filter((function(e){return e.userVid===a}))[0];r(t.INIT_LECTURE_INFO,{chapters:n,lecturer:o}),r(t.INIT_LECTURER_LIST,R.map((function(e){return i({},e,{totalCount:n.length})})))}else r(t.SET_ERROR_STATE,!0)})).catch((function(){r(t.SET_ERROR_STATE,!0)}))},r[t.ADD_TO_BOOKSHELF]=function(e,n){var r=e.commit,o=n.bookId,i=n.markAsSecret,a=void 0===i||i;if(o){var u=[d.default.addToBookShelf(o,!0)];return a&&u.push(d.default.secretBook({bookId:o,secret:!0})),Promise.all(u).then((function(){r(t.INIT_BOOK_IN_SHELF,!0),h.default.commit(I.LATEST_READ_BOOK,{bookId:A.bookInfo.bookId,cover:A.bookInfo.cover,isOnBookShelf:!0,secret:!0,isLecture:!0,hasLecture:A.bookInfo.hasLecture})}))}console.log("invalid bookId")},r[t.REMOVE_FROM_BOOKSHELF]=function(e,n){var r=e.commit;return Promise.all([d.default.deleteFromBookshelf(n,!0),d.default.secretBook({bookId:n,secret:!1})]).then((function(){r(t.INIT_BOOK_IN_SHELF,!1),h.default.commit(I.LATEST_READ_BOOK,{bookId:A.bookInfo.bookId,cover:A.bookInfo.cover,isOnBookShelf:!1,secret:!0,isLecture:!0,hasLecture:A.bookInfo.hasLecture});var e=m.default.getStorageSync("latestRead");m.default.setStorageSync("latestRead",e.filter((function(e){return e.bookId!==A.bookInfo.bookId}))),h.default.dispatch(I.INIT_RECENTREAD)}))},r[t.INIT_BOOK_REVIEW_LIST]=function(e,n){var r=e.state,o=e.commit,i=n.bookId,a=n.chapterUid,u=n.reviewId,s=n.lectureType;return"TTS"===(s=s||r.lectureType)?_.default.loadBookReviewList(i,a,500).then((function(e){e&&e.reviews&&(o(t.INIT_BOOK_REVIEW_LIST,e.reviews),o(t.INIT_BOOK_REVIEW_COUNT,e.chapterTotalCount))})):"LECTURE"===s?_.default.loadLectureReviewList(u).then((function(e){if(e&&e.comments){var n=e.comments.map((function(e){return{reviewId:e.reviewId,commentId:e.commentId,review:e,likesCount:e.likesCount,isLike:e.isLike}}));o(t.INIT_BOOK_REVIEW_LIST,n),o(t.INIT_BOOK_REVIEW_COUNT,e.commentsCount)}if(e&&e.likes){var r=e.likes.filter((function(e){return e.nick||e.name}));o(t.INIT_BOOK_LIKE_LIST,r),o(t.INIT_BOOK_LIKE_COUNT,e.likesCount),o(t.SET_CHAPTER_LIKED,e.review&&e.review.isLike)}})):void 0},r[t.LIKE_BOOK]=function(e,n){var r=e.state,o=e.commit,i=n.reviewId,a=n.isUnlike,u=n.lectureType;"LECTURE"===(u=u||r.lectureType)&&d.default.reviewLike(i,a).then((function(e){e&&e.succ&&o(a?t.UNLIKE_BOOK:t.LIKE_BOOK)}))},r[t.LIKE_REVIEW]=function(e,n){var r=e.state,o=e.commit,i=n.reviewId,a=n.commentId,u=n.isUnlike,s=n.lectureType;"LECTURE"===(s=s||r.lectureType)?_.default.commentLike(a,u).then((function(){o(t.LIKE_REVIEW,{commentId:a,isUnlike:u})})).catch((function(){wx.showToast({title:"点赞失败",icon:"none"})})):"TTS"===s&&d.default.reviewLike(i,u).then((function(){o(t.LIKE_REVIEW,{reviewId:i,isUnlike:u})})).catch((function(){wx.showToast({title:"点赞失败",icon:"none"})}))},r[t.SEND_REVIEW]=function(e,n){var r=e.state,o=e.commit,i=n.bookId,a=n.chapterUid,u=n.reviewId,s=n.content,c=n.lectureType;"LECTURE"===(c=c||r.lectureType)?_.default.publishLectureReview(u,s).then((function(e){e&&e.commentId&&o(t.SEND_REVIEW,{commentId:e.commentId,content:s})})):"TTS"===c&&d.default.publishBookReview({bookId:i,chapterUid:a,type:1,content:s}).then((function(e){e&&e.reviewId&&o(t.SEND_REVIEW,{reviewId:e.reviewId,content:s})}))},r[t.DELETE_REVIEW]=function(e,n){var r=e.state,o=e.commit,i=n.commentId,a=n.reviewId,u=n.lectureType;"LECTURE"===(u=u||r.lectureType)?_.default.deleteComment(i).then((function(e){e&&e.succ&&o(t.DELETE_REVIEW,{commentId:i})})):"TTS"===u&&d.default.deleteBookReview(a).then((function(e){e&&e.succ&&o(t.DELETE_REVIEW,{reviewId:a})}))},r[t.SET_PLAY_BACK_RATE]=function(e,n){var r=e.state,o=e.commit;r.audioManager&&r.audioManager.setPlayBackRate(n),o(t.SET_PLAY_BACK_RATE,n)},r[t.INIT_BOOK_IN_SHELF]=function(e){var n=e.state,r=e.commit;d.default.loadBookInfo(n.bookId).then((function(e){r(t.INIT_BOOK_IN_SHELF,e&&e.lectureInShelf)}))},r[t.UPLOAD_LECTURE_SCHEDULE_TIME]=function(e,t){var n=e.state,r=t.bookId,o=t.chapterUid,a=t.chapterIdx,u=t.progress,s=void 0===u?0:u,c=t.lectureTime,l=void 0===c?0:c,f=t.ttsTime,d=void 0===f?0:f,E=t.reviewId,p={bookId:r,progress:s};return"LECTURE"===n.lectureType?p=i({},p,{lectureTime:l,reviewId:E}):"TTS"===n.lectureType&&(p=i({},p,{ttsTime:d,chapterUid:o,chapterIdx:a})),_.default.uploadLectureProgressAndTime(p)},r[t.REPORT_LOG]=function(e,t){var n=e.state,r=t.itemname,o=t.extra;return d.default.analysisLog(r,i({lectureType:n.lectureType},o))},r[t.INIT_LISTEN_COUNT]=function(e,n){var r=e.commit,o=n.bookId,i=n.lecturerVid;return _.default.loadListenCount(o,i).then((function(e){r(t.SET_LISTEN_COUNT,e.totalCount||0)})).catch((function(e){console.log("err INIT_LISTEN_COUNT",e),r(t.SET_LISTEN_COUNT,0)}))},r),S=((o={})[t.INIT_BOOK_INFO]=function(e,t){e.bookInfo=i({},e.bookInfo,t)},o[t.INIT_LECTURE_INFO]=function(e,t){var n=t.chapters,r=t.lecturer;e.chapters=n,e.currentLecturer=i({},g,r)},o[t.SET_LECTURER]=function(e,t){var n=R.filter((function(e){return e.userVid===t}))[0];e.currentLecturer=i({},g,n)},o[t.INIT_AUDIO_MANAGER]=function(e,t){e.audioManager=t},o[t.SET_LECTURE_TYPE]=function(e,t){e.lectureType=t},o[t.INIT_LECTURER_LIST]=function(e,t){e.lecturers=t},o[t.INIT_BOOK_IN_SHELF]=function(e,t){e.bookInfo.lectureInShelf=t},o[t.INIT_BOOK_REVIEW_LIST]=function(e,t){e.reviews=t.map((function(e){var t=e.likesCount||0;return i({},e,{originalLikesCount:e.isLike?t-1:t})}))},o[t.INIT_BOOK_REVIEW_COUNT]=function(e,t){e.reviewCount=t},o[t.INIT_BOOK_LIKE_LIST]=function(e,t){e.likes=t},o[t.INIT_BOOK_LIKE_COUNT]=function(e,t){e.likeCount=t,e.originalLikeCount=e.chapterLiked?t-1:t},o[t.RESET_DISPLAY]=function(e){e.reviews=[],e.reviewCount=0,e.likes=[],e.likeCount=0},o[t.LIKE_BOOK]=function(e){var t=p.default.getUser(),n={userVid:t.vid,name:t.name,avatar:t.avatar,isFollowing:!1,isFollower:!1,nick:t.nickname};e.likes.unshift(n),e.likeCount=e.originalLikeCount+1,e.chapterLiked=!0},o[t.UNLIKE_BOOK]=function(e){e.chapterLiked=!1,e.likeCount=e.originalLikeCount,e.likes=e.likes.filter((function(e){return e.userVid!==p.default.getUser().vid}))},o[t.SET_CHAPTER_LIKED]=function(e,t){e.chapterLiked=t},o[t.LIKE_REVIEW]=function(e,t){var n=t.reviewId,r=t.commentId,o=t.isUnlike;e.reviews=e.reviews.map((function(e){if(n&&e.reviewId===n||r&&e.commentId===r){var t=o?0:1;return i({},e,{review:i({},e.review,{isLike:!o}),likesCount:e.originalLikesCount+t})}return e}))},o[t.SEND_REVIEW]=function(e,t){var n=t.reviewId,r=t.commentId,o=t.content,i=p.default.getUser(),a={reviewId:n,commentId:r,review:{content:o,createTime:Math.floor((new Date).getTime()/1e3),isLike:0,userVid:i.vid,author:{userVid:i.vid,name:i.name,avatar:i.avatar,nick:i.nickname}},likesCount:0,originalLikesCount:0,isLike:!1};e.reviews.unshift(a),e.reviewCount+=1},o[t.DELETE_REVIEW]=function(e,t){var n=t.reviewId,r=t.commentId;e.reviews=e.reviews.filter((function(e){var t=n&&e.reviewId===n,o=r&&e.commentId===r;return!t&&!o}))},o[t.SET_PLAY_BACK_RATE]=function(e,t){e.playBackRate=t},o[t.SET_MINI_PLAYER_STATE]=function(e,t){e.showMiniPlayer=t},o[t.SET_PLAYING_CHAPTERS]=function(e,t){e.playingChapters=t},o[t.SET_ERROR_STATE]=function(e,t){e.isError=t},o[t.SET_PAUSE_ON_END]=function(e,t){e.pauseOnEnd=t},o[t.RESET_PAGE_INFO]=function(e){e.bookInfo=T,e.currentLecturer=g,e.lecturers=[],e.chapters=[]},o[t.SET_PROGRESS_RECORD]=function(e,t){e.progressRecord=t},o[t.SET_LISTEN_COUNT]=function(e,t){e.listenCount=t},o);t.store=new f.default.Store({actions:O,getters:{isTrialRead:function(e){return!(!e||!e.bookInfo)&&!e.bookInfo.paid&&e.bookInfo.payType&1<<19},isTrialChapter:function(e){return function(t){var n=e.chapters[t];if(e.bookInfo&&e.bookInfo.maxFreeChapter&&n&&n.chapterUid){var r=n&&0===n.price;return e.bookInfo.maxFreeChapter>=n.chapterUid&&r}return!1}},isTrialPlayingChapter:function(e){return function(t){var n=e.playingChapters[t];if(e.bookInfo&&e.bookInfo.maxFreeChapter&&n&&n.chapterUid){var r=n&&0===n.price;return e.bookInfo.maxFreeChapter>=n.chapterUid&&r}return!1}},currentProgressRecord:function(e){return e.progressRecord&&e.progressRecord.lectureType===e.lectureType?e.progressRecord:null}},mutations:S,plugins:[],state:A})},89:function(e,t,n){n.r(t);var r=n(8),o=n.n(r),i=n(6),a=n.n(i),u=n(48),s=n.n(u),c=n(59),l=n.n(c),f=n(106),d=n.n(f),_=n(2),E=n(3),p={vid:0,pf:0,os:"",wifi:0,gender:0,page:"",appversion:"",from:"",totalTime:0,loadTime:0,renderTime:0,renderError:0,extra:{}},h=d()("#report_manager"),I=["flipCardList","freeLibraryInit","giveOneGetOne","lotteryInfo","infiniteGiftQuery","invitationData"],m=function(){function e(){s()(this,e),this.page=null,this.data=p,this[h]=null}return l()(e,[{key:"init",value:function(e){var t=e.page,n=e.common,r=e.extra,o=e.selector;return t&&t!==this.page&&(this.page=t),this.initReportData(),this.injectCommon(n),this.injectExtra(r),o&&this._initObserver(o),this.data.page=t,this._loadStart=Date.now(),this}},{key:"renderStart",value:function(){return this._loadStart=Date.now(),this}},{key:"loadEnd",value:function(){return this._loadEnd=Date.now(),this}},{key:"_initObserver",value:function(e){var t=this;if(e.length)try{this.observer=wx.createIntersectionObserver().relativeToViewport(),this.observer.observe(e,(function(){var e=Date.now(),n=t._loadStart,r=t._loadEnd;if(n&&r){var o=e-n,i=r-n,a=e-r;if(console.log("performance: performance checker get time: "+o+" = "+i+" + "+a),o>0&&i>0&&a>0&&o<3e4){var u={totalTime:o,loadTime:i,renderTime:a};t.injectCommon(u),t.send()}}}))}catch(e){console.error("performance: report manager init observer error with: "+e)}}},{key:"disconnect",value:function(){try{this.observer&&this.observer.disconnect()}catch(e){}}},{key:"initReportData",value:function(){this.data=p,this._loadStart=0,this._loadEnd=0,this.observer=null}},{key:"injectCommon",value:function(e){return e&&this._isObject(e)&&(this.data=a()({},this.data,e)),this}},{key:"injectExtra",value:function(e){return e&&this._isObject(e)&&(this.data.extra=a()({},this.data.extra,e)),this}},{key:"injectCampaignTime",value:function(e,t){!~I.indexOf(e)||"infiniteGiftQuery"===e&&"infiniteTrial"!==this.data.extra.campaign||"index"!==this.data.page||(this.data.extra.campaignTime=t,this.send())}},{key:"send",value:function(e){e?this._send():this.data.extra.campaign&&"unlock"!==this.data.extra.campaign||!this.data.totalTime?this.data.extra.campaign&&this.data.totalTime&&this.data.extra.campaignTime&&this._send():this._send()}},{key:"_send",value:function(e){var t=this;this.beforeSend(),new o.a((function(e,t){wx.getNetworkType?wx.getNetworkType({success:function(t){var n=t.networkType;e("wifi"===n?1:0)},fail:function(){e(0)}}):e(0)})).then((function(n){var r=a()({},t.data,e,{wifi:n}),o=r.extra||{};_.default.analysisLog("mp_performance_report",a()({},r,o)),t.initReportData()}))}},{key:"beforeSend",value:function(){var e=E.default.getUser(),t=this._formatUserInfo(e);this.data=a()({},this.data,t)}},{key:"_formatUserInfo",value:function(e){return e?{vid:e.vid||0,pf:e.isAndroid?0:1,os:e.OS||"",gender:e.gender||0,appversion:e.appversion||"unknown",wifi:e.wifiEnable||0}:{}}},{key:"_isObject",value:function(e){return!(!e||"[object Object]"!==Object.prototype.toString.call(e))}},{key:"directlyReport",value:function(e){this._send(e)}}],[{key:"instance",get:function(){return this[h]||(this[h]=new e),this[h]}}]),e}();t.default=m},90:function(e,t,n){var r=n(33),o=n.n(r);t.a=function(e,t){var n="",r=0,i=!0,a=!1,u=void 0;try{for(var s,c=o()(e);!(i=(s=c.next()).done);i=!0){var l=s.value;if(l.length>1||null!==l.match(/[\u4e00-\u9fa5]/gi)?r+=2:r++,r>t){n+="...";break}n+=l}}catch(e){a=!0,u=e}finally{try{!i&&c.return&&c.return()}finally{if(a)throw u}}return n}},92:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(15)),i=function(){function e(e,t){this.instance=null,this.instance=wx.createInnerAudioContext(),this.instance.autoplay=!1,this.instance.loop=!!t,this.instance.src="https://weread-1258476243.file.myqcloud.com/miniprogram/battlegame/music/"+e+".mp3",this.instance.volume=0}return e.prototype.play=function(){this.instance.play()},e.prototype.pause=function(){this.instance.pause()},e.prototype.mute=function(){this.instance.volume=0},e.prototype.notMute=function(){this.instance.volume=1},e}(),a=function(){function e(){var e=this;this.audio={battle:null,click:null,failed:null,home:null,match:null,success:null,wrong:null,correct:null},this.current="",this.pageHide=!1,this.audio.battle=new i("battle",!0),this.audio.click=new i("click",!1),this.audio.failed=new i("failed",!1),this.audio.success=new i("success",!1),this.audio.match=new i("match",!1),this.audio.home=new i("home",!0),this.audio.correct=new i("correct",!1),this.audio.wrong=new i("wrong",!1),wx.onAudioInterruptionEnd&&wx.onAudioInterruptionEnd((function(){console.log("wx.onAudioInterruptionEnd"),e.resume()})),this.toggleMute(!1),o.default.getStorage({key:"RACE_GAME_VOICE",success:function(t){t&&t.data&&e.toggleMute(!0)}})}return e.prototype.play=function(e){this.pageHide||(this.pause(),this.current=e,this.audio[e]&&this.audio[e].play())},e.prototype.pause=function(){this.audio[this.current]&&this.audio[this.current].pause()},e.prototype.playOnce=function(e){this.pageHide||this.audio[e]&&this.audio[e].play()},e.prototype.resume=function(){this.pageHide||this.audio[this.current]&&this.audio[this.current].play()},e.prototype.toggleMute=function(e){var t=this,n=Object.keys(this.audio);e?n.forEach((function(e){t.audio[e].notMute()})):n.forEach((function(e){t.audio[e].mute()}))},e.prototype.hide=function(){this.pause(),this.pageHide=!0},e.prototype.show=function(){this.pageHide=!1},e}();t.backgroundAudioManager=new a},95:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.wrappedNodes=function(e,t){var n={attrs:{},children:[],name:"div"};t&&(n.attrs={class:t});var r=e;return"string"==typeof r&&(r=[r]),r.map((function(e){"string"==typeof e?n.children.push({children:[{text:e,type:"text"}],name:"div",type:"node"}):n.children.push(e)})),[n]},function(e){e.NODE="node",e.TEXT="text"}(t.RichTextNodeType||(t.RichTextNodeType={}))},96:function(e,t,n){n.r(t),t.default=function(e,t){var n=e.replace(/[st][0-9]?_(\S+\.\w+)$/,"t"+t+"_$1");return n?n.replace(/^http:/,"https:").replace("wfqqreader.3g.qq.com","static.reader.qq.com"):e}},99:function(e,t,n){n.r(t),n.d(t,"shouldShowInfiniteCard",(function(){return p})),n.d(t,"infiniteShareMessage",(function(){return _})),n.d(t,"trySendGiftToShareFriend",(function(){return E}));var r=n(17),o=n.n(r),i=n(8),a=n.n(i),u=n(0),s=n(49),c=n(3),l=n(2),f=(n(16),n(151)),d=n(35);function _(e){console.log("infiniteShareMessage response:",o()(e));var t={title:c.default.getUser().name+"邀请你来免费阅读好书",path:"/pages/index/main?from=mainShare",imageUrl:"https://rescdn.qqmail.com/weread/cover/reader_share.f443a6025b.png"};return console.log("shareMessage indexPage:",t),t}function E(e){if(console.log("trySendGiftToShareFriend query:",e),c.default.getUser().vid!==+e.fromVid){if((e.signupBenefitId||e.sharegetBenefiId)&&e.userType){var t=e.signupBenefitId||e.sharegetBenefiId,n=e.fromVid||e.shareVid,r=e.userType,o=Object(f.c)(r),i=Object(f.b)(r),a="infiniteTrial"===e.campaign?"app":"";l.default.infiniteCardingSendGift({benefitId:t,counterpartVid:n,userType:r,shareUserType:o,shareSource:i,toPlatform:a}).then((function(e){console.log("[infiniteCardingSendGift] 领取成功",e)})).catch((function(e){console.error("[infiniteCardingSendGift] 领取失败",e)}))}}else console.log("trySendGiftToShareFriend 自己打开的不算")}function p(e){var t=e.isIndexPage,n=void 0!==t&&t,r=e.campaign,o=void 0===r?"":r,i=!1,a=getCurrentPages(),u=c.default.getUser();return n?i=!("infiniteTrial"===o||"infiniteLottery"===o&&u.vid%2==0):(1===a.length||"infiniteTrial"===o||"infiniteLottery"===o&&u.vid%2==0)&&(i=!0),console.log("shouldShowInfiniteCard","campaign",o,"vid",u.vid,"shouldShow",i),i}t.default=function(){return d.store.dispatch(d.INIT,{autoRedeem:!0}).then((function(e){return s.store.dispatch(u.KV_LOG_REPORT,{itemname:"Wp_Infinite_Win_Exp"}),e.redeemedInfiniteDays>0?"SignUpBonus":a.a.reject(new Error("User is ineligible for this campaign."))})).catch((function(e){throw e}))}}}]);