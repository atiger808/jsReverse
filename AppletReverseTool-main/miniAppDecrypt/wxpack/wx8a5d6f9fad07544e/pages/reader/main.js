require("../../common/manifest.js"),require("../../common/vendor.js"),require("../../common/components.js"),require("../../common/apis.js"),require("../../common/others.js"),(global.webpackJsonpMpvue=global.webpackJsonpMpvue||[]).push([["pages/reader/main"],{1055:function(e,t){},1057:function(e,t){},1059:function(e,t){},1061:function(e,t){},1063:function(e,t){},1065:function(e,t){},1067:function(e,t){},1069:function(e,t){},1071:function(e,t){},1073:function(e,t){},1075:function(e,t){},1077:function(e,t){},1079:function(e,t){},1081:function(e,t){},1083:function(e,t){},1085:function(e,t){},1087:function(e,t){},1089:function(e,t){},1091:function(e,t){},1093:function(e,t){},1095:function(e,t){},1097:function(e,t){},544:function(e,t,o){o.r(t);var a=o(5),r=o.n(a),i=o(17),n=o.n(i),s=o(107),c=o.n(s),d=o(4),l=o.n(d),h=o(10),u=o.n(h),p=o(8),_=o.n(p),f=o(6),g=o.n(f),m=o(168),b=o(60),k=o(103),v=o(25),w=o(63),x=o(48),y=o.n(x),C=function e(t,o){y()(this,e),this.fontSize=t,this.lineHeight=o},S=[new C(16,26),new C(17,29),new C(18,32),new C(19,34),new C(20,35),new C(22,40),new C(24,43)],B=S[2],P=function e(t,o){y()(this,e),this.name=t,this.value=o},T=function e(t,o){y()(this,e),this.text=t+"×",this.value=o},I=[new T("0.7",4),new T("1",6),new T("1.3",7),new T("1.6",8),new T("2",9)],R=[new P("男声",3),new P("女声",4)],A=I[1],E=o(15),O=o(89),L=o(167),$=o(0),V=o(35),N=o(3),U=o(2),D=o(9),M=o(152),F=o(99),W=o(33),j=o.n(W),H=o(59),G=o.n(H),q=o(131),K=[".","。","?","？","!","！","…"],z=['"',"”","'","’",")","）"],Y=[",","，",";","；"],Q=[":","；"],Z=['"',"“","'","‘","\\s","、"],X=new RegExp("["+K.join("|")+"]"),J=new RegExp("["+Y.join("|")+"]"),ee=new RegExp("["+Q.join("|")+"]"),te=new RegExp("["+Z.join("|")+"]"),oe=new RegExp("["+Array.prototype.concat([],K,z,Y,Q,Z).join("|")+"]"),ae=new RegExp("^["+Array.prototype.concat([],K,z,Y,Q,Z,["-"]).join("|")+"]+$"),re=new RegExp("^[a-zA-Z0-9\\-]$");function ie(e){return te.test(e)}function ne(e){return re.test(e)}function se(e){return oe.test(e)}function ce(e){return X.test(e)}function de(e){return J.test(e)?1:ee.test(e)?2:te.test(e)?3:0}function le(e,t,o){for(var a=[],r=o;o>=t;){var i=e[o];if(se(i)){var n=de(i);n&&!a[n]&&(a[n]=o)}o-=1}return a[1]?a[1]:a[2]?a[2]:a[3]?a[3]:r-1}function he(e,t,o,a){var r=[],i=0,n=0,s=0,c=0,d=function(e){for(var t=!0,o=!0,a=0;a<=e.length-1;){var r=e[a];ne(r)||se(r)||(t=!1),se(r)||(o=!1),a++}return{allEnglish:t,allMark:o}}(e),l=60;if(d.allEnglish&&(l=180),d.allMark)return r;for(;n<=e.length-1;)if(ce(e[n])){if(s===n){s=n+=1;continue}se(e[n+1])&&!ie(e[n+1])&&(n+=1),r.push({sentenceIndex:i,start:s,end:n+1,fileName:o+"_"+a+"_"+t+"_"+i}),s=n+1,n+=1,i+=1,c=0}else if((c+=1)>=l){var h=le(e,s,n);r.push({sentenceIndex:i,start:s,end:h+1,fileName:o+"_"+a+"_"+t+"_"+i}),s=h+1,n=h+1,i+=1,c=0}else n+=1;return r.push({sentenceIndex:i,start:s,end:e.length,fileName:o+"_"+a+"_"+t+"_"+i}),r.filter((function(t){var o=t.start,a=t.end;return!function(e,t,o){return t===o||(a=e.substring(t,o),ae.test(a));var a}(e,o,a)}))}var ue=function(e,t,o){if(!o||!o.length)return null;var a=[];return o.forEach((function(o,r){var i=he(o.trim(),r,e,t);a.push(i)})),a},pe=new q.a,_e=function(){function e(){y()(this,e),this.errCount=0,this.accessToken="",this.playingChapter=null,this.playingParagrahIndex=null,this.nextChapter={chapter:null,content:null},this.initAudioSetting()}return G()(e,[{key:"initPlayer",value:function(){var e=u()(l.a.mark((function e(t){var o=t.bookTitle,a=t.author,r=t.cover,i=t.playNextCallback,n=t.playPrevCallback,s=t.pauseCallback;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.backgroundAudioManager=wx.getBackgroundAudioManager(),this.backgroundAudioManager.title=o,this.backgroundAudioManager.epname=o,this.backgroundAudioManager.singer=a,this.backgroundAudioManager.coverImgUrl=r,this.backgroundAudioManager.onNext(i),this.backgroundAudioManager.onPrev(n),this.backgroundAudioManager.onPause(s),this.backgroundAudioManager.onStop(s),this.dirPath=wx.env.USER_DATA_PATH+"/ttsCache",e.abrupt("return",pe.createDir(this.dirPath));case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"playFromParagraphIndex",value:function(){var e=u()(l.a.mark((function e(t,o,a,r,i){var n,s,c,d,h=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.playingChapter=o,n=o.bookId,s=o.chapterUid,!(a.length<=t)){e.next=5;break}return console.log("已播完"),e.abrupt("return");case 5:return c=ue(n,s,a),e.next=8,this.getAccessToken();case 8:e.t0=l.a.keys(c);case 9:if((e.t1=e.t0()).done){e.next=15;break}if(!(d=e.t1.value)){e.next=13;break}return e.delegateYield(l.a.mark((function e(){var i,u,p,_,f,g,m,b;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((i=parseInt(d))>t||0===t)){e.next=33;break}u=!0,p=!1,_=void 0,e.prev=5,f=j()(c[i]);case 7:if(u=(g=f.next()).done){e.next=19;break}if(m=g.value,b=a[i].substring(m.start,m.end),r(i,o),h.playingParagrahIndex=i,setTimeout((function(){i<c.length&&h.preLoadAudioFile(i,c,a,n,s)}),200),!(b&&b.length>0)){e.next=16;break}return e.next=16,h.playContent(b,m.fileName,n,s);case 16:u=!0,e.next=7;break;case 19:e.next=25;break;case 21:e.prev=21,e.t0=e.catch(5),p=!0,_=e.t0;case 25:e.prev=25,e.prev=26,!u&&f.return&&f.return();case 28:if(e.prev=28,!p){e.next=31;break}throw _;case 31:return e.finish(28);case 32:return e.finish(25);case 33:c&&c.length-i<4&&h.nextChapter&&h.nextChapter.content&&h.preloadNextChapter();case 34:case"end":return e.stop()}}),e,h,[[5,21,25,33],[26,,28,32]])}))(),"t2",13);case 13:e.next=9;break;case 15:i(o);case 16:case"end":return e.stop()}}),e,this)})));return function(t,o,a,r,i){return e.apply(this,arguments)}}()},{key:"setNextChapter",value:function(e,t){e&&t&&(this.nextChapter={chapter:e,content:t})}},{key:"preloadNextChapter",value:function(){var e=u()(l.a.mark((function e(){var t,o,a,r,i,n,s,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.nextChapter,o=t.chapter,a=t.content,r=o.bookId,i=o.chapterUid,n=ue(r,i,a),e.next=5,this.getAccessToken();case 5:for(s=e.sent,c=0;c<=2;c++)this.preloadParagraph(s,r,a[c],n[c],i);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isPlaying",value:function(){var e=!this.backgroundAudioManager.paused;return console.log("isPlaying :",e),e}},{key:"tryPlayAudio",value:function(e,t,o,a,r){var i=this;return this.playAudio(e).then((function(){i.errCount=0})).catch((function(n){return console.log("playContent error:",n," errCount:",i.errCount),i.handlePlayAudioError(e,t,o,a,r)}))}},{key:"handlePlayAudioError",value:function(e,t,o,a,r){var i=this;return pe.readFile(e).then((function(n){return console.log("read error audio file :",n),pe.removeFile(e).then((function(){return i.retryPlayContent(t,o,a,r)}))}))}},{key:"retryAfterTokenExpired",value:function(e,t,o,a,r){var i=this;return this.updateAccessToken(null),this.getAccessToken().then((function(e){return i.retryPlayContent(t,o,a,r)}))}},{key:"playContent",value:function(){var e=u()(l.a.mark((function e(t,o,a,r){var i,n,s,c=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.errCount>15)){e.next=5;break}return i={errCode:-1,errMsg:"失败太多次了"},console.log("playContent error:",i),this.backgroundAudioManager.stop(),e.abrupt("return",_.a.reject(i));case 5:if(n=this.filePathWithName(o),!pe.isFileExist(n)){e.next=10;break}return console.log("playContent hit cache"),e.abrupt("return",this.tryPlayAudio(n,t,o,a,r));case 10:return console.log("playContent has no cache"),e.next=13,this.getAccessToken();case 13:return s=e.sent,e.abrupt("return",U.default.getWeixinTTSAudio({text:t,accessToken:s,filePath:n,spd:this.spd,per:this.per,bookId:a,chapterUid:r}).then((function(){return c.tryPlayAudio(n,t,o,a,r)})).catch((function(e){return e&&-13===e.errCode&&c.retryAfterTokenExpired(n,t,o,a,r),e&&e.errMsg&&e.errMsg.indexOf("file storage limit is exceeded")?pe.removeDir(c.dirPath,!0).then((function(){return pe.createDir(c.dirPath).then((function(e){return c.handlePlayAudioError(n,t,o,a,r)}))})):c.handlePlayAudioError(n,t,o,a,r)})));case 15:case"end":return e.stop()}}),e,this)})));return function(t,o,a,r){return e.apply(this,arguments)}}()},{key:"preLoadAudioFile",value:function(){var e=u()(l.a.mark((function e(t,o,a,r,i){var n,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t<0||!o||!a||o.length-t<2)){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.getAccessToken();case 4:for(n=e.sent,s=0;s<=2;s++)this.preloadParagraph(n,r,a[t+s],o[t+s],i);case 6:case"end":return e.stop()}}),e,this)})));return function(t,o,a,r,i){return e.apply(this,arguments)}}()},{key:"preloadParagraph",value:function(e,t,o,a,r){if(o&&a&&a.length){var i=!0,n=!1,s=void 0;try{for(var c,d=j()(a);!(i=(c=d.next()).done);i=!0){var l=c.value,h=o.substring(l.start,l.end),u=this.filePathWithName(l.fileName);pe.isFileExist(u)||this.preloadSentence(h,e,u,t,l,r)}}catch(e){n=!0,s=e}finally{try{!i&&d.return&&d.return()}finally{if(n)throw s}}}}},{key:"preloadSentence",value:function(e,t,o,a,r,i){var n=this;U.default.getWeixinTTSAudio({text:e,accessToken:t,filePath:o,spd:this.spd,per:this.per,bookId:a,chapterUid:i}).catch((function(s){pe.removeFile(o),r.retryCount?r.retryCount=1:r.retryCount+=1,r.retryCount<2&&(s&&-13===s.errCode?(n.updateAccessToken(null),n.getAccessToken().then((function(){n.preloadSentence(e,t,o,a,r,i)}))):setTimeout((function(){n.preloadSentence(e,t,o,a,r,i)}),2e3))}))}},{key:"filePathWithName",value:function(e){return wx.env.USER_DATA_PATH+"/ttsCache/v2_"+e+"_"+(this.spd&&this.spd.value?this.spd.value:0)+"_"+this.per+"_"+this.errCount+".mp3"}},{key:"clearDownloadedAudio",value:function(){var e=u()(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,pe.removeDir(this.dirPath,!0);case 2:return e.next=4,pe.createDir(this.dirPath);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"retryPlayContent",value:function(e,t,o,a){return this.errCount++,this.errCount<=1?this.playContent(e,t,o,a):(U.default.reportRealKVLog({key:44175}),_.a.resolve())}},{key:"playAudio",value:function(e,t,o){var a=this;return console.log("playAudio src:",e),e?(this.backgroundAudioManager.src=e,this.backgroundAudioManager.title=this.playingChapter.title||this.title||"第"+this.playingChapter.chapterIdx+"章",new _.a((function(e,t){a.backgroundAudioManager.onError((function(e){console.log("backgroundAudioManager onError:",e),t(e)})),a.backgroundAudioManager.onPlay((function(){console.log("backgroundAudioManager onPlay:",new Date)})),a.backgroundAudioManager.onEnded((function(){console.log("backgroundAudioManager onEnded:",new Date),e()}))}))):_.a.reject({errMsg:"invalid src"})}},{key:"pauseTTS",value:function(){this.backgroundAudioManager&&(this.backgroundAudioManager.pause(),this.savePlayingProgress())}},{key:"stopTTS",value:function(){this.backgroundAudioManager&&(this.backgroundAudioManager.stop(),this.savePlayingProgress())}},{key:"savePlayingProgress",value:function(){if(this.playingChapter&&this.playingChapter.bookId&&this.playingChapter.chapterIdx){var e=this.playingChapter.bookId+"_tts";E.default.setStorage({key:e,data:{chapterIdx:this.playingChapter.chapterIdx,paragraphIndex:this.playingParagrahIndex}})}}},{key:"updateAccessToken",value:function(e){this.accessToken=e,E.default.setStorageSync("ttsToken",{token:e})}},{key:"getAccessToken",value:function(){var e=u()(l.a.mark((function e(){var t,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.accessToken){e.next=2;break}return e.abrupt("return",_.a.resolve(this.accessToken));case 2:if(!(t=E.default.getStorageSync("ttsToken"))||!t.token){e.next=5;break}return e.abrupt("return",_.a.resolve(t.token));case 5:return e.next=7,U.default.getWeixinTTSToken();case 7:return o=e.sent,this.updateAccessToken(o.token),e.abrupt("return",_.a.resolve(o.token));case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"initAudioSetting",value:function(){this.spd=A,this.per=3;var e=E.default.getStorageSync("ttsSetting");if(e){var t=e.spd,o=e.per;this.spd=t,this.per=1===o||3===o?3:4}}},{key:"updateAudioSetting",value:function(e){var t=e.spd,o=e.per,a=E.default.getStorageSync("ttsSetting");a||(a={spd:this.spd,per:this.per}),c()(t)&&(a.spd=t,this.spd=t),c()(o)&&(a.per=o,this.per=o),E.default.setStorageSync("ttsSetting",a)}},{key:"getAudioSetting",value:function(){return{spd:this.spd,per:this.per}}}]),e}(),fe=o(12),ge=o(80),me=o(50),be=o(134),ke=o.n(be),ve=o(37),we=o(24),xe=o(14),ye={name:"Checkbox",props:{customSelector:{type:[Object,String],required:!1,default:""},size:{type:String,validator:function(e){return["mini"].indexOf(e)>-1},default:"mini"},checked:{type:Boolean,default:!1}},computed:{sizeSelector:function(){return"mini"===this.size?"wr_checkbox_Mini":""}},methods:{handleCheckboxClick:function(e){this.$emit("click",e)}}},Ce={components:{Checkbox:o(7)(ye,{render:function(){var e=this.$createElement;return(this._self._c||e)("view",{class:[{wr_checkbox:!0,wr_checkbox_Checked:this.checked},this.sizeSelector,this.customSelector],attrs:{"hover-class":"wr_commonActive",checked:this.checked,eventid:"0_0"},on:{click:this.handleCheckboxClick}})},staticRenderFns:[]},(function(e){o(1059)}),null,null).exports},props:{customSelector:{type:[Object,String],default:""},book:{type:Object,required:!0},chapter:{type:Object,required:!0}},data:function(){return{willAutoPay:!1}},computed:g()({},Object(D.mapState)({accountBalance:function(e){return e.profile.balance},accountPaidBalance:function(e){return e.profile.paidBalance},accountGiftBalance:function(e){return e.profile.giftBalance}}),{formattedBalance:function(){return this.accountBalance?this.accountBalance.toFixed(2):0},formattedPaidBalance:function(){return this.accountPaidBalance?this.accountPaidBalance.toFixed(2):0},formattedGiftBalance:function(){return this.accountGiftBalance?this.accountGiftBalance.toFixed(2):0},needRecharge:function(){var e=this.isPaidBalanceOnly?Number(this.formattedPaidBalance):Number(this.accountBalance);return!(e&&this.book&&this.chapter)||(1&this.book.payType?e<this.book.price:e<this.chapter.price)},isPaidBalanceNeedRecharge:function(){return 1&this.book.payType?Number(this.formattedPaidBalance)<this.book.price:Number(this.formattedPaidBalance)<this.chapter.price},isGiftBalanceNeedRecharge:function(){return 1&this.book.payType?Number(this.formattedGiftBalance)<this.book.price:Number(this.formattedGiftBalance)<this.chapter.price},isPaidBalanceOnly:function(){return 0!=(this.book.payType&1<<21)}}),mounted:function(){this.willAutoPay=this.book.isAutoPay,console.log("[bookChapter] "+n()(this.chapter)),console.log("[isPaidBalanceOnly]:bookType: "+this.book.payType+" isPaidBalanceOnly: "+this.isPaidBalanceOnly)},methods:{buyBook:function(){var e=this;console.log("book: ",this.book),this.$store.dispatch($.KV_LOG_REPORT,{itemname:"Wp_BuyBook_Btn_Confirm"}),U.default.buyBook(this.book.bookId,this.book.price).then((function(t){console.log("buyBook res = ",t),t.succ&&1===t.succ?e.refreshBalanceAfterBuySuccess():(wx.showToast({title:"购买失败，请稍后重试！",icon:"none"}),e.$emit("finish",{succ:0,refresh:!1}))})).catch((function(t){if(console.log("buyBook error = ",t),t&&t.hasOwnProperty("errcode")){var o=t.errcode;-2281===o?(wx.showToast({title:"书籍价格信息变化，请重新购买！",icon:"none"}),e.$emit("finish",{succ:0,refresh:!0})):-2112===o?e.handleRechargeButtonClick():-2202===o?wx.showToast({title:"你已拥有本书！",icon:"none"}):wx.showToast({title:"购买失败，请稍后重试！",icon:"none"}),e.$emit("finish",{succ:0,refresh:!0})}else wx.showToast({title:"购买失败，请稍后重试！",icon:"none"}),e.$emit("finish",{succ:0,refresh:!1})}))},buyChapter:function(){console.log("chapter:",this.chapter);var e=this;this.$store.dispatch($.KV_LOG_REPORT,{itemname:"Wp_BuyChapter_Btn_Confirm"}),U.default.buyChapters(this.chapter.bookId,this.chapter.chapterUid+"",this.chapter.price,this.willAutoPay).then((function(t){console.log("buyChapter res:",t),t.succ&&1===t.succ?(console.log("[buy chapter]: Success and refresh"),e.refreshBalanceAfterBuySuccess()):(wx.showToast({title:"购买失败，请稍后重试！",icon:"none"}),e.$emit("finish",{succ:0,refresh:!1}))})).catch((function(t){if(console.log("buyChapter error:",t),t.hasOwnProperty("errcode")){var o=t.errcode;-2112===o?e.handleRechargeButtonClick():-2228===o||-2202===o?wx.showToast({title:"章节已经购买过，请勿重复购买！",icon:"none"}):-2227===o?wx.showToast({title:"所选章节已经部分购买过，请勿重复购买！",icon:"none"}):-2281===o?wx.showToast({title:"章节价格信息变化，请重新购买！",icon:"none"}):-2204===o?wx.showToast({title:"本书已下架，部分内容不再支持购买！",icon:"none"}):wx.showToast({title:"购买失败，请稍后重试！",icon:"none"}),e.$emit("finish",{succ:0,refresh:!0})}else wx.showToast({title:"购买失败，请稍后重试！",icon:"none"}),e.$emit("finish",{succ:0,refresh:!1})}))},handleRechargeButtonClick:function(){this.$emit("recharge")},handleBuyButtonClick:function(){-1===this.chapter.price||-1!==this.book.price?this.buyBook():this.buyChapter()},handleAutoBuyCheckboxClick:function(){this.willAutoPay=!this.willAutoPay},refreshBalanceAfterBuySuccess:function(){wx.showToast({title:"购买成功！",icon:"success"}),this.$store.dispatch($.PAY_BALANCE).then((function(e){console.log("res PAY_BALANCE:",e)})).catch((function(e){console.log("error PAY_BALANCE:",e)})),this.$emit("finish",{succ:1,refresh:!0})}}},Se=o(7)(Ce,{render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("view",{staticClass:"wr_buyBook"},[-1===e.chapter.price||-1!==e.book.price?o("view",[o("view",{staticClass:"wr_buyBook_money"},[e._v(e._s(e.book.price))]),e._v(" "),o("view",{class:["wr_buyBook_balance",{wr_buyBook_balance_NotEnough:e.needRecharge,wr_buyBook_balance_paid_only:e.isPaidBalanceOnly}]},[e._v("充值币 "+e._s(e.formattedPaidBalance)),o("text",{class:{wr_buyBook_balance_NotEnough_reset:e.isPaidBalanceOnly&&!e.isGiftBalanceNeedRecharge}},[e._v(" | 赠币 "+e._s(e.formattedGiftBalance))])]),e._v(" "),e.isPaidBalanceOnly?o("view",{class:["wr_buyBook_balance"]},[e._v("本书仅支持充值币购买")]):e._e(),e._v(" "),o("view",{staticClass:"wr_buyBook_info"},[o("view",{staticClass:"wr_buyBook_info_title"},[e._v("书籍")]),e._v(" "),o("view",{staticClass:"wr_buyBook_info_detail"},[e._v(e._s(e.book.title))])]),e._v(" "),o("view",{staticClass:"wr_buyBook_info"},[o("view",{staticClass:"wr_buyBook_info_title"},[e._v("作者")]),e._v(" "),o("view",{staticClass:"wr_buyBook_info_detail"},[e._v(e._s(e.book.author))])])]):o("view",[o("view",{staticClass:"wr_buyBook_money"},[e._v(e._s(e.chapter.price))]),e._v(" "),o("view",{class:["wr_buyBook_balance",{wr_buyBook_balance_NotEnough:e.needRecharge,wr_buyBook_balance_paid_only:e.isPaidBalanceOnly}]},[e._v("充值币 "+e._s(e.formattedPaidBalance)),o("text",{class:{wr_buyBook_balance_NotEnough_reset:e.isPaidBalanceOnly&&!e.isGiftBalanceNeedRecharge}},[e._v(" | 赠币 "+e._s(e.formattedGiftBalance))])]),e._v(" "),e.isPaidBalanceOnly?o("view",{class:["wr_buyBook_balance"]},[e._v("本书仅支持充值币购买")]):e._e(),e._v(" "),o("view",{staticClass:"wr_buyBook_info"},[o("view",{staticClass:"wr_buyBook_info_title"},[e._v("章节")]),e._v(" "),o("view",{staticClass:"wr_buyBook_info_detail"},[e._v(e._s(e.book.title)+" 第"+e._s(e.chapter.chapterIdx)+"章")])]),e._v(" "),o("view",{staticClass:"wr_buyBook_info"},[o("view",{staticClass:"wr_buyBook_info_title"},[e._v("作者")]),e._v(" "),o("view",{staticClass:"wr_buyBook_info_detail"},[e._v(e._s(e.book.author))])]),e._v(" "),o("view",{staticClass:"wr_buyBook_autoBuyChapter",attrs:{"hover-class":"wr_commonActive",eventid:"2_0"},on:{click:function(t){t.stopPropagation(),e.handleAutoBuyCheckboxClick(t)}}},[o("checkbox",{attrs:{checked:e.willAutoPay}}),e._v(" "),o("view",{staticClass:"wr_buyBook_autoBuyChapter_title"},[e._v("自动购买后续章节")])],1)]),e._v(" "),e.needRecharge?o("view",{staticClass:"wr_bottomEntry wr_buyBook_action"},[o("view",{staticClass:"wr_bottomEntry_link wr_bottomEntry_link_Blue",attrs:{title:"充值","hover-class":"wr_commonActive",eventid:"2_1"},on:{click:function(t){t.stopPropagation(),e.handleRechargeButtonClick(t)}}},[e._v("\n            充 值\n        ")])]):o("view",{staticClass:"wr_bottomEntry wr_buyBook_action"},[o("view",{staticClass:"wr_bottomEntry_link wr_bottomEntry_link_Blue",attrs:{title:"购 买","hover-class":"wr_commonActive",eventid:"2_2"},on:{click:function(t){t.stopPropagation(),e.handleBuyButtonClick(t)}}},[e._v("\n            购 买\n        ")])])])},staticRenderFns:[]},(function(e){o(1057)}),null,null).exports,Be=o(52),Pe=o(73),Te=function(e,t){if(e&&e.maxFreeChapter&&t&&t.chapterUid){var o=t&&0===t.price;return e.maxFreeChapter>=t.chapterUid&&o}return!1},Ie={components:{Loader:Be.default,Mask:Pe.a},props:{book:{type:Object,required:!0},reader:{type:Object,required:!0},firstChapter:{type:Object,required:!0},shouldShow:{type:Boolean},isAllCatalog:{type:Boolean,default:!1}},data:function(){return{shouldShowTopLoading:!1,shouldShowBottomLoading:!1}},computed:{catalog:function(){var e=this;return this.reader&&this.reader.catalog?this.reader.catalog.map((function(t){return t.selector=["reader_catalog_link"],t.level&&t.selector.push("reader_catalog_link_Level"+t.level),e.isTrialRead&&(t.disabled=!Te(e.book,t)),t})):[]},formattedUpdateTime:function(){return this.book?Object(b.default)(this.book.updateTime):""},hasPreCatalogChapter:function(){return!!(this.reader&&this.book&&this.book.bookId)&&this.$store.getters.hasPreCatalogChapter(this.book.bookId)},hasNextCatalogChapter:function(){return!!(this.reader&&this.book&&this.book.bookId)&&this.$store.getters.hasNextCatalogChapter(this.book.bookId)},isTrialRead:function(){return this.book&&!this.book.paid&&this.book.payType&1<<19}},methods:{show:function(e){this.isAllCatalog||this.$emit("loadCatalog",this.book),this.$refs.catalogMask.showMask(),e&&e()},hide:function(){this.$refs.catalogMask&&this.$refs.catalogMask.closeMask()},emitHide:function(){this.$emit("hide")},emitShowChapter:function(e){this.$emit("showChapter",{chapter:e})},emitCancelAutoPay:function(){this.$emit("cancelAutoPay")},emitCatalogSort:function(){this.$emit("sort")},handleCatalogScrollToUpper:function(){var e=this;this.hasPreCatalogChapter||(this.shouldShowTopLoading=!0,setTimeout((function(){e.$store.dispatch($.LOAD_CATALOG_PRE,{bookId:e.book.bookId}).then((function(){e.shouldShowTopLoading=!1})).catch((function(){e.shouldShowTopLoading=!1}))}),250))},handleCatalogScrollToLower:function(){var e=this;this.hasNextCatalogChapter||(this.shouldShowBottomLoading=!0,setTimeout((function(){e.$store.dispatch($.LOAD_CATALOG_NEXT,{bookId:e.book.bookId}).then((function(){e.shouldShowBottomLoading=!1})).catch((function(){e.shouldShowBottomLoading=!1}))}),250))}}},Re=o(7)(Ie,{render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("view",[o("Mask",{ref:"catalogMask",attrs:{"custom-selector":"reader_catalogMask",eventid:"1_0",mpcomid:"0"},on:{click:e.emitHide}}),e._v(" "),o("view",{class:[{reader_catalog:!0,reader_catalog_Show:e.shouldShow}]},[o("view",{staticClass:"reader_catalog_head",attrs:{eventid:"2_4"},on:{touchstart:function(e){e.stopPropagation()},touchmove:function(e){e.stopPropagation()},touchend:function(e){e.stopPropagation()}}},[o("view",{staticClass:"reader_catalog_head_top"},[o("view",{staticClass:"reader_catalog_head_top_title",attrs:{"hover-class":"wr_commonActive",eventid:"4_1"},on:{touchend:function(t){e.emitShowChapter(e.firstChapter)}}},[o("view",{staticClass:"reader_catalog_head_top_title_text"},[e._v(e._s(e.book.title))]),e._v(" "),o("view",{staticClass:"reader_catalog_head_top_title_arrow"})]),e._v(" "),2===e.book.bookStatus&&0===e.book.finished?o("view",{staticClass:"reader_catalog_head_top_desc"},[e._v("更新于"+e._s(e.formattedUpdateTime))]):2===e.book.bookStatus?o("view",{staticClass:"reader_catalog_head_top_desc"},[e._v("已完结")]):e._e()]),e._v(" "),o("view",{staticClass:"reader_catalog_head_bottom"},[o("view",{staticClass:"reader_catalog_head_author"},[e._v(e._s(e.book.author))]),e._v(" "),2===e.book.bookStatus&&e.book.isAutoPay?o("view",{staticClass:"reader_catalog_head_cancelAutoPayButton",attrs:{"hover-class":"wr_commonActive","aria-role":"button",eventid:"4_2"},on:{touchend:function(t){t.stopPropagation(),e.emitCancelAutoPay(t)}}},[o("text",{staticClass:"reader_catalog_head_cancelAutoPayButton_icon"}),e._v(" "),o("text",{staticClass:"reader_catalog_head_cancelAutoPayButton_text"},[e._v("自动购买")])]):e._e(),e._v(" "),2&e.book.payType?o("view",{staticClass:"reader_catalog_head_sort",attrs:{"hover-class":"wr_commonActive","aria-role":"button",eventid:"4_3"},on:{touchend:function(t){t.stopPropagation(),e.emitCatalogSort(t)}}},[o("view",{class:[{reader_catalog_head_sort_icon:!0,reader_catalog_head_sort_icon_Positive:e.reader.isDescend}]}),e._v(" "),e.reader.isDescend?o("text",{staticClass:"reader_catalog_head_sort_text"},[e._v("正序")]):o("text",{staticClass:"reader_catalog_head_sort_text"},[e._v("倒序")])]):e._e()])]),e._v(" "),o("scroll-view",{staticClass:"reader_catalog_list",attrs:{"scroll-y":"true","upper-threshold":"100","lower-threshold":"100",eventid:"2_6"},on:{scrolltoupper:e.handleCatalogScrollToUpper,scrolltolower:e.handleCatalogScrollToLower}},[e.shouldShowTopLoading?o("view",{key:"catalog_item_spinner_wrap_top",staticClass:"reader_catalog_item"},[o("loader",{key:"catalogSpinnerTop",attrs:{"is-loading":"true",mpcomid:"1"}})],1):e._e(),e._v(" "),e._l(e.catalog,(function(t,a){return o("view",{key:a,class:[{reader_catalog_item:!0,reader_catalog_item_Current:t.chapterUid===e.reader.chapter.chapterUid,reader_catalog_item_Disabled:t.disabled}],attrs:{id:"catalog_item_"+t.chapterUid}},[o("view",{class:t.selector,attrs:{"hover-class":"wr_itemActive",eventid:"4_5_"+a},on:{click:function(o){o.stopPropagation(),e.emitShowChapter(t)}}},["epub"!==e.book.format?o("view",{staticClass:"reader_catalog_item_text"},[e._v("\n                        第"+e._s(t.chapterIdx)+"章 "+e._s(t.title)+"\n                    ")]):o("view",{staticClass:"reader_catalog_item_text"},[e._v(e._s(t.title))])])])})),e._v(" "),e.shouldShowBottomLoading?o("view",{key:"catalog_item_spinner_wrap_bottom",staticClass:"reader_catalog_item"},[o("loader",{key:"catalogSpinnerBottom",attrs:{"is-loading":"true",mpcomid:"2"}})],1):e._e()],2)],1)],1)},staticRenderFns:[]},(function(e){o(1061)}),null,null).exports,Ae=o(22),Ee=o(173),Oe=o(232),Le=o(18),$e=o(54),Ve=o(104),Ne={components:{Mask:Pe.a},extends:Ve.a,props:{bookId:{type:String,required:!0},title:{type:String,required:!0},content:{type:String,required:!0}},data:function(){return{tapCount:0}},methods:{showBookIdIfNeeded:function(){this.tapCount++,this.tapCount>=5&&(wx.showModal({content:this.bookId,showCancel:!1,confirmText:"我知道了"}),this.tapCount=0)}}},Ue=o(7)(Ne,{render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("view",{class:[e.customSelector]},[o("Mask",{ref:"mask",attrs:{"needs-close-button":"true",eventid:"1_0",mpcomid:"0"},on:{click:e.closeModal}}),e._v(" "),o("view",{class:[{wr_modal:!0,wr_modal_ForBtn:!0,wr_modal_Show:e.showing,wr_modal_Hide:e.hiding,wr_introModal:!0},e.animationSelector],attrs:{eventid:"1_2"},on:{click:function(e){e.stopPropagation()},animationend:e.handleAnimationEnd}},[o("view",{staticClass:"wr_introModal_cnt"},[o("view",{staticClass:"wr_introModal_title",attrs:{eventid:"3_1"},on:{tap:e.showBookIdIfNeeded}},[e._v("\n                "+e._s(e.title)+"\n            ")]),e._v(" "),e.content?o("scroll-view",{staticClass:"wr_introModal_text",attrs:{"scroll-y":"true"}},[o("view",{staticClass:"wr_introModal_text_value"},[e._v(e._s(e.content))])]):e._e()],1)])],1)},staticRenderFns:[]},(function(e){o(1063)}),null,null).exports,De=o(21),Me=o(233),Fe=o(129),We=o(126),je=o(149),He=o(127),Ge=o.n(He),qe=o(79),Ke={components:{BookCover:xe.default},props:{similarBook:{type:Object,required:!0}},computed:{displaySimilarBook:function(){return this.similarBook&&this.similarBook.books&&this.similarBook.books.length?{hasMore:this.similarBook.hasMore,books:this.similarBook.books.slice(0,4)}:{hasMore:!1,books:[]}}},methods:{handleShuffle:function(){this.$emit("shuffle")},openReader:function(e){var t="/pages/reader/main?bookId="+e,o=getCurrentPages();o&&o.length<10?wx.navigateTo({url:t}):(console.log("openReader over max hierarchy redirectTo"),wx.redirectTo({url:t}))}}},ze=o(7)(Ke,{render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return e.similarBook.books.length>0?o("view",{staticClass:"reader_book_recommend"},[o("view",{staticClass:"reader_book_recommend_header"},[e._v("书籍推荐")]),e._v(" "),o("view",{class:["reader_book_recommend_item_container",{reader_book_recommend_item_container_AlignLeft:e.displaySimilarBook.books.length<4}]},e._l(e.displaySimilarBook.books,(function(t,a){return o("view",{key:a,staticClass:"reader_book_recommend_item",attrs:{"hover-class":"wr_commonActive",eventid:"2_0_"+a},on:{click:function(o){o.stopPropagation(),e.openReader(t.bookId)}}},[o("book-cover",{attrs:{src:t.cover,alt:t.title,width:72,mpcomid:"0_"+a}}),e._v(" "),o("view",{staticClass:"reader_book_recommend_item_title"},[e._v(e._s(t.title))])],1)}))),e._v(" "),e.displaySimilarBook.hasMore?o("view",{staticClass:"reader_book_recommend_btn",attrs:{"hover-class":"wr_commonActive",eventid:"1_1"},on:{click:function(t){t.stopPropagation(),e.handleShuffle(t)}}},[e._v("\n        换一批\n    ")]):e._e()]):e._e()},staticRenderFns:[]},(function(e){o(1065)}),"data-v-482d84b1",null).exports,Ye=o(177),Qe={props:{label:{type:String,required:!0},percent:{type:Number,required:!0,default:0},customSelector:{type:[Object,String],default:""}}},Ze={components:{BookRatingItemBar:o(7)(Qe,{render:function(){var e=this.$createElement,t=this._self._c||e;return t("view",{class:["book_rating_item_bar",this.customSelector]},[t("view",[this._v(this._s(this.label))]),this._v(" "),t("view",{staticClass:"book_rating_item_bar_background"},[t("view",{staticClass:"book_rating_item_bar_content",style:{width:this.percent+"%"}})])])},staticRenderFns:[]},(function(e){o(1071)}),null,null).exports,BookRatingItemLabel:o(68).default},props:{title:{type:String,required:!0},newRating:{type:String,required:!0},newRatingCount:{type:Number,required:!0},newRatingDetail:{type:Object,required:!0}},computed:{newRatingCountNumber:function(){return this.newRatingDetail?this.newRatingCount>9999?Math.round(this.newRatingCount/1e3)/10:this.newRatingCount:0}},methods:{getNewRatingPercent:function(e){if(this.newRatingCount&&this.newRatingDetail[e]){var t=this.newRatingDetail[e];return this.newRatingCount>0?Math.round(100*t/this.newRatingCount):0}return 0},emitOnClick:function(e){this.$emit("click",e)}}},Xe=o(7)(Ze,{render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return e.newRatingDetail?o("view",{staticClass:"book_rating_item_container",attrs:{"hover-class":"wr_commonActive","aria-label":"button",eventid:"0_0"},on:{click:function(t){t.stopPropagation(),e.emitOnClick(t)}}},[o("view",{staticClass:"book_rating_item_detail"},[o("book-rating-item-label",{attrs:{title:e.title,rating:e.newRating,mpcomid:"0"}}),e._v(" "),e.newRatingCount?o("view",{staticClass:"book_rating_item_detail_count"},[o("text",[e._v(e._s(e.newRatingCountNumber)+e._s(e.newRatingCount>9999?"万":"")+"人点评")]),e._v(" "),o("view",{staticClass:"book_rating_item_detail_count_icon"})]):e._e()],1),e._v(" "),o("view",{staticClass:"book_rating_item_bar_container"},[o("BookRatingItemBar",{attrs:{label:"好看",percent:e.getNewRatingPercent("good"),mpcomid:"1"}}),e._v(" "),o("BookRatingItemBar",{attrs:{label:"一般",percent:e.getNewRatingPercent("fair"),"custom-selector":"book_rating_item_bar_margin",mpcomid:"2"}}),e._v(" "),o("BookRatingItemBar",{attrs:{label:"不行",percent:e.getNewRatingPercent("poor"),mpcomid:"3"}})],1)]):e._e()},staticRenderFns:[]},(function(e){o(1069)}),null,null).exports,Je={components:{Alert:ve.default},props:{customSelector:{type:String,default:""}},methods:{closeAlertCallback:function(){return""},show:function(){this.$refs.alert.showModal()}}},et=o(7)(Je,{render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("Alert",{ref:"alert",attrs:{"custom-selector":["book_ratings_modal_container",e.customSelector],"needs-close-button":!0,"show-animation":!1,"close-alert-callback":e.closeAlertCallback,"content-needs-scroll":!1,mpcomid:"0"}},[o("view",{staticClass:"book_ratings_modal"},[o("text",{staticClass:"book_ratings_modal_header"},[e._v("推荐值"),o("text",[e._v(" = ")]),e._v("好看数"),o("text",[e._v(" / ")]),e._v("总点评数")]),e._v(" "),o("text",{staticClass:"book_ratings_modal_intro"},[e._v("点评人数超过"),o("text",[e._v("20")]),e._v("人时，显示推荐值")]),e._v(" "),o("text",{staticClass:"book_ratings_modal_intro"},[e._v("点评人数超过"),o("text",[e._v("100")]),e._v("人时，将根据推荐值大小显示对应评语")]),e._v(" "),o("view",{staticClass:"book_ratings_modal_bar"})])])},staticRenderFns:[]},(function(e){o(1073)}),null,null).exports,tt={components:{BookRatingsButton:Ye.a,BookRatingItem:Xe,BookRatingsModal:et},props:{bookInfo:{type:Object,required:!0},showRatingsTag:{type:Boolean,default:!1},isImportedBook:{type:Boolean,default:!1},customSelector:{type:[Object,String],default:""},isWithoutButton:{type:Boolean,default:!1}},data:function(){return{localSelectedGrade:""}},computed:{shouldShowBookRatings:function(){return!this.isImportedBook&&this.bookInfo.hasOwnProperty("newRating")&&this.bookInfo.hasOwnProperty("newRatingDetail")},newRating:function(){return 0!==this.bookInfo.newRating?(this.bookInfo.newRating/10).toFixed(1):0},newRatingDetail:function(){return this.bookInfo&&this.bookInfo.newRatingDetail?this.bookInfo.newRatingDetail:{}},newRatingCount:function(){return this.bookInfo&&this.bookInfo.newRatingCount?this.bookInfo.newRatingCount:0},myRating:function(){return this.newRatingDetail&&this.newRatingDetail.myRating?this.newRatingDetail.myRating:""},title:function(){return this.newRatingDetail&&this.newRatingDetail.title?this.newRatingDetail.title:""},shouldShowNewRating:function(){return this.title&&0!==this.newRating},ratingsButtonStatus:function(){return this.$store.state.ratingsButtonStatus}},mounted:function(){this.initRatingsButtonStatus()},onShow:function(){this.refreshRatingsButtonStatus()},methods:{refreshRatingsButtonStatus:function(){this.localSelectedGrade=this.ratingsButtonStatus},initRatingsButtonStatus:function(){this.$store.commit($.STORE_RATINGS_BUTTON_STATUS,{grade:this.myRating}),this.localSelectedGrade=this.ratingsButtonStatus},didRateButtonClick:function(e){var t=e.grade;this.localSelectedGrade=t,this.rateBook(t)},openBookReviews:function(){this.$store.dispatch($.KV_LOG_REPORT,{itemname:"Wp_Reader_MoreReview_Clk"}),wx.navigateTo({url:"/pages/bookReviews/main?bookId="+this.bookInfo.bookId})},showRatingsModal:function(){this.$refs.bookRatingsModal.show()},rateBook:function(e){this.$store.dispatch($.KV_LOG_REPORT,{itemname:"Wp_Reader_BookReview_Clk"}),wx.navigateTo({url:"/pages/rateBook/main?bookId="+this.bookInfo.bookId+"&grade="+e})}}},ot=o(7)(tt,{render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return e.shouldShowBookRatings?o("view",{class:["book_ratings_container",{book_ratings_container_WithoutButton:e.isWithoutButton},e.customSelector]},[o("view",{staticClass:"book_ratings_header",attrs:{"hover-class":"wr_commonActive","aria-label":"button",eventid:"1_0"},on:{click:function(t){t.stopPropagation(),e.showRatingsModal(t)}}},[e._v("\n        微信读书推荐值\n        "),e.shouldShowNewRating?o("view",{staticClass:"book_ratings_header_number"},[o("text",[e._v(e._s(e.newRating)),o("text",{staticClass:"book_ratings_header_number_suffix"},[e._v("%")])])]):e._e()]),e._v(" "),o("book-rating-item",{attrs:{title:e.title,"new-rating":e.newRating,"new-rating-count":e.newRatingCount,"new-rating-detail":e.newRatingDetail,eventid:"1_1",mpcomid:"0"},on:{click:e.openBookReviews}}),e._v(" "),e.showRatingsTag?o("view",{staticClass:"book_ratings_tag_container"},[o("view",{staticClass:"book_ratings_tag_item",attrs:{"hover-class":"wr_commonActive","aria-label":"点评分类标签"}},[e._v("\n            全部\n        ")])]):e._e(),e._v(" "),e.newRatingDetail?o("book-ratings-button",{attrs:{selected:e.localSelectedGrade,eventid:"1_2",mpcomid:"1"},on:{rateButtonClick:e.didRateButtonClick}}):e._e(),e._v(" "),o("book-ratings-modal",{ref:"bookRatingsModal",attrs:{mpcomid:"2"}})],1):e._e()},staticRenderFns:[]},(function(e){o(1067)}),null,null).exports,at=o(230),rt={props:{customSelector:{type:[Object,String],default:""},unitId:{type:String,required:!0}},data:function(){return{isAdLoaded:!1}},mounted:function(){this.prepareForAd()},methods:{prepareForAd:function(){Object(w.default)(N.default.getUser().SDKVersion,"1.9.97")>=0&&(this.isAdLoaded=!0)},handleAdError:function(e){this.isAdLoaded=!1,console.log("[Ad] error",e.mp.detail)},handleAdClose:function(){this.isAdLoaded=!1,console.log("[Ad] close")}}},it=o(7)(rt,{render:function(){var e=this.$createElement,t=this._self._c||e;return this.isAdLoaded&&this.unitId?t("view",{class:["wr_reader_custom_ad",this.customSelector]},[t("ad-custom",{style:{borderRadius:8,overflow:"hidden"},attrs:{"unit-id":this.unitId,eventid:"1_0",mpcomid:"0"},on:{error:this.handleAdError,close:this.handleAdClose}})],1):this._e()},staticRenderFns:[]},(function(e){o(1075)}),null,null).exports,nt=o(27),st=o.n(nt),ct=o(65),dt=o.n(ct),lt=function(e){return function(e){return(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/&OElig;/g,"Œ")).replace(/&oelig;/g,"œ")).replace(/&Scaron;/g,"Š")).replace(/&scaron;/g,"š")).replace(/&Yuml;/g,"Ÿ")).replace(/&fnof;/g,"ƒ")).replace(/&circ;/g,"ˆ")).replace(/&tilde;/g,"˜")).replace(/&ensp;/g,"")).replace(/&emsp;/g,"")).replace(/&thinsp;/g,"")).replace(/&zwnj;/g,"")).replace(/&zwj;/g,"")).replace(/&lrm;/g,"")).replace(/&rlm;/g,"")).replace(/&ndash;/g,"–")).replace(/&mdash;/g,"—")).replace(/&lsquo;/g,"‘")).replace(/&rsquo;/g,"’")).replace(/&sbquo;/g,"‚")).replace(/&ldquo;/g,"“")).replace(/&rdquo;/g,"”")).replace(/&bdquo;/g,"„")).replace(/&dagger;/g,"†")).replace(/&Dagger;/g,"‡")).replace(/&bull;/g,"•")).replace(/&hellip;/g,"…")).replace(/&permil;/g,"‰")).replace(/&prime;/g,"′")).replace(/&Prime;/g,"″")).replace(/&lsaquo;/g,"‹")).replace(/&rsaquo;/g,"›")).replace(/&oline;/g,"‾")).replace(/&euro;/g,"€")).replace(/&trade;/g,"™")).replace(/&larr;/g,"←")).replace(/&uarr;/g,"↑")).replace(/&rarr;/g,"→")).replace(/&darr;/g,"↓")).replace(/&harr;/g,"↔")).replace(/&crarr;/g,"↵")).replace(/&lceil;/g,"⌈")).replace(/&rceil;/g,"⌉")).replace(/&lfloor;/g,"⌊")).replace(/&rfloor;/g,"⌋")).replace(/&loz;/g,"◊")).replace(/&spades;/g,"♠")).replace(/&clubs;/g,"♣")).replace(/&hearts;/g,"♥")).replace(/&diams;/g,"♦")).replace(/&#39;/g,"'")}(e=function(e){return(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/&Alpha;/g,"Α")).replace(/&Beta;/g,"Β")).replace(/&Gamma;/g,"Γ")).replace(/&Delta;/g,"Δ")).replace(/&Epsilon;/g,"Ε")).replace(/&Zeta;/g,"Ζ")).replace(/&Eta;/g,"Η")).replace(/&Theta;/g,"Θ")).replace(/&Iota;/g,"Ι")).replace(/&Kappa;/g,"Κ")).replace(/&Lambda;/g,"Λ")).replace(/&Mu;/g,"Μ")).replace(/&Nu;/g,"Ν")).replace(/&Xi;/g,"Ν")).replace(/&Omicron;/g,"Ο")).replace(/&Pi;/g,"Π")).replace(/&Rho;/g,"Ρ")).replace(/&Sigma;/g,"Σ")).replace(/&Tau;/g,"Τ")).replace(/&Upsilon;/g,"Υ")).replace(/&Phi;/g,"Φ")).replace(/&Chi;/g,"Χ")).replace(/&Psi;/g,"Ψ")).replace(/&Omega;/g,"Ω")).replace(/&alpha;/g,"α")).replace(/&beta;/g,"β")).replace(/&gamma;/g,"γ")).replace(/&delta;/g,"δ")).replace(/&epsilon;/g,"ε")).replace(/&zeta;/g,"ζ")).replace(/&eta;/g,"η")).replace(/&theta;/g,"θ")).replace(/&iota;/g,"ι")).replace(/&kappa;/g,"κ")).replace(/&lambda;/g,"λ")).replace(/&mu;/g,"μ")).replace(/&nu;/g,"ν")).replace(/&xi;/g,"ξ")).replace(/&omicron;/g,"ο")).replace(/&pi;/g,"π")).replace(/&rho;/g,"ρ")).replace(/&sigmaf;/g,"ς")).replace(/&sigma;/g,"σ")).replace(/&tau;/g,"τ")).replace(/&upsilon;/g,"υ")).replace(/&phi;/g,"φ")).replace(/&chi;/g,"χ")).replace(/&psi;/g,"ψ")).replace(/&omega;/g,"ω")).replace(/&thetasym;/g,"ϑ")).replace(/&upsih;/g,"ϒ")).replace(/&piv;/g,"ϖ")).replace(/&middot;/g,"·")}(e=function(e){return(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/&forall;/g,"∀")).replace(/&part;/g,"∂")).replace(/&exist;/g,"∃")).replace(/&empty;/g,"∅")).replace(/&nabla;/g,"∇")).replace(/&isin;/g,"∈")).replace(/&notin;/g,"∉")).replace(/&ni;/g,"∋")).replace(/&prod;/g,"∏")).replace(/&sum;/g,"∑")).replace(/&minus;/g,"−")).replace(/&lowast;/g,"∗")).replace(/&radic;/g,"√")).replace(/&prop;/g,"∝")).replace(/&infin;/g,"∞")).replace(/&ang;/g,"∠")).replace(/&and;/g,"∧")).replace(/&or;/g,"∨")).replace(/&cap;/g,"∩")).replace(/&cup;/g,"∪")).replace(/&int;/g,"∫")).replace(/&there4;/g,"∴")).replace(/&sim;/g,"∼")).replace(/&cong;/g,"≅")).replace(/&asymp;/g,"≈")).replace(/&ne;/g,"≠")).replace(/&le;/g,"≤")).replace(/&ge;/g,"≥")).replace(/&sub;/g,"⊂")).replace(/&sup;/g,"⊃")).replace(/&nsub;/g,"⊄")).replace(/&sube;/g,"⊆")).replace(/&supe;/g,"⊇")).replace(/&oplus;/g,"⊕")).replace(/&otimes;/g,"⊗")).replace(/&perp;/g,"⊥")).replace(/&sdot;/g,"⋅")}(e)))},ht=function(e,t){return/^\/\//.test(e)?"https:"+e:/^\//.test(e)?"https://"+t+e:e},ut=function(e){return(e=(e=(e=(e=(e=(e=(e=e.replace(/&nbsp;/g," ")).replace(/&ensp;/g," ")).replace(/&emsp;/g,"　")).replace(/&quot;/g,"'")).replace(/&amp;/g,"&")).replace(/&lt;/g,"<")).replace(/&gt;/g,">")).replace(/&#8226;/g,"•")},pt=/^<([-A-Za-z0-9_]+)((?:\s+[a-zA-Z0-9_:][-a-zA-Z0-9_:.]*(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)>/,_t=/^<\/([-A-Za-z0-9_]+)[^>]*>/,ft=/([a-zA-Z0-9_:][-a-zA-Z0-9_:.]*)(?:\s*=\s*(?:(?:"((?:\\.|[^"])*)")|(?:'((?:\\.|[^'])*)')|([^>\s]+)))?/g;function gt(e){for(var t={},o=e.split(","),a=0;a<o.length;a+=1)t[o[a]]=!0;return t}var mt=gt("area,base,basefont,br,col,frame,hr,img,input,link,meta,param,embed,command,keygen,source,track,wbr"),bt=gt("address,code,article,applet,aside,audio,blockquote,button,canvas,center,dd,del,dir,div,dl,dt,fieldset,figcaption,figure,footer,form,frameset,h1,h2,h3,h4,h5,h6,header,hgroup,hr,iframe,ins,isindex,li,map,menu,noframes,noscript,object,ol,output,p,pre,section,script,table,tbody,td,tfoot,th,thead,tr,ul,video"),kt=gt("a,abbr,acronym,applet,b,basefont,bdo,big,br,button,cite,del,dfn,em,font,i,iframe,img,input,ins,kbd,label,map,object,q,s,samp,script,select,small,span,strike,strong,sub,sup,textarea,tt,u,var"),vt=gt("colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr"),wt=gt("checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected");function xt(e){for(var t={},o=e.split(","),a=0;a<o.length;a+=1)t[o[a]]=!0;return t}var yt=xt("br,code,address,article,applet,aside,audio,blockquote,button,canvas,center,dd,del,dir,div,dl,dt,fieldset,figcaption,figure,footer,form,frameset,h1,h2,h3,h4,h5,h6,header,hgroup,hr,iframe,ins,isindex,li,map,menu,noframes,noscript,object,ol,output,p,pre,section,script,table,tbody,td,tfoot,th,thead,tr,ul,video"),Ct=xt("a,abbr,acronym,applet,b,basefont,bdo,big,button,cite,del,dfn,em,font,i,iframe,img,input,ins,kbd,label,map,object,q,s,samp,script,select,small,span,strike,strong,sub,sup,textarea,tt,u,var"),St=xt("colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr"),Bt=function(e,t,o,a){e=function(e){return e.replace(/<!--.*?-->/gi,"").replace(/\/\*.*?\*\//gi,"").replace(/[ ]+</gi,"<").replace(/<script[^]*<\/script>/gi,"").replace(/<style[^]*<\/style>/gi,"")}(e=function(e){return/<body.*>([^]*)<\/body>/.test(e)?RegExp.$1:e}(e)),e=lt(e);var r,i=[],n={nodes:[],imageUrls:[]};function s(e){this.node="element",this.tag=e}return s.prototype.$screen=(r={},wx.getSystemInfo({success:function(e){r.width=e.windowWidth,r.height=e.windowHeight}}),r),s.prototype.$host=a,function(e,t){var o=void 0,a=void 0,r=void 0,i=e,n=[];function s(e,o){var a=void 0;if(o)for(o=o.toLowerCase(),a=n.length-1;a>=0&&n[a]!==o;a-=1);else a=0;if(a>=0){for(var r=n.length-1;r>=a;r-=1)t.end&&t.end(n[r]);n.length=a}}function c(e,o,a,r){if(o=o.toLowerCase(),bt[o])for(;n.last()&&kt[n.last()];)s(0,n.last());if(vt[o]&&n.last()===o&&s(0,o),(r=mt[o]||!!r)||n.push(o),t.start){var i=[];a.replace(ft,(function(e,t){var o=arguments[2]||arguments[3]||arguments[4]||(wt[t]?t:"");i.push({name:t,value:o,escaped:o.replace(/(^|[^\\])"/g,'$1\\"')})})),t.start&&t.start(o,i,r)}}for(n.last=function(){return n[n.length-1]};e;){if(a=!0,0===e.indexOf("</")?(r=e.match(_t))&&(e=e.substring(r[0].length),r[0].replace(_t,s),a=!1):0===e.indexOf("<")&&(r=e.match(pt))&&(e=e.substring(r[0].length),r[0].replace(pt,c),a=!1),a){o=e.indexOf("<");for(var d="";0===o;)d+="<",o=(e=e.substring(1)).indexOf("<");d+=o<0?e:e.substring(0,o),e=o<0?"":e.substring(o),t.chars&&t.chars(d)}if(e===i)throw new Error("Parse Error: "+e);i=e}s()}(e,{start:function(e,a,r){var c=new s(e);if(0!==i.length){var d=i[0];void 0===d.nodes&&(d.nodes=[])}if(yt[e]?c.tagType="block":Ct[e]?c.tagType="inline":St[e]&&(c.tagType="closeSelf"),c.attr=a.reduce((function(e,t){var o=t.name,a=t.value;return"class"===o&&(c.classStr=a),"style"===o&&(c.styleStr=a),a.match(/ /)&&(a=a.split(" ")),e[o]?Array.isArray(e[o])?e[o].push(a):e[o]=[e[o],a]:e[o]=a,e}),{}),c.classStr?c.classStr+=" "+c.tag:c.classStr=c.tag,"inline"===c.tagType&&(c.classStr+=" inline"),"img"===c.tag){var l=c.attr.src;l=ht(l,o.domain),dt()(c.attr,o,{src:l||""}),l&&n.imageUrls.push(l)}if("a"===c.tag&&(c.attr.href=c.attr.href||""),"font"===c.tag){var h=["x-small","small","medium","large","x-large","xx-large","-webkit-xxx-large"],u={color:"color",face:"font-family",size:"font-size"};c.styleStr||(c.styleStr=""),st()(u).forEach((function(e){if(c.attr[e]){var t="size"===e?h[c.attr[e]-1]:c.attr[e];c.styleStr+=u[e]+": "+t+";"}}))}if("source"===c.tag&&(n.source=c.attr.src),t.start&&t.start(c,n),r){var p=i[0]||n;void 0===p.nodes&&(p.nodes=[]),p.nodes.push(c)}else i.unshift(c)},end:function(e){var o=i.shift();if(o.tag!==e&&console.error("invalid state: mismatch end tag"),"video"===o.tag&&n.source&&(o.attr.src=n.source,delete n.source),t.end&&t.end(o,n),0===i.length)n.nodes.push(o);else{var a=i[0];a.nodes||(a.nodes=[]),a.nodes.push(o)}},chars:function(e){if(e.trim()){var o={node:"text",text:e=ut(e)};if(t.chars&&t.chars(o,n),0===i.length)n.nodes.push(o);else{var a=i[0];void 0===a.nodes&&(a.nodes=[]),a.nodes.push(o)}}}}),n},Pt={name:"WxParseImg",props:{node:{type:Object,default:function(){return{}}}},data:function(){return{loadingClass:"ePubImageLoading"}},computed:{styleObj:function(){if(this.node&&this.node.styleStr){var e={};return this.node.styleStr.split(";").map((function(e){return e.trim()})).filter((function(e){return e.length>0})).forEach((function(t){var o=t.split(":");return o[0]&&o[1]&&(e[o[0]]=o[1].trim()),e})),e}return{}},newStyle:function(){var e=[],t=parseFloat(this.node.attr["data-ratio"]),o=this.node.attr["data-w"],a=this.node.$host.maxImageWidth;if(this.styleObj&&this.styleObj.height&&!this.styleObj.width)e.push("width: calc("+this.styleObj.height+" / "+t+")");else if(this.styleObj.width||!this.styleObj.qrbleed&&!this.styleObj.qrfullpage)if(this.styleObj.width){if(this.styleObj.width&&t){var r=this.styleObj.width;if(r.indexOf("%")>-1){var i=a*(parseFloat(r.match(/\d+%/))/100)+"px",n="calc("+i+" * "+t+")";e.push("width: "+i+";height: "+n)}else e.push("width: "+this.styleObj.width+";height: calc("+this.styleObj.width+" * "+t+")")}}else{var s=Math.min(parseInt(o),a);e.push("width: "+s+"px;height: calc("+s+"px * "+t+")")}else e.push("width: "+a+"px;height: calc("+a+"px * "+t+")");return{str:e.join(";"),mode:"widthFix"}}},methods:{wxParseImgTap:function(e){var t=e.target.dataset.src;t&&this.node.$host.preview(t,e)},wxParseImgLoad:function(){this.loadingClass=""}}},Tt=o(7)(Pt,{render:function(){var e=this,t=e.$createElement;return(e._self._c||t)("image",{class:[e.node.classStr,e.loadingClass],style:(e.node.styleStr?e.node.styleStr+";":"")+e.newStyle.str,attrs:{mode:e.newStyle.mode,src:e.node.attr.src,"data-src":e.node.attr.src,"data-alt":e.node.attr.alt,"data-w":e.node.attr["data-w"],"data-ratio":e.node.attr["data-ratio"],"lazy-load":"true",eventid:"0_0"},on:{load:e.wxParseImgLoad,tap:e.wxParseImgTap}})},staticRenderFns:[]},(function(e){o(1093)}),null,null).exports,It={name:"WxParseVideo",props:{node:{type:Object,default:function(){return{}}}},data:function(){return{showFullscreenBtn:!1,showCenterPlayBtn:!0}},methods:{handleClick:function(e){console.log(e),e.stopPropagation()}}},Rt=o(7)(It,{render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("view",{class:e.node.classStr,style:e.node.styleStr},[o("video",{class:e.node.classStr,style:e.node.styleStr,attrs:{src:e.node.attr.src,"show-fullscreen-btn":e.showFullscreenBtn,"show-center-play-btn":e.showCenterPlayBtn,eventid:"1_0"},on:{click:e.handleClick}})])},staticRenderFns:[]},(function(e){o(1095)}),null,null).exports,At={name:"WxParseAudio",props:{node:{type:Object,default:function(){return{}}}}},Et=o(7)(At,{render:function(){var e=this,t=e.$createElement;return(e._self._c||t)("audio",{class:e.node.classStr,style:e.node.styleStr,attrs:{id:e.node.attr.id,src:e.node.attr.src,loop:e.node.attr.loop,poster:e.node.attr.poster,name:e.node.attr.name,author:e.node.attr.author,controls:""}})},staticRenderFns:[]},(function(e){o(1097)}),null,null).exports,Ot={name:"WxParseTemplate6",components:{wxParseImg:Tt,wxParseVideo:Rt,wxParseAudio:Et},props:{loopIndex:{type:String,default:""},idPrefix:{type:String,default:""},node:{type:Object,default:function(){return{}}}},methods:{wxParseATap:function(e){var t=e.target.dataset.href;t&&this.node.$host.navigate(t,e)}}},Lt={name:"WxParseTemplate5",components:{wxParseTemplate:o(7)(Ot,{render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return"element"==e.node.node?o("block",["button"==e.node.tag?o("block",[o("button",{attrs:{type:"default",size:"mini"}})],1):"li"==e.node.tag?o("block",[o("view",{class:e.node.classStr,style:e.node.styleStr},[e._v("\n            "+e._s(e.node.text)+"\n        ")])]):"video"==e.node.tag?o("block",[o("wx-parse-video",{attrs:{node:e.node,mpcomid:"0"}})],1):"audio"==e.node.tag?o("block",[o("wx-parse-audio",{attrs:{node:e.node,mpcomid:"1"}})],1):"img"==e.node.tag&&e.node.attr.src?o("block",[o("wx-parse-img",{attrs:{node:e.node,mpcomid:"2"}})],1):"a"==e.node.tag?o("block",[o("view",{class:e.node.classStr,style:e.node.styleStr,attrs:{id:e.node.attr["data-wr-footernote"]?"ePub_note_"+e.loopIndex:e.node.attr.id,"data-href":e.node.attr.href,"data-note":e.node.attr["data-wr-footernote"],eventid:"2_0"},on:{click:function(t){t.stopPropagation(),e.wxParseATap(t)}}},[e._v("\n            "+e._s(e.node.text)+"\n        ")])]):"br"==e.node.tag?o("text",[e._v("\\n")]):"hr"==e.node.tag?o("view",{staticClass:"wxParse_hr"}):(e.node.tag,o("block",[o("view",{class:e.node.classStr,style:e.node.styleStr},[e._v("\n            "+e._s(e.node.text)+"\n        ")])]))],1):"text"==e.node.node?o("text",{attrs:{id:e.idPrefix+"--ePub_text_"+e.loopIndex,"data-text":e.node.text}},[e._v(e._s(e.node.text))]):e._e()},staticRenderFns:[]},(function(e){o(1091)}),null,null).exports,wxParseImg:Tt,wxParseVideo:Rt,wxParseAudio:Et},props:{loopIndex:{type:String,default:""},idPrefix:{type:String,default:""},node:{type:Object,default:function(){return{}}}},methods:{wxParseATap:function(e){var t=e.target.dataset.href;t&&this.node.$host.navigate(t,e)}}},$t={name:"WxParseTemplate4",components:{wxParseTemplate:o(7)(Lt,{render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return"element"==e.node.node?o("block",["button"==e.node.tag?o("block",[o("button",{attrs:{type:"default",size:"mini"}},e._l(e.node.nodes,(function(t,a){return o("block",{key:a},[o("wx-parse-template",{attrs:{node:t,"loop-index":e.loopIndex+"_"+a,"id-prefix":e.idPrefix,mpcomid:"0_"+a}})],1)})))],1):"li"==e.node.tag?o("block",[o("view",{class:e.node.classStr,style:e.node.styleStr},e._l(e.node.nodes,(function(t,a){return o("block",{key:a},[o("wx-parse-template",{attrs:{node:t,"loop-index":e.loopIndex+"_"+a,"id-prefix":e.idPrefix,mpcomid:"1_"+a}})],1)})))]):"video"==e.node.tag?o("block",[o("wx-parse-video",{attrs:{node:e.node,mpcomid:"2"}})],1):"audio"==e.node.tag?o("block",[o("wx-parse-audio",{attrs:{node:e.node,mpcomid:"3"}})],1):"img"==e.node.tag&&e.node.attr.src?o("block",[o("wx-parse-img",{attrs:{node:e.node,mpcomid:"4"}})],1):"a"==e.node.tag?o("block",[o("view",{class:e.node.classStr,style:e.node.styleStr,attrs:{id:e.node.attr["data-wr-footernote"]?"ePub_note_"+e.loopIndex:e.node.attr.id,"data-href":e.node.attr.href,"data-note":e.node.attr["data-wr-footernote"],eventid:"2_0"},on:{click:function(t){t.stopPropagation(),e.wxParseATap(t)}}},e._l(e.node.nodes,(function(t,a){return o("block",{key:a},[o("wx-parse-template",{attrs:{node:t,"loop-index":e.loopIndex+"_"+a,"id-prefix":e.idPrefix,mpcomid:"5_"+a}})],1)})))]):"br"==e.node.tag?o("text",[e._v("\\n")]):"hr"==e.node.tag?o("view",{staticClass:"wxParse_hr"}):"pre"==e.node.tag?o("block",[o("view",{class:e.node.classStr,style:e.node.styleStr},e._l(e.node.nodes,(function(t,a){return o("block",{key:a},[o("wx-parse-template",{attrs:{node:t,"loop-index":e.loopIndex+"_"+a,"id-prefix":e.idPrefix,mpcomid:"6_"+a}})],1)})))]):o("block",[o("view",{class:e.node.classStr,style:e.node.styleStr},e._l(e.node.nodes,(function(t,a){return o("block",{key:a},[o("wx-parse-template",{attrs:{node:t,"loop-index":e.loopIndex+"_"+a,"id-prefix":e.idPrefix,mpcomid:"7_"+a}})],1)})))])],1):"text"==e.node.node?o("text",{attrs:{id:e.idPrefix+"--ePub_text_"+e.loopIndex,"data-text":e.node.text}},[e._v(e._s(e.node.text))]):e._e()},staticRenderFns:[]},(function(e){o(1089)}),null,null).exports,wxParseImg:Tt,wxParseVideo:Rt,wxParseAudio:Et},props:{loopIndex:{type:String,default:""},idPrefix:{type:String,default:""},node:{type:Object,default:function(){return{}}}},methods:{wxParseATap:function(e){var t=e.target.dataset.href;t&&this.node.$host.navigate(t,e)}}},Vt={name:"WxParseTemplate3",components:{wxParseTemplate:o(7)($t,{render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return"element"==e.node.node?o("block",["button"==e.node.tag?o("block",[o("button",{attrs:{type:"default",size:"mini"}},e._l(e.node.nodes,(function(t,a){return o("block",{key:a},[o("wx-parse-template",{attrs:{node:t,"loop-index":e.loopIndex+"_"+a,"id-prefix":e.idPrefix,mpcomid:"0_"+a}})],1)})))],1):"li"==e.node.tag?o("block",[o("view",{class:e.node.classStr,style:e.node.styleStr},e._l(e.node.nodes,(function(t,a){return o("block",{key:a},[o("wx-parse-template",{attrs:{node:t,"loop-index":e.loopIndex+"_"+a,"id-prefix":e.idPrefix,mpcomid:"1_"+a}})],1)})))]):"video"==e.node.tag?o("block",[o("wx-parse-video",{attrs:{node:e.node,mpcomid:"2"}})],1):"audio"==e.node.tag?o("block",[o("wx-parse-audio",{attrs:{node:e.node,mpcomid:"3"}})],1):"img"==e.node.tag?o("block",[o("wx-parse-img",{attrs:{node:e.node,mpcomid:"4"}})],1):"a"==e.node.tag?o("block",[o("view",{class:e.node.classStr,style:e.node.styleStr,attrs:{id:e.node.attr["data-wr-footernote"]?"ePub_note_"+e.loopIndex:e.node.attr.id,"data-href":e.node.attr.href,"data-note":e.node.attr["data-wr-footernote"],eventid:"2_0"},on:{click:function(t){t.stopPropagation(),e.wxParseATap(t)}}},e._l(e.node.nodes,(function(t,a){return o("block",{key:a},[o("wx-parse-template",{attrs:{node:t,"loop-index":e.loopIndex+"_"+a,"id-prefix":e.idPrefix,mpcomid:"5_"+a}})],1)})))]):"br"==e.node.tag?o("text",[e._v("\\n")]):"hr"==e.node.tag?o("view",{staticClass:"wxParse_hr"}):"pre"==e.node.tag?o("block",[o("view",{class:e.node.classStr,style:e.node.styleStr},e._l(e.node.nodes,(function(t,a){return o("block",{key:a},[o("wx-parse-template",{attrs:{node:t,"loop-index":e.loopIndex+"_"+a,"id-prefix":e.idPrefix,mpcomid:"6_"+a}})],1)})))]):o("block",[o("view",{class:e.node.classStr,style:e.node.styleStr},e._l(e.node.nodes,(function(t,a){return o("block",{key:a},[o("wx-parse-template",{attrs:{node:t,"loop-index":e.loopIndex+"_"+a,"id-prefix":e.idPrefix,mpcomid:"7_"+a}})],1)})))])],1):"text"==e.node.node?o("text",{attrs:{id:e.idPrefix+"--ePub_text_"+e.loopIndex,"data-text":e.node.text}},[e._v(e._s(e.node.text))]):e._e()},staticRenderFns:[]},(function(e){o(1087)}),null,null).exports,wxParseImg:Tt,wxParseVideo:Rt,wxParseAudio:Et},props:{loopIndex:{type:String,default:""},idPrefix:{type:String,default:""},node:{type:Object,default:function(){return{}}}},methods:{wxParseATap:function(e){var t=e.target.dataset.href;t&&this.node.$host.navigate(t,e)}}},Nt={name:"WxParseTemplate2",components:{wxParseTemplate:o(7)(Vt,{render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return"element"==e.node.node?o("block",["button"==e.node.tag?o("block",[o("button",{attrs:{type:"default",size:"mini"}},e._l(e.node.nodes,(function(t,a){return o("block",{key:a},[o("wx-parse-template",{attrs:{node:t,"loop-index":e.loopIndex+"_"+a,"id-prefix":e.idPrefix,mpcomid:"0_"+a}})],1)})))],1):"li"==e.node.tag?o("block",[o("view",{class:e.node.classStr,style:e.node.styleStr},e._l(e.node.nodes,(function(t,a){return o("block",{key:a},[o("wx-parse-template",{attrs:{node:t,"loop-index":e.loopIndex+"_"+a,"id-prefix":e.idPrefix,mpcomid:"1_"+a}})],1)})))]):"video"==e.node.tag?o("block",[o("wx-parse-video",{attrs:{node:e.node,mpcomid:"2"}})],1):"audio"==e.node.tag?o("block",[o("wx-parse-audio",{attrs:{node:e.node,mpcomid:"3"}})],1):"img"==e.node.tag&&e.node.attr.src?o("block",[o("wx-parse-img",{attrs:{node:e.node,mpcomid:"4"}})],1):"a"==e.node.tag?o("block",[o("view",{class:e.node.classStr,style:e.node.styleStr,attrs:{id:e.node.attr["data-wr-footernote"]?"ePub_note_"+e.loopIndex:e.node.attr.id,"data-href":e.node.attr.href,"data-note":e.node.attr["data-wr-footernote"],eventid:"2_0"},on:{click:function(t){t.stopPropagation(),e.wxParseATap(t)}}},e._l(e.node.nodes,(function(t,a){return o("block",{key:a},[o("wx-parse-template",{attrs:{node:t,"loop-index":e.loopIndex+"_"+a,"id-prefix":e.idPrefix,mpcomid:"5_"+a}})],1)})))]):"br"==e.node.tag?o("text",[e._v("\\n")]):"hr"==e.node.tag?o("view",{staticClass:"wxParse_hr"}):"pre"==e.node.tag?o("block",[o("view",{class:e.node.classStr,style:e.node.styleStr},e._l(e.node.nodes,(function(t,a){return o("block",{key:a},[o("wx-parse-template",{ref:"template",refInFor:!0,attrs:{node:t,"loop-index":e.loopIndex+"_"+a,"id-prefix":e.idPrefix,mpcomid:"6_"+a}})],1)})))]):o("block",[o("view",{class:e.node.classStr,style:e.node.styleStr},e._l(e.node.nodes,(function(t,a){return o("block",{key:a},[o("wx-parse-template",{attrs:{node:t,"loop-index":e.loopIndex+"_"+a,"id-prefix":e.idPrefix,mpcomid:"7_"+a}})],1)})))])],1):"text"==e.node.node?o("text",{attrs:{id:e.idPrefix+"--ePub_text_"+e.loopIndex,"data-text":e.node.text}},[e._v(e._s(e.node.text))]):e._e()},staticRenderFns:[]},(function(e){o(1085)}),null,null).exports,wxParseImg:Tt,wxParseVideo:Rt,wxParseAudio:Et},props:{loopIndex:{type:String,default:""},idPrefix:{type:String,default:""},node:{type:Object,default:function(){return{}}}},methods:{wxParseATap:function(e){var t=e.target.dataset.href;t&&this.node.$host.navigate(t,e)}}},Ut={name:"WxParseTemplate1",components:{wxParseTemplate:o(7)(Nt,{render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return"element"==e.node.node?o("block",["button"==e.node.tag?o("block",[o("button",{attrs:{type:"default",size:"mini"}},e._l(e.node.nodes,(function(t,a){return o("block",{key:a},[o("wx-parse-template",{attrs:{node:t,"loop-index":e.loopIndex+"_"+a,"id-prefix":e.idPrefix,mpcomid:"0_"+a}})],1)})))],1):"li"==e.node.tag?o("block",[o("view",{class:e.node.classStr,style:e.node.styleStr},e._l(e.node.nodes,(function(t,a){return o("block",{key:a},[o("wx-parse-template",{attrs:{node:t,"loop-index":e.loopIndex+"_"+a,"id-prefix":e.idPrefix,mpcomid:"1_"+a}})],1)})))]):"video"==e.node.tag?o("block",[o("wx-parse-video",{attrs:{node:e.node,mpcomid:"2"}})],1):"audio"==e.node.tag?o("block",[o("wx-parse-audio",{attrs:{node:e.node,mpcomid:"3"}})],1):"img"==e.node.tag&&e.node.attr.src?o("block",[o("wx-parse-img",{attrs:{node:e.node,mpcomid:"4"}})],1):"a"==e.node.tag?o("block",[o("view",{class:e.node.classStr,style:e.node.styleStr,attrs:{id:e.node.attr["data-wr-footernote"]?"ePub_note_"+e.loopIndex:e.node.attr.id,"data-href":e.node.attr.href,"data-note":e.node.attr["data-wr-footernote"],eventid:"2_0"},on:{click:function(t){t.stopPropagation(),e.wxParseATap(t)}}},e._l(e.node.nodes,(function(t,a){return o("block",{key:a},[o("wx-parse-template",{attrs:{node:t,"loop-index":e.loopIndex+"_"+a,"id-prefix":e.idPrefix,mpcomid:"5_"+a}})],1)})))]):"br"==e.node.tag?o("text",[e._v("\\n")]):"hr"==e.node.tag?o("view",{staticClass:"wxParse_hr"}):"pre"==e.node.tag?o("block",[o("view",{class:e.node.classStr,style:e.node.styleStr},e._l(e.node.nodes,(function(t,a){return o("block",{key:a},[o("wx-parse-template",{attrs:{node:t,"loop-index":e.loopIndex+"_"+a,"id-prefix":e.idPrefix,mpcomid:"6_"+a}})],1)})))]):o("block",[o("view",{class:e.node.classStr,style:e.node.styleStr},e._l(e.node.nodes,(function(t,a){return o("block",{key:a},[o("wx-parse-template",{attrs:{node:t,"loop-index":e.loopIndex+"_"+a,"id-prefix":e.idPrefix,mpcomid:"7_"+a}})],1)})))])],1):"text"==e.node.node?o("text",{attrs:{id:e.idPrefix+"--ePub_text_"+e.loopIndex,"data-text":e.node.text}},[e._v(e._s(e.node.text))]):e._e()},staticRenderFns:[]},(function(e){o(1083)}),null,null).exports,wxParseImg:Tt,wxParseVideo:Rt,wxParseAudio:Et},props:{loopIndex:{type:String,default:""},idPrefix:{type:String,default:""},highlightParaId:{type:String,default:""},node:{type:Object,default:function(){return{}}}},data:function(){return{chunkIndex:0}},methods:{wxParseATap:function(e){var t=e.target.dataset.href;t&&this.node.$host.navigate(t,e)}}},Dt={name:"WxParseTemplate0",components:{wxParseTemplate:o(7)(Ut,{render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return"element"==e.node.node?o("block",["button"==e.node.tag?o("block",[o("button",{class:[e.node.classStr,{highlight:"ePub_para_"+e.loopIndex==e.highlightParaId}],attrs:{id:"ePub_para_"+e.loopIndex,type:"default",size:"mini"}},e._l(e.node.nodes,(function(t,a){return o("block",{key:a},[o("wx-parse-template",{attrs:{node:t,"loop-index":e.loopIndex+"_"+a,"id-prefix":"ePub_para_"+e.loopIndex,mpcomid:"0_"+a}})],1)})))],1):"li"==e.node.tag?o("block",[o("view",{class:[e.node.classStr,{highlight:"ePub_para_"+e.loopIndex==e.highlightParaId}],style:e.node.styleStr,attrs:{id:"ePub_para_"+e.loopIndex}},e._l(e.node.nodes,(function(t,a){return o("block",{key:a},[o("wx-parse-template",{attrs:{node:t,"loop-index":e.loopIndex+"_"+a,"id-prefix":"ePub_para_"+e.loopIndex,mpcomid:"1_"+a}})],1)})))]):"video"==e.node.tag?o("block",[o("wx-parse-video",{attrs:{node:e.node,mpcomid:"2"}})],1):"audio"==e.node.tag?o("block",[o("wx-parse-audio",{attrs:{node:e.node,mpcomid:"3"}})],1):"img"==e.node.tag&&e.node.attr.src?o("block",[o("wx-parse-img",{attrs:{node:e.node,mpcomid:"4"}})],1):"a"==e.node.tag?o("block",[o("view",{style:e.node.styleStr,attrs:{id:e.node.attr["data-wr-footernote"]?"ePub_note_"+e.loopIndex:e.node.attr.id,"data-href":e.node.attr.href,"data-note":e.node.attr["data-wr-footernote"],eventid:"2_0"},on:{click:function(t){t.stopPropagation(),e.wxParseATap(t)}}},e._l(e.node.nodes,(function(t,a){return o("block",{key:a},[o("wx-parse-template",{attrs:{node:t,"loop-index":e.loopIndex+"_"+a,"id-prefix":"ePub_para_"+e.loopIndex,mpcomid:"5_"+a}})],1)})))]):"br"==e.node.tag?o("text",[e._v("\\n")]):"hr"==e.node.tag?o("view",{staticClass:"wxParse_hr"}):"pre"==e.node.tag?o("block",[o("view",{class:[e.node.classStr,{highlight:"ePub_para_"+e.loopIndex==e.highlightParaId}],style:e.node.styleStr,attrs:{id:"ePub_para_"+e.loopIndex}},e._l(e.node.nodes,(function(t,a){return o("block",{key:a},[o("wx-parse-template",{attrs:{node:t,"loop-index":e.loopIndex+"_"+a,"id-prefix":"ePub_para_"+e.loopIndex,mpcomid:"6_"+a}})],1)})))]):o("block",[o("view",{class:[e.node.classStr,{highlight:"ePub_para_"+e.loopIndex==e.highlightParaId}],style:e.node.styleStr,attrs:{id:"ePub_para_"+e.loopIndex}},e._l(e.node.nodes,(function(t,a){return o("block",{key:a},[o("wx-parse-template",{attrs:{node:t,"loop-index":e.loopIndex+"_"+a,"id-prefix":"ePub_para_"+e.loopIndex,mpcomid:"7_"+a}})],1)})))])],1):"text"==e.node.node?o("text",{attrs:{id:"ePub_text_"+e.loopIndex,"data-text":e.node.text}},[e._v(e._s(e.node.text))]):e._e()},staticRenderFns:[]},(function(e){o(1081)}),null,null).exports},props:{loopIndex:{type:String,default:""},node:{type:Object,default:function(){return{}}},highlightParaId:{type:String,default:""},newStyleStr:{type:String,default:""}},data:function(){return{step:0,temporaryEmpty:!1}},computed:{outputNodes:function(){return this.node.nodes}}},Mt=o(7)(Dt,{render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return"element"==e.node.node?o("block",[o("view",{staticClass:"wxParse_root",class:e.node.classStr,style:(e.node.styleStr||"")+";"+e.newStyleStr},e._l(e.outputNodes,(function(t,a){return o("block",{key:a},[o("wx-parse-template",{attrs:{node:t,"loop-index":e.loopIndex+"_"+a,"highlight-para-id":e.highlightParaId,mpcomid:"0_"+a}})],1)})))]):"text"==e.node.node?o("text",{class:"text_"+e.loopIndex==e.highlightParaId?"highlight":"",attrs:{id:"text_"+e.loopIndex,"data-text":e.node.text}},[e._v(e._s(e.node.text))]):e._e()},staticRenderFns:[]},(function(e){o(1079)}),null,null).exports,Ft="",Wt={name:"WxParse",components:{wxParseTemplate:Mt},props:{loading:{type:Boolean,default:!1},className:{type:String,default:""},content:{type:String,default:""},noData:{type:String,default:""},startHandler:{type:Function,default:function(){return function(e){e.attr.class=null,e.attr.style=null}}},endHandler:{type:Function,default:null},charsHandler:{type:Function,default:null},imageProp:{type:Object,default:function(){return{mode:"aspectFit",padding:0,lazyLoad:!1,domain:""}}},currentScrollTop:{type:Number,default:0},navBarHeight:{type:Number,default:0},highlightParaId:{type:String,default:""},styleStr:{type:String,default:""}},data:function(){return{scrollData:{},selfWidth:0,imageUrls:[],noteContent:"",noteViewStyle:"",noteArrowViewStyle:"",showNoteView:!1,windowHeight:N.default.getUser().windowHeight,windowWidth:N.default.getUser().windowWidth,maxImageWidth:N.default.getUser().windowWidth-48}},computed:{originalNodes:function(){var e=this.content,t=this.noData,o=this.imageProp,a=this.startHandler,r=this.endHandler,i=this.charsHandler,n=Bt(e||t,{start:a,end:r,chars:i},o,this);return this.imageUrls=n.imageUrls,n.nodes}},methods:{navigate:function(e,t){var o=this;if(t.stopPropagation(),t.target.dataset.note)if(Ft===t.target.id)this.showNoteView=!1,Ft="";else{var a=t.target,r=t.target.id;Ft=t.target.id,this.noteContent=t.target.dataset.note,this.showNoteView=!1,setTimeout((function(){wx.createSelectorQuery().select("#"+r).boundingClientRect().select("#noteView").boundingClientRect().select("#noteArrowView").boundingClientRect().select("#wxParseView").boundingClientRect().exec((function(e){var r=e[0],i=e[1],n=e[2],s=e[3],c=r.top,d=r.height,l=n.width,h=n.height,u=i.width,p=i.height,_=t.target.offsetTop,f=_+d-2,g=a.offsetLeft+r.width/2-l/2,m=f+h-1,b=a.offsetLeft+r.width/2-u/2;b+u>=o.windowWidth?b=o.windowWidth-u-8:b<0&&(b=8),c+d+p>s.top+s.height?(m=(f=_-h+2)-p,o.noteArrowViewStyle="border-bottom-color: rgba(0, 0, 0, 0);"):o.noteArrowViewStyle="border-top-color: rgba(0, 0, 0, 0);",o.noteViewStyle="top: "+m+"px;left: "+b+"px;",o.noteArrowViewStyle+="top:"+f+"px;left:"+g+"px;",o.showNoteView=!0}))}),60)}},preview:function(e){this.imageUrls.length&&wx.previewImage({current:e,urls:this.imageUrls,referrerPolicy:"origin"})},wxParseBaseClick:function(e){e.target.dataset.note||(this.showNoteView=!1,Ft="",e.stopPropagation())}}},jt=o(7)(Wt,{render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("view",{staticClass:"wxParse",class:e.className,attrs:{id:"wxParseView",eventid:"0_0"},on:{click:e.wxParseBaseClick}},[o("view",{staticClass:"wxParse_ovhFix"}),e._v(" "),e._l(e.originalNodes,(function(t,a){return o("block",{key:a},[o("wx-parse-template",{attrs:{"new-style-str":e.styleStr,"loop-index":a,"highlight-para-id":e.highlightParaId,node:t,mpcomid:"0_"+a}})],1)})),e._v(" "),o("view",{staticClass:"wxParse_noteArrowView",class:{wxParse_note_Hide:!e.showNoteView},style:e.noteArrowViewStyle,attrs:{id:"noteArrowView"}}),e._v(" "),o("view",{staticClass:"wxParse_noteView",class:{wxParse_note_Hide:!e.showNoteView},style:e.noteViewStyle,attrs:{id:"noteView"}},[e._v("\n        "+e._s(e.noteContent)+"\n    ")])],2)},staticRenderFns:[]},(function(e){o(1077)}),null,null).exports,Ht=o(88),Gt=void o(227),qt=0,Kt=(new ge.a,null),zt=null,Yt="",Qt=!1,Zt={components:{Alert:ve.default,Avatar:we.default,BookCover:xe.default,BuyBook:Se,CatalogSidebar:Re,CustomSlider:Oe.default,CustomerServicePrompt:Ae.default,SubscribeBookPrompt:Ee.a,EmptyView:Le.default,IntroModal:Ue,InfiniteCardPrompt:$e.default,Mask:Pe.a,NavigationBar:De.a,PinTips:Me.default,RechargeView:Fe.default,wxParse:jt,MiniLecturePlayer:qe.default,BookRecommend:ze,BookRatings:ot,ReaderCustomAd:it},data:function(){return{clearChapterContent:!1,ePubHighlightParaId:"",isSwitchingChapter:!1,scene:0,loaded:!1,loading:!1,shouldShowEmptyView:!1,offshelfEmptyView:!1,markAsSecret:!0,willAutoPay:!1,cancelAutoPayConfirmationButtons:[{type:"cancel",title:"取 消"},{type:"confirm",title:"关 闭"}],bookRemovalConfirmationButtons:[{type:"cancel",title:"取 消"},{type:"delete",title:"移 出"}],catalog:{shouldShow:!1,isAllCatalog:!1},tts:{shouldShow:!1},ttsSetting:{shouldShow:!1,voicePrefix:"AI",voiceList:R,speedList:I,speedIndex:1,voiceIndex:0},tabBar:{shouldShow:!0},setting:{shouldShow:!1,fontConfigIndex:2,fontConfig:B},emptyView:{title:"",buttonLabel:""},isReachBottom:!1,bookId:null,authorVid:null,startTime:Math.floor((new Date).getTime()/1e3),scrollTop:0,windowHeight:0,disableEntry:!0,hasUserScrolled:!1,initReaderData:null,navigationBarTitle:"",reportFormIdCount:0,isTTSPlaying:!1,playingParagraphIndex:null,ttsProgressTitle:"",scrollIntoViewId:"",scrollWithAnimation:!1,bookInfoSEO:{},shouldDetectBlankScreen:!0,csSource:"reader",csDetailType:"benefits",canReceivedOneDayGift:!0,REPORT_READ_TIME_INTERVAL:3e5,shouldShowAd:!1,subscribedChapter:0,rewardedVideoAd:{},isVideoLoaded:!1,isVideoPlaying:!1,observer:null,isFromLecture:!1,isToLecture:!1,hideAdUntil:0,currentTime:0}},computed:g()({},Object(D.mapState)({profile:function(e){return e.profile},theme:function(e){return e.profile.user.theme},user:function(e){return e.profile.user},upBookNotifyOpened:function(e){return e.upBookNotifyState}}),Object(D.mapGetters)({isAndroid:"isAndroid",isLowPerformanceDevice:"isLowPerformanceDevice",navBarHeight:"navigationBarHeight",themeSelector:"themeSelector",shouldBlockedUser:"shouldBlockedUser",logAppWithin7Days:"logAppWithin7Days",needAuthorized:"needAuthorized",infiniteRemainingDays:"infiniteRemainingDays",readerUnlockStatus:"readerUnlockStatus",infiniteLabelText:"infiniteLabelText"}),{showAd:function(){return console.log("[Reader] showAd","currentTime:",this.currentTime,"hideUntil:",this.hideAdUntil,"paid:",this.book&&this.book.paid,"isPayChapterBook:",this.isPayChapterBook,"chaper-paid:",this.chapter&&this.chapter.paid,"chaper-price:",this.chapter&&this.chapter.price),!(this.hideAdUntil&&this.currentTime&&this.hideAdUntil>this.currentTime)&&!(this.book&&this.book.paid&&!this.isPayChapterBook)&&!(this.chapter&&this.chapter.paid&&this.chapter.price>0)&&!this.isPoliticalSensitive&&!this.profile.isPaying&&(this.nextChapter||this.bookEPubData.hasMore)},showInlineAd:function(){return this.showAd&&!this.isEPubMode&&this.isPayChapterBook},showPurchase:function(){return!0},currentTTSParagraph:function(){return Ht.store.state.audioManager?Ht.store.state.audioManager.currentParaIndex:0},isEPubMode:function(){return this.book&&this.book.format&&"epub"===this.book.format&&this.bookEPubContent&&this.bookEPubContent.trim&&this.bookEPubContent.trim().length>0},appRedeemableDays:function(){return V.store.getters.appRedeemableDays},authorized:function(){var e=this.user.nickName;return!(!e||!e.length)},isBookValid:function(){return!(this.book&&0===this.book.type&&0===this.book.lastChapterIdx&&!this.isImportedBook||!this.book||!this.book.title)},isImportedBook:function(){var e=this.bookId&&this.bookId.startsWith("CB_");return console.log("is imported book:",e),e},isPayChapterBook:function(){return this.book&&2&this.book.payType},shouldPayChapterBook:function(){return this.book&&(3===this.book.payingStatus||4===this.book.payingStatus||5===this.book.payingStatus)},shouldShowUpdateTime:function(){var e=this.$root.$mp.query;return(!e||!e.authorVid)&&this.book&&!this.isImportedBook&&this.isPayChapterBook},isOffShelf:function(){var e=this.$root.$mp.query;return!(e&&e.authorVid||!(this.book&&0===this.book.type&&this.book.soldout>0)||this.book.canRead||this.book.paid)},showOffShelf:function(){var e=this.isOffShelf&&!this.hasPaperBook&&!this.isTrialRead;return console.log("shouldShowOffShelf:",e,this.book),e},supportedBook:function(){var e=this.book&&this.book.category&&-1!==this.book.category.indexOf("漫画"),t=this.book&&this.book.format&&"epub"===this.book.format,o=this.book&&0===this.book.type&&!this.authorVid&&(!e||t);return console.log("isSupport:",this.book,"isSupported:",o,"isBookValid:",this.isBookValid),!o&&this.book&&fe.default.reportExp("readerUnsupport"),o&&this.isBookValid},baseContainerSelector:function(){var e="reader_wrap";return this.book&&!this.supportedBook&&(e+=" reader_wrap_Unsupported"),e},deviceSelector:function(){if(this.user&&this.user.OS){var e=this.user.OS.match(/[a-zA-Z]* ([\d.]*)/);if(e&&e.length>1){var t=e[1];if(Object(w.default)(t,"9.0")<0)return"wr_legacyDevice"}}return"wr_modernDevice"},navBarCustomSelector:function(){var e="reader_navBar";return this.shouldShowHeader&&(e+=" reader_navBar_InTitlePage"),e},shouldShowHeader:function(){var e=!this.prevChapter||!this.supportedBook||this.isOffShelf;return!(this.bookEPubData&&this.bookEPubData.sectionIndex>0)&&(e&&this.reportReaderHeadBottomButton&&this.reportReaderHeadBottomButton(),e)},shouldShowAddShelfTips:function(){var e=this.book&&!this.book.isOnBookShelf&&this.reader&&this.reader.readChapterCount%10==0;return e&&this.$store.dispatch($.KV_LOG_REPORT,{itemname:"Wp_AddShelfTips_Exp"}),e},shouldShowPicDownloadTips:function(){return!(!this.chapter||!this.chapter.hasImage||(this.shouldBlockedUser?(console.log("shouldShowPicDownloadTips userActive black"),1):this.shouldShowAddShelfTips||this.isEPubMode||(this.isReachBottom&&fe.default.reportCustomerExp("readerEpub"),0)))},reader:function(){if(!this.bookId)return null;var e=this.$store.getters.readerWithBookId(this.bookId);return e&&!e.chapter&&this.outputPageStack(),e},showSubscribeBookButton:function(){return this.book&&1!==this.book.finished&&!(this.nextChapter&&this.nextChapter.chapterUid)},similarBook:function(){return!this.reader||!this.reader.similarBook||!this.reader.similarBook.books||!this.reader.similarBook.books.length>0?{books:[]}:this.reader.similarBook},readFinishSimilarBook:function(){return this.similarBook.books.slice(0,6)},chapter:function(){return this.reader&&this.reader.chapter},firstChapter:function(){return this.bookId&&this.isBookValid?this.book&&0!==this.book.type?null:this.$store.getters.firstChapter(this.bookId):null},book:function(){return this.bookId?this.$store.getters.bookWithBooId(this.bookId):null},reviewList:function(){return this.$store.getters.bookReviewListWithBookId(this.bookId)},reviews:function(){return this.reviewList&&this.reviewList.items?this.reviewList.items:[]},bookReadingCount:function(){return this.book?Object(k.default)(this.book.readingCount):Object(k.default)(0)},readingFriends:function(){return this.book&&this.book.readingFriends?this.book.readingFriends.slice(0,4):[]},bookContent:function(){return this.reader&&this.reader.content?this.reader.content:[]},bookContentWithAd:function(){var e=this,t=0,o=this.bookContent.map((function(o){return(t+=o.length)>1e3&&e.showInlineAd?(t=0,{paragraph:o,adUnitId:"adunit-96cd8808bc99a0aa"}):{paragraph:o}}));t=0;for(var a=o.length-1;a>=0;a-=1){if(o[a].adUnitId&&t<500){delete o[a].adUnitId;break}if(t>=500)break}return o},bookEPubData:function(){return this.reader&&this.reader.ePubData?(Yt=this.reader.ePubData.sectionIndex||0,this.reader.ePubData):{}},bookEPubContent:function(){return this.bookEPubData&&this.bookEPubData.html?this.bookEPubData.html:null},bookReadingTime:function(){return this.book?Object(m.a)(this.book.totalReadingTime):""},paperBookInfo:function(){return this.hasPaperBook?this.book.paperBook:null},indexStyleObj:function(){var e=19/B.fontSize,t=23/B.lineHeight;return"font-size: "+Math.floor(e*this.setting.fontConfig.fontSize)+"px; line-height: "+Math.floor(t*this.setting.fontConfig.lineHeight)+"px"},titleStyleObj:function(){var e=24/B.fontSize,t=29/B.lineHeight;return"font-size: "+Math.floor(e*this.setting.fontConfig.fontSize)+"px; line-height: "+Math.floor(t*this.setting.fontConfig.lineHeight)+"px"},contentStyleObj:function(){return"font-size: "+this.setting.fontConfig.fontSize+"px; line-height: "+this.setting.fontConfig.lineHeight+"px"},headerBottomDownloadButtonText:function(){return this.authorVid,this.isOffShelf&&this.hasPaperBook,"去微信读书 app 阅读本书"},prevChapter:function(){return this.reader&&this.reader.chapter?this.$store.getters.prevChapter(this.bookId,this.reader.chapter):{}},nextChapter:function(){return this.reader&&this.reader.chapter?this.$store.getters.nextChapter(this.bookId,this.reader.chapter):{}},lastFreeChapter:function(){return this.bookId&&this.isTrialRead?this.$store.getters.lastFreeChapter(this.bookId):null},needsPurchase:function(){return Boolean(this.reader&&this.reader.chapter&&this.reader.chapter.needsPurchase)},isBookPurchase:function(){return this.book&&1&this.book.payType},shouldShowReaderUnlockPromtBtn:function(){return!this.shouldBlockedUser&&!!this.chapter},shouldShowReaderPromtBtn:function(){return!this.shouldBlockedUser&&!!this.chapter&&!this.shouldShowReaderUnlock&&(this.chapter.needsPurchase||!!(this.prevChapter&&this.nextChapter&&this.nextChapter.chapterUid))&&(fe.default.reportExp("readerContentBottom"),!0)},formattedUpdateTime:function(){return this.book?Object(b.default)(this.book.updateTime,!1,!0):""},bookRemovalConfirmationContent:function(){return this.book?"是否将《"+this.book.title+"》移出书架？":""},bottomBarTTSTitle:function(){return this.chapter&&this.book?this.book&&"epub"!==this.book.format?"第"+this.chapter.chapterIdx+"章 "+this.chapter.title:this.chapter.title:""},ttsSettingSpeedText:function(){return this.ttsSetting.speedList[this.ttsSetting.speedIndex].text},ttsSettingSpeedValue:function(){return this.ttsSetting.speedList[this.ttsSetting.speedIndex].value},ttsSettingVoiceNameNodes:function(){return e=[this.ttsSetting.voicePrefix,this.ttsSetting.voiceList[this.ttsSetting.voiceIndex].name],t={name:"div",children:[]},"string"==typeof(o=e)&&(o=[o]),o.map((function(e){t.children.push({type:"node",name:"div",children:[{type:"text",text:e}]})})),[t];var e,t,o},ttsSettingVoiceValue:function(){return this.ttsSetting.voiceList[this.ttsSetting.voiceIndex].value},shouldShowLaunchAppButton:function(){return console.log("shouldShowLaunchAppButton scene:",1036===this.scene||1069===this.scene),1036===this.scene||1069===this.scene},chapterContentBottomPromptText:function(){return"去微信读书 app 阅读此书"},canUseSubscribeMessage:function(){return Object(w.default)(N.default.getUser().SDKVersion,"2.8.2")>-1},shouldShowFreeInfiniteReminder:function(){return!1},isChapterSubscribed:function(){return this.chapter&&this.chapter.chapterUid&&this.chapter.chapterUid===this.subscribedChapter},shouldShowReaderUnlock:function(){return!1},hasPaperBook:function(){return this.book&&this.book.paperBook&&this.book.paperBook.skuId},paperBookDetailImages:function(){return this.book&&this.book.paperBook&&this.book.paperBook.detailImages?this.book.paperBook.detailImages:[]},isTrialRead:function(){return this.book&&!this.book.paid&&this.book.payType&1<<19},isTrialChapter:function(){return this.isTrialRead&&Te(this.book,this.chapter)},bookFinishHint:function(){var e="全书完",t="去微信读书 app 阅读更多书籍";return this.book&&!this.book.finished?(e="未完待续",t="订阅更新通知"):this.isTrialRead&&(e="试读结束",t=this.hasPaperBook?"去微信读书 app 购买此书":"去微信读书 app 阅读此书"),{btnText:t,title:e}},shouldShowReadFinishHint:function(){return!(!this.isTrialRead||this.isTrialChapter)||this.prevChapter&&!this.needsPurchase&&!this.nextChapter&&!this.bookEPubData.hasMore},shouldShowChapterContent:function(){return!this.isOffShelf||this.isTrialChapter},shouldShowHeaderBottomButton:function(){return!this.shouldBlockedUser&&!this.logAppWithin7Days},isPoliticalSensitive:function(){var e=this.book;if(!e)return!1;var t=e.payType;return Boolean(32768&t||65536&t||t&1<<17||t&1<<18)}}),mounted:function(){this.$refs.navigationBar&&this.$refs.navigationBar.refreshControls(),this.adjustStatusBarColor(),this.getWindowHeight(),V.store.dispatch(V.INIT,{}),this.$store.dispatch($.QUERY_INFINITE),console.log("[purchase pre check]: isAndroid: "+this.isAndroid)},created:function(){var e=this;E.default.getStorage({key:"readerFontConfigIndex",success:function(t){var o=parseInt(t.data);(0===o||o)&&(e.setting.fontConfig=S[o],e.setting.fontConfigIndex=o)}})},methods:{refreshCurrentTime:function(){this.currentTime=+new Date},refreshHideAd:function(){var e=this;this.refreshCurrentTime(),E.default.getStorage({key:"readerHideAdUntil",success:function(t){var o=parseInt(t.data);o&&(e.hideAdUntil=o)}})},handleHideAdVideoEnd:function(){this.refreshCurrentTime();var e=+new Date+18e5;this.hideAdUntil=e,console.log("免广告持续至",e),E.default.setStorage({key:"readerHideAdUntil",data:e,success:function(){}})},initReaderQuery:function(e){if(e.bookId)this.bookId=e.bookId,this.authorVid=e.authorVid;else if(e.q){var t=decodeURIComponent(e.q);if(t){console.log("testqrcodeQuery:",t);var o=t.match(/share\/([\w]+)/),a=t.match(/authorVid=([\w]+)/);console.log("authorVid:",a),o&&o[1]?(this.bookId=o[1],this.authorVid=0,a&&a[1]&&(this.authorVid=a[1]),this.$store.dispatch($.KV_LOG_REPORT,{itemname:"Wp_source_QRCode"})):wx.showToast({title:"二维码不正确，加载失败",icon:"none"})}}if(this.bookId){var r=N.default.getUser().vid;e.bookId&&e.fromVid&&"shareUnlock"===e.from&&+r!=+e.fromVid&&setTimeout((function(){wx.showToast({title:"阅读 1 分钟，即可帮好友解锁阅读权限",duration:3e3,icon:"none"}),U.default.reportReaderShareUnlock({bookId:e.bookId,shareVid:e.fromVid}).then((function(){console.log("解锁成功")})).catch(Ge.a)}),2e3),this.initReaderData={bookId:this.bookId};var i=E.default.getStorageSync(this.bookId)||{};i.ePubPageIndex&&(this.initReaderData.section=i.ePubPageIndex);var n=parseInt(e.chapterUid);n&&(this.initReaderData.chapterUid=n),console.log("不要自动标记私密",e.publicByDefault),e.publicByDefault&&(this.markAsSecret=!1),console.log("init reader query:",this.initReaderData),"mpLecture"===e.from&&(this.isFromLecture=!0)}else console.error("进入阅读器，但是没有bookId")},updateLaunchScene:function(){var e=this.$root.$mp.appOptions;this.scene=e.scene,console.log("[阅读器]","当前场景值是",e.scene)},getWindowHeight:function(){this.windowHeight=N.default.getUser().windowHeight},report:function(e){this.$store.dispatch($.KV_LOG_REPORT,{itemname:"Wp_Reader_"+e})},reportShareGiftLogInfo:function(e){return ke.a.reportInfo({source:"mp|reader",message:e})},reportShareGiftLogError:function(e){return ke.a.reportError({source:"mp|reader",message:e})},reportShareGiftLogErrorWithCode:function(e,t){return ke.a.reportError({source:"mp|reader",message:e,errorCode:t})},openReader:function(e,t){var o;o=t?"/pages/reader/main?bookId="+e+"&chapterUid="+t:"/pages/reader/main?bookId="+e;var a=getCurrentPages();a&&a.length<10?wx.navigateTo({url:o}):(console.log("openReader over max hierarchy redirectTo"),wx.redirectTo({url:o}))},openBookstore:function(){wx.navigateTo({url:"/pages/index/main"})},openProfile:function(e){wx.navigateTo({url:"/pages/profile/main?userVid="+e})},openBookReviews:function(){this.$store.dispatch($.KV_LOG_REPORT,{itemname:"Wp_Reader_MoreReview_Clk"}),wx.navigateTo({url:"/pages/bookReviews/main?bookId="+this.bookId})},openTop100:function(){this.$store.dispatch($.KV_LOG_REPORT,{itemname:"Wp_Reader_Top100"+this.book.ranklist.categoryId}),wx.navigateTo({url:"/pages/top100/main?categoryId="+this.book.ranklist.categoryId})},loadChapter:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments[3],i=e&&0===e.price;return this.isTrialRead&&!i?(this.$store.commit($.READ_CHAPTER,{bookId:this.bookId,chapter:e}),this.$store.dispatch($.KV_LOG_REPORT,{itemname:"Wp_Reader_Trial_End"}),console.log("[Trial] 不可试读章节",this.bookId,e),_.a.resolve()):(this.shouldDetectBlankScreen=!1,this.isReachBottom=!1,this.clearChapterContent=!0,t&&this.showLoading(),this.$store.dispatch($.READ_CHAPTER,{bookId:this.bookId,chapter:e,section:a,format:this.book&&this.book.format,pageLevel:r}).then((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{isPreload:!1};o.$nextTick((function(){o.hideWhenCaptureIfNeed(),o.hideEmptyView(),r||o.setNavigationBarTitleIfNeed(),o.clearHighlightParagraph(),o.clearChapterContent=!1,t&&o.hideLoading((function(){o.scrollTop=0,o.scrollIntoViewId=null})),e.isPreload&&(o.scrollTop=0,o.scrollIntoViewId="readerEmptyHeader"),o.checkContentRenderingIssue(),r||o.preloadChapter(),o.bottomButtonExpose(),o.reportPurchaseExpose(),o.needsPurchase&&U.default.analysisLog("mp_reader_need_Purchase")})),o.uploadReadingProgressAndTime()})).catch((function(e){console.log("preload chapter",e),t&&o.hideLoading((function(){o.showDefaultEmptyView()})),console.log("Reader: ","章节加载失败",e),o.$store.dispatch($.REPORT_READER_FAIL)})).then((function(){setTimeout((function(){o.shouldDetectBlankScreen=!0}),200)})))},gotoPrevChapter:function(){var e=this;return this.isSwitchingChapter=!0,this.bookEPubData.sectionIndex>0?(qt=0,this.scrollTop=0,this.scrollIntoViewId="readerEmptyHeader",this.loadChapter(this.chapter,!0,this.bookEPubData.sectionIndex-1,!0).then((function(){e.isSwitchingChapter=!1,e.refreshCurrentTime()}))):this.prevChapter?(qt=0,this.scrollTop=0,this.loadChapter(this.prevChapter).then((function(){e.isSwitchingChapter=!1,e.refreshCurrentTime()}))):_.a.reject({errMsg:"has no more chapter"})},gotoNextChapter:function(){var e=this;return this.isSwitchingChapter=!0,this.bookEPubData.hasMore?(qt=0,this.scrollTop=0,this.scrollIntoViewId="readerEmptyHeader",this.$store.dispatch($.KV_LOG_REPORT,{itemname:"Wp_Reader_NextEPubPage"}),this.loadChapter(this.chapter,!0,this.bookEPubData.sectionIndex+1,!0).then((function(){e.isSwitchingChapter=!1,e.refreshCurrentTime()}))):this.nextChapter?(qt=0,this.scrollTop=0,this.$store.dispatch($.KV_LOG_REPORT,{itemname:"Wp_Reader_NextChapter"}),this.loadChapter(this.nextChapter).then((function(){e.isSwitchingChapter=!1,e.refreshCurrentTime()}))):(this.isSwitchingChapter=!1,_.a.reject({errMsg:"has no more chapter"}))},preloadChapter:function(){var e=this;this.nextChapter&&this.nextChapter.chapterUid&&this.$store.dispatch($.PRELOAD_CHAPTER,{bookId:this.bookId,chapter:this.nextChapter,format:this.book&&this.book.format||""}).then((function(t){t.concat([e.showingTitle(e.nextChapter)],t),Gt&&Gt.setNextChapter(e.nextChapter,Array.prototype.concat([],[e.showingTitle(e.nextChapter)],t))})).catch((function(e){console.error("preload chapter error: ",e)}))},subscribeBook:function(){!Object(w.default)(N.default.getUser().Version,"7.0.6")<1&&this.$refs.subscribeBookPrompt.show(),this.handleSubscribeBook()},handleSubscribeBook:function(){if(this.$store.dispatch($.KV_LOG_REPORT,{itemname:"Wp_Reader_Show_UpBook"}),wx.requestSubscribeMessage){var e="n1r9HBlqRtIjNVeluX_txoYN7VS8zrmUXfQHX95STwI",t=this;wx.requestSubscribeMessage({tmplIds:[e],success:function(o){"accept"===o[e]?t.$store.dispatch($.SUBMIT_UPBOOK_NOTIFY,{bookId:t.bookId,open:!0}).then((function(e){e&&1===e.succ&&(t.$store.dispatch($.KV_LOG_REPORT,{itemname:"Wp_Reader_Open_UpBook"}),t.subscribedChapter=t.chapter.chapterUid,t.addSubscribeRecord(t.bookId,t.chapter.chapterUid),wx.showToast({title:"订阅成功",icon:"none"}))})):"reject"===o[e]?(t.$store.dispatch($.KV_LOG_REPORT,{itemname:"Wp_Reader_Reject_UpBook"}),wx.showToast({title:"订阅失败：权限被拒绝",icon:"none"})):wx.showToast({title:"订阅失败：内部错误",icon:"none"})},fail:function(e){console.log(e)},complete:function(){t.$refs.subscribeBookPrompt.closeSelf()}})}else wx.showToast({title:"订阅失败：请升级微信版本",icon:"none"})},addSubscribeRecord:function(e,t){E.default.setStorage({key:e+"_subscribe",data:{chapterUid:t}})},addToShelfIfNeed:function(){var e=this;this.book&&(this.book.isOnBookShelf||(!this.book.soldout||this.isTrialRead||this.book.paid?(console.log("加入书架时自动私密",this.markAsSecret),this.$store.dispatch($.ADD_TO_BOOKSHELF,{bookId:this.bookId,markAsSecret:this.markAsSecret}).then((function(){e.$store.dispatch($.KV_LOG_REPORT,{itemname:"Wp_Reader_AddShelf"}),wx.showToast({title:"成功加入书架",icon:"none"})})).catch((function(t){-2001===t?e.$refs.shelfFullPrompt&&e.$refs.shelfFullPrompt.show():wx.showToast({title:"加入书架失败",icon:"none"})}))):console.log("下架书籍")))},showAddToShelfTip:function(){var e=this;this.$store.dispatch($.ADD_TO_BOOKSHELF,{bookId:this.bookId}).then((function(){wx.showToast({title:"成功加入书架",icon:"none"}),e.$store.dispatch($.KV_LOG_REPORT,{itemname:"Wp_Reader_AddShelf"})})).catch((function(t){-2001===t?e.$refs.shelfFullPrompt&&e.$refs.shelfFullPrompt.show():wx.showToast({title:"加入书架失败",icon:"none"})}))},removeFromShelfIfNeed:function(){this.book.isOnBookShelf&&this.$refs.bookRemovalConfirmation.showModal()},confirmBookRemoval:function(){this.$store.dispatch($.REMOVE_FROM_BOOKSHELF,{bookId:this.bookId}).then((function(){wx.showToast({title:"成功移出书架",icon:"none"})})).catch((function(){wx.showToast({title:"移出书架失败",icon:"none"})}))},handleFontSliderChange:function(e){var t=e.mp.detail.value;this.setting.fontConfig=S[t],this.setting.fontConfigIndex=t,E.default.setStorage({key:"readerFontConfigIndex",data:t,success:function(){}})},cancelAutoPay:function(){var e=this;wx.showLoading({title:"加载中…"}),this.$store.dispatch($.CANCEL_AUTO_PAY,{bookId:this.bookId,type:this.book.type}).then((function(){e.book.isAutoPay=0,wx.hideLoading(),wx.showToast({title:"取消成功！",icon:"none"})})).catch((function(){wx.hideLoading(),wx.showToast({title:"取消失败，请稍后重试！",icon:"none"})}))},showChapter:function(e){this.hideTabBarIfNeed(),this.loadChapter(e)},getTtsSettingItemIndexWithValue:function(e,t,o){for(var a=o.length,r=0;r<a;r++)if(o[r].value===e)return r;return t},showTTSSetting:function(){this.ttsSetting.shouldShow=!0,this.$refs.ttsSettingMask.showMask()},hideTTSSetting:function(){this.ttsSetting.shouldShow=!1,this.$refs.ttsSettingMask&&this.$refs.ttsSettingMask.closeMask()},hideTabBarIfNeed:function(){this.tabBar.shouldShow&&(this.hideTTSIfNeed(),this.hideSettingIfNeed(),this.hideCatalogIfNeed(),this.tabBar.shouldShow=!1)},showTabBarIfNeed:function(){this.tabBar.shouldShow||(this.isTTSPlaying?(this.showTTSIfNeed(),this.tabBar.shouldShow=!0):this.tabBar.shouldShow=!0)},toggleTabBar:function(){this.tabBar.shouldShow?this.hideTabBarIfNeed():this.showTabBarIfNeed()},showCatalogIfNeed:function(){var e=this;this.$refs.catalogSidebar&&(this.catalog.shouldShow||(this.catalog.shouldShow=!0,this.$refs.catalogSidebar.show((function(){e.hideTTSIfNeed(),e.hideSettingIfNeed()}))))},hideCatalogIfNeed:function(){this.$refs.catalogSidebar&&this.catalog.shouldShow&&(this.catalog.shouldShow=!1,this.$refs.catalogSidebar.hide())},showTTSIfNeed:function(){this.tts.shouldShow||(this.tts.shouldShow=!0,this.hideCatalogIfNeed(),this.hideSettingIfNeed())},hideTTSIfNeed:function(){this.tts.shouldShow&&(this.tts.shouldShow=!1)},showSetting:function(){this.setting.shouldShow||(this.setting.shouldShow=!0,fe.default.reportCustomerExp("readerMoreSetting"),this.hideCatalogIfNeed(),this.hideTTSIfNeed())},hideSettingIfNeed:function(){this.setting.shouldShow&&(this.setting.shouldShow=!1)},reset:function(){qt=0,this.scrollWithAnimation=!1,this.loaded=!1,this.loading=!1,this.catalog.isAllCatalog=!1,this.hideCatalogIfNeed(),this.hideTTSIfNeed(),this.hideSettingIfNeed(),this.showTabBarIfNeed(),Yt=""},showDefaultEmptyView:function(){var e=this;this.emptyView={title:"加载失败",buttonLabel:"重试"},this.$nextTick((function(){e.shouldShowEmptyView=!0}))},showShelvesEmptyView:function(){var e=this;this.emptyView={title:"本书已下架",buttonLabel:"去书城发现更多好书"},this.$nextTick((function(){e.shouldShowEmptyView=!0,e.offshelfEmptyView=!0}))},hideEmptyView:function(){this.shouldShowEmptyView=!1,this.offshelfEmptyView=!1,this.emptyView={title:"",buttonLabel:""}},retryLoadReader:function(){this.book&&this.book.soldout>0?this.openBookstore():this.reader?this.loadChapter(this.reader.chapter):this.initBookData()},showLoading:function(){this.loading=!0,wx.showLoading({title:"加载中…"})},showLoadingIfNeed:function(){var e=this;setTimeout((function(){e.loaded||(e.loading=!0,wx.showLoading({title:"加载中…"}))}),300)},hideLoading:function(e){this.loaded=!0,this.loading?(wx.hideLoading(),this.loading=!1,e&&e()):e&&e()},uploadReadingProgressAndTime:function(){var e=this;if(this.reader&&this.book&&this.chapter&&this.book.lastChapterIdx&&0===this.book.type&&this.shouldShowChapterContent){var t=Math.floor((new Date).getTime()/1e3)-this.startTime;console.log("[reader time]: ",this.startTime,t),(!this.hasUserScrolled||t>this.REPORT_READ_TIME_INTERVAL/1e3+360)&&(this.startTime=Math.floor((new Date).getTime()/1e3),t=0);var o=0;t>60&&(o=this.reader.chapter.chapterIdx/this.book.lastChapterIdx*100);var a=this.isTTSPlaying?t:0,r=this.isTTSPlaying?0:t;this.$store.dispatch($.UPLOAD_READING_SCHEDULE_TIME,{book:this.book,chapter:this.chapter,readingTime:r,ttsTime:a,progress:Math.round(o),scrollTop:qt,ePubPageIndex:Yt}).then((function(){e.startTime=Math.floor((new Date).getTime()/1e3),e.hasUserScrolled=!1,console.log("reading progress uploaded")}))}},setNavigationBarTitleIfNeed:function(){this.prevChapter&&this.book?this.navigationBarTitle=this.book.title:this.navigationBarTitle="",this.book&&wx.setNavigationBarTitle({title:this.book.title})},loadCatalog:function(e){var t=this;e&&e.bookId&&this.$store.dispatch($.INIT_CHAPTERINFOS,{book:e}).then((function(){t.catalog.isAllCatalog=!0}))},initBookData:function(){var e=u()(l.a.mark((function e(){var t=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Kt=null,this.shouldDetectBlankScreen=!1,this.clearChapterContent=!0,e.abrupt("return",this.$store.dispatch($.INIT_BOOK_READER,this.initReaderData).then((function(){var e=t.book;console.log("initBookData: ",e),e&&e.isAllCatalog&&(t.catalog.isAllCatalog=!0),t.clearChapterContent=!1,setTimeout((function(){t.$store.dispatch($.LAST_APP_LOGINTIME),t.loadCatalog(e),t.isEPubMode&&t.$store.dispatch($.KV_LOG_REPORT,{itemname:"Wp_Reader_EPubMode"})}),200),t.isOffShelf&&!t.isTrialRead&&t.prevChapter&&t.prevChapter.chapterUid?t.showChapter(t.reader.catalog[0]):(t.setNavigationBarTitleIfNeed(),t.hideWhenCaptureIfNeed(),t.hideLoading((function(){t.hideEmptyView(),t.updateScrollTopWithRecords()})),t.initTTS(),t.sendBookIfNeed(),t.book&&0===t.book.finished&&t.$store.dispatch($.UPBOOK_NOTIFY,t.bookId))})).catch((function(e){if(t.hideLoading(),e&&-10001===e.errCode)return console.log("bookId changed !!!! older bookId:",t.bookId," new bookId: ",e.bookId),t.bookId=e.bookId,t.initReaderData.bookId=e.bookId,void t.initBookData();O.default.instance.injectCommon({renderError:1}).send(!0),t.showDefaultEmptyView(),console.log("Reader: ","加载失败",e),U.default.monitor({code:500,action:"reader_render_error"}),t.$store.dispatch($.REPORT_READER_FAIL)})).then((function(){t.uploadReadingProgressAndTime(),t.tryReceiveInfiniteGift();var e=t.book.cover&&t.book.cover.replace(/[a-z0-9]+_(\d+\.\w+)$/,"t9_$1"),o=t.book.intro.slice(0,200);t.bookInfoSEO={type:"general",uniq_id:t.book.bookId,title:t.book.title,thumbs:[t.book.cover],cover:e,digest:o,tags:[t.book.title,t.book.author,t.book.category,"免费小说","免费阅读","在线阅读","小说","阅读","电子书","读书"]},t.shouldDetectBlankScreen=!0,t.checkContentRenderingIssue(),Object(me.default)(t.$root.$mp.appOptions),t.$store.dispatch($.KV_LOG_REPORT,{itemname:"Wp_reader_Entry"}),t.isTrialRead&&t.$store.dispatch($.KV_LOG_REPORT,{itemname:"Wp_reader_Entry_Trial"}),t.$store.dispatch($.BALANCE),t.prepareShareImage(),t.claimRebates(),t.bottomButtonExpose(),t.reportPurchaseExpose();var a=t.$root.$mp.query.from;O.default.instance.init({page:"reader",selector:".reader_performance_tracker",common:{from:a||""}}),t.$nextTick((function(){t.needsPurchase&&U.default.analysisLog("mp_reader_need_Purchase");var e=t.user,o=e.userActiveType,a=e.birdBox,r=e.birdBoxyw;U.default.analysisLog("mp_reader_user_identity",{identity:""+o,birdBox:a?1:0,birdBoxyw:r?1:0})})),a&&a.indexOf("ad_")>-1&&(U.default.reportKVLog({itemname:"Wp_source_ad_all"}),fe.default.reportExp("ad_all","act"),fe.default.reportClk("ad_all","act"),fe.default.reportExp(a,"act"),fe.default.reportClk(a,"act"))})));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),claimRebates:function(){this.$root.$mp.query.packetId&&U.default.claimRebates({packetId:this.$root.$mp.query.packetId})},setKeepScreenOn:function(e){wx.setKeepScreenOn&&wx.setKeepScreenOn({keepScreenOn:e})},tryReceiveInfiniteGift:function(){var e=this,t=this.$root.$mp.appOptions.query||{};Object(F.shouldShowInfiniteCard)({isIndexPage:!1,campaign:t.campaign})&&Object(F.default)().then((function(t){e.$refs.infiniteCardPrompt.show(t)})).catch((function(e){console.error("[InfiniteCard]",e.message)}))},changeTheme:function(e){e!==this.theme&&(this.$store.commit($.THEME,{theme:e}),this.adjustStatusBarColor(),"dark"===e?this.$store.dispatch($.KV_LOG_REPORT,{itemname:"Wp_changeTheme_dark_Clk"}):this.$store.dispatch($.KV_LOG_REPORT,{itemname:"Wp_changeTheme_light_Clk"}))},setDefaultStatusBarColor:function(){wx.setNavigationBarColor({frontColor:"#000000",backgroundColor:"#ffffff",animation:{duration:400,timingFunc:"easeIn"}})},adjustStatusBarColor:function(){"dark"===this.theme?wx.setNavigationBarColor({frontColor:"#ffffff",backgroundColor:"#000000",animation:{duration:400,timingFunc:"easeIn"}}):this.setDefaultStatusBarColor()},initRewardedVideoAd:function(){var e=this;wx.createRewardedVideoAd&&(this.rewardedVideoAd=wx.createRewardedVideoAd({adUnitId:"adunit-71cffaf28eed7140",multiton:!1}),this.rewardedVideoAd.onError((function(t){console.log("阅读激励广告异常",t),e.isVideoLoaded&&(console.log("视频组件异常，切换状态"),e.isVideoLoaded=!1)})),this.rewardedVideoAd.onClose(this.handleAdFinished),this.rewardedVideoAd.load().then((function(){e.isVideoLoaded=!0,console.log("阅读器激励广告创建","adunit-71cffaf28eed7140")})))},handleAdFinished:function(e){var t=this;this.isVideoPlaying=!1,e&&e.isEnded&&U.default.reportReaderAdUnlock(this.bookId).then((function(e){e&&e.dateWatermark&&(t.$store.commit($.UPDATE_BOOKREADER_UNLOCK_STATUS,e),t.retryLoadReader())})).catch((function(e){console.error("视频激励广告更新数据错误",e)}))},unloadRewardedVideoAd:function(){this.rewardedVideoAd.offClose&&this.rewardedVideoAd.offClose(this.handleAdFinished)},handleUnlockChapterWithAdWatch:function(){var e=this;if(!this.isVideoLoaded||this.isVideoPlaying)return!1;U.default.analysisLog("mp_reader_adWatchUnlock_click"),wx.showLoading({title:"广告载入中"}),this.rewardedVideoAd.load().then((function(){e.rewardedVideoAd.show().then((function(){console.log("开始播放阅读器视频广告"),wx.hideLoading(),e.isVideoPlaying=!0}))})).catch((function(t){console.log("广告组件异常: ",t),wx.hideLoading(),wx.showToast({title:"广告载入失败，暂时没有可观看广告",icon:"none"}),e.isVideoLoaded=!1,e.isVideoPlaying=!1,e.unloadRewardedVideoAd()}))},handleHeaderInfoAuthorClick:function(){this.book&&this.book.author&&(this.$store.dispatch($.KV_LOG_REPORT,{itemname:"Wp_Reader_Author_Clk"}),wx.navigateTo({url:"/pages/featuredBooks/main?type=author&keyword="+this.book.author}))},handleIntroClick:function(){this.$refs.bookIntroModal.showModal()},handleHeadInteractiveReadingClick:function(){fe.default.reportCustomerPfClk("readerInteractiveReading"),this.csSource="readerInteractiveReading",this.csDetailType="friends",this.$refs.customerServicePrompt.action()},handleHeaderBottomDownloadButtonClick:function(){fe.default.reportClk("readerHeadBottomButton"),this.$refs.customerServicePrompt.action()},reportPurchaseExpose:function(){var e=this;setTimeout((function(){console.log("try to report purchase"),e.needsPurchase&&(e.isAndroid&&e.isBookPurchase?e.$store.dispatch($.KV_LOG_REPORT,{itemname:"Wp_BuyBook_Btn_Exp"}):e.isAndroid&&e.$store.dispatch($.KV_LOG_REPORT,{itemname:"Wp_BuyChapter_Btn_Exp"}))}),2e3)},shouldShowReaderLongPressPromt:function(){if(this.$store.getters.shouldBlockedUser)return console.log("shouldBlockedUser"),!1;var e=E.default.getStorageSync("readerLongPressPromt");return!((new Date/1e3|0)-e<86400&&(console.log("readerLongPressPromt 间隔时间不足"),1))},handleBookContentLongPress:function(){if(console.log("handleBookContentLongPress clicked"),!this.shouldShowReaderLongPressPromt())return console.log("reader longpress, but not show promt"),!1;var e=new Date/1e3|0;E.default.setStorageSync("readerLongPressPromt",e),fe.default.reportCustomerPfClk("readerContentLongPress"),this.csSource="readerContentLongPress",this.csDetailType="features",this.$refs.customerServicePrompt.action()},handleShareFreeButtonClick:function(){var e=this;setTimeout((function(){e.$store.dispatch($.REWARD_FROM_SHARE,{bookId:e.bookId}).then((function(){wx.showToast({title:"解锁成功",icon:"none"}),e.loadChapter(e.reader.chapter,!1)})).catch((function(e){console.log("Reader: ","分享解锁章节失败",e),wx.showToast({title:e.msg,icon:"none"})}))}),2e3),this.$store.dispatch($.KV_LOG_REPORT,{itemname:"Wp_ShareGetChapter_Clk"})},handleBuyChapterButtonClick:function(){var e=this;this.$store.dispatch($.KV_LOG_REPORT,{itemname:"Wp_BuyChapter_Btn_Clk"}),this.$store.dispatch($.BALANCE).then((function(){e.$refs.buyBookConfirmation.showModal()})).catch((function(t){console.error("[balance err]",t),e.$refs.buyBookConfirmation.showModal()}))},handleBuyBookButtonClick:function(){var e=this;this.$store.dispatch($.KV_LOG_REPORT,{itemname:"Wp_BuyBook_Btn_Clk"}),this.$store.dispatch($.BALANCE),this.$store.dispatch($.BALANCE).then((function(){e.$refs.buyBookConfirmation.showModal()})).catch((function(t){console.error("[balance err]",t),e.$refs.buyBookConfirmation.showModal()}))},handleBuyFinish:function(e){this.$refs.buyBookConfirmation.closeModal(),e.refresh&&this.initBookData()},handleRechargeButtonClick:function(){var e=this;this.isAndroid?(this.$refs.buyBookConfirmation.closeModal(),this.$refs.rechargeBookConfirmation.showModal()):wx.showModal({title:"充值失败",content:"因苹果政策，小程序内无法充值书币，请在微信读书 app 内充值。",showCancel:!1,complete:function(){e.$emit("finish",null)}})},handleChapterActionsSubmit:function(e){},handleRechargeFinish:function(e){wx.showToast({title:e}),this.$refs.rechargeBookConfirmation.closeModal()},handleShuffleSimilarBook:function(){this.$store.dispatch($.SIMILAR_BOOKS,{bookId:this.bookId,count:6})},handleInviteFriendButtonClick:function(){var e=this;setTimeout((function(){e.$store.dispatch($.KV_LOG_REPORT,{itemname:"Wp_Reader_ShareInfinite_Clk"}),wx.showToast({title:"分享成功, 快邀请朋友们点击你分享的链接吧",icon:"none",duration:3e3})}),2e3)},handleCatalogButtonClick:function(){var e=this;return u()(l.a.mark((function t(){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.catalog.shouldShow?(console.log("[Reader]","目录关"),e.hideCatalogIfNeed()):(console.log("[Reader]","目录开"),e.showCatalogIfNeed());case 1:case"end":return t.stop()}}),t,e)})))()},handleTTSButtonClick:function(){var e=this;return u()(l.a.mark((function t(){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.tts.shouldShow?(console.log("[Reader]","TTS 预览面板关"),e.hideTTSIfNeed()):(console.log("[Reader]","TTS 预览面板开"),e.showTTSIfNeed());case 1:case"end":return t.stop()}}),t,e)})))()},handleCatalogSidebarSort:function(){var e=this.reader.isDescend?$.LOAD_CATALOG_INIT:$.LOAD_CATALOG_REVERSE;this.$store.commit(e,{bookId:this.bookId})},handleCatalogSidebarCancelAutoPay:function(){this.$refs.cancelAutoPayConfirmation.showModal()},handleCatalogSidebarShowChapter:function(e){var t=e.chapter;this.showChapter(t)},handleTTSSettingButtonClick:function(){this.ttsSetting.shouldShow?this.hideTTSSetting():this.showTTSSetting()},handleTTSSettingMaskClick:function(){this.hideTTSSetting()},handleTTSSpeedSliderChange:function(e){if(Gt){var t=e.mp.detail.value;this.ttsSetting.speedIndex=t,Gt.updateAudioSetting({spd:this.ttsSettingSpeedValue}),this.playChapterContent(this.playingParagraphIndex)}else console.log("不支持TTS")},handleTTSSettingVoiceItemClick:function(e){Gt?(this.ttsSetting.voiceIndex=e,Gt.updateAudioSetting({per:this.ttsSettingVoiceValue}),this.playChapterContent(this.playingParagraphIndex)):console.log("不支持TTS")},handleSettingButtonClick:function(){this.setting.shouldShow?this.hideSettingIfNeed():this.showSetting()},handleBookshelfButtonClick:function(){this.book.isOnBookShelf?this.removeFromShelfIfNeed():this.addToShelfIfNeed()},handleBottomBarSubmit:function(e){},handleMainScroll:function(e){this.hasUserScrolled||(this.hasUserScrolled=!0);var t=e.mp.detail;this.isLowPerformanceDevice||(t.scrollTop+this.windowHeight>t.scrollHeight-10?(this.isReachBottom||(this.isReachBottom=!0),this.showTabBarIfNeed()):(this.isReachBottom&&(this.isReachBottom=!1),this.hideTabBarIfNeed())),void 0!==t.scrollTop&&(qt=t.scrollTop)},handleAudioPlay:function(){var e=this;if(this.$store.dispatch($.KV_LOG_REPORT,{itemname:"Wp_TTS_play_Clk"}),this.book&&this.book.shouldHideTTS)return wx.showToast({icon:"none",title:"应版权方要求，本书暂不支持"}),void this.$store.dispatch($.KV_LOG_REPORT,{itemname:"Wp_TTS_play_Hide_TTS"});if(this.isTrialRead){if(!this.isTrialChapter)return void wx.showToast({icon:"none",title:"应版权方要求，本书仅支持试读"});this.$store.dispatch($.KV_LOG_REPORT,{itemname:"Wp_TTS_play_trial_Enter"})}var t=wx.createSelectorQuery();this.isEPubMode?this.generateEPubTTSArray((function(t){var o=t.filter((function(t){return t.top>e.navBarHeight}));if(o[0]&&o[0].text){var a=o[0].text,r=e.bookContent.findIndex((function(e){return a&&a.indexOf(e)>-1||a&&e&&a.split(" ").join("")===e.split(" ").join("")}))||0;e.handleOpenLecture(r)}else e.handleOpenLecture(0)})):t.selectAll(".reader_chapter_content_paragraph").boundingClientRect((function(t){var o=t.find((function(t){return t.top>e.navBarHeight}));o=o||{};var a=parseInt(o.id&&o.id.substring(2)||0);e.handleOpenLecture(a)})).exec()},handleAudioStop:function(){this.$store.dispatch($.KV_LOG_REPORT,{itemname:"Wp_TTS_stop_Clk"}),this.stopTTS()},stopTTS:function(){Gt&&Gt.pauseTTS(),this.isTTSPlaying=!1,this.clearHighlightParagraph()},clearHighlightParagraph:function(){this.playingParagraphIndex=null,this.ePubHighlightParaId=""},showingTitle:function(e){return e?this.book&&"epub"===this.book.format?e.title:"第"+e.chapterIdx+"章 "+e.title:""},initTTS:function(){var e=(Gt=new _e).getAudioSetting();this.ttsSetting.speedIndex=this.getTtsSettingItemIndexWithValue(e.spd,1,this.ttsSetting.speedList),this.ttsSetting.voiceIndex=this.getTtsSettingItemIndexWithValue(e.per,0,this.ttsSetting.voiceList)},generateEPubTTSArray:function(e){wx.createSelectorQuery().selectAll(".wxParse ._text").boundingClientRect((function(t){var o=t.filter((function(e){return e.dataset.text&&e.dataset.text.length})).reduce((function(e,t){var o;o=t.id&&t.id.split("--")&&t.id.split("--").length&&t.id.split("--").length>1?t.id.split("--")[0]:t.id;var a=e.find((function(e){return e.id===o}));if(a)a.text=(a.text||"")+t.dataset.text;else{var r={id:o,text:t.dataset.text,top:t.top};e.push(r)}return e}),[]);e&&e(o)})).exec()},playChapterContent:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return u()(l.a.mark((function o(){var a,r,i,n,s,d;return l.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(e.book.wxtts){o.next=3;break}return e.$refs.customerServicePrompt.action(),o.abrupt("return");case 3:return a=function(){console.log("backgroundAudioManager onNext"),e.gotoPlayNextChapter(e.chapter)},r=function(){console.log("backgroundAudioManager onPrev"),e.gotoPlayPrevChapter(e.chapter)},i=function(){console.log("backgroundAudioManager onPause"),e.stopTTS()},o.next=8,Gt.initPlayer({bookTitle:e.book.title,author:e.book.author,cover:e.book.cover,playNextCallback:a,playPrevCallback:r,pauseCallback:i});case 8:(n=[]).push(e.showingTitle(e.chapter)),n=n.concat(e.bookContent),s=function(t,o){if(t>0&&e.chapter.chapterUid===o.chapterUid)if(e.isEPubMode){var a=n[t];e.generateEPubTTSArray((function(o){var r=o.find((function(e){return e.text.split(" ").join("")===a.split(" ").join("")||e.text.indexOf(a)>-1}));if(r){var i=o.findIndex((function(e){return e.text.split(" ").join("")===a.split(" ").join("")||e.text.indexOf(a)>-1}));e.playingParagraphIndex=t-1,e.ePubHighlightParaId=r.id,e.scrollIntoViewId=r.id,e.scrollWithAnimation=!0,e.hasUserScrolled=!0,c()(e.scrollTop)&&(qt=e.scrollTop),Qt=i===o.length-1}else!Qt&&r||(e.gotoNextChapter(),Qt=!1,e.ePubHighlightParaId="",e.scrollIntoViewId="",e.playingParagraphIndex=t-1,e.hasUserScrolled=!0)}))}else e.playingParagraphIndex=t-1,e.scrollIntoViewId="p_"+e.playingParagraphIndex,e.scrollWithAnimation=!0,e.hasUserScrolled=!0,c()(e.scrollTop)&&(qt=e.scrollTop)},d=function(t){e.nextChapter?e.gotoPlayNextChapter(t):(e.stopTTS(),e.isTTSPlaying=!1)},Gt.playFromParagraphIndex(t,e.chapter,n,s,d),e.isTTSPlaying=!0;case 15:case"end":return o.stop()}}),o,e)})))()},gotoPlayNextChapter:function(e){var t=this,o=this.$store.getters.nextChapter(this.bookId,e);o?this.loadChapter(o).then((function(){t.scrollIntoViewId="chapterTitle",setTimeout((function(){t.playChapterContent(0)}),1e3)})).catch((function(e){console.log(e),t.stopTTS()})):console.log("has no next chapter")},gotoPlayPrevChapter:function(e){var t=this,o=this.$store.getters.prevChapter(this.bookId,e);o?this.loadChapter(o).then((function(){t.scrollIntoViewId="chapterTitle",setTimeout((function(){t.playChapterContent(0)}),1e3)})).catch((function(e){console.log(e),t.stopTTS()})):console.log("has no prev chapter")},handlePurchasePrompt:function(){fe.default.reportClk("readerContentBottom"),this.$refs.customerServicePrompt.action()},checkContentRenderingIssue:function(){var e=this;Object(M.a)("pages/reader/main",(function(){return new _.a((function(t,o){e.shouldDetectBlankScreen||o(new Error("还在加载中，不检查渲染问题")),(!e.isBookValid||e.isOffShelf||e.isTrialRead)&&o(new Error("本书已下架，不检查渲染问题")),e.supportedBook||o(new Error("本书不是小程序支持的书籍类型，不检查渲染问题"));var a=[],r=[];return[".reader_chapter_index",".reader_chapter_title",".reader_head_info_title",".reader_chapter_wxParse"].forEach((function(e){r.push(new _.a((function(t){wx.createSelectorQuery().selectAll(e).boundingClientRect((function(e){e.forEach((function(e){a.push({id:e.id,height:e.height})})),t()})).exec()})))})),_.a.all(r).then((function(){console.log("检查渲染问题",e.loading,a),0===a.length?t():o(new Error("经过检查，没有渲染问题"))}))}))}))},gotoWebviewPromptPage:function(){wx.navigateTo({url:"/pages/webview/main?url="+encodeURIComponent("http://mp.weixin.qq.com/s?__biz=MzA5OTE5NTI5Mw==&mid=502670862&idx=1&sn=b5c52395853da613eb5eb83c1d526359&chksm=088486fc3ff30fead70083116b1402e6e318ad11f66e51ec54eeb08979781447a6f0fb2c3a22#rd")+"&title=微信读书"})},outputPageStack:function(){var e=getCurrentPages();e.length&&(console.log("[阅读器]","输出阅读器页面堆栈"),e.forEach((function(e){console.log(e.route)})))},handleUserInfoAuthorization:function(e){var t=this;e&&e.target&&e.target.userInfo?N.default.handleUserInfoAuthorization(e,(function(){t.gotoNextChapter(),t.$store.dispatch($.UPDATE_USERINFO)}),(function(){t.gotoNextChapter()})):this.gotoNextChapter()},handleUserInfoAuthorizationWithReview:function(e){var t=this;e&&e.target&&e.target.userInfo&&N.default.handleUserInfoAuthorization(e,(function(){t.$store.dispatch($.UPDATE_USERINFO)}))},prepareShareImage:function(){if(this.book&&this.book.cover&&this.supportedBook&&!isNaN(this.book.bookId)&&!this.book.soldout){console.debug("prepare share image",this.book);var e=this.book;return Object(je.default)({imageURL:e.cover.replace("s_","t4_")}).catch((function(){return Object(je.default)({imageURL:e.cover.replace("s_","t5_")})})).then((function(o){var a=Object(at.getBookRatingInfo)(e),r="text";"rate"===a.type?r="rate":"image"===a.type&&(r="svg");var i=e.readingCount,n=a.rating||0,s=t(a.raters),c=t(i||0),d=e.bookId+"_"+r+"_"+n+"_"+s+"_"+c;if("text"===r){var l="待评分"===a.title?0:1;d=e.bookId+"_"+r+"_"+l+"_"+s+"_"+c}else if("svg"===r){var h=a.score;d=e.bookId+"_"+r+"_"+h+"_"+s+"_"+c}return Object(We.default)({templateId:"book_share_v2",cacheKey:d,replacements:{"%TYPE%":r,"%COVER%":o,"%BOOKID%":e.bookId,"%TITLE%":e.title,"%AUTHOR%":e.author,"%RATING%":a.rating,"%RATERS%":a.raters,"%READERS%":i||1,"%SCORE%":a.score,"%RATING_TEXT%":a.title}})})).then((function(e){Kt=e})).catch((function(){Kt=null}))}function t(e){return e?e>=1e4?Math.round(e/1e3):e>=1e3?Math.round(e/100):e>=100?Math.round(e/50):Math.round(e/10):0}},closePinTip:function(){L.store.dispatch(L.PIN_TIPS_SHOWN,{hasShown:1})},handleAdLoad:function(){U.default.reportKVLog({itemname:"Ad_Load"}),this.shouldShowAd=!0},handleAdError:function(e){console.log("[Ad] error",e.mp.detail),U.default.reportKVLog({itemname:"Ad_Error",value:e.mp.detail.errCode}),this.shouldShowAd=!1},handleAdClose:function(){U.default.reportKVLog({itemname:"Ad_Close"}),this.shouldShowAd=!1},handleUnlockBookWithInviteFriend:function(){console.log("invite clicked"),U.default.analysisLog("mp_reader_shareUnlock_click"),wx.showToast({icon:"none",title:"好友点击你分享的链接后，今日即可免费阅读本书",duration:5e3})},sendBookIfNeed:function(){var e=this,t=this.$root.$mp.query.campaignType,o=this.$root.$mp.query.campaignId,a=parseInt(this.$root.$mp.query.senderVid),r=this.bookId,i=parseInt(this.$root.$mp.query.type),n=parseInt(this.authorVid),s=parseInt(this.$root.$mp.query.timestamp),c=this.$root.$mp.query.scene,d=this.$root.$mp.query.sn;if(t&&o&&a&&r){ke.a.reportExp({source:"mp|reader",campaignType:t,campaignId:o,senderVid:a,bookId:r,type:i,authorVid:n,timestamp:s,scene:c,sn:d});var l=o.split("_");l&&l[0]&&(fe.default.reportExp(l[0],"act"),fe.default.reportClk(l[0],"act"));var h=N.default.getUser();if(!h||!h.vid)return console.error("sendBookIfNeed","无法判断身份，不能触发赠书"),this.reportShareGiftLogError("无法判断身份，不能触发赠书");if(h.vid===a)return console.log("sendBookIfNeed","本人打开，不触发赠书"),this.reportShareGiftLogInfo("本人打开，不触发赠书");if("shareOneGetOne"===t)return U.default.shareOneGetOneRedeem({campaignId:o,senderVid:a,bookId:r});if("shareOneGetOne2"===t){var u=l[1];return u?void 0===i?(console.log("sendBookIfNeed "+t,"缺少类型参数",i),this.reportShareGiftLogError("缺少类型参数")):s&&c&&d?U.default.shareGetRedeem({bookId:r,type:i,scene:c,timestamp:s,sn:d,vol:u,senderVid:a,authorVid:n}).then((function(e){console.log("sendBookIfNeed "+t+" succeed",e)})).catch((function(o){return o.data&&-2653===o.data.errcode?(console.log("sendBookIfNeed "+t+" failed",o),wx.showToast({title:"本周你已帮其他用户解锁过该福利",icon:"none"}),e.reportShareGiftLogInfo("本周你已帮其他用户解锁过该福利")):o.data&&-2656===o.data.errcode?(console.log("sendBookIfNeed "+t+" failed",o),e.reportShareGiftLogInfo("活动已过期")):(console.error("sendBookIfNeed "+t+" failed",o),e.reportShareGiftLogErrorWithCode("领取失败",o.data&&o.data.errcode))})):(console.log("sendBookIfNeed "+t,"缺少验证参数",s,c,d),this.reportShareGiftLogError("缺少验证参数")):(console.log("sendBookIfNeed "+t,"缺少期数",u),this.reportShareGiftLogError("缺少期数"))}}else console.log("sendBookIfNeed","无有效赠书参数，不触发赠书",t,o,a,r)},bottomButtonExpose:function(){this.user.userActiveType&&this.shouldShowReaderUnlock&&this.needsPurchase&&(U.default.analysisLog("mp_reader_shareUnlock_expose"),this.readerUnlockStatus&&this.readerUnlockStatus.readerAdWatchRemainTimes>0&&this.isVideoLoaded&&U.default.analysisLog("mp_reader_adWatchUnlock_expose"))},updateScrollTopWithRecords:function(e){var t=E.default.getStorageSync(this.bookId)||{},o=this.reader&&this.reader.wpChapterOffset?this.reader.wpChapterOffset:0,a=e||(this.chapter&&this.chapter.chapterUid?this.chapter.chapterUid:"");a&&(t&&a===t.chapterUid?this.scrollTop=t.scrollTop:this.scrollTop=o||0)},handleOpenLecture:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this.chapter&&this.chapter.chapterUid||0,o="/pages/lecture/player/main?type=TTS&bookId="+this.bookId+"&chapterUid="+t+"&paragraphIdx="+e;this.isToLecture=!0,wx.redirectTo({url:o})},gotoParagraph:function(e){var t=this,o=[];if(o.push(this.showingTitle(this.chapter)),o=o.concat(this.bookContent),this.isEPubMode){var a=o[e];this.generateEPubTTSArray((function(o){var r=o.find((function(e){return e.text.split(" ").join("")===a.split(" ").join("")||e.text.indexOf(a)>-1}));if(r){var i=o.findIndex((function(e){return e.text.split(" ").join("")===a.split(" ").join("")||e.text.indexOf(a)>-1}));t.hasUserScrolled=!0,c()(t.scrollTop)&&(qt=t.scrollTop),Qt=i===o.length-1}else!Qt&&r||(Qt=!1,t.ePubHighlightParaId="",t.scrollIntoViewId="",t.playingParagraphIndex=e-1,t.hasUserScrolled=!0)}))}else this.scrollWithAnimation=!0,this.hasUserScrolled=!0,c()(this.scrollTop)&&(qt=this.scrollTop)},gotoLastFreeChapter:function(){var e=this;return qt=0,this.scrollTop=0,this.loadChapter(this.lastFreeChapter).then((function(){e.isSwitchingChapter=!1}))},hideWhenCaptureIfNeed:function(){this.book&&this.shouldPayChapterBook&&0===this.book.finished&&this.chapter.chapterIdx>this.book.lastChapterIdx-5?(console.log("should hidden when capture"),wx.setVisualEffectOnCapture&&(console.log("set capture effect"),wx.setVisualEffectOnCapture({visualEffect:"hidden",success:function(){U.default.analysisLog("mp_reader_capture_hidden",{succeed:1})},fail:function(){U.default.analysisLog("mp_reader_capture_hidden",{failed:1})}}))):(console.log("should not hidden when capture"),wx.setVisualEffectOnCapture&&wx.setVisualEffectOnCapture({visualEffect:"none",success:function(){U.default.analysisLog("mp_reader_capture_none",{succeed:1})},fail:function(){U.default.analysisLog("mp_reader_capture_none",{failed:1})}}))}},onUnload:function(){this.uploadReadingProgressAndTime(),this.isToLecture||this.$store.commit($.ON_UNLOAD_READER,this.bookId),this.reset(),clearInterval(zt),this.setKeepScreenOn(!1),this.isFromLecture=!1,this.isToLecture=!1},onShow:function(){var e=this;console.log("[onShow] pages/reader/main"),this.$refs.navigationBar&&this.$refs.navigationBar.refreshControls(),this.setNavigationBarTitleIfNeed();var t,o=getCurrentPages();if(o.length&&o[o.length-1].options){var a=o&&o[o.length-1].options.bookId,r=o&&o[o.length-1].options.chapterUid;this.$root.$mp.query&&a!==this.$root.$mp.query.bookId&&(console.log("reset bookId:",this.$root.$mp.query.bookId,"realBookId:",a),this.bookId=a,this.updateScrollTopWithRecords(r))}if(this.bookId){this.updateScrollTopWithRecords();var i=E.default.getStorageSync(this.bookId+"_subscribe");i&&(this.subscribedChapter=i.chapterUid)}wx.removeStorage({key:"shouldRecoverReader"}),zt=setInterval((function(){e.uploadReadingProgressAndTime()}),this.REPORT_READ_TIME_INTERVAL),this.updateLaunchScene(),1014===this.scene&&this.$store.dispatch($.KV_LOG_REPORT,{itemname:"Wp_Reader_Show_FromSubscribe"}),this.markAsSecret=!(this.$root.$mp.query&&this.$root.$mp.query.publicByDefault),console.log("加入书架时自动私密",this.markAsSecret),this.reportReaderHeadBottomButton=(t=!1,function(){t||(fe.default.reportExp("readerHeadBottomButton"),t=!0)})},onHide:function(){console.log("reader onHide"),O.default.instance.disconnect(),this.uploadReadingProgressAndTime(),clearInterval(zt),this.navigationBarTitle=""},onShareAppMessage:function(e){var t=this.chapter&&this.chapter.chapterUid||0,o="/pages/reader/main?bookId="+this.bookId+"&chapterUid="+t,a=this.book&&this.book.title||"微信读书",r=Kt||"",i=this.profile,n=N.default.getUser();if(e&&e.target&&e.target.id)if("shareFreeButton"===e.target.id)a=n.nickName+"邀请你来免费阅读好书",o="/pages/index/main?from=readerFreeShare";else if("inviteFriendButton"===e.target.id)o="/pages/index/main?from=readerInfiniteShare&fromVid="+n.vid,o+="&signupBenefitId="+i.signupBenefitId+"&userType="+n.userActiveType;else{if("shareUnlockButton"!==e.target.id)return Object(F.infiniteShareMessage)(e);o="/pages/reader/main?bookId="+this.bookId+"&fromVid="+n.vid+"&from=shareUnlock",a=n.name+" 邀你一起阅读"}return this.isImportedBook&&(a=n.nickName+"邀请你来免费阅读好书",o="/pages/index/main?from=importedBook",r="https://rescdn.qqmail.com/weread/cover/reader_share.f443a6025b.png"),console.log("reader onShareAppMessage url:",o),{title:a,imageUrl:r,path:o}},onLoad:function(e){var t=this;console.log("reader onload options:",n()(e)),this.showLoadingIfNeed(),this.initReaderQuery(e),this.initBookData().then((function(){if(t.isFromLecture)var e=setInterval((function(){t.generateEPubTTSArray((function(o){o.length&&(t.gotoParagraph(t.currentTTSParagraph),clearInterval(e))}))}),500)})),this.refreshHideAd(),Object(v.b)({fonts:[v.a.DIN_MEDIUM,v.a.DIN_BOLD]}),this.setKeepScreenOn(!0)}},Xt=o(7)(Zt,{render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("view",{class:[e.baseContainerSelector,e.themeSelector,e.deviceSelector],attrs:{"wx:scope-data":e.bookInfoSEO}},[o("navigation-bar",{ref:"navigationBar",attrs:{title:e.navigationBarTitle,"custom-selector":e.navBarCustomSelector,"color-scheme":e.theme,mpcomid:"0"}}),e._v(" "),o("view",{directives:[{name:"show",rawName:"v-show",value:e.reader&&e.reader.chapter,expression:"reader && reader.chapter"}],staticClass:"reader_performance_tracker"}),e._v(" "),e.shouldShowEmptyView?o("empty-view",{attrs:{title:e.emptyView.title,"button-label":e.emptyView.buttonLabel,eventid:"1_22",mpcomid:"15"},on:{click:e.retryLoadReader}}):e.reader&&e.book&&!e.loading?o("scroll-view",{staticClass:"reader_main",style:{height:"calc(100vh - "+e.navBarHeight+"px)"},attrs:{"scroll-top":e.scrollTop,"scroll-y":"true","enable-back-to-top":!0,"scroll-into-view":e.scrollIntoViewId,"scroll-with-animation":e.scrollWithAnimation,eventid:"1_21"},on:{click:e.toggleTabBar,scroll:e.handleMainScroll}},[o("view",{staticClass:"reader_empty_header",attrs:{id:"readerEmptyHeader"}}),e._v(" "),e.shouldShowHeader?o("view",{staticClass:"reader_head"},[o("view",{class:["reader_head_info",{reader_head_info_AlignItemsStart:e.book.isLongBookTitle}]},[o("book-cover",{attrs:{src:e.book.cover,mp:e.book.mpCover,"custom-selector":"wr_bookCover_Book108",alt:e.book.title,width:108,"audio-status":e.authorVid?1:0,mpcomid:"1"}}),e._v(" "),o("view",{staticClass:"reader_head_info_meta"},[o("view",{staticClass:"reader_head_info_title"},[e._v(e._s(e.book.title))]),e._v(" "),o("view",{staticClass:"reader_head_info_author",attrs:{"hover-class":"wr_commonActive","aria-label":"查看该作者的作品列表",eventid:"5_0"},on:{click:e.handleHeaderInfoAuthorClick}},[e._v("\n                        "+e._s(e.book.author)+"\n                    ")]),e._v(" "),e.book.readingCount&&e.book.readingCount>0?o("view",{staticClass:"reader_head_info_readers"},[e.readingFriends.length>0?o("view",{staticClass:"reader_head_info_readers_avatars_container"},[e._l(e.readingFriends,(function(e,t){return o("avatar",{key:t,attrs:{src:e.avatar,alt:e.name,size:20,clickable:!0,mpcomid:"2_"+t}})})),e._v(" "),o("view",{staticClass:"reader_head_info_readers_count"},[e._v("\n                                等"+e._s(e.bookReadingCount.number)+e._s(e.bookReadingCount.unit)+"人阅读\n                            ")])],2):o("view",{staticClass:"reader_head_info_readers_count_container"},[o("view",{staticClass:"reader_head_info_readers_count"},[e._v("\n                                "+e._s(e.bookReadingCount.number)+e._s(e.bookReadingCount.unit)+"人在读此书\n                            ")])])]):e._e(),e._v(" "),e.book.intro&&0!==e.book.intro.length?o("view",{key:"bookIntro",class:["reader_head_info_intro",{reader_head_info_intro_WithDisclosureIndicator:e.book.intro.length>=30},{reader_head_info_intro_without_readingCount:!e.book.readingCount}],attrs:{"hover-class":"wr_commonActive","aria-role":"button","aria-label":"显示简介浮层",eventid:"5_1"},domProps:{textContent:e._s(e.book.intro)},on:{click:function(t){t.stopPropagation(),e.handleIntroClick(t)}}}):o("view",{key:"bookIntroEmpty",staticClass:"reader_head_info_intro"},[e._v("\n                        暂无简介\n                    ")]),e._v(" "),e.shouldShowUpdateTime?o("view",{staticClass:"reader_head_info_update"},[e.book.chapterSize?o("text",[e._v(e._s(e.book.chapterSize)+"章 · ")]):e._e(),e._v(" "),!e.book.finished&&e.book.updateTime?o("text",[e._v("更新于 "+e._s(e.formattedUpdateTime))]):o("text",[e._v("已完结")])]):e._e()])],1),e._v(" "),e.isPoliticalSensitive?e._e():o("book-ratings",{attrs:{"is-imported-book":e.isImportedBook,"book-info":e.book,"is-without-button":!e.shouldShowHeaderBottomButton,mpcomid:"3"}}),e._v(" "),e.shouldShowHeaderBottomButton?o("button",{staticClass:"wr_btn wr_btn_Big reader_head_bottomBtn",attrs:{"hover-class":"wr_commonActive",eventid:"3_2"},on:{click:e.handleHeaderBottomDownloadButtonClick}},[e._v("\n                "+e._s(e.headerBottomDownloadButtonText)+"\n            ")]):e._e(),e._v(" "),e.shouldShowAd?o("view",{staticClass:"reader_ad"},[o("ad",{attrs:{"unit-id":"adunit-7fdf7d3e3d71c479",eventid:"4_3",mpcomid:"4"},on:{load:e.handleAdLoad,error:e.handleAdError,close:e.handleAdClose}})],1):e._e()],1):e._e(),e._v(" "),e.shouldShowHeader&&e.hasPaperBook&&e.paperBookDetailImages.length?o("view",{staticClass:"reader_paperbook_detail"},e._l(e.paperBookDetailImages,(function(e,t){return o("image",{key:e,staticClass:"reader_paperbook_detail_image",attrs:{src:e,mode:"widthFix"}})}))):e._e(),e._v(" "),e.shouldShowHeader&&e.similarBook.books.length>0&&!e.isPoliticalSensitive?o("book-recommend",{attrs:{"similar-book":e.similarBook,eventid:"2_4",mpcomid:"5"},on:{shuffle:e.handleShuffleSimilarBook}}):e._e(),e._v(" "),e.supportedBook&&e.reader.chapter?o("view",{class:{reader_chapter:!0,reader_chapter_insetBottom:e.shouldShowChapterContent||e.shouldShowReadFinishHint}},[e.prevChapter&&e.isTrialRead&&!e.isTrialChapter&&e.lastFreeChapter?o("view",{staticClass:"reader_chapter_prevChapterBtn",attrs:{"aria-role":"button","hover-class":"wr_commonActive",eventid:"3_5"},on:{click:e.gotoLastFreeChapter}},[o("text",[e._v("上一章")])]):e._e(),e._v(" "),e.shouldShowChapterContent?o("view",{staticClass:"reader_chapter_main_content"},[e.shouldShowFreeInfiniteReminder?o("view",{staticClass:"reader_chapter_reminder reader_chapter_reminder_Top reader_chapter_reminder_Gold"},[o("view",{staticClass:"reader_chapter_reminder_icon reader_chapter_reminder_icon_Infinite"}),e._v(" "),o("view",{staticClass:"reader_chapter_reminder_cnt"},[o("view",{staticClass:"reader_chapter_reminder_title"},[e._v("\n                            你正在使用无限卡免费阅读本书\n                        ")]),e._v(" "),e.infiniteRemainingDays>=0&&e.infiniteLabelText?o("view",{staticClass:"reader_chapter_reminder_desc"},[e._v("\n                            "+e._s(e.infiniteLabelText)+"\n                        ")]):e._e()])]):e._e(),e._v(" "),e.prevChapter||!e.prevChapter&&e.bookEPubData&&e.bookEPubData.sectionIndex>0?o("view",{staticClass:"reader_chapter_prevChapterBtn",attrs:{"aria-role":"button","hover-class":"wr_commonActive",eventid:"4_6"},on:{click:e.gotoPrevChapter}},[e.bookEPubData.sectionIndex>0?o("text",[e._v("上一页")]):o("text",[e._v("上一章")])]):e._e(),e._v(" "),"epub"!==e.book.format?o("view",{staticClass:"reader_chapter_index",style:e.indexStyleObj,attrs:{id:"chapterTitle"}},[e._v("\n                    第"+e._s(e.reader.chapter.chapterIdx)+"章\n                ")]):e._e(),e._v(" "),!e.isEPubMode||e.needsPurchase?o("view",{key:"chapterTitle",staticClass:"reader_chapter_title",style:e.titleStyleObj},[e._v("\n                    "+e._s(e.reader.chapter.title)+"\n                ")]):e._e(),e._v(" "),e.isEPubMode&&!e.clearChapterContent?o("wx-parse",{ref:"wxParse",attrs:{"class-name":"reader_chapter_wxParse",content:e.bookEPubContent,"style-str":e.contentStyleObj,"highlight-para-id":e.ePubHighlightParaId,mpcomid:"8"}}):e.bookContent&&e.bookContent.length>0&&!e.clearChapterContent?o("view",{key:"chapterContent",staticClass:"reader_chapter_content",style:e.contentStyleObj,attrs:{eventid:"4_7"},on:{longpress:e.handleBookContentLongPress}},[e._l(e.bookContentWithAd,(function(t,a){return[o("view",{key:a,class:["reader_chapter_content_paragraph",{reader_chapter_content_paragraph_Highlight:a===e.playingParagraphIndex}],attrs:{id:"p_"+a}},[o("text",{staticClass:"reader_chapter_content_paragraph_text"},[e._v(e._s(t.paragraph))])]),e._v(" "),t.adUnitId&&e.showInlineAd?o("reader-custom-ad",{key:a,attrs:{"custom-selector":"reader_chapter_content_paragraph_ad","unit-id":t.adUnitId,mpcomid:"6_"+a}}):e._e()]}))],2):e._e(),e._v(" "),o("form",{staticClass:"reader_chapter_actions",attrs:{id:"promForm","report-submit":"",eventid:"4_16"},on:{submit:e.handleChapterActionsSubmit}},[e.needsPurchase?[o("view",{staticClass:"reader_chapter_actions_previewMask"}),e._v(" "),e.shouldShowReaderUnlock?[o("view",{staticClass:"reader_chapter_actions_unlock_group"},[e.readerUnlockStatus.readerAdWatchRemainTimes>0&&e.isVideoLoaded?o("view",{staticClass:"wr_btn wr_btn_Big wr_btn_Gray reader_chapter_actions_adWatch",attrs:{"aria-role":"button","hover-class":"wr_commonActive",eventid:"8_8"},on:{click:function(t){t.stopPropagation(),e.handleUnlockChapterWithAdWatch(t)}}},[e._v("\n                                    看广告免费读 10 章\n                                ")]):e._e(),e._v(" "),e.user&&"brown"!==e.user.userActiveType?o("button",{staticClass:"wr_btn wr_btn_Big wr_btn_Gray reader_chapter_actions_inviteUser",attrs:{id:"shareUnlockButton","aria-role":"button","hover-class":"wr_commonActive","open-type":"share",eventid:"8_9"},on:{click:function(t){t.stopPropagation(),e.handleUnlockBookWithInviteFriend(t)}}},[e._v("\n                                    分享今日免费读\n                                ")]):e._e()],1),e._v(" "),e.shouldBlockedUser?e._e():o("button",{staticClass:"wr_btn wr_btn_Big reader_chapter_actions_promtBtn",attrs:{id:"purchasePromt","hover-class":"wr_commonActive","form-type":"submit",eventid:"7_10"},on:{click:function(t){t.stopPropagation(),e.handlePurchasePrompt(t)}}},[e._v("\n                                "+e._s(e.chapterContentBottomPromptText)+"\n                            ")])]:[e.isBookPurchase&&e.showPurchase?o("view",{key:"purchaseButton",staticClass:"wr_btn wr_btn_Big wr_btn_Gray reader_chapter_actions_purchaseBtn_Book",attrs:{id:"buyBook","aria-role":"button","hover-class":"wr_commonActive",eventid:"7_12"},on:{click:function(t){t.stopPropagation(),e.handleBuyBookButtonClick(t)}}},[e._v("\n                                购买本书 "+e._s(e.book.price.toFixed(2))+"\n                            ")]):e.showPurchase?o("view",{key:"purchaseButtonChapter",staticClass:"wr_btn wr_btn_Big wr_btn_Gray reader_chapter_actions_purchaseBtn_Chapter",attrs:{id:"buyChapter","aria-role":"button","hover-class":"wr_commonActive",eventid:"7_11"},on:{click:function(t){t.stopPropagation(),e.handleBuyChapterButtonClick(t)}}},[e._v("\n                                购买本章 "+e._s(e.reader.chapter.price)+"\n                            ")]):o("view",{staticClass:"reader_chapter_actions_tip"},[e._v("\n                                由于相关规范，购买功能暂不可用\n                            ")])]]:[e.nextChapter&&e.needAuthorized||e.needAuthorized&&!e.nextChapter&&e.bookEPubData.hasMore?o("button",{staticClass:"wr_btn wr_btn_Big wr_btn_Gray reader_chapter_actions_goNext_GetInfo",class:[e.isSwitchingChapter?"wr_btn_Disabled":""],attrs:{"aria-role":"wr_commonActive","form-type":"submit","open-type":"getUserInfo",eventid:"6_14"},on:{getuserinfo:e.handleUserInfoAuthorization}},[e.bookEPubData.hasMore?o("text",[e._v("下一页")]):o("text",[e._v("下一章")])]):e.nextChapter||!e.nextChapter&&e.bookEPubData.hasMore?o("button",{staticClass:"wr_btn wr_btn_Big wr_btn_Gray reader_chapter_actions_goNext",class:[e.isSwitchingChapter?"wr_btn_Disabled":""],attrs:{"aria-role":"button","hover-class":"wr_commonActive","form-type":"submit",eventid:"6_13"},on:{click:function(t){t.stopPropagation(),e.gotoNextChapter(t)}}},[e.bookEPubData.hasMore?o("text",[e._v("下一页")]):o("text",[e._v("下一章")])]):e._e()],e._v(" "),e.shouldShowReaderPromtBtn?o("button",{staticClass:"wr_btn wr_btn_Big reader_chapter_actions_promtBtn",attrs:{id:"purchasePromt","hover-class":"wr_commonActive","form-type":"submit",eventid:"5_15"},on:{click:function(t){t.stopPropagation(),e.handlePurchasePrompt(t)}}},[e._v("\n                        "+e._s(e.chapterContentBottomPromptText)+"\n                    ")]):e._e(),e._v(" "),o("view",{staticClass:"reader_chapter_actions_bottom"})],2)],1):e._e(),e._v(" "),e.shouldShowReadFinishHint?o("view",{class:["reader_chapter_backCover",{reader_chapter_backCover_noContent:!e.shouldShowChapterContent}]},[o("view",{staticClass:"reader_chapter_backCover_title"},[e._v(e._s(e.bookFinishHint.title))]),e._v(" "),e.book.totalReadingTime>0?o("view",{staticClass:"reader_chapter_backCover_desc"},[e._v("\n                    阅读"+e._s(e.bookReadingTime)+"\n                ")]):e._e(),e._v(" "),e.showSubscribeBookButton&&!e.isChapterSubscribed&&e.canUseSubscribeMessage?o("view",{class:[{reader_chapter_subscription:!0}]},[o("button",{staticClass:"wr_btn wr_btn_Big reader_chapter_subscription_btn",attrs:{"aria-role":"button","hover-class":"wr_commonActive","form-type":"submit",eventid:"5_17"},on:{click:function(t){t.stopPropagation(),e.subscribeBook(t)}}},[e._v("\n                        订阅下一章更新通知\n                    ")]),e._v(" "),o("view",{staticClass:"reader_chapter_subscription_introduction"},[e._v("订阅后，将通知你本书章节更新信息")])],1):o("view",{class:[{reader_chapter_subscription:!0}]},[o("button",{staticClass:"wr_btn wr_btn_Big reader_chapter_subscription_btn",attrs:{"aria-role":"button","hover-class":"wr_commonActive","form-type":"submit",eventid:"5_18"},on:{click:function(t){t.stopPropagation(),e.handlePurchasePrompt(t)}}},[e._v("\n                        "+e._s(e.bookFinishHint.btnText)+"\n                    ")])],1),e._v(" "),e.isPoliticalSensitive?e._e():o("book-ratings",{attrs:{"is-imported-book":e.isImportedBook,"show-ratings-tag":!1,"book-info":e.book,"custom-selector":"reader_chapter_backCover_book_ratings",mpcomid:"13"}}),e._v(" "),e.similarBook.books.length>0?o("view",{staticClass:"reader_chapter_related"},[o("view",{staticClass:"reader_chapter_related_head"},[o("view",{staticClass:"reader_chapter_related_head_title"},[e._v("继续阅读")])]),e._v(" "),o("view",{staticClass:"reader_chapter_related_list"},e._l(e.readFinishSimilarBook,(function(t,a){return o("view",{key:a,staticClass:"reader_chapter_related_item",attrs:{"hover-class":"wr_commonActive",eventid:"6_19_"+a},on:{click:function(o){o.stopPropagation(),e.openReader(t.bookId)}}},[o("book-cover",{attrs:{src:t.cover,alt:t.title,width:96,description:t.reason,mp:t.mpCover,mpcomid:"14_"+a}}),e._v(" "),o("view",{staticClass:"reader_chapter_related_item_title"},[e._v(e._s(t.title))])],1)}))),e._v(" "),e.similarBook.hasMore?o("button",{staticClass:"wr_btn wr_btn_Big wr_btn_Gray reader_chapter_related_head_more",attrs:{"hover-class":"wr_commonActive",eventid:"5_20"},on:{click:function(t){t.stopPropagation(),e.handleShuffleSimilarBook(t)}}},[e._v("\n                        换一批\n                    ")]):e._e()],1):e._e()],1):e._e(),e._v(" "),e.shouldShowAddShelfTips?o("view",{staticClass:"reader_chapter_reminder reader_chapter_reminder_Gray"},[o("view",{staticClass:"reader_chapter_reminder_cnt"},[o("view",{staticClass:"reader_chapter_reminder_title"},[e._v("你已阅读本书很久啦，喜欢的话就加入书架吧")]),e._v(" "),o("view",{staticClass:"reader_chapter_reminder_arrow"})])]):e._e()]):e._e()],1):e._e(),e._v(" "),e.book&&e.book.intro?o("IntroModal",{ref:"bookIntroModal",attrs:{title:"简介",content:e.book.intro,"book-id":e.book.bookId,mpcomid:"16"}}):e._e(),e._v(" "),e.supportedBook?o("Mask",{ref:"ttsSettingMask",attrs:{"custom-selector":"reader_ttsSettingMask",eventid:"1_23",mpcomid:"17"},on:{click:e.handleTTSSettingMaskClick}}):e._e(),e._v(" "),e.supportedBook?o("view",{class:["reader_ttsSetting",{reader_ttsSetting_Show:e.ttsSetting.shouldShow}]},[o("view",{staticClass:"reader_ttsSetting_head"},[o("view",{staticClass:"reader_ttsSetting_head_backBtn",attrs:{"hover-class":"wr_commonActive","aria-role":"button","aria-label":"关闭 TTS 设置浮层",eventid:"3_24"},on:{click:e.hideTTSSetting}},[o("view",{staticClass:"reader_ttsSetting_head_backBtn_icon"})]),e._v(" "),o("view",{staticClass:"reader_ttsSetting_head_title"},[e._v("设置")])]),e._v(" "),o("view",{staticClass:"reader_ttsSetting_cnt"},[o("view",{staticClass:"reader_ttsSetting_voice"},e._l(e.ttsSetting.voiceList,(function(t,a){return o("view",{key:a,class:["reader_ttsSetting_voice_item",{reader_ttsSetting_voice_item_Current:e.ttsSetting.voiceIndex===a}],attrs:{"hover-class":"wr_itemActive",eventid:"4_25_"+a},on:{click:function(t){e.handleTTSSettingVoiceItemClick(a)}}},[e._v("\n                    "+e._s(e.ttsSetting.voicePrefix+t.name)+"\n                ")])})))])]):e._e(),e._v(" "),!e.supportedBook||e.offshelfEmptyView||e.isOffShelf&&!e.isTrialRead?e._e():o("view",{class:["reader_bottomBar",{reader_bottomBar_Show:e.tabBar.shouldShow},{reader_bottomBar_ShowSetting:e.setting.shouldShow},{reader_bottomBar_ShowTTS:e.tts.shouldShow},{reader_bottomBar_ShowCatalog:e.catalog.shouldShow}]},[o("form",{attrs:{"report-submit":"",eventid:"2_36"},on:{submit:e.handleBottomBarSubmit}},[e.setting.shouldShow?o("view",{staticClass:"reader_bottomBar_setting"},[o("view",{staticClass:"reader_bottomBar_setting_top"},[o("view",{staticClass:"reader_bottomBar_setting_decreaseBtn"}),e._v(" "),o("CustomSlider",{attrs:{"custom-selector":"reader_bottomBar_setting_sliderWrap",min:0,max:6,value:e.setting.fontConfigIndex,eventid:"5_26",mpcomid:"18"},on:{change:e.handleFontSliderChange}}),e._v(" "),o("view",{staticClass:"reader_bottomBar_setting_increaseBtn"})],1),e._v(" "),o("view",{staticClass:"reader_bottomBar_setting_theme"},[o("view",{class:["reader_bottomBar_setting_theme_item","reader_bottomBar_setting_theme_item_Light",{reader_bottomBar_setting_theme_item_Curr:"light"===e.theme}],attrs:{"aria-role":"button","aria-label":"白色主题",eventid:"5_27"},on:{click:function(t){e.changeTheme("light")}}}),e._v(" "),o("view",{class:["reader_bottomBar_setting_theme_item","reader_bottomBar_setting_theme_item_Dark",{reader_bottomBar_setting_theme_item_Curr:"dark"===e.theme}],attrs:{"aria-role":"button","aria-label":"夜间模式",eventid:"5_28"},on:{click:function(t){e.changeTheme("dark")}}},[o("view",{staticClass:"reader_bottomBar_setting_theme_item_icon"})])])]):e._e(),e._v(" "),e.tts.shouldShow?o("view",{class:["reader_bottomBar_tts",{reader_bottomBar_tts_Playing:e.isTTSPlaying}]},[e.isTTSPlaying?o("view",{staticClass:"reader_bottomBar_tts_pauseBtn",attrs:{"aria-role":"button",eventid:"4_30"},on:{click:e.handleAudioStop}},[o("view",{staticClass:"reader_bottomBar_tts_pauseBtn_icon"})]):o("view",{staticClass:"reader_bottomBar_tts_playBtn",attrs:{"aria-role":"button",eventid:"4_29"},on:{click:e.handleAudioPlay}},[o("view",{staticClass:"reader_bottomBar_tts_playBtn_icon"})]),e._v(" "),o("view",{staticClass:"reader_bottomBar_tts_title"},[e._v("\n                    "+e._s(e.bottomBarTTSTitle)+"\n                ")]),e._v(" "),o("view",{staticClass:"reader_bottomBar_tts_preview",attrs:{"aria-role":"button","aria-label":"打开 TTS 设置","hover-class":"wr_commonActive",eventid:"4_31"},on:{click:e.handleTTSSettingButtonClick}},[o("rich-text",{staticClass:"reader_bottomBar_tts_preview_voice",attrs:{nodes:e.ttsSettingVoiceNameNodes,mpcomid:"19"}})],1)]):e._e(),e._v(" "),o("view",{staticClass:"reader_bottomBar_action"},[o("view",{staticClass:"reader_bottomBar_action_item reader_bottomBar_action_item_Catalog",attrs:{"aria-role":"button",eventid:"4_32"},on:{click:function(t){t.stopPropagation(),e.handleCatalogButtonClick(t)}}},[o("view",{staticClass:"reader_bottomBar_action_item_icon"}),e._v(" "),o("view",{staticClass:"reader_bottomBar_action_item_text"},[e._v("目录")])]),e._v(" "),o("view",{class:["reader_bottomBar_action_item","reader_bottomBar_action_item_TTS",{reader_bottomBar_action_item_Disabled:e.book.shouldHideTTS}],attrs:{"aria-role":"button",eventid:"4_33"},on:{click:function(t){t.stopPropagation(),e.handleAudioPlay(t)}}},[o("view",{staticClass:"reader_bottomBar_action_item_icon"}),e._v(" "),o("view",{staticClass:"reader_bottomBar_action_item_text"},[e._v("听书")])]),e._v(" "),o("view",{staticClass:"reader_bottomBar_action_item reader_bottomBar_action_item_Setting",attrs:{"aria-role":"button",eventid:"4_34"},on:{click:function(t){t.stopPropagation(),e.handleSettingButtonClick(t)}}},[o("view",{staticClass:"reader_bottomBar_action_item_icon"}),e._v(" "),o("view",{staticClass:"reader_bottomBar_action_item_text"},[e._v("设置")])]),e._v(" "),o("button",{class:["reader_bottomBar_action_item","reader_bottomBar_action_item_Bookshelf",{reader_bottomBar_action_item_BookshelfAdded:e.book.isOnBookShelf,reader_bottomBar_action_item_BookshelfAdd:!e.book.isOnBookShelf}],attrs:{"hover-class":"wr_active","form-type":"submit",eventid:"4_35"},on:{click:function(t){t.stopPropagation(),e.handleBookshelfButtonClick(t)}}},[o("view",{staticClass:"reader_bottomBar_action_item_inner"},[o("view",{staticClass:"reader_bottomBar_action_item_icon"}),e._v(" "),o("view",{staticClass:"reader_bottomBar_action_item_text"},[e._v(e._s(e.book.isOnBookShelf?"已加入书架":"加入书架"))])])])],1)])],1),e._v(" "),e.reader?o("pin-tips",{attrs:{mpcomid:"20"}}):e._e(),e._v(" "),o("infinite-card-prompt",{ref:"infiniteCardPrompt",attrs:{mpcomid:"21"}}),e._v(" "),e.reader&&e.reader.chapter&&e.profile&&e.supportedBook?o("alert",{ref:"buyBookConfirmation",attrs:{"needs-close-button":"true","animation-style":"slide","custom-selector":"reader_buyBookConfirmation_alert",mpcomid:"23"}},[o("BuyBook",{attrs:{book:e.book,chapter:e.reader.chapter,eventid:"2_37",mpcomid:"22"},on:{recharge:e.handleRechargeButtonClick,finish:e.handleBuyFinish}})],1):e._e(),e._v(" "),e.reader&&e.reader.chapter&&e.profile&&e.supportedBook?o("alert",{ref:"rechargeBookConfirmation",attrs:{"needs-close-button":"true","animation-style":"slide","custom-selector":"reader_rechargeBookConfirmation_alert",mpcomid:"25"}},[o("RechargeView",{attrs:{eventid:"2_38",mpcomid:"24"},on:{finish:e.handleRechargeFinish}})],1):e._e(),e._v(" "),e.supportedBook?o("alert",{ref:"cancelAutoPayConfirmation",attrs:{"custom-selector":"reader_cancelAutoPayConfirmation_alert",title:"是否关闭自动购买？",content:"关闭后，阅读到本书未购买章节均需手动购买确认。",buttons:e.cancelAutoPayConfirmationButtons,"animation-style":"slide",eventid:"1_39",mpcomid:"26"},on:{confirm:e.cancelAutoPay}}):e._e(),e._v(" "),e.supportedBook?o("alert",{ref:"bookRemovalConfirmation",attrs:{"custom-selector":"reader_bookRemovalConfirmation_alert",title:"移出书架",content:e.bookRemovalConfirmationContent,buttons:e.bookRemovalConfirmationButtons,eventid:"1_40",mpcomid:"27"},on:{delete:e.confirmBookRemoval}}):e._e(),e._v(" "),o("CustomerServicePrompt",{ref:"customerServicePrompt",attrs:{source:e.csSource,"detail-type":e.csDetailType,mpcomid:"28"}}),e._v(" "),o("CustomerServicePrompt",{ref:"shelfFullPrompt",attrs:{source:"reader","detail-type":"paying","color-style":"golden",header:"请在微信读书 app",intent:"升级为付费会员","alter-divider":"付费特权","blocked-user-message":"书架已达上限，请升级为付费会员",mpcomid:"29"}}),e._v(" "),o("SubscribeBookPrompt",{ref:"subscribeBookPrompt",attrs:{mpcomid:"30"}}),e._v(" "),e.reader&&e.supportedBook?o("CatalogSidebar",{ref:"catalogSidebar",attrs:{book:e.book,reader:e.reader,"should-show":e.catalog.shouldShow,"first-chapter":e.firstChapter,"is-all-catalog":e.catalog.isAllCatalog,eventid:"1_41",mpcomid:"31"},on:{hide:e.hideCatalogIfNeed,loadCatalog:e.loadCatalog,showChapter:e.handleCatalogSidebarShowChapter,cancelAutoPay:e.handleCatalogSidebarCancelAutoPay,sort:e.handleCatalogSidebarSort}}):e._e(),e._v(" "),e.tabBar.shouldShow?o("mini-lecture-player",{attrs:{mpcomid:"32"}}):e._e()],1)},staticRenderFns:[]},(function(e){o(1055)}),null,null).exports;new r.a(Xt).$mount()}},[[544,"common/manifest","common/vendor","common/components","common/apis","common/others"]]]);